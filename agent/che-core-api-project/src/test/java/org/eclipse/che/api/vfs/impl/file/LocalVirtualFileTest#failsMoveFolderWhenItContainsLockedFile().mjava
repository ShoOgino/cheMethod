    @Test
    public void failsMoveFolderWhenItContainsLockedFile() throws Exception {
        VirtualFile folder = getRoot().createFolder(generateFolderName());
        VirtualFile lockedFile = folder.createFile(generateFileName(), DEFAULT_CONTENT);
        lockedFile.lock(0);
        VirtualFile targetFolder = getRoot().createFolder(generateFolderName());
        Path movedFolderPath = targetFolder.getPath().newPath(folder.getName());

        try {
            folder.moveTo(targetFolder);
            thrown.expect(ForbiddenException.class);
        } catch (ForbiddenException e) {
            assertionHelper.assertThatIoFileDoesNotExist(movedFolderPath);

            assertionHelper.assertThatIoFileExists(folder.getPath());
            assertionHelper.assertThatIoFileExists(lockedFile.getPath());
            assertionHelper.assertThatLockIoFileExists(lockedFile.getPath());
        }
    }

