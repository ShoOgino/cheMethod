    @Test
    public void failsCopyFolderUnderNewNameWhenTargetFolderContainsItemWithSameNameAndOverwritingIsDisabled() throws Exception {
        VirtualFile folder = getRoot().createFolder(generateFolderName());
        VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);

        VirtualFile targetFolder = getRoot().createFolder(generateFolderName());
        VirtualFile conflictFolder = targetFolder.createFolder("new_name");

        try {
            folder.copyTo(targetFolder, "new_name", false);
            thrown.expect(ConflictException.class);
        } catch (ConflictException expected) {
            assertNull(getRoot().getChild(conflictFolder.getPath().newPath(file.getName())));
        }
    }

