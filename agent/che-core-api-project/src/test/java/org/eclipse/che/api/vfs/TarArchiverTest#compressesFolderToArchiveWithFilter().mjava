    @Test
    public void compressesFolderToArchiveWithFilter() throws Exception {
        VirtualFile folder = createFileTreeForArchiving();
        ByteArrayOutputStream compressedFolder = new ByteArrayOutputStream();
        Map<String, String> entries = getFileTreeAsList(folder).stream()
                                                               .filter(f -> f.isFolder() || f.getName().equals("_a.txt"))
                                                               .collect(toMap(f -> getTarEntryName(folder, f),
                                                                              this::readContentUnchecked));

        new TarArchiver(folder).compress(compressedFolder, f -> f.isFolder() || f.getName().equals("_a.txt"));
        assertThatTarArchiveContainsAllEntries(new ByteArrayInputStream(compressedFolder.toByteArray()), entries);
    }

