    @Test
    public void failsRenameFolderWhenParentContainsItemWithSameName() throws Exception {
        VirtualFile folder = getRoot().createFolder(generateFolderName());
        VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
        VirtualFile conflictFolder = getRoot().createFolder("new_name");

        try {
            folder.rename("new_name");
            thrown.expect(ConflictException.class);
        } catch (ConflictException expected) {
            assertionHelper.assertThatIoFileDoesNotExist(conflictFolder.getPath().newPath(file.getName()));

            assertionHelper.assertThatIoFileExists(folder.getPath());
            assertionHelper.assertThatIoFileHasContent(file.getPath(), DEFAULT_CONTENT_BYTES);
        }
    }

