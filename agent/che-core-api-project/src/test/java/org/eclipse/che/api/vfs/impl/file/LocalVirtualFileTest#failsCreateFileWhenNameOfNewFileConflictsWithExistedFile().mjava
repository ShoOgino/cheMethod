    @Test
    public void failsCreateFileWhenNameOfNewFileConflictsWithExistedFile() throws Exception {
        VirtualFile file = getRoot().createFile("file", DEFAULT_CONTENT);
        file.setProperty("property1", "value1");

        try {
            getRoot().createFile("file", "xxx");
            thrown.expect(ConflictException.class);
        } catch (ConflictException expected) {
            assertionHelper.assertThatIoFileHasContent(file.getPath(), DEFAULT_CONTENT_BYTES);
            assertionHelper.assertThatMetadataIoFileHasContent(file.getPath(),
                                                               serializeVirtualFileMetadata(ImmutableMap.of("property1", "value1")));
        }
    }

