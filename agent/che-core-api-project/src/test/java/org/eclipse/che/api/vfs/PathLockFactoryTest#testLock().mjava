    public void testLock() throws Exception {
        final AtomicBoolean acquired = new AtomicBoolean(false);
        final CountDownLatch waiter = new CountDownLatch(1);
        Thread t = new Thread() {
            @Override
            public void run() {
                try {
                    pathLockFactory.getLock(path, true).acquire();
                    acquired.set(true);
                } finally {
                    waiter.countDown();
                }
            }
        };
        t.start();
        waiter.await();
        assertTrue(acquired.get());
    }

