    @Test
    public void renamesLockedFileWithLockToken() throws Exception {
        VirtualFile folder = getRoot().createFolder(generateFolderName());
        VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
        Path filePath = file.getPath();
        String lockToken = file.lock(0);

        VirtualFile renamedFile = file.rename("new name", lockToken);

        assertionHelper.assertThatIoFileHasContent(renamedFile.getPath(), DEFAULT_CONTENT_BYTES);
        assertionHelper.assertThatLockIoFileDoesNotExist(renamedFile.getPath());
        assertionHelper.assertThatIoFileDoesNotExist(filePath);
        assertionHelper.assertThatLockIoFileDoesNotExist(filePath);
    }

