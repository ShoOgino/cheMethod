    @Test
    public void notifiesNotificationListenerWhenErrorOccurs() throws Exception {
        RuntimeException error = new RuntimeException();
        FileWatcherNotificationHandler notificationHandler = aNotificationHandler();
        doThrow(error).when(notificationHandler).handleFileWatcherEvent(eq(CREATED), eq(testDirectory), anyString(), anyBoolean());

        fileWatcher = new FileTreeWatcher(testDirectory, newHashSet(), notificationHandler);
        fileWatcher.startup();

        Thread.sleep(500);
        fileWatcherTestTree.createFile("");
        Thread.sleep(5000);

        verify(notificationHandler).errorOccurred(eq(testDirectory), eq(error));
    }

