    @Test
    public void watchesCreate() throws Exception {
        fileWatcherTestTree.createDirectory("", "watched");

        FileWatcherNotificationHandler notificationHandler = aNotificationHandler();
        fileWatcher = new FileTreeWatcher(testDirectory, newHashSet(), notificationHandler);
        fileWatcher.startup();

        Thread.sleep(500);

        Set<String> created = newHashSet(fileWatcherTestTree.createDirectory(""),
                                         fileWatcherTestTree.createFile(""),
                                         fileWatcherTestTree.createDirectory("watched"),
                                         fileWatcherTestTree.createFile("watched"));

        Thread.sleep(5000);

        verify(notificationHandler, never()).errorOccurred(eq(testDirectory), any(Throwable.class));
        verify(notificationHandler, never()).handleFileWatcherEvent(eq(DELETED), eq(testDirectory), anyString(), anyBoolean());
        verify(notificationHandler, never()).handleFileWatcherEvent(eq(MODIFIED), eq(testDirectory), anyString(), anyBoolean());

        ArgumentCaptor<String> createdEvents = ArgumentCaptor.forClass(String.class);
        verify(notificationHandler, times(4)).handleFileWatcherEvent(eq(CREATED), eq(testDirectory), createdEvents.capture(), anyBoolean());
        assertEquals(newHashSet(created), newHashSet(createdEvents.getAllValues()));
    }

