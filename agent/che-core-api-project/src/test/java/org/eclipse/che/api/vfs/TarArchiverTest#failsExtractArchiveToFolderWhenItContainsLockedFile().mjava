    @Test
    public void failsExtractArchiveToFolderWhenItContainsLockedFile() throws Exception {
        byte[] archive = createTestTarArchive();
        VirtualFile folder = vfsRoot.createFolder("folder");
        VirtualFile arc = folder.createFolder("arc");
        VirtualFile lockedFile = arc.createFolder("a").createFile("_a.txt", "xxx");
        lockedFile.lock(0);

        try {
            new TarArchiver(folder).extract(new ByteArrayInputStream(archive), true, 0);
            thrown.expect(ForbiddenException.class);
        } catch (ForbiddenException expected) {
            assertEquals("xxx", lockedFile.getContentAsString());
        }
    }

