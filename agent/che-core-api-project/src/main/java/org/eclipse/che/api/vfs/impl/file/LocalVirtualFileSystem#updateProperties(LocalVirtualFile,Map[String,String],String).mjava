    void updateProperties(LocalVirtualFile virtualFile, Map<String, String> updates, String lockToken)
            throws ForbiddenException, ServerException {
        if (virtualFile.isFile() && fileIsLockedAndLockTokenIsInvalid(virtualFile, lockToken)) {
            throw new ForbiddenException(
                    String.format("Unable update properties of item '%s'. Item is locked", virtualFile.getPath()));
        }
        final PathLockFactory.PathLock pathLock = pathLockFactory.getLock(virtualFile.getPath(), true).acquire(WAIT_FOR_FILE_LOCK_TIMEOUT);
        try {
            doUpdateProperties(virtualFile, updates);
        } finally {
            pathLock.release();
        }
    }

