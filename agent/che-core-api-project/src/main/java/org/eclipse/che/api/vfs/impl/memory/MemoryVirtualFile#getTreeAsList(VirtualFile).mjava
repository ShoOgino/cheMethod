    List<VirtualFile> getTreeAsList(VirtualFile folder) throws ServerException {
        List<VirtualFile> list = newArrayList();
        folder.accept(new VirtualFileVisitor() {
            @Override
            public void visit(VirtualFile virtualFile) throws ServerException {
                if (virtualFile.isFolder()) {
                    for (VirtualFile child : virtualFile.getChildren()) {
                        child.accept(this);
                    }
                }
                list.add(virtualFile);
            }
        });
        return list;
    }

