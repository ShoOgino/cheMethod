    void updateContent(LocalVirtualFile virtualFile, InputStream content, String lockToken)
            throws ForbiddenException, ServerException {
        if (virtualFile.isFile()) {
            if (fileIsLockedAndLockTokenIsInvalid(virtualFile, lockToken)) {
                throw new ForbiddenException(String.format("Unable update content of file '%s'. File is locked", virtualFile.getPath()));
            }
            final PathLockFactory.PathLock lock = pathLockFactory.getLock(virtualFile.getPath(), true).acquire(WAIT_FOR_FILE_LOCK_TIMEOUT);
            try {
                doUpdateContent(virtualFile, content);
            } finally {
                lock.release();
            }
            updateInSearcher(virtualFile);
        } else {
            throw new ForbiddenException(String.format("Unable update content. Item '%s' is not file", virtualFile.getPath()));
        }
    }

