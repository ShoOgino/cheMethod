    private static String[] normalizePathSegments(String[] parent, String[] relative) {
        List<String> segmentsList = new ArrayList<>(parent.length + relative.length);
        Collections.addAll(segmentsList, parent);
        for (String segment : relative) {
            if ("..".equals(segment)) {
                int size = segmentsList.size();
                if (size == 0) {
                    throw new IllegalArgumentException(String.format("Invalid path '%s', '..' on root. ", Joiner.on('/').join(relative)));
                }
                segmentsList.remove(size - 1);
            } else if (!(".".equals(segment))) {
                segmentsList.add(segment);
            }
        }
        if (segmentsList.isEmpty()) {
            return EMPTY_PATH;
        }
        return segmentsList.toArray(new String[segmentsList.size()]);
    }

