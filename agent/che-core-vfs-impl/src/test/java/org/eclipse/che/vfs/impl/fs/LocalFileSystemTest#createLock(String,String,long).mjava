    protected boolean createLock(String vfsPath, String lockToken, long timeout) throws IOException {
        java.io.File file = getIoFile(vfsPath);
        if (file.isFile()) {
            java.io.File locksDir = new java.io.File(file.getParentFile(), FSMountPoint.LOCKS_DIR);
            if (!(locksDir.exists() || locksDir.mkdirs())) {
                fail();
            }

            java.io.File lockFile = new java.io.File(locksDir, file.getName() + FSMountPoint.LOCK_FILE_SUFFIX);
            try (DataOutputStream dos = new DataOutputStream(new BufferedOutputStream(new FileOutputStream(lockFile)))) {
                lockSerializer.write(dos, new FileLock(lockToken, timeout));
            }
            return true;
        }
        // If not a file.
        return false;
    }

