    protected void compareStreams(InputStream in1, InputStream in2) throws IOException {
        int r;
        byte[] buf = new byte[1024];
        while ((r = in1.read(buf)) != -1) {
            byte[] bytes1 = Arrays.copyOf(buf, r);
            r = in2.read(buf);
            if (r == -1) {
                fail();
            }
            byte[] bytes2 = Arrays.copyOf(buf, r);
            compareBytes(bytes1, bytes2);
        }
    }

