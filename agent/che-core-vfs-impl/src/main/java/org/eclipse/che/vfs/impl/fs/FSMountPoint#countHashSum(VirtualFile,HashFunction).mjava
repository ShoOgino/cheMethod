    private String countHashSum(VirtualFile virtualFile, HashFunction hashFunction) throws ServerException {
        final PathLockFactory.PathLock lock = pathLockFactory.getLock(virtualFile.getVirtualFilePath(), false).acquire(LOCK_FILE_TIMEOUT);
        try (InputStream contentStream = virtualFile.getContent().getStream()) {
            return ByteSource.wrap(ByteStreams.toByteArray(contentStream)).hash(hashFunction).toString();
        } catch (ForbiddenException e) {
            throw new ServerException(e.getServiceError());
        } catch (IOException e) {
            throw new ServerException(e);
        } finally {
            lock.release();
        }
    }

