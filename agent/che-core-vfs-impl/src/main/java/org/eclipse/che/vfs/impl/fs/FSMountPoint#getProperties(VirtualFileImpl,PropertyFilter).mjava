    List<Property> getProperties(VirtualFileImpl virtualFile, PropertyFilter filter) {
        // Do not check permission here. We already check 'read' permission when get VirtualFile.
        final Map<String, String[]> metadata = getFileMetadata(virtualFile);
        final List<Property> result = new ArrayList<>(metadata.size());
        for (Map.Entry<String, String[]> e : metadata.entrySet()) {
            final String name = e.getKey();
            if (filter.accept(name)) {
                final Property property = DtoFactory.getInstance().createDto(Property.class).withName(name);
                if (e.getValue() != null) {
                    List<String> list = new ArrayList<>(e.getValue().length);
                    Collections.addAll(list, e.getValue());
                    property.setValue(list);
                }
                result.add(property);
            }
        }
        return result;
    }

