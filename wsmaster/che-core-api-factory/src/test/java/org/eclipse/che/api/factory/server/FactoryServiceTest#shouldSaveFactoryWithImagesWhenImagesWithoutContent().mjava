    @Test
    public void shouldSaveFactoryWithImagesWhenImagesWithoutContent() throws Exception {
        final Factory factory = createFactory();
        when(factoryManager.saveFactory(any(FactoryDto.class), anySetOf(FactoryImage.class))).thenReturn(factory);
        when(factoryManager.getById(FACTORY_ID)).thenReturn(factory);
        final FactoryDto factoryDto = asDto(factory, user);
        doReturn(factoryDto).when(factoryBuilderSpy).build(any(InputStream.class));

        final Response response = given().auth()
                                         .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
                                         .multiPart("factory", DTO.toJson(factoryDto), APPLICATION_JSON)
                                         .multiPart("image", File.createTempFile("img", ".jpeg"), "image/jpeg")
                                         .expect()
                                         .statusCode(200)
                                         .when()
                                         .post(SERVICE_PATH);
        final FactoryDto result = getFromResponse(response, FactoryDto.class);
        verify(factoryManager).saveFactory(any(FactoryDto.class), anySetOf(FactoryImage.class));
        factoryDto.withLinks(result.getLinks())
                  .getCreator()
                  .withCreated(result.getCreator().getCreated());
        assertEquals(result, factoryDto);
    }

