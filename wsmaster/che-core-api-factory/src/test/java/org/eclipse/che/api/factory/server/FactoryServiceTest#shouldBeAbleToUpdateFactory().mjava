    @Test
    public void shouldBeAbleToUpdateFactory() throws Exception {
        final Factory existed = createFactory();
        final Factory update = createFactoryWithStorage(null, "git", "https://github.com/codenvy/platform-api1.git");
        when(factoryManager.getById(FACTORY_ID)).thenReturn(existed);
        when(factoryManager.updateFactory(any())).thenReturn(update);

        final Response response = given().auth()
                                         .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
                                         .contentType(APPLICATION_JSON)
                                         .body(JsonHelper.toJson(asDto(existed, user)))
                                         .when()
                                         .expect()
                                         .statusCode(200)
                                         .put(SERVICE_PATH + "/" + FACTORY_ID);

        final FactoryDto result = getFromResponse(response, FactoryDto.class);
        verify(factoryManager, times(1)).updateFactory(any());
        assertEquals(result.withLinks(emptyList()), asDto(update, user));
    }

