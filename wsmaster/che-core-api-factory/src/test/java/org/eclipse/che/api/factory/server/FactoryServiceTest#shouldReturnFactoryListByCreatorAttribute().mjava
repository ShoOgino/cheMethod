  @Test
  public void shouldReturnFactoryListByCreatorAttribute() throws Exception {
    final FactoryImpl factory1 = createNamedFactory("factory1");
    final FactoryImpl factory2 = createNamedFactory("factory2");
    doReturn(new Page<>(ImmutableList.of(factory1, factory2), 0, 2, 2))
        .when(factoryManager)
        .getByAttribute(2, 0, ImmutableList.of(Pair.of("creator.userId", user.getName())));

    final Response response =
        given()
            .auth()
            .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
            .contentType(APPLICATION_JSON)
            .when()
            .expect()
            .statusCode(200)
            .get(SERVICE_PATH + "/find?maxItems=2&skipCount=0&creator.userId=" + user.getName());

    final Set<FactoryDto> res =
        unwrapDtoList(response, FactoryDto.class)
            .stream()
            .map(f -> f.withLinks(emptyList()))
            .collect(toSet());
    assertEquals(res.size(), 2);
    assertTrue(res.containsAll(ImmutableList.of(asDto(factory1, user), asDto(factory2, user))));
  }

