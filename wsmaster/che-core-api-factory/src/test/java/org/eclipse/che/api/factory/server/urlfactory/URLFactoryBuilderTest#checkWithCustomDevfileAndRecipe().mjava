  @Test
  public void checkWithCustomDevfileAndRecipe() throws Exception {

    DevfileImpl devfile = new DevfileImpl();
    WorkspaceConfigImpl workspaceConfigImpl = new WorkspaceConfigImpl();
    String myLocation = "http://foo-location/";
    RecipeImpl expectedRecipe =
        new RecipeImpl(KUBERNETES_COMPONENT_TYPE, "application/x-yaml", "content", "");
    EnvironmentImpl expectedEnv = new EnvironmentImpl(expectedRecipe, emptyMap());
    workspaceConfigImpl.setEnvironments(singletonMap("name", expectedEnv));
    workspaceConfigImpl.setDefaultEnv("name");

    when(urlFetcher.fetchSafely(anyString())).thenReturn("random_content");
    when(devfileManager.parse(anyString())).thenReturn(devfile);
    when(devfileManager.createWorkspaceConfig(any(DevfileImpl.class), any()))
        .thenReturn(workspaceConfigImpl);

    FactoryDto factory =
        urlFactoryBuilder
            .createFactoryFromDevfile(
                new DefaultFactoryUrl()
                    .withDevfileFileLocation(myLocation)
                    .withDevfileFilename("devfile.yml"),
                s -> myLocation + ".list")
            .get();

    WorkspaceConfigDto expectedWorkspaceConfig = asDto(workspaceConfigImpl);
    assertEquals(factory.getWorkspace(), expectedWorkspaceConfig);
    assertEquals(factory.getSource(), "devfile.yml");
  }

