  @Test
  public void shouldNotGenerateFactoryIfNoProjectsWithSourceStorage() throws Exception {
    // given
    final String wsId = "workspace123234";
    WorkspaceImpl.WorkspaceImplBuilder ws = WorkspaceImpl.builder();
    WorkspaceConfigImpl.WorkspaceConfigImplBuilder wsConfig = WorkspaceConfigImpl.builder();
    ws.setId(wsId);
    wsConfig.setProjects(
        Arrays.asList(
            DTO.createDto(ProjectConfigDto.class).withPath("/proj1"),
            DTO.createDto(ProjectConfigDto.class).withPath("/proj2")));
    wsConfig.setName("wsname");
    wsConfig.setEnvironments(singletonMap("env1", DTO.createDto(EnvironmentDto.class)));
    wsConfig.setDefaultEnv("env1");
    ws.setStatus(WorkspaceStatus.RUNNING);
    wsConfig.setCommands(
        singletonList(
            DTO.createDto(CommandDto.class)
                .withName("MCI")
                .withType("mvn")
                .withCommandLine("clean install")));
    ws.setConfig(wsConfig.build());

    WorkspaceImpl usersWorkspace = ws.build();
    when(workspaceManager.getWorkspace(eq(wsId))).thenReturn(usersWorkspace);

    // when
    Response response =
        given()
            .auth()
            .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
            .when()
            .get(SERVICE_PATH + "/workspace/" + wsId);

    // then
    assertEquals(response.getStatusCode(), BAD_REQUEST.getStatusCode());
  }

