    @Test
    public void shouldBeAbleToReturnMarkdownSnippetForFactory1WithImage(ITestContext context) throws Exception {
        // given
        SourceStorageDto storageDto = dto.createDto(SourceStorageDto.class)
                                  .withType("git")
                                  .withLocation("http://github.com/codenvy/platform-api.git");
        Factory factory = dto.createDto(Factory.class)
                             .withV("4.0")
                             .withWorkspace(dto.createDto(WorkspaceConfigDto.class)
                                               .withProjects(singletonList(dto.createDto(ProjectConfigDto.class)
                                                                              .withSource(storageDto))))
                             .withId(CORRECT_FACTORY_ID)
                             .withButton(dto.createDto(Button.class)
                                            .withType(Button.ButtonType.logo));
        String imageName = "1241234";
        FactoryImage image = new FactoryImage();
        image.setName(imageName);

        when(factoryStore.getFactory(CORRECT_FACTORY_ID)).thenReturn(factory);
        when(factoryStore.getFactoryImages(CORRECT_FACTORY_ID, null)).thenReturn(new HashSet<>(singletonList(image)));
        // when, then
        given().expect()
               .statusCode(200)
               .contentType(MediaType.TEXT_PLAIN)
               .body(
                       equalTo("[![alt](" + getServerUrl(context) + "/api/factory/" + CORRECT_FACTORY_ID + "/image?imgId=" +
                               imageName + ")](" +
                               getServerUrl(context) + "/factory?id=" +
                               CORRECT_FACTORY_ID + ")")
                    )
               .when()
               .get(SERVICE_PATH + "/" + CORRECT_FACTORY_ID + "/snippet?type=markdown");
    }

