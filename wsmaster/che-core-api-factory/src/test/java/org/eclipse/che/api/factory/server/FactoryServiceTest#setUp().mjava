  @BeforeMethod
  public void setUp() throws Exception {
    factoryBuilderSpy = spy(new FactoryBuilder(new SourceStorageParametersValidator()));
    factoryParametersResolvers = new HashSet<>();
    lenient().doNothing().when(factoryBuilderSpy).checkValid(any(FactoryDto.class));
    lenient().doNothing().when(factoryBuilderSpy).checkValid(any(FactoryDto.class), anyBoolean());
    when(factoryParametersResolverHolder.getFactoryParametersResolvers())
        .thenReturn(factoryParametersResolvers);
    user = new UserImpl(USER_ID, USER_EMAIL, ADMIN_USER_NAME);
    lenient().when(userManager.getById(anyString())).thenReturn(user);
    lenient()
        .when(preferenceManager.find(USER_ID))
        .thenReturn(ImmutableMap.of("preference", "value"));
    service =
        new FactoryService(
            factoryManager,
            userManager,
            preferenceManager,
            createValidator,
            acceptValidator,
            editValidator,
            factoryBuilderSpy,
            workspaceManager,
            factoryParametersResolverHolder);
  }

