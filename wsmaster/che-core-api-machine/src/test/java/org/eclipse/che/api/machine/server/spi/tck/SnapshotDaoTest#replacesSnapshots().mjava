    @Test(dependsOnMethods = "shouldFindSnapshotsByWorkspaceAndNamespace")
    public void replacesSnapshots() throws Exception {
        final SnapshotImpl newSnapshot = createSnapshot("new-snapshot",
                                                        snapshots[0].getWorkspaceId(),
                                                        snapshots[0].getEnvName(),
                                                        snapshots[0].getMachineName());

        final List<SnapshotImpl> replaced = snapshotDao.replaceSnapshots(newSnapshot.getWorkspaceId(),
                                                                         newSnapshot.getEnvName(),
                                                                         singletonList(newSnapshot));

        assertEquals(new HashSet<>(replaced), Sets.newHashSet(snapshots[0], snapshots[1]));
        assertEquals(new HashSet<>(snapshotDao.findSnapshots(snapshots[0].getWorkspaceId())),
                     Sets.newHashSet(newSnapshot, snapshots[2]));
    }

