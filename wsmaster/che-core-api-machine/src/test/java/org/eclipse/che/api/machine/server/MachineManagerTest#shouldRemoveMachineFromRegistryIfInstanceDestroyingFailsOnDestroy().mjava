    @Test
    public void shouldRemoveMachineFromRegistryIfInstanceDestroyingFailsOnDestroy() throws Exception {
        final MachineConfigImpl machineConfig = createMachineConfig();
        when(instance.getConfig()).thenReturn(machineConfig);
        when(instance.getWorkspaceId()).thenReturn(WS_ID);
        doThrow(new MachineException("test")).when(instance).destroy();

        try {
            manager.destroy(MACHINE_ID, false);
        } catch (Exception e) {
            verify(machineRegistry).remove(MACHINE_ID);
        }
    }

