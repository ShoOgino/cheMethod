    @BeforeMethod
    public void setUp() throws Exception {
        wsAgentLauncher = new WsAgentLauncherImpl(() -> machineManager,
                                                  requestFactory,
                                                  WS_AGENT_START_CMD_LINE,
                                                  WS_AGENT_MAX_START_TIME_MS,
                                                  WS_AGENT_PING_DELAY_MS,
                                                  WS_AGENT_PING_CONN_TIMEOUT_MS,
                                                  WS_AGENT_TIMED_OUT_MESSAGE);
        pingRequest = mock(HttpJsonRequest.class, new SelfReturningAnswer());
        when(machineManager.getDevMachine(WS_ID)).thenReturn(machine);
        when(machine.getId()).thenReturn(MACHINE_ID);
        when(machine.getRuntime()).thenReturn(machineRuntime);
        doReturn(Collections.<String, Server>singletonMap(WS_AGENT_PORT, SERVER)).when(machineRuntime).getServers();
        when(requestFactory.fromUrl(anyString())).thenReturn(pingRequest);
        when(pingRequest.request()).thenReturn(pingResponse);
        when(pingResponse.getResponseCode()).thenReturn(HttpURLConnection.HTTP_OK);
    }

