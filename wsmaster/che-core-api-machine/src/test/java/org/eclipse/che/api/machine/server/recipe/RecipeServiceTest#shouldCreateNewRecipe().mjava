  @Test
  public void shouldCreateNewRecipe() throws Exception {
    final NewRecipe newRecipe =
        newDto(NewRecipe.class)
            .withType("docker")
            .withName("name")
            .withScript("FROM ubuntu\n")
            .withTags(asList("java", "mongo"));

    final Response response =
        given()
            .auth()
            .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
            .contentType("application/json")
            .body(newRecipe)
            .when()
            .post(SECURE_PATH + "/recipe");

    assertEquals(response.getStatusCode(), 201);
    verify(recipeDao).create(any(RecipeImpl.class));
    final RecipeDescriptor descriptor = unwrapDto(response, RecipeDescriptor.class);
    assertNotNull(descriptor.getId());
    assertEquals(descriptor.getName(), newRecipe.getName());
    assertEquals(descriptor.getCreator(), USER_ID);
    assertEquals(descriptor.getScript(), newRecipe.getScript());
    assertEquals(descriptor.getTags(), newRecipe.getTags());
  }

