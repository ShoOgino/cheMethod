    /**
     * Header name is case insensitive in accordance to spec. So we can't compare arrays via equals method.
     *
     * @param actual
     *         map of actual headers
     * @param expected
     *         map of expected headers
     */
    private void assertEqualsHeaders(Map<String, List<String>> actual, Map<String, List<String>> expected) {
        assertEquals(actual.size(), expected.size());

        final Set<String> expectedHeadersKeys = expected.keySet();

        for (Map.Entry<String, List<String>> actualHeader : actual.entrySet()) {
            List<String> expectedHeaderValues = null;
            if (expectedHeadersKeys.contains(actualHeader.getKey())) {
                expectedHeaderValues = expected.get(actualHeader.getKey());
            } else {
                for (String expectedHeaderKey : expectedHeadersKeys) {
                    if (expectedHeaderKey.equalsIgnoreCase(actualHeader.getKey())) {
                        expectedHeaderValues = expected.get(expectedHeaderKey);
                        break;
                    }
                }
            }
            if (expectedHeaderValues != null) {
                assertEquals(actualHeader.getValue(), expectedHeaderValues);
            } else {
                fail("Expected headers don't contain header:" + actualHeader.getKey());
            }
        }
    }

