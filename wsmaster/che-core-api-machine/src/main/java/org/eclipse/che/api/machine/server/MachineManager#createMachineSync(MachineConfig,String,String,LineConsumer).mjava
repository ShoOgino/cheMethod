    /**
     * Synchronously creates and starts machine from scratch.
     *
     * @param machineConfig
     *         configuration that contains all information needed for machine creation
     * @param workspaceId
     *         id of the workspace the created machine will belong to
     * @param environmentName
     *         environment name the created machine will belongs to
     * @param outputConsumer
     *         output consumer of machine
     * @return new machine
     * @throws NotFoundException
     *         if machine type from recipe is unsupported
     * @throws NotFoundException
     *         if snapshot not found
     * @throws NotFoundException
     *         if no instance provider implementation found for provided machine type
     * @throws SnapshotException
     *         if error occurs on retrieving snapshot information
     * @throws ConflictException
     *         if machine with given name already exists
     * @throws BadRequestException
     *         if machine display name is invalid
     * @throws MachineException
     *         if any other exception occurs during starting
     */
    public MachineImpl createMachineSync(MachineConfig machineConfig,
                                         final String workspaceId,
                                         final String environmentName,
                                         LineConsumer outputConsumer)
            throws NotFoundException,
                   SnapshotException,
                   ConflictException,
                   MachineException,
                   BadRequestException {
        LOG.info("Creating machine [ws = {}: env = {}: machine = {}]",
                 workspaceId,
                 environmentName,
                 machineConfig.getName());
        final MachineImpl machine = createMachine(normalizeMachineConfig(machineConfig),
                                                  workspaceId,
                                                  environmentName,
                                                  this::createInstance,
                                                  null,
                                                  outputConsumer);
        LOG.info("Machine [ws = {}: env = {}: machine = {}] was successfully created, its id is '{}'",
                 workspaceId,
                 environmentName,
                 machine.getConfig().getName(),
                 machine.getId());

        return machineRegistry.getMachine(machine.getId());
    }

