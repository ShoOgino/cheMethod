    private HttpURLConnection prepareProxyConnection(HttpServletRequest req) throws NotFoundException, ServerException {
        String extensionApiUrl = getExtensionApiUrl(req);
        try {
            final HttpURLConnection conn = (HttpURLConnection)new URL(extensionApiUrl).openConnection();

            conn.setRequestMethod(req.getMethod());

            setHeaders(conn, req);

            if ("POST".equals(req.getMethod()) || "PUT".equals(req.getMethod()) || "DELETE".equals(req.getMethod())) {
                if (req.getInputStream() != null) {
                    conn.setDoOutput(true);

                    try (InputStream is = req.getInputStream();
                         OutputStream os = conn.getOutputStream()) {
                        ByteStreams.copy(is, os);
                    }
                }
            }

            return conn;
        } catch (IOException e) {
            LOG.error(e.getLocalizedMessage(), e);
            throw new ServerException(e.getLocalizedMessage());
        }
    }

