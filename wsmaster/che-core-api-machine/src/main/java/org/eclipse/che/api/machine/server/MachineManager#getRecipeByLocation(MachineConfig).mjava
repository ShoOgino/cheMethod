    Recipe getRecipeByLocation(MachineConfig machineConfig) throws MachineException {
        String recipeContent;
        URL recipeUrl = null;
        File file = null;
        try {
            UriBuilder targetUriBuilder = UriBuilder.fromUri(machineConfig.getSource().getLocation());
            // add user token to be able to download user's private recipe
            if (machineConfig.getSource().getLocation().startsWith(apiEndpoint)) {
                if (EnvironmentContext.getCurrent().getUser() != null
                    && EnvironmentContext.getCurrent().getUser().getToken() != null) {
                    targetUriBuilder.queryParam("token", EnvironmentContext.getCurrent().getUser().getToken());
                }
            }
            recipeUrl = targetUriBuilder.build().toURL();
            file = IoUtil.downloadFile(null, "recipe", null, recipeUrl);
            recipeContent = IoUtil.readAndCloseQuietly(new FileInputStream(file));
        } catch (IOException | IllegalArgumentException e) {
            throw new MachineException("Can't start machine " + machineConfig.getName() +
                                       ". Machine recipe downloading failed. Recipe url " + recipeUrl + ". "
                                       + e.getLocalizedMessage());
        } finally {
            if (file != null) {
                FileCleaner.addFile(file);
            }
        }

        return new RecipeImpl().withType("Dockerfile").withScript(recipeContent);
    }

