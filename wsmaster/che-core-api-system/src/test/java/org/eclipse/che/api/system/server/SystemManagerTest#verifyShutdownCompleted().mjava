  private void verifyShutdownCompleted() throws InterruptedException {
    verify(terminator, timeout(2000)).terminateAll();
    verify(eventService, times(2)).publish(eventsCaptor.capture());
    Iterator<SystemStatusChangedEvent> eventsIt = eventsCaptor.getAllValues().iterator();
    assertEquals(eventsIt.next(), new SystemStatusChangedEvent(RUNNING, PREPARING_TO_SHUTDOWN));
    assertEquals(
        eventsIt.next(), new SystemStatusChangedEvent(PREPARING_TO_SHUTDOWN, READY_TO_SHUTDOWN));
  }

