  @Test
  public void shouldBeAbleToGetUserToken() throws Exception {
    String provider = "myprovider";
    String token = "token123";
    OAuthAuthenticator authenticator = mock(OAuthAuthenticator.class);
    when(providers.getAuthenticator(eq(provider))).thenReturn(authenticator);
    when(authenticator.getToken(anyString())).thenReturn(newDto(OAuthToken.class).withToken(token));

    final Response response =
        given()
            .auth()
            .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
            .contentType("application/json")
            .when()
            .queryParam("oauth_provider", provider)
            .get(SECURE_PATH + "/oauth/token");

    assertEquals(response.getStatusCode(), 200);
    assertEquals(
        DtoFactory.getInstance()
            .createDtoFromJson(response.getBody().asInputStream(), OAuthToken.class)
            .getToken(),
        token);
  }

