    /**
     * Convenient method to rewrite incoming external servers in a loop
     * @param incoming servers
     * @return rewritten Map of Servers (name -> Server)
     */
    private Map<String, Server> rewriteExternalServers(Map<String, ? extends Server> incoming) {
        Map<String, Server> outgoing = new HashMap<>();
        RuntimeIdentity identity = context.getIdentity();
        for (Map.Entry<String, ? extends Server> entry : incoming.entrySet()) {
            String name = entry.getKey();
            Server incomingServer = entry.getValue();
            try {
                URL url = new URL(incomingServer.getUrl());
                ServerImpl server = new ServerImpl(urlRewriter.rewriteURL(identity, name, url).toString(),
                                                   incomingServer.getStatus());
                outgoing.put(name, server);
            } catch (MalformedURLException e) {
                warnings.add(new Warning() {
                    @Override
                    public int getCode() {
                        return 101;
                    }

                    @Override
                    public String getMessage() {
                        return "Malformed URL for " + name + " : " + e.getMessage();
                    }
                });
            }
        }

        return outgoing;
    }

