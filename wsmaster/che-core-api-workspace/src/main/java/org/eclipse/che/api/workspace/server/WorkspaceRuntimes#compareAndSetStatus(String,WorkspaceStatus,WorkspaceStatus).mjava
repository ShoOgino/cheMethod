    /**
     * Safely compares current status of given workspace
     * with {@code from} and if they are equal sets the status to {@code to}.
     * Returns true if the status of workspace was updated with {@code to} value.
     */
    private boolean compareAndSetStatus(String id, WorkspaceStatus from, WorkspaceStatus to) throws ServerException {
        try (@SuppressWarnings("unused") Unlocker u = locks.writeLock(id)) {
            checkIsNotTerminated(format("change status from '%s' to '%s' for the workspace '%s'", from, to, id));
            RuntimeState state = states.get(id);
            if (state != null && state.status == from) {
                state.status = to;
                return true;
            }
        }
        return false;
    }

