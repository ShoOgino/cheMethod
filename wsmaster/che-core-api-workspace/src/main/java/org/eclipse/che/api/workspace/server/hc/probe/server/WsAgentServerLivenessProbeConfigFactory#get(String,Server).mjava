  @Override
  public HttpProbeConfig get(String workspaceId, Server server)
      throws InternalInfrastructureException {

    try {
      // add trailing slash
      URI uri = UriBuilder.fromUri(server.getUrl()).path("/").build();

      return new HttpProbeConfig(
          uri.getPort() == -1 ? 80 : uri.getPort(),
          uri.getHost(),
          uri.getScheme(),
          uri.getPath(),
          singletonMap(HttpHeaders.AUTHORIZATION, machineTokenProvider.getToken(workspaceId)),
          1,
          3,
          120,
          10,
          10);
    } catch (MachineTokenException e) {
      throw new InternalInfrastructureException(
          "Failed to retrieve workspace token for ws-agent server liveness probe. Error: "
              + e.getMessage());
    } catch (UriBuilderException e) {
      throw new InternalInfrastructureException(
          "Wsagent server liveness probe url is invalid. Error: " + e.getMessage());
    }
  }

