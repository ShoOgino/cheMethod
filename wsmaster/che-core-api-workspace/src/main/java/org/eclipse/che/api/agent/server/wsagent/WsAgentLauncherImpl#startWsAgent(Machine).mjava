    @Override
    public void startWsAgent(Machine devMachine) throws NotFoundException,
                                                        ServerException {
        final HttpJsonRequest wsAgentPingRequest = createPingRequest(devMachine);
        final String wsAgentPingUrl = wsAgentPingRequest.getUrl();
        try {
            machineProcessManagerProvider.get().exec(devMachine.getWorkspaceId(),
                                                     devMachine.getId(),
                                                     new CommandImpl(WS_AGENT_PROCESS_NAME,
                                                                     wsAgentStartCommandLine,
                                                                     "Arbitrary"),
                                                     getWsAgentProcessOutputChannel(devMachine.getWorkspaceId()));
            final long pingStartTimestamp = System.currentTimeMillis();
            LOG.debug("Starts pinging ws agent. Workspace ID:{}. Url:{}. Timestamp:{}",
                      devMachine.getWorkspaceId(),
                      wsAgentPingUrl,
                      pingStartTimestamp);

            while (System.currentTimeMillis() - pingStartTimestamp < wsAgentMaxStartTimeMs) {
                if (pingWsAgent(wsAgentPingRequest)) {
                    return;
                } else {
                    Thread.sleep(wsAgentPingDelayMs);
                }
            }
        } catch (BadRequestException wsAgentLaunchingExc) {
            throw new ServerException(wsAgentLaunchingExc.getLocalizedMessage(), wsAgentLaunchingExc);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new ServerException("Ws agent pinging is interrupted");
        }
        LOG.error("Fail pinging ws agent. Workspace ID:{}. Url:{}. Timestamp:{}", devMachine.getWorkspaceId(), wsAgentPingUrl);
        throw new ServerException(pingTimedOutErrorMessage);
    }

