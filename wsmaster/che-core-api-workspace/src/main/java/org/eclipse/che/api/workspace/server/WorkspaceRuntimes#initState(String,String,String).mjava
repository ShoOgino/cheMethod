    /**
     * Initializes workspace in {@link WorkspaceStatus#STARTING} status,
     * saves the state or throws an appropriate exception if the workspace is already initialized.
     */
    private void initState(String workspaceId, String workspaceName, String envName) throws ConflictException, ServerException {
        try (StripedLocks.WriteLock ignored = stripedLocks.acquireWriteLock(workspaceId)) {
            ensurePreDestroyIsNotExecuted();
            final WorkspaceState state = workspaces.get(workspaceId);
            if (state != null) {
                throw new ConflictException(format("Could not start workspace '%s' because its status is '%s'",
                                                   workspaceName,
                                                   state.status));
            }
            workspaces.put(workspaceId, new WorkspaceState(WorkspaceStatus.STARTING, envName));
        }
    }

