    /**
     * Stops workspace destroying all its machines and removing it from in memory storage.
     */
    private void stopMachines(RuntimeWorkspaceImpl workspace) throws NotFoundException, ServerException {
        final List<MachineImpl> machines = new ArrayList<>(workspace.getMachines());
        // destroying all non-dev machines
        for (MachineImpl machine : machines) {
            if (machine.getConfig().isDev()) {
                continue;
            }
            try {
                machineManager.destroy(machine.getId(), false);
            } catch (NotFoundException | MachineException ex) {
                LOG.error(format("Could not destroy machine '%s' of workspace '%s'",
                                 machine.getId(),
                                 machine.getWorkspaceId()),
                          ex);
            }
        }
        // destroying dev-machine
        try {
            machineManager.destroy(workspace.getDevMachine().getId(), false);
        } finally {
            doRemoveWorkspace(workspace.getId());
        }
    }

