    @Override
    public InputStream adapt(InputStream entityStream) throws WebApplicationException, IOException {
        try (Reader r = new InputStreamReader(entityStream)) {
            return new ByteArrayInputStream(adapt(CharStreams.toString(r)).getBytes(defaultCharset()));
        } catch (IllegalArgumentException x) {
            throw new WebApplicationException(x.getMessage(), x, BAD_REQUEST);
        } catch (RuntimeException x) {
            throw new WebApplicationException(x.getMessage(), x, INTERNAL_SERVER_ERROR);
        }
    }

