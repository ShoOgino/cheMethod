  private void addAgentsProvidedServers(MachineImpl machine, List<String> agentKeys)
      throws ServerException {
    for (String agentKey : agentKeys) {
      try {
        AgentImpl agent = new AgentImpl(agentRegistry.getAgent(AgentKeyImpl.parse(agentKey)));
        for (Map.Entry<String, ? extends ServerConf2> entry : agent.getServers().entrySet()) {
          String ref = entry.getKey();
          ServerConf2 conf2 = entry.getValue();

          ServerConfImpl conf =
              new ServerConfImpl(
                  ref, conf2.getPort(), conf2.getProtocol(), conf2.getProperties().get("path"));
          machine.getConfig().getServers().add(conf);
        }
      } catch (AgentException e) {
        throw new ServerException(e);
      }
    }
  }

