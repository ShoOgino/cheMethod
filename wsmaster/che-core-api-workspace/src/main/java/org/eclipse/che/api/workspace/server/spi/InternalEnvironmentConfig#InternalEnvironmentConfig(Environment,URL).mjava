    public InternalEnvironmentConfig(Environment environment, URL registryEndpoint) throws ApiException, IOException {

        this.recipe = new InternalRecipeConfig(environment.getRecipe());

        Map<String, ? extends MachineConfig> effectiveMachines = environment.getMachines();

//        if(effectiveMachines.isEmpty())
//            effectiveMachines = analyzeRecipe(recipe.getScript());

        for(Map.Entry<String, ? extends MachineConfig> entry : effectiveMachines.entrySet()) {
            internalMachines.put(entry.getKey(), new InternalMachineConfig(entry.getValue(), registryEndpoint));
        }
    }

