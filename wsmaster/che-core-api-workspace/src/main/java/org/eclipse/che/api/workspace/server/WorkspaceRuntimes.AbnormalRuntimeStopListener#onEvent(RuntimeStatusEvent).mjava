    @Override
    public void onEvent(RuntimeStatusEvent event) {
      if (event.isFailed()) {
        String workspaceId = event.getIdentity().getWorkspaceId();
        // Cancels workspace servers probes if any
        probeScheduler.cancel(workspaceId);
        final WorkspaceStatus status;
        try (Unlocker ignored = lockService.writeLock(workspaceId)) {
          runtimes.remove(workspaceId);
          status = statuses.remove(workspaceId);
        }
        if (status != null) {
          publishWorkspaceStatusEvent(
              workspaceId,
              STOPPED,
              RUNNING,
              "Error occurs on workspace runtime stop. Error: " + event.getError());
          setAbnormalStopAttributes(workspaceId, event.getError());
        }
      }
    }

