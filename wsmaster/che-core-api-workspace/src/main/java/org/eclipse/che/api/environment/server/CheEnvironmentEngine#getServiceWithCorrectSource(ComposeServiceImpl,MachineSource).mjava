    private ComposeServiceImpl getServiceWithCorrectSource(ComposeServiceImpl composeService, MachineSource machineSource)
            throws ServerException {
        ComposeServiceImpl serviceWithCorrectSource = composeService;
        if (machineSource != null) {
            serviceWithCorrectSource = new ComposeServiceImpl(composeService);
            if ("image".equals(machineSource.getType())) {
                serviceWithCorrectSource.setBuild(null);
                serviceWithCorrectSource.setImage(machineSource.getLocation());
            } else {
                // dockerfile
                if (machineSource.getContent() != null) {
                    throw new ServerException(
                            "Additional machine creation from dockerfile content is not supported anymore. " +
                            "Please use dockerfile location instead");
                } else {
                    serviceWithCorrectSource.setBuild(new BuildContextImpl(machineSource.getLocation(), null));
                    serviceWithCorrectSource.setImage(null);
                }
            }
        }
        return serviceWithCorrectSource;
    }

