    private void applyAgents(Environment env, ComposeEnvironmentImpl composeEnvironment) throws ServerException {
        for (Map.Entry<String, ComposeServiceImpl> entry : composeEnvironment.getServices().entrySet()) {
            String machineName = entry.getKey();
            ComposeServiceImpl composeService = entry.getValue();

            List<String> agents = env.getMachines().get(machineName).getAgents();

            try {
                agentConfigApplier.modify(composeService, agents);
            } catch (AgentException e) {
                throw new ServerException("Can't apply agent config", e);
            }
        }
    }

