  /**
   * Removes all snapshots of workspace machines, continues to remove snapshots even when removal of
   * some of them fails.
   *
   * <p>Note that snapshots binaries are removed asynchronously while metadata removal is
   * synchronous operation.
   *
   * @param workspaceId workspace id to remove machine snapshots
   * @throws NotFoundException when workspace with given id doesn't exists
   * @throws ServerException when any other error occurs
   */
  public void removeSnapshots(String workspaceId) throws NotFoundException, ServerException {
    List<SnapshotImpl> snapshots = getSnapshot(workspaceId);
    List<SnapshotImpl> removed = new ArrayList<>(snapshots.size());
    for (SnapshotImpl snapshot : snapshots) {
      try {
        snapshotDao.removeSnapshot(snapshot.getId());
        removed.add(snapshot);
      } catch (Exception x) {
        LOG.error(
            format(
                "Couldn't remove snapshot '%s' meta data, " + "binaries won't be removed either",
                snapshot.getId()),
            x);
      }
    }
    // binaries removal may take some time, do it asynchronously
    sharedPool.execute(() -> runtimes.removeBinaries(removed));
  }

