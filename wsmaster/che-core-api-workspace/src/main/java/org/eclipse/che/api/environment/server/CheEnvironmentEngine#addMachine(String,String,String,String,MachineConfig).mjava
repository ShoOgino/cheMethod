    private void addMachine(String workspaceId,
                            String machineId,
                            String envName,
                            String creator,
                            MachineConfig machineConfig) throws ServerException {
        Instance machine = new NoOpMachineInstance(MachineImpl.builder()
                                                              .setConfig(machineConfig)
                                                              .setId(machineId)
                                                              .setWorkspaceId(workspaceId)
                                                              .setStatus(MachineStatus.CREATING)
                                                              .setEnvName(envName)
                                                              .setOwner(creator)
                                                              .build());
        try (StripedLocks.WriteLock lock = stripedLocks.acquireWriteLock(workspaceId)) {
            ensurePreDestroyIsNotExecuted();
            EnvironmentHolder environmentHolder = environments.get(workspaceId);
            if (environmentHolder != null && environmentHolder.status != EnvStatus.STOPPING) {
                environmentHolder.machines.add(machine);
            } else {
                throw new ServerException(
                        format("Can't add machine into environment. Environment of workspace '%s' is missing",
                               workspaceId));
            }
        }
    }

