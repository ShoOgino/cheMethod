  private CheServiceImpl machineConfigToService(MachineConfig machineConfig)
      throws ServerException {
    CheServiceImpl service = new CheServiceImpl();
    service.setMemLimit(machineConfig.getLimits().getRam() * 1024L * 1024L);
    service.setEnvironment(machineConfig.getEnvVariables());
    if ("image".equals(machineConfig.getSource().getType())) {
      service.setImage(machineConfig.getSource().getLocation());
    } else {
      if (machineConfig.getSource().getContent() != null) {
        throw new ServerException(
            "Additional machine creation from dockerfile content is not supported anymore. "
                + "Please use dockerfile location instead");
      } else {
        service.setBuild(
            new CheServiceBuildContextImpl(
                machineConfig.getSource().getLocation(), null, null, null));
      }
    }
    List<? extends ServerConf> servers = machineConfig.getServers();
    if (servers != null) {
      List<String> expose = new ArrayList<>();
      for (ServerConf server : servers) {
        expose.add(server.getPort());
      }
      service.setExpose(expose);
    }

    return service;
  }

