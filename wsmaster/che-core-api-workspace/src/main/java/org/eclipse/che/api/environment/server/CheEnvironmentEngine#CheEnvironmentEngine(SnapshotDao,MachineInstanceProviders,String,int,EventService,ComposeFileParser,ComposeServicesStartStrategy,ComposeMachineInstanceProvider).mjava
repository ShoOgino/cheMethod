    @Inject
    public CheEnvironmentEngine(SnapshotDao snapshotDao,
                                MachineInstanceProviders machineInstanceProviders,
                                @Named("machine.logs.location") String machineLogsDir,
                                @Named("machine.default_mem_size_mb") int defaultMachineMemorySizeMB,
                                EventService eventService,
                                ComposeFileParser composeFileParser,
                                ComposeServicesStartStrategy startStrategy,
                                ComposeMachineInstanceProvider composeProvider) {
        this.snapshotDao = snapshotDao;
        this.eventService = eventService;
        this.composeFileParser = composeFileParser;
        this.startStrategy = startStrategy;
        this.composeProvider = composeProvider;
        this.environments = new ConcurrentHashMap<>();
        this.machineInstanceProviders = machineInstanceProviders;
        this.machineLogsDir = new File(machineLogsDir);
        this.defaultMachineMemorySizeMB = defaultMachineMemorySizeMB + "MB";
        // 16 - experimental value for stripes count, it comes from default hash map size
        this.stripedLocks = new StripedLocks(16);
        eventService.subscribe(new MachineCleaner());
    }

