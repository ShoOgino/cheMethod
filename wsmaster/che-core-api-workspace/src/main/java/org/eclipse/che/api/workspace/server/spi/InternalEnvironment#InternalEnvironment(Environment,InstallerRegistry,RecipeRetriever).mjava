  InternalEnvironment(
      Environment environment, InstallerRegistry registry, RecipeRetriever recipeRetriever)
      throws InfrastructureException {
    this.registry = registry;
    this.machines = new HashMap<>();
    this.warnings = new ArrayList<>();
    this.recipe = getInternalRecipe(environment, recipeRetriever);

    for (Map.Entry<String, ? extends MachineConfig> entry : environment.getMachines().entrySet()) {
      machines.put(entry.getKey(), new InternalMachineConfig(entry.getValue(), registry));
    }
  }

