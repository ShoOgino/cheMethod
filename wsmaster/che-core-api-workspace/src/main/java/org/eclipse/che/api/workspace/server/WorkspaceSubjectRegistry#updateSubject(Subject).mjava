  /*
   * If some workspaces have been started by the userId contained
   * in this <code>Subject</code>, then the subject (with
   * the userName and token) is updated in the workspace-to-subject
   * cache for all these workspaces.
   */
  public void updateSubject(Subject subject) {
    String token = subject != null ? subject.getToken() : null;
    if (token != null && token.startsWith("machine")) {
      // We are not interested in machine tokens here, but in
      // having the up-to-date token used by the user to connect
      // to the front-end application and create the workspace
      return;
    }
    lock.readLock().lock();
    try {
      String userId = subject.getUserId();
      for (String workspaceId : userIdToWorkspaces.get(userId)) {
        workspaceOwners.put(workspaceId, subject);
      }
    } finally {
      lock.readLock().unlock();
    }
  }

