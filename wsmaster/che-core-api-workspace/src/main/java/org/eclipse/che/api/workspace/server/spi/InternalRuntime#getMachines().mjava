    @Override
    public Map<String, ? extends Machine> getMachines() {

        if(cachedExternalMachines == null) {
            cachedExternalMachines = new HashMap<>();
            for(Map.Entry<String, ? extends Machine> entry : getInternalMachines().entrySet()) {
                String key = entry.getKey();
                Machine machine = entry.getValue();
                ServerRewritingStrategy.Result result = serverRewritingStrategy.rewrite(context.getIdentity(), entry.getValue().getServers());
                Map<String, Server> newServers = result.getServers();
                MachineImpl newMachine = new MachineImpl(machine.getProperties(), newServers);
                cachedExternalMachines.put(key, newMachine);
                if(!result.getWarnings().isEmpty()) {
                    warnings.addAll(result.getWarnings());
                }
            }

        }
        return cachedExternalMachines;

    }

