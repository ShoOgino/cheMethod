    @Override
    public Map<String, ? extends Machine> getMachines() {

        if (cachedExternalMachines == null) {
            cachedExternalMachines = new HashMap<>();
            // should not be null, replace with empty map in this case
            Map<String, ? extends Machine> internalMachines = getInternalMachines() == null ? new HashMap<>() : getInternalMachines();
            for (Map.Entry<String, ? extends Machine> entry : internalMachines.entrySet()) {
                String key = entry.getKey();
                Machine machine = entry.getValue();
                Map<String, Server> newServers = rewriteExternalServers(machine.getServers());
                MachineImpl newMachine = new MachineImpl(machine.getProperties(), newServers);
                cachedExternalMachines.put(key, newMachine);
            }

        }
        return cachedExternalMachines;
    }

