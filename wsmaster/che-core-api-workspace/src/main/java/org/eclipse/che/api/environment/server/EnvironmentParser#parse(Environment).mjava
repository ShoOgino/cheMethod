    /**
     * Parses {@link Environment} into {@link CheServicesEnvironmentImpl}.
     *
     * @param environment
     *         environment to parse
     * @return environment representation as compose environment
     * @throws IllegalArgumentException
     *         if provided environment is illegal
     * @throws ServerException
     *         if fetching of environment recipe content fails
     */
    public CheServicesEnvironmentImpl parse(Environment environment) throws IllegalArgumentException,
                                                                            ServerException {

        checkNotNull(environment, "Environment should not be null");
        checkNotNull(environment.getRecipe(), "Environment recipe should not be null");
        checkNotNull(environment.getRecipe().getType(), "Environment recipe type should not be null");
        checkArgument(environment.getRecipe().getContent() != null || environment.getRecipe().getLocation() != null,
                      "Recipe of environment must contain location or content");

        CheServicesEnvironmentImpl cheServicesEnvironment;
        String envType = environment.getRecipe().getType();
        switch (envType) {
            case "compose":
                cheServicesEnvironment = parseCompose(environment.getRecipe());
                break;
            case "dockerimage":
            case "dockerfile":
                cheServicesEnvironment = parseDocker(environment);
                break;
            default:
                throw new IllegalArgumentException(format("Environment type '%s' is not supported. " +
                                                          "Supported environment types: %s",
                                                          envType,
                                                          Joiner.on(", ").join(types)));
        }

        cheServicesEnvironment.getServices().forEach((name, service) -> {
            ExtendedMachine extendedMachine = environment.getMachines().get(name);
            if (extendedMachine != null) {
                normalizeMachine(name, service, extendedMachine);
            }
        });

        return cheServicesEnvironment;
    }

