  private CheServiceImpl normalizeServiceSource(CheServiceImpl service, MachineSource machineSource)
      throws ServerException {
    CheServiceImpl serviceWithNormalizedSource = service;
    if (machineSource != null) {
      serviceWithNormalizedSource = new CheServiceImpl(service);
      if ("image".equals(machineSource.getType())) {
        serviceWithNormalizedSource.setBuild(null);
        serviceWithNormalizedSource.setImage(machineSource.getLocation());
      } else {
        // dockerfile
        serviceWithNormalizedSource.setImage(null);
        if (machineSource.getContent() != null) {
          serviceWithNormalizedSource.setBuild(
              new CheServiceBuildContextImpl(null, null, machineSource.getContent(), null));
        } else {
          serviceWithNormalizedSource.setBuild(
              new CheServiceBuildContextImpl(machineSource.getLocation(), null, null, null));
        }
      }
    }
    return serviceWithNormalizedSource;
  }

