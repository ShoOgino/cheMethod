    @Inject
    public CheEnvironmentEngine(SnapshotDao snapshotDao,
                                MachineInstanceProviders machineInstanceProviders,
                                @Named("che.workspace.logs") String machineLogsDir,
                                @Named("che.workspace.default_memory_mb") int defaultMachineMemorySizeMB,
                                EventService eventService,
                                EnvironmentParser environmentParser,
                                DefaultServicesStartStrategy startStrategy,
                                MachineInstanceProvider machineProvider,
                                InfrastructureProvisioner infrastructureProvisioner,
                                @Named("che.api") String apiEndpoint,
                                RecipeDownloader recipeDownloader,
                                ContainerNameGenerator containerNameGenerator,
                                AgentRegistry agentRegistry,
                                WorkspaceSharedPool sharedPool) {
        this.snapshotDao = snapshotDao;
        this.eventService = eventService;
        this.environmentParser = environmentParser;
        this.startStrategy = startStrategy;
        this.machineProvider = machineProvider;
        this.infrastructureProvisioner = infrastructureProvisioner;
        this.recipeDownloader = recipeDownloader;
        this.agentRegistry = agentRegistry;
        this.sharedPool = sharedPool;
        this.environments = new ConcurrentHashMap<>();
        this.machineInstanceProviders = machineInstanceProviders;
        this.machineLogsDir = new File(machineLogsDir);
        this.defaultMachineMemorySizeBytes = Size.parseSize(defaultMachineMemorySizeMB + "MB");
        // 16 - experimental value for stripes count, it comes from default hash map size
        this.stripedLocks = new StripedLocks(16);
        this.recipeApiPattern = Pattern.compile("(^https?" +
                                                apiEndpoint.substring(apiEndpoint.indexOf(":")) +
                                                "/recipe/.*$)|(^/recipe/.*$)");
        this.containerNameGenerator = containerNameGenerator;
    }

