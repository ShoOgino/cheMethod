    /**
     * Shuts down workspace service and waits for it to finish, so currently
     * starting and running workspaces are stopped and it becomes unavailable to start new workspaces.
     *
     * @throws InterruptedException
     *         if it's interrupted while waiting for running workspaces to stop
     * @throws IllegalStateException
     *         if component shutdown is already called
     */
    public void shutdown() throws InterruptedException {
        if (!runtimes.refuseWorkspacesStart()) {
            throw new IllegalStateException("Workspace service shutdown has been already called");
        }
        LOG.info("Shutting down workspace service");
        stopRunningWorkspacesNormally();
        runtimes.shutdown();
        sharedPool.shutdown();
        LOG.info("Workspace service stopped");
    }

