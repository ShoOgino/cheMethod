    @Test
    public void shouldSyncDbAttributesWhileUpdatingWorkspace() throws Exception {
        final AccountImpl account = new AccountImpl("accountId", "namespace", "test");
        final WorkspaceImpl workspace = createWorkspace("id", account, "name");

        // persist the workspace
        manager.getTransaction().begin();
        manager.persist(account);
        manager.persist(workspace);
        manager.getTransaction().commit();
        manager.clear();

        // put a new attribute
        workspace.getConfig()
                 .getProjects()
                 .get(0)
                 .getAttributes()
                 .put("new-attr", singletonList("value"));
        workspaceDao.update(workspace);

        manager.clear();

        // check it's okay
        assertEquals(workspaceDao.get(workspace.getId())
                                 .getConfig()
                                 .getProjects()
                                 .get(0)
                                 .getAttributes()
                                 .size(), 3);
    }

