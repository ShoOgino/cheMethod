    @Test
    public void runtimeIsNotRecoveredIfInfraPreparationFailed() throws Exception {
        RuntimeIdentity identity = new RuntimeIdentityImpl("workspace123", "my-env", "me");

        EnvironmentImpl env = mockWorkspace(identity).getConfig().getEnvironments().get(identity.getEnvName());
        doThrow(new InfrastructureException("oops!")).when(infrastructure).prepare(identity, env);

        // try recover
        runtimes.recoverOne(infrastructure, identity);

        assertFalse(runtimes.hasRuntime(identity.getWorkspaceId()));
    }

