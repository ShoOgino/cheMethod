    @Test
    public void usesProvidedEnvironmentInsteadOfDefault() throws Exception {
        WorkspaceConfigImpl config = createConfig();
        config.getEnvironments().put("non-default-env", new EnvironmentImpl(null, null));
        WorkspaceImpl workspace = createAndMockWorkspace(config, NAMESPACE);

        RuntimeDescriptor descriptor = createDescriptor(workspace, STARTING);
        when(runtimes.startAsync(any(), anyString(), anyBoolean())).thenReturn(immediateFuture(descriptor));

        workspaceManager.startWorkspace(workspace.getId(), "non-default-env", false);

        verify(runtimes).startAsync(workspaceCaptor.capture(), eq("non-default-env"), eq(false));
        assertEquals(workspaceCaptor.getValue().getConfig(), config);
    }

