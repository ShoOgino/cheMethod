    @Test
    public void stopsTheRunningWorkspaceAndRethrowsTheErrorDifferentFromServerException() throws Exception {
        setRuntime("workspace", WorkspaceStatus.RUNNING);
        doThrow(new EnvironmentNotRunningException("no!")).when(envEngine).stop("workspace");

        try {
            runtimes.stop("workspace");
        } catch (ServerException x) {
            assertEquals(x.getMessage(), "no!");
            assertTrue(x.getCause() instanceof EnvironmentNotRunningException);
        }

        verify(envEngine).stop("workspace");
        assertFalse(runtimeStates.containsKey("workspace"));
        verifyEventsSequence(event("workspace",
                                   WorkspaceStatus.RUNNING,
                                   WorkspaceStatus.STOPPING,
                                   EventType.STOPPING,
                                   null),
                             event("workspace",
                                   WorkspaceStatus.STOPPING,
                                   WorkspaceStatus.STOPPED,
                                   EventType.ERROR,
                                   "no!"));
    }

