    @Test
    public void removesTemporaryWorkspaceAfterStopFailed() throws Exception {
        final WorkspaceImpl workspace = createAndMockWorkspace();
        workspace.setTemporary(true);
        mockRuntime(workspace, RUNNING);
        doThrow(new ConflictException("runtime stop failed")).when(runtimes).stop(workspace.getId(), emptyMap());

        workspaceManager.stopWorkspace(workspace.getId(), emptyMap());
        captureRunAsyncCallsAndRunSynchronously();
        verify(workspaceDao).remove(workspace.getId());
    }

