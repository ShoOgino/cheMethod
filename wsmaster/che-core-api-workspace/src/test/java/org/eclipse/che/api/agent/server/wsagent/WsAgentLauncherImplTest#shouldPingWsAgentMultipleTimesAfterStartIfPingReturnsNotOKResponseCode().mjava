    @Test
    public void shouldPingWsAgentMultipleTimesAfterStartIfPingReturnsNotOKResponseCode() throws Exception {
        when(pingResponse.getResponseCode()).thenReturn(HttpURLConnection.HTTP_CREATED,
                                                        HttpURLConnection.HTTP_NO_CONTENT,
                                                        HttpURLConnection.HTTP_OK);

        wsAgentLauncher.startWsAgent(machine);

        verify(requestFactory).fromUrl(WS_AGENT_SERVER_URL);
        verify(pingRequest).setMethod(HttpMethod.GET);
        verify(pingRequest).setTimeout(WS_AGENT_PING_CONN_TIMEOUT_MS);
        verify(pingRequest, times(3)).request();
        verify(pingResponse, times(3)).getResponseCode();
    }

