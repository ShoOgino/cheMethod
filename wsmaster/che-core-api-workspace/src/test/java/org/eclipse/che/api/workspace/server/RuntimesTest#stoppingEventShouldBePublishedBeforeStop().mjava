//
//    @Test
//    public void errorEventShouldBePublishedIfDevMachineFailedToStart() throws Exception {
//        // given
//        WorkspaceImpl workspace = createWorkspace();
//        when(envEngine.start(anyString(),
//                             anyString(),
//                             any(Environment.class),
//                             anyBoolean(),
//                             any()))
//                .thenReturn(singletonList(createMachine(false)));
//
//        try {
//            // when
//            runtimes.start(workspace,
//                           workspace.getConfig().getDefaultEnv(),
//                           false);
//
//        } catch (Exception e) {
//            // then
//            verify(eventService).publish(DtoFactory.newDto(WorkspaceStatusEvent.class)
//                                                   .withWorkspaceId(workspace.getId())
//                                                   .withEventType(EventType.ERROR)
//                                                   .withPrevStatus(WorkspaceStatus.STARTING));
//        }
//    }
//
    @Test
    public void stoppingEventShouldBePublishedBeforeStop() throws Exception {
        // given
        WorkspaceImpl workspace = createWorkspace();
        runtimes.start(workspace,
                       workspace.getConfig().getDefaultEnv(),
                       null);

        // when
        runtimes.stop(workspace.getId(), null);

        // then
        verify(eventService).publish(DtoFactory.newDto(WorkspaceStatusEvent.class)
                                               .withStatus(WorkspaceStatus.STOPPING)
                                               .withWorkspaceId(workspace.getId())
                                               .withEventType(WorkspaceStatusEvent.EventType.STOPPING)
                                               .withPrevStatus(WorkspaceStatus.RUNNING));
    }

