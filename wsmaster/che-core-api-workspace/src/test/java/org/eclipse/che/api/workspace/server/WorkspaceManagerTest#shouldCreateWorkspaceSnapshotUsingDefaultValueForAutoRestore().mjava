    @Test
    public void shouldCreateWorkspaceSnapshotUsingDefaultValueForAutoRestore() throws Exception {
        // given
        workspaceManager = new WorkspaceManager(workspaceDao,
                                                runtimes,
                                                eventService,
                                                accountManager,
                                                true,
                                                false,
                                                snapshotDao,
                                                sharedPool);

        final WorkspaceImpl workspace = createAndMockWorkspace();
        mockRuntime(workspace, RUNNING);

        SnapshotImpl oldSnapshot = mock(SnapshotImpl.class);
        when(snapshotDao.getSnapshot(eq(workspace.getId()),
                                     eq(workspace.getConfig().getDefaultEnv()),
                                     anyString()))
                .thenReturn(oldSnapshot);

        // when
        workspaceManager.stopWorkspace(workspace.getId());

        // then
        captureAsyncTaskAndExecuteSynchronously();
        verify(runtimes).snapshot(workspace.getId());
        verify(runtimes).stop(workspace.getId());
    }

