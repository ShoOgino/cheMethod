  private void verifyCompletionException(
      Future<?> f, Class<? extends Exception> expectedEx, String expectedMessage) {
    assertTrue(f.isDone());
    try {
      f.get();
    } catch (ExecutionException execEx) {
      if (expectedEx.isInstance(execEx.getCause())) {
        assertEquals(execEx.getCause().getMessage(), expectedMessage);
      } else {
        fail(execEx.getMessage(), execEx);
      }
    } catch (InterruptedException interruptedEx) {
      fail(interruptedEx.getMessage(), interruptedEx);
    }
  }

