    @Test
    public void workspaceShouldBeInStartingStatusUntilDevMachineIsNotStarted() throws Exception {
        final MachineManager machineManagerMock = mock(MachineManager.class);
        final RuntimeWorkspaceRegistry registry = new RuntimeWorkspaceRegistry(machineManagerMock);
        final UsersWorkspaceImpl workspaceMock = workspaceMock();

        // check if workspace in starting status before dev machine is started
        when(machineManagerMock.createMachineSync(any(), any(), any())).thenAnswer(invocationOnMock -> {
            final RuntimeWorkspaceImpl startingWorkspace = registry.get(workspaceMock.getId());
            final MachineConfig cfg = (MachineConfig)invocationOnMock.getArguments()[0];
            if (cfg.isDev()) {
                assertEquals(startingWorkspace.getStatus(), WorkspaceStatus.STARTING, "Workspace status is not 'STARTING'");
            }
            return machineMock((MachineConfig)invocationOnMock.getArguments()[0]);
        });

        registry.start(workspaceMock, workspaceMock.getConfig().getDefaultEnv());
    }

