  @Test(dataProvider = "environmentsProvider")
  public void shouldAddExecAgentIfNeededOnCreateWS(
      Map<String, EnvironmentDto> inputEnv, Map<String, EnvironmentDto> expectedEnv)
      throws Exception {
    final Response response =
        given()
            .auth()
            .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
            .contentType("application/json")
            .body(newDto(WorkspaceConfigDto.class).withEnvironments(inputEnv))
            .when()
            .post(SECURE_PATH + "/workspace");

    assertEquals(response.getStatusCode(), 201);
    verify(workspaceService)
        .create(workspaceConfigCaptor.capture(), any(), anyBoolean(), anyString());
    Map<String, EnvironmentDto> actualEnv = workspaceConfigCaptor.getValue().getEnvironments();
    assertEquals(actualEnv, expectedEnv);
  }

