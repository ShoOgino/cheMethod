  @Test
  public void shouldUseSourceWarningsEnvVarsAndAttributesWhileInternalEnvironmentCreation()
      throws Exception {
    // given
    List<Warning> sourceWarnings = singletonList(new WarningImpl(123, "message"));
    ImmutableMap<String, String> sourceEnv = ImmutableMap.of("CHE_API", "localhost");
    ImmutableMap<String, String> sourceAttributes = ImmutableMap.of("attribute", "value");
    MachineConfigImpl machineConfig =
        new MachineConfigImpl(null, null, sourceEnv, sourceAttributes);

    EnvironmentImpl env =
        new EnvironmentImpl(null, ImmutableMap.of("machine", machineConfig), sourceWarnings);

    // when
    environmentFactory.create(env);

    // then
    verify(environmentFactory).doCreate(any(), machinesCaptor.capture(), eq(sourceWarnings));
    Map<String, InternalMachineConfig> internalMachines = machinesCaptor.getValue();
    assertEquals(internalMachines.get("machine").getEnv(), sourceEnv);
    assertEquals(internalMachines.get("machine").getAttributes(), sourceAttributes);
  }

