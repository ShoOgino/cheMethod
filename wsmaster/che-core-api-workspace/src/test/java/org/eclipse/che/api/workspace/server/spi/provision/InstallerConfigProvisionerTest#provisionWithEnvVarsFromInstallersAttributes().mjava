  @Test
  public void provisionWithEnvVarsFromInstallersAttributes() throws Exception {
    // given
    when(installer1.getProperties())
        .thenReturn(
            ImmutableMap.of(Installer.ENVIRONMENT_PROPERTY, "envVar1=value1,envVar2=value2"));
    when(installer2.getProperties())
        .thenReturn(ImmutableMap.of(Installer.ENVIRONMENT_PROPERTY, "envVar3=value3"));

    Map<String, String> machine1Env = new HashMap<>();
    when(machine1.getEnv()).thenReturn(machine1Env);

    Map<String, String> machine2Env = new HashMap<>();
    when(this.machine2.getEnv()).thenReturn(machine2Env);
    machine2Env.put("existingEnv", "value");

    // when
    installerConfigProvisioner.provision(runtimeIdentity, internalEnvironment);

    // then
    assertEquals(machine1Env, ImmutableMap.of("envVar1", "value1", "envVar2", "value2"));
    assertEquals(machine2Env, ImmutableMap.of("existingEnv", "value", "envVar3", "value3"));
  }

