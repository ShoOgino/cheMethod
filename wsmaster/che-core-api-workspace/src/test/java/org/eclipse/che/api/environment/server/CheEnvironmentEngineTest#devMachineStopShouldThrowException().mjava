  @Test(
    expectedExceptions = ConflictException.class,
    expectedExceptionsMessageRegExp =
        "Stop of dev machine is not allowed. Please, stop whole environment"
  )
  public void devMachineStopShouldThrowException() throws Exception {
    // given
    List<Instance> instances = startEnv();
    Optional<Instance> instanceOpt =
        instances.stream().filter(machine -> machine.getConfig().isDev()).findAny();
    assertTrue(instanceOpt.isPresent(), "Required for test dev machine is not found");
    Instance instance = instanceOpt.get();

    // when
    engine.stopMachine(instance.getWorkspaceId(), instance.getId());
  }

