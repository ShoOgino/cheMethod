    @Test
    public void shouldBeAbleToStartMachineInRunningWs() throws Exception {
        // given
        String testWsId = "testWsId";
        String testActiveEnv = "testActiveEnv";
        WorkspaceImpl workspaceMock = mock(WorkspaceImpl.class);
        doReturn(workspaceMock).when(workspaceManager).getWorkspace(testWsId);
        WorkspaceRuntimeImpl wsRuntimeMock = mock(WorkspaceRuntimeImpl.class);
        when(workspaceMock.getStatus()).thenReturn(RUNNING);
        when(workspaceMock.getRuntime()).thenReturn(wsRuntimeMock);
        when(wsRuntimeMock.getActiveEnv()).thenReturn(testActiveEnv);
        LineConsumer lineConsumerMock = mock(LineConsumer.class);
        MachineConfigImpl machineConfig = createConfig().getEnvironments().get(0).getMachineConfigs().get(0);
        when(runtimes.getMachineLogger(testWsId, machineConfig.getName())).thenReturn(lineConsumerMock);

        // when
        workspaceManager.startMachine(machineConfig, testWsId);

        // then
        verify(machineManager).createMachineAsync(eq(machineConfig), eq(testWsId), eq(testActiveEnv), eq(lineConsumerMock));
    }

