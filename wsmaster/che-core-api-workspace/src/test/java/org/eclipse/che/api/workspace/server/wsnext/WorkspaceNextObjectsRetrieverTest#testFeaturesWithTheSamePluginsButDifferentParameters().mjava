  @Test
  public void testFeaturesWithTheSamePluginsButDifferentParameters() throws Exception {
    Map<String, String> featuresAttributes =
        featuresAttribute(
            TEST_FEATURE_NAME, TEST_FEATURE_VERSION, TEST_FEATURE_2_NAME, TEST_FEATURE_2_VERSION);
    CheFeature feature1 =
        testFeature(
            TEST_PLUGIN, TEST_PLUGIN_VERSION, TEST_PLUGIN_PARAM_NAME, TEST_PLUGIN_PARAM_VALUE);
    CheFeature feature2 =
        testFeature(
            TEST_PLUGIN, TEST_PLUGIN_VERSION, TEST_PLUGIN_PARAM_2_NAME, TEST_PLUGIN_PARAM_VALUE_2);
    ChePlugin plugin =
        testPlugin(
            TEST_PLUGIN_ENV_NAME_2,
            TEST_PLUGIN_PARAM_PLACEHOLDER,
            TEST_PLUGIN_ENV_NAME_3,
            TEST_PLUGIN_PARAM_2_PLACEHOLDER);
    doReturn(feature1)
        .when(retriever)
        .getBody(eq(getFeatureURI(TEST_FEATURE_NAME, TEST_FEATURE_VERSION)), eq(CheFeature.class));
    doReturn(feature2)
        .when(retriever)
        .getBody(
            eq(getFeatureURI(TEST_FEATURE_2_NAME, TEST_FEATURE_2_VERSION)), eq(CheFeature.class));
    doReturn(plugin).when(retriever).getBody(any(URI.class), eq(ChePlugin.class));
    ChePlugin expectedPlugin =
        expectedPluginWithEnv(
            TEST_PLUGIN_ENV_NAME_2,
            TEST_PLUGIN_PARAM_VALUE,
            TEST_PLUGIN_ENV_NAME_3,
            TEST_PLUGIN_PARAM_VALUE_2);

    Collection<ChePlugin> plugins = retriever.get(featuresAttributes);

    assertEquals(plugins, singletonList(expectedPlugin));
  }

