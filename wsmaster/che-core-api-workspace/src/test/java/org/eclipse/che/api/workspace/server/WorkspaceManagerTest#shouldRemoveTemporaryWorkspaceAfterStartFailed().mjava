  @Test
  public void shouldRemoveTemporaryWorkspaceAfterStartFailed() throws Exception {
    WorkspaceImpl workspace = createAndMockWorkspace();
    workspace.setTemporary(true);
    mockRuntime(workspace, RUNNING);
    doThrow(new ServerException("")).when(runtimes).stop(workspace.getId());

    workspaceManager.stopWorkspace(workspace.getId());

    captureRunAsyncCallsAndRunSynchronously();
    verify(workspaceDao).remove(workspace.getId());
  }

