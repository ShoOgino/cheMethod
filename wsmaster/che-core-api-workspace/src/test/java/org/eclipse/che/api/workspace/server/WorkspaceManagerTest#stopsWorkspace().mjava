  @Test
  public void stopsWorkspace() throws Exception {
    final WorkspaceImpl workspace = createAndMockWorkspace(createConfig(), NAMESPACE_1);
    mockRuntime(workspace, RUNNING);

    workspaceManager.stopWorkspace(workspace.getId(), emptyMap());

    captureRunAsyncCallsAndRunSynchronously();
    verify(runtimes).stop(workspace.getId(), emptyMap());
    verify(workspaceDao).update(workspaceCaptor.capture());
    assertNotNull(workspaceCaptor.getValue().getAttributes().get(UPDATED_ATTRIBUTE_NAME));
  }

