  @Test
  public void shouldStartTheWorkspaceAfterItIsCreatedFromConfigWhenStartAfterCreateParamIsTrue()
      throws Exception {
    final WorkspaceConfigDto configDto = createConfigDto();
    final WorkspaceImpl workspace = createWorkspace(configDto);
    when(wsManager.createWorkspace(any(WorkspaceConfig.class), any(), any())).thenReturn(workspace);

    given()
        .auth()
        .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
        .contentType("application/json")
        .body(configDto)
        .when()
        .post(
            SECURE_PATH
                + "/workspace"
                + "?attribute=factoryId:factory123"
                + "&attribute=custom:custom:value"
                + "&start-after-create=true");

    verify(wsManager).startWorkspace(workspace.getId(), null, emptyMap());
    verify(wsManager)
        .createWorkspace(
            any(WorkspaceConfig.class),
            anyString(),
            eq(
                ImmutableMap.of(
                    "factoryId", "factory123",
                    "custom", "custom:value")));
  }

