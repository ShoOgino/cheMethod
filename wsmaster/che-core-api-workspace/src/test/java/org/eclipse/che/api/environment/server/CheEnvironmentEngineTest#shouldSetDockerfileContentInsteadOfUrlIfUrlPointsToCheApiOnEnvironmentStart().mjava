    @Test
    public void shouldSetDockerfileContentInsteadOfUrlIfUrlPointsToCheApiOnEnvironmentStart() throws Exception {
        // given
        EnvironmentImpl env = createEnv();
        String machineName = "machineWithDockerfileFromApi";
        String additionalServiceComposeFilePart = "\n  " + machineName + ":\n    build:\n      context: " + API_ENDPOINT + "/recipe/12345";
        env.getRecipe().setContent(env.getRecipe().getContent() + additionalServiceComposeFilePart);
        String dockerfileContent = "this is dockerfile content";
        when(recipeDownloader.getRecipe(anyString())).thenReturn(dockerfileContent);

        // when
        startEnv(env);

        // then
        ArgumentCaptor<ComposeServiceImpl> captor = ArgumentCaptor.forClass(ComposeServiceImpl.class);
        verify(composeProvider).startService(anyString(),
                                             anyString(),
                                             anyString(),
                                             anyString(),
                                             eq(machineName),
                                             eq(false),
                                             anyString(),
                                             captor.capture(),
                                             any(LineConsumer.class));
        ComposeServiceImpl actualService = captor.getValue();
        assertNull(actualService.getBuild().getContext());
        assertEquals(actualService.getBuild().getDockerfile(), dockerfileContent);
    }

