  @Test
  public void shouldSetDockerfileContentInsteadOfUrlIfUrlPointsToCheApiOnEnvironmentStart()
      throws Exception {
    // given
    EnvironmentImpl env = createEnv();
    String machineName = "machineWithDockerfileFromApi";
    String dockerfileContent = "this is dockerfile content";
    when(recipeDownloader.getRecipe(anyString())).thenReturn(dockerfileContent);

    //prepare CheServicesEnvironmentImpl which should return compose parser
    CheServicesEnvironmentImpl cheServicesEnvironment = createCheServicesEnvByName(machineName);
    cheServicesEnvironment
        .getServices()
        .get(machineName)
        .withBuild(new CheServiceBuildContextImpl().withContext(API_ENDPOINT + "/recipe/12345"));

    // when
    startEnv(env, cheServicesEnvironment);

    // then
    ArgumentCaptor<CheServiceImpl> captor = ArgumentCaptor.forClass(CheServiceImpl.class);
    verify(machineProvider)
        .startService(
            anyString(),
            anyString(),
            anyString(),
            eq(machineName),
            eq(false),
            anyString(),
            captor.capture(),
            any(LineConsumer.class));
    CheServiceImpl actualService = captor.getValue();
    assertNull(actualService.getBuild().getContext());
    assertNull(actualService.getBuild().getDockerfilePath());
    assertEquals(actualService.getBuild().getDockerfileContent(), dockerfileContent);
  }

