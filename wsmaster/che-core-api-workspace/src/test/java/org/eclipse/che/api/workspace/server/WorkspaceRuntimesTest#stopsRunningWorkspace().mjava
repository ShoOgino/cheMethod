  @Test
  public void stopsRunningWorkspace() throws Exception {
    setRuntime("workspace", WorkspaceStatus.RUNNING);

    runtimes.stop("workspace");

    verify(envEngine).stop("workspace");
    verifyEventsSequence(
        event(
            "workspace",
            WorkspaceStatus.RUNNING,
            WorkspaceStatus.STOPPING,
            EventType.STOPPING,
            null),
        event(
            "workspace",
            WorkspaceStatus.STOPPING,
            WorkspaceStatus.STOPPED,
            EventType.STOPPED,
            null));
    assertFalse(runtimeStates.containsKey("workspace"));
  }

