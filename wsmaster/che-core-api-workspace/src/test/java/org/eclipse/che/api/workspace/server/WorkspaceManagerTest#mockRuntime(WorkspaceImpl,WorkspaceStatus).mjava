    private WorkspaceRuntimeImpl mockRuntime(WorkspaceImpl workspace, WorkspaceStatus status) {
        when(runtimes.getStatus(workspace.getId())).thenReturn(status);
        MachineImpl machine1 = spy(createMachine(workspace.getId(), workspace.getConfig().getDefaultEnv(), true));
        MachineImpl machine2 = spy(createMachine(workspace.getId(), workspace.getConfig().getDefaultEnv(), false));
        Map<String, MachineImpl> machines = new HashMap<>();
        machines.put(machine1.getId(), machine1);
        machines.put(machine2.getId(), machine2);
        WorkspaceRuntimeImpl runtime = new WorkspaceRuntimeImpl(workspace.getConfig().getDefaultEnv(), machines.values());
        doAnswer(inv -> {
            workspace.setStatus(status);
            workspace.setRuntime(runtime);
            return null;
        }).when(runtimes).injectRuntime(workspace);
        when(runtimes.isAnyRunning()).thenReturn(true);
        return runtime;
    }

