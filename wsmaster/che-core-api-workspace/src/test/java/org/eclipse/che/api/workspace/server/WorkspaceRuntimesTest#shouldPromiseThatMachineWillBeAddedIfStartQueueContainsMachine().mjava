    @Test
    public void shouldPromiseThatMachineWillBeAddedIfStartQueueContainsMachine() throws Exception {
        // prepare runtime
        final WorkspaceRuntimeImpl runtime = mock(WorkspaceRuntimeImpl.class);
        final ArrayList<MachineImpl> machines = new ArrayList<>();
        when(runtime.getMachines()).thenReturn(machines);
        // prepare descriptor
        when(descriptor.getRuntime()).thenReturn(runtime);
        when(descriptor.getRuntimeStatus()).thenReturn(RUNNING);
        // prepare queue
        final ArrayDeque<MachineConfigImpl> queue = new ArrayDeque<>();
        queue.add(createConfig(false));
        // register mocks
        runtimes.descriptors.put(WORKSPACE_ID, descriptor);
        runtimes.startQueues.put(WORKSPACE_ID, queue);

        final MachineImpl machine = createMachine(false);
        assertTrue(runtimes.addMachine(machine), "should be added");
        assertTrue(machines.isEmpty());
    }

