    @Test
    public void errorEventShouldBePublishedIfEnvFailedToStop() throws Exception {
        // given
        WorkspaceImpl workspace = createWorkspace();
        runtimes.start(workspace,
                       workspace.getConfig().getDefaultEnv(),
                       false);

        try {
            // when
            runtimes.stop(workspace.getId());
        } catch (Exception e) {
            // then
            verify(eventService).publish(DtoFactory.newDto(WorkspaceStatusEvent.class)
                                                   .withWorkspaceId(workspace.getId())
                                                   .withEventType(EventType.ERROR)
                                                   .withPrevStatus(WorkspaceStatus.STOPPING)
                                                   .withError("Test error"));
        }
    }

