  @Test
  public void shouldNotSetDockerfileContentInsteadOfUrlIfUrlDoesNotPointToCheApiOnEnvironmentStart()
      throws Exception {
    // given
    EnvironmentImpl env = createEnv();
    String machineName = "machineWithDockerfileNotFromApi";
    String contextUrl = "http://another-server.com/recipe/12345";

    // prepare CheServicesEnvironmentImpl which should return compose parser
    CheServicesEnvironmentImpl cheServicesEnvironment = createCheServicesEnvByName(machineName);
    cheServicesEnvironment
        .getServices()
        .get(machineName)
        .withBuild(new CheServiceBuildContextImpl().withContext(contextUrl));

    // when
    startEnv(env, cheServicesEnvironment);

    // then
    ArgumentCaptor<CheServiceImpl> captor = ArgumentCaptor.forClass(CheServiceImpl.class);
    verify(machineProvider)
        .startService(
            anyString(),
            anyString(),
            anyString(),
            eq(machineName),
            eq(false),
            anyString(),
            captor.capture(),
            any(LineConsumer.class));
    CheServiceImpl actualService = captor.getValue();
    assertNull(actualService.getBuild().getDockerfilePath());
    assertNull(actualService.getBuild().getDockerfileContent());
    assertEquals(actualService.getBuild().getContext(), contextUrl);
  }

