    @BeforeMethod
    public void setUp() throws Exception {
        workspaceManager =
                spy(new WorkspaceManager(workspaceDao, registry, workspaceConfigValidator, eventService, machineManager, userManager));
        workspaceManager.setHooks(workspaceHooks);

        when(workspaceDao.create(any(UsersWorkspaceImpl.class))).thenAnswer(invocation -> invocation.getArguments()[0]);
        when(workspaceDao.update(any(UsersWorkspaceImpl.class))).thenAnswer(invocation -> invocation.getArguments()[0]);

        EnvironmentContext.setCurrent(new EnvironmentContext() {
            @Override
            public User getUser() {
                return new UserImpl("name", USER_ID, "token", new ArrayList<>(), false);
            }
        });
    }

