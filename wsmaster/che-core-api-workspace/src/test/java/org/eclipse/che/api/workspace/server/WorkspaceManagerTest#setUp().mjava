    @BeforeMethod
    public void setUp() throws Exception {
        workspaceManager = spy(new WorkspaceManager(workspaceDao,
                                                    runtimes,
                                                    eventService,
                                                    machineManager,
                                                    userManager));
        workspaceManager.setHooks(workspaceHooks);

        when(workspaceDao.create(any(WorkspaceImpl.class))).thenAnswer(invocation -> invocation.getArguments()[0]);
        when(workspaceDao.update(any(WorkspaceImpl.class))).thenAnswer(invocation -> invocation.getArguments()[0]);

        EnvironmentContext.setCurrent(new EnvironmentContext() {
            @Override
            public Subject getSubject() {
                return new SubjectImpl("Test User", USER_ID, "token", new ArrayList<>(), false);
            }
        });
    }

