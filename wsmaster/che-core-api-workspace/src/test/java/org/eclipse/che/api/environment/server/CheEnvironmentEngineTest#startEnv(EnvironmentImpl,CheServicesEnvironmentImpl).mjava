  private List<Instance> startEnv(EnvironmentImpl env, CheServicesEnvironmentImpl cheServicesEnv)
      throws Exception {
    String envName = "env-1";
    String workspaceId = "wsId";
    when(machineProvider.startService(
            anyString(),
            eq(workspaceId),
            eq(envName),
            anyString(),
            anyBoolean(),
            anyString(),
            any(CheServiceImpl.class),
            any(LineConsumer.class)))
        .thenAnswer(
            invocationOnMock -> {
              Object[] arguments = invocationOnMock.getArguments();
              String machineName = (String) arguments[3];
              boolean isDev = (boolean) arguments[4];
              CheServiceImpl service = (CheServiceImpl) arguments[6];
              Machine machine = createMachine(workspaceId, envName, service, machineName, isDev);
              return spy(new NoOpMachineInstance(machine));
            });

    when(environmentParser.parse(env)).thenReturn(cheServicesEnv);

    // when
    return engine.start(workspaceId, envName, env, false, messageConsumer);
  }

