  @Test(dependsOnMethods = "shouldGetById")
  public void shouldNotRemoveStackWhenSubscriberThrowsExceptionOnStackRemoving() throws Exception {
    final StackImpl stack = stacks[0];
    CascadeEventSubscriber<BeforeStackRemovedEvent> subscriber = mockCascadeEventSubscriber();
    doThrow(new ServerException("error")).when(subscriber).onCascadeEvent(any());
    eventService.subscribe(subscriber, BeforeStackRemovedEvent.class);

    try {
      stackDao.remove(stack.getId());
      fail("StackDao#remove had to throw server exception");
    } catch (ServerException ignored) {
    }

    assertEquals(stackDao.getById(stack.getId()), stack);
    eventService.unsubscribe(subscriber, BeforeStackRemovedEvent.class);
  }

