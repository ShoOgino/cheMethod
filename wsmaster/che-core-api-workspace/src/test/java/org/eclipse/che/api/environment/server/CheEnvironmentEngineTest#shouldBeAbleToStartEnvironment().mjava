    @Test
    public void shouldBeAbleToStartEnvironment() throws Exception {
        // given
        EnvironmentImpl env = createEnv();
        String workspaceId = "wsId";
        List<Instance> expectedMachines = new ArrayList<>();
        when(instanceProvider.createInstance(any(Machine.class),
                                             any(LineConsumer.class)))
                .thenAnswer(invocationOnMock -> {
                    Object[] arguments = invocationOnMock.getArguments();
                    Machine machine = (Machine)arguments[0];
                    Instance instance = spy(new NoOpMachineInstance(machine));
                    expectedMachines.add(instance);
                    return instance;
                });

        // when
        List<Instance> machines = engine.start(workspaceId, env, false, messageConsumer);

        // then
        assertEquals(machines, expectedMachines);
        verify(instanceProvider, times(env.getMachineConfigs().size()))
                .createInstance(any(Machine.class), any(LineConsumer.class));
    }

