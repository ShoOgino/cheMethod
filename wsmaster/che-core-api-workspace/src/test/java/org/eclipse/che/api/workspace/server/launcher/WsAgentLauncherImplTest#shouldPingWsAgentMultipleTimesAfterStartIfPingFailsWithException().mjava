    @Test
    public void shouldPingWsAgentMultipleTimesAfterStartIfPingFailsWithException() throws Exception {
        when(pingRequest.request()).thenThrow(new ServerException(""),
                                              new BadRequestException(""),
                                              new IOException())
                                   .thenReturn(pingResponse);

        wsAgentLauncher.launch(machine, agent);

        verify(requestFactory).fromUrl(WS_AGENT_SERVER_URL);
        verify(pingRequest).setMethod(HttpMethod.GET);
        verify(pingRequest).setTimeout(WS_AGENT_PING_CONN_TIMEOUT_MS);
        verify(pingRequest, times(4)).request();
        verify(pingResponse).getResponseCode();
    }

