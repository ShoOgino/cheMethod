    @Test
    public void stoppedEventShouldBePublishedAfterEnvStop() throws Exception {
        // given
        WorkspaceImpl workspace = createWorkspace();
        runtimes.start(workspace,
                       workspace.getConfig().getDefaultEnv(),
                       false);

        // when
        runtimes.stop(workspace.getId());

        // then
        verify(eventService).publish(DtoFactory.newDto(WorkspaceStatusEvent.class)
                                               .withStatus(WorkspaceStatus.STOPPED)
                                               .withWorkspaceId(workspace.getId())
                                               .withEventType(EventType.STOPPED)
                                               .withPrevStatus(WorkspaceStatus.STOPPING));
    }

