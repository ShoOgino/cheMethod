    @Test
    public void shouldBeAbleToStartTemporaryWorkspace() throws Exception {
        final WorkspaceConfigImpl config = createConfig();
        when(runtimes.start(any(), anyString(), anyBoolean())).thenReturn(mock(RuntimeDescriptor.class));
        when(runtimes.get(any())).thenThrow(new NotFoundException(""));

        final WorkspaceImpl runtime = workspaceManager.startWorkspace(createConfig(), "user123", true, "account");

        verify(runtimes, timeout(2000)).start(workspaceCaptor.capture(), anyString(), anyBoolean());
        final WorkspaceImpl captured = workspaceCaptor.getValue();
        assertTrue(captured.isTemporary());
        assertNotNull(captured.getConfig()
                              .getEnvironments()
                              .get(0)
                              .getMachineConfigs()
                              .get(0));
        verify(workspaceHooks).beforeCreate(captured, "account");
        verify(workspaceHooks).afterCreate(runtime, "account");
        verify(workspaceHooks).beforeStart(captured, config.getDefaultEnv(), "account");
        verify(workspaceManager).performAsyncStart(captured, captured.getConfig().getDefaultEnv(), false, "account");
    }

