    @BeforeMethod
    public void setUp(Method method) throws Exception {
        runtimes = spy(new WorkspaceRuntimes(eventService,
                                             envEngine,
                                             agentSorter,
                                             launcherFactory,
                                             agentRegistry,
                                             snapshotDao,
                                             sharedPool));

        List<Instance> machines = asList(createMachine(true), createMachine(false));
        when(envEngine.start(anyString(),
                             anyString(),
                             any(Environment.class),
                             anyBoolean(),
                             any()))
                .thenReturn(machines);
        when(envEngine.getMachines(WORKSPACE_ID)).thenReturn(machines);
    }

