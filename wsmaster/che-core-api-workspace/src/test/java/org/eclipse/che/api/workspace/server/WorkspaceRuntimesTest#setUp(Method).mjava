    @BeforeMethod
    public void setUp(Method method) throws Exception {
        runtimes = spy(new WorkspaceRuntimes(eventService,
                                             environmentEngine,
                                             agentSorter,
                                             launcherFactory,
                                             agentRegistry));

        List<Instance> machines = asList(createMachine(true), createMachine(false));
        when(environmentEngine.start(anyString(),
                                     anyString(),
                                     any(Environment.class),
                                     anyBoolean(),
                                     any()))
                .thenReturn(machines);
        when(environmentEngine.getMachines(WORKSPACE_ID)).thenReturn(machines);
    }

