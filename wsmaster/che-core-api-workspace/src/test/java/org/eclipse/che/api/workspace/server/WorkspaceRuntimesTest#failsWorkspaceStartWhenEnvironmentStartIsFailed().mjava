    @Test
    public void failsWorkspaceStartWhenEnvironmentStartIsFailed() throws Exception {
        WorkspaceImpl workspace = newWorkspace("workspace", "env-name");
        rejectEnvironmentStart(workspace, "env-name", new EnvironmentException("no no no!"));

        CompletableFuture<WorkspaceRuntimeImpl> cmpFuture = runtimes.startAsync(workspace, "env-name", false);

        try {
            captureAsyncTaskAndExecuteSynchronously();
        } catch (EnvironmentException x) {
            assertEquals(x.getMessage(), "no no no!");
            verifyCompletionException(cmpFuture, EnvironmentException.class, "no no no!");
        }
        assertFalse(runtimes.hasRuntime(workspace.getId()));
        verifyEventsSequence(event("workspace",
                                   WorkspaceStatus.STOPPED,
                                   WorkspaceStatus.STARTING,
                                   EventType.STARTING,
                                   null),
                             event("workspace",
                                   WorkspaceStatus.STARTING,
                                   WorkspaceStatus.STOPPED,
                                   EventType.ERROR,
                                   "Start of environment 'env-name' failed. Error: no no no!"));
    }

