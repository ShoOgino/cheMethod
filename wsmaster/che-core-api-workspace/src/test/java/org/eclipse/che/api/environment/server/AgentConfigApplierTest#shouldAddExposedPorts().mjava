    @Test
    public void shouldAddExposedPorts() throws Exception {
        final ServerConf2 serverConf1 = mock(ServerConf2.class);
        final ServerConf2 serverConf2 = mock(ServerConf2.class);
        when(serverConf1.getPort()).thenReturn("1111/udp");
        when(serverConf2.getPort()).thenReturn("2222/tcp");

        when(sorter.sort(any())).thenReturn(asList(AgentKeyImpl.parse("agent1"),
                                                   AgentKeyImpl.parse("agent2"),
                                                   AgentKeyImpl.parse("agent3")));
        when(agent1.getServers()).thenAnswer(invocation -> singletonMap("a", serverConf1));
        when(agent2.getServers()).thenAnswer(invocation -> singletonMap("b", serverConf2));
        when(agent3.getServers()).thenReturn(emptyMap());
        CheServiceImpl service = new CheServiceImpl();

        agentConfigApplier.apply(new ExtendedMachineImpl(asList("agent1", "agent2", "agent3"),
                                                         emptyMap(),
                                                         emptyMap()),
                                 service);

        List<String> exposedPorts = service.getExpose();
        assertTrue(exposedPorts.contains("1111/udp"));
        assertTrue(exposedPorts.contains("2222/tcp"));
    }

