    @Test
    public void shouldAddExposedPorts() throws Exception {
        when(sorter.sort(any())).thenReturn(asList(AgentKeyImpl.parse("agent1"),
                                                   AgentKeyImpl.parse("agent2"),
                                                   AgentKeyImpl.parse("agent3")));
        when(agent1.getProperties()).thenReturn(singletonMap("ports", "terminal:1111/udp,terminal:2222/tcp"));
        when(agent2.getProperties()).thenReturn(singletonMap("ports", "3333/udp"));
        CheServiceImpl service = new CheServiceImpl();

        agentConfigApplier.modify(service, asList("agent1", "agent2", "agent3"));

        List<String> exposedPorts = service.getExpose();
        assertTrue(exposedPorts.contains("1111/udp"));
        assertTrue(exposedPorts.contains("2222/tcp"));
        assertTrue(exposedPorts.contains("3333/udp"));
    }

