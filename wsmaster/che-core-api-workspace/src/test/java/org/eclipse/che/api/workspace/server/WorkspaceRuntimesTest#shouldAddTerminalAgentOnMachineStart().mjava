    @Test
    public void shouldAddTerminalAgentOnMachineStart() throws Exception {
        // when
        WorkspaceImpl workspace = createWorkspace();
        runtimes.start(workspace,
                       workspace.getConfig().getDefaultEnv(),
                       false);
        MachineConfigImpl config = createConfig(false);
        Instance instance = mock(Instance.class);
        when(environmentEngine.startMachine(anyString(), any(MachineConfig.class), any())).thenReturn(instance);
        when(instance.getConfig()).thenReturn(config);

        // when
        Instance actual = runtimes.startMachine(workspace.getId(), config);

        // then
        assertEquals(actual, instance);
        verify(environmentEngine).startMachine(eq(workspace.getId()),
                                               eq(config),
                                               eq(singletonList("org.eclipse.che.terminal")));
        verify(runtimes).launchAgents(instance, singletonList("org.eclipse.che.terminal"));
    }

