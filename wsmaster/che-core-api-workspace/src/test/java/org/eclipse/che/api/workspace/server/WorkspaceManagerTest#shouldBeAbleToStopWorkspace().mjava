    @Test
    public void shouldBeAbleToStopWorkspace() throws Exception {
        WorkspaceImpl workspace = createAndMockWorkspace(createConfig(), NAMESPACE);
        mockRuntime(workspace, RUNNING);

        // when
        workspaceManager.stopWorkspace(workspace.getId());

        // then
        captureRunAsyncCallsAndRunSynchronously();

        verify(runtimes).stop(workspace.getId());

        verify(workspaceDao).update(workspaceCaptor.capture());
        WorkspaceImpl updated = workspaceCaptor.getValue();
        assertNotNull(updated.getAttributes().get(UPDATED_ATTRIBUTE_NAME));
    }

