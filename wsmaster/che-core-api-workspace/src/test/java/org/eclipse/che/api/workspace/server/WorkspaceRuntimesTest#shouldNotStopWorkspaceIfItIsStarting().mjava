    @Test(expectedExceptions = ConflictException.class,
          expectedExceptionsMessageRegExp = "Couldn't stop '.*' workspace because its status is 'STARTING'")
    public void shouldNotStopWorkspaceIfItIsStarting() throws Exception {
        final MachineManager machineManagerMock = mock(MachineManager.class);
        final WorkspaceRuntimes registry = new WorkspaceRuntimes(machineManagerMock, eventService);
        final WorkspaceImpl workspace = createWorkspace();

        when(machineManagerMock.createMachineSync(any(), any(), any())).thenAnswer(invocationOnMock -> {
            registry.stop(workspace.getId());
            return createMachine((MachineConfig)invocationOnMock.getArguments()[0]);
        });

        registry.start(workspace, workspace.getConfig().getDefaultEnv());
    }

