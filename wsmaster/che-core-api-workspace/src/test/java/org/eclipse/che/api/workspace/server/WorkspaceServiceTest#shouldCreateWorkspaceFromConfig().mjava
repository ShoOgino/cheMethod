  @Test
  public void shouldCreateWorkspaceFromConfig() throws Exception {
    final WorkspaceConfigDto configDto = createConfigDto();
    final WorkspaceImpl workspace = createWorkspace(configDto);
    when(wsManager.createWorkspace(any(WorkspaceConfig.class), anyString(), any()))
        .thenReturn(workspace);

    final Response response =
        given()
            .auth()
            .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
            .contentType("application/json")
            .body(configDto)
            .when()
            .post(
                SECURE_PATH
                    + "/workspace"
                    + "?namespace=test"
                    + "&attribute=factoryId:factory123"
                    + "&attribute=custom:custom:value");

    assertEquals(response.getStatusCode(), 201);
    assertEquals(
        new WorkspaceImpl(unwrapDto(response, WorkspaceDto.class), TEST_ACCOUNT), workspace);
    verify(wsManager)
        .createWorkspace(
            any(WorkspaceConfig.class),
            eq("test"),
            eq(
                ImmutableMap.of(
                    "factoryId", "factory123",
                    "custom", "custom:value")));
  }

