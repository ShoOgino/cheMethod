    private WorkspaceImpl createRunningWorkspace() throws ServerException, NotFoundException, ConflictException {
        // should be snapshotted when stopped
        final WorkspaceImpl workspace = workspaceManager.createWorkspace(createConfig(), NAMESPACE);
        workspace.getAttributes().put(Constants.AUTO_CREATE_SNAPSHOT, "true");
        when(workspaceDao.get(workspace.getId())).thenReturn(workspace);

        // has runtime
        final RuntimeDescriptor descriptor = createDescriptor(workspace, RUNNING);
        when(runtimes.get(workspace.getId())).thenReturn(descriptor);

        // doesn't have snapshots
        when(snapshotDao.findSnapshots(workspace.getId())).thenReturn(emptyList());
        when(snapshotDao.replaceSnapshots(eq(workspace.getId()),
                                          eq(workspace.getRuntime().getActiveEnv()),
                                          any())).thenReturn(emptyList());

        return workspace;
    }

