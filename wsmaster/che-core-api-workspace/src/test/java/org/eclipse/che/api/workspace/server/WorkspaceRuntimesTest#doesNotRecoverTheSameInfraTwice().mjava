  @Test
  public void doesNotRecoverTheSameInfraTwice() throws Exception {
    TestInfrastructure infra =
        spy(new TestInfrastructure(installerRegistry, recipeRetriever, "test1", "test2"));

    new WorkspaceRuntimes(
            eventService,
            Collections.singletonMap(
                "test", new TestEnvironmentFactory(installerRegistry, recipeRetriever)),
            Collections.singleton(infra),
            sharedPool,
            workspaceDao,
            dbInitializer)
        .recover();

    verify(infra).getIdentities();
  }

