  @Test(dataProvider = "environmentsProvider")
  public void shouldAddExecAgentIfNeededOnStartWSFromConfig(
      Map<String, EnvironmentDto> inputEnv, Map<String, EnvironmentDto> expectedEnv)
      throws Exception {
    final Response response =
        given()
            .auth()
            .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
            .contentType("application/json")
            .body(newDto(WorkspaceConfigDto.class).withEnvironments(inputEnv))
            .when()
            .post(SECURE_PATH + "/workspace/runtime");

    assertEquals(response.getStatusCode(), 200);
    verify(workspaceService)
        .startFromConfig(
            workspaceConfigCaptor.capture(), nullable(Boolean.class), nullable(String.class));
    Map<String, EnvironmentDto> actualEnv = workspaceConfigCaptor.getValue().getEnvironments();
    assertEquals(actualEnv, expectedEnv);
  }

