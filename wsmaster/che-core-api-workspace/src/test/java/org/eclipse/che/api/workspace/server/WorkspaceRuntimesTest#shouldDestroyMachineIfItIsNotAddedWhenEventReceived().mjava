    @Test
    public void shouldDestroyMachineIfItIsNotAddedWhenEventReceived() throws Exception {
        // prepare runtimes
        runtimes = spy(new WorkspaceRuntimes(machineManager, eventService));
        doReturn(false).when(runtimes).addMachine(any());
        // prepare machine
        final MachineImpl machine = createMachine(true);
        when(machineManager.getMachine(machine.getId())).thenReturn(machine);
        // prepare event
        final MachineStatusEvent event = DtoFactory.newDto(MachineStatusEvent.class)
                                                   .withDev(true)
                                                   .withEventType(MachineStatusEvent.EventType.RUNNING)
                                                   .withMachineId(machine.getId());


        runtimes.new AddMachineEventSubscriber().onEvent(event);

        verify(machineManager).destroy(machine.getId(), true);
    }

