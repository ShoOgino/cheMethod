  @Test
  public void shouldProvisionWorkspacesWithInstallers() throws Exception {
    // given

    // make 1 of the machine configs have an installer - this should make the whole environment
    // be considered legacy and therefore the legacy env vars should be applied.
    when(machineConfig1.getInstallers()).thenReturn(singletonList(mock(InstallerImpl.class)));

    LegacyEnvVarEnvironmentProvisioner provisioner =
        new LegacyEnvVarEnvironmentProvisioner(ImmutableSet.of(provider1, provider2));

    when(provider1.get(any())).thenReturn(Pair.of("test", "test"));
    when(provider2.get(any())).thenReturn(Pair.of("test", "test"));

    // when
    provisioner.provision(RUNTIME_IDENTITY, internalEnvironment);

    // then
    verify(provider1).get(eq(RUNTIME_IDENTITY));
    verify(provider2).get(eq(RUNTIME_IDENTITY));
  }

