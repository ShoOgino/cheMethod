  @Test
  public void shouldRemoveTemporaryWorkspaces() throws Exception {
    doNothing().when(workspaceDao).remove(anyString());
    // As we want to check pagination, we return items 100 when skip count is 0 or 100,
    // return 50 items when skip count is 200, and return empty list when skip count is 300.
    doReturn(createEntities(100))
        .when(workspaceDao)
        .getWorkspaces(
            eq(true),
            intThat(
                new ArgumentMatcher<Integer>() {
                  @Override
                  public boolean matches(Object argument) {
                    return ((int) argument) < 200;
                  }
                }),
            anyInt());
    doReturn(createEntities(50))
        .when(workspaceDao)
        .getWorkspaces(
            eq(true),
            intThat(
                new ArgumentMatcher<Integer>() {
                  @Override
                  public boolean matches(Object argument) {
                    return ((int) argument) == 200;
                  }
                }),
            anyInt());
    doReturn(Collections.emptyList())
        .when(workspaceDao)
        .getWorkspaces(
            eq(true),
            intThat(
                new ArgumentMatcher<Integer>() {
                  @Override
                  public boolean matches(Object argument) {
                    return ((int) argument) > COUNT_OF_WORKSPACES;
                  }
                }),
            anyInt());

    remover.removeTemporaryWs();

    verify(workspaceDao, times(COUNT_OF_WORKSPACES)).remove(anyString());
  }

