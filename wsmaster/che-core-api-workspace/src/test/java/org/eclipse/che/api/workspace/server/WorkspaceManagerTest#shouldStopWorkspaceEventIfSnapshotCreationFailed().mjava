    @Test
    public void shouldStopWorkspaceEventIfSnapshotCreationFailed() throws Exception {
        WorkspaceImpl workspace = createAndMockWorkspace();
        mockRuntime(workspace, RUNNING);
        doThrow(new ServerException("Test")).when(runtimes).snapshot(workspace.getId());

        workspaceManager.stopWorkspace(workspace.getId(), true);

        captureAsyncTaskAndExecuteSynchronously();
        verify(runtimes).stop(any());
    }

