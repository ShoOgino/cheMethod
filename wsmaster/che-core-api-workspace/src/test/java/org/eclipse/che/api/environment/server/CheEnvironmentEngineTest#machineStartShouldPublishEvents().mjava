    @Test
    public void machineStartShouldPublishEvents() throws Exception {
        // given
        List<Instance> instances = startEnv();
        Instance instance = instances.get(0);

        MachineConfigImpl config = createConfig(false);
        when(engine.generateMachineId()).thenReturn("newMachineId");

        // when
        engine.startMachine(instance.getWorkspaceId(), config, emptyList());

        // then
        verify(eventService).publish(newDto(MachineStatusEvent.class)
                                             .withEventType(MachineStatusEvent.EventType.CREATING)
                                             .withDev(config.isDev())
                                             .withMachineName(config.getName())
                                             .withMachineId("newMachineId")
                                             .withWorkspaceId(instance.getWorkspaceId()));
        verify(eventService).publish(newDto(MachineStatusEvent.class)
                                             .withEventType(MachineStatusEvent.EventType.RUNNING)
                                             .withDev(config.isDev())
                                             .withMachineName(config.getName())
                                             .withMachineId("newMachineId")
                                             .withWorkspaceId(instance.getWorkspaceId()));
    }

