    @Test
    public void removeMachineSubscriberShouldRemoveMachineIfItIsDevAndEventIsDestroyed() throws Exception {
        // prepare runtimes
        runtimes = spy(new WorkspaceRuntimes(machineManager, eventService));
        doNothing().when(runtimes).removeMachine(anyString(), anyString(), anyString());
        // prepare event
        final MachineImpl machine = createMachine(true);
        final MachineStatusEvent event = DtoFactory.newDto(MachineStatusEvent.class)
                                                   .withDev(false)
                                                   .withEventType(MachineStatusEvent.EventType.DESTROYED)
                                                   .withMachineId(machine.getId())
                                                   .withMachineName(machine.getConfig().getName())
                                                   .withWorkspaceId(machine.getWorkspaceId());

        runtimes.new RemoveMachineEventSubscriber().onEvent(event);

        verify(runtimes).removeMachine(machine.getId(), machine.getConfig().getName(), machine.getWorkspaceId());
    }

