  @Test
  public void shouldRecoverWorkspaceWhenRecoverParameterIsTrueAndSnapshotExists() throws Exception {
    final WorkspaceImpl workspace = createAndMockWorkspace();
    mockStart(workspace);
    SnapshotImpl.SnapshotBuilder snapshotBuilder =
        SnapshotImpl.builder()
            .generateId()
            .setEnvName("env")
            .setDev(true)
            .setMachineName("machine1")
            .setWorkspaceId(workspace.getId())
            .setType("docker")
            .setMachineSource(new MachineSourceImpl("image"));
    SnapshotImpl snapshot1 = snapshotBuilder.build();
    SnapshotImpl snapshot2 =
        snapshotBuilder.generateId().setDev(false).setMachineName("machine2").build();
    when(snapshotDao.findSnapshots(workspace.getId())).thenReturn(asList(snapshot1, snapshot2));

    workspaceManager.startWorkspace(workspace.getId(), workspace.getConfig().getDefaultEnv(), true);

    verify(runtimes).startAsync(workspace, workspace.getConfig().getDefaultEnv(), true);
    assertNotNull(workspace.getAttributes().get(UPDATED_ATTRIBUTE_NAME));
  }

