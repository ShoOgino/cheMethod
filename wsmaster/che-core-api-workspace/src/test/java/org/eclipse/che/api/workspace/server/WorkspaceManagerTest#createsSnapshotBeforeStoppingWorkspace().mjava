    @Test
    public void createsSnapshotBeforeStoppingWorkspace() throws Exception {
        WorkspaceImpl workspace = createAndMockWorkspace();
        createAndMockDescriptor(workspace, RUNNING);

        workspaceManager.stopWorkspace(workspace.getId(), true);

        captureAsyncTaskAndExecuteSynchronously();
        verify(runtimes).snapshot(workspace.getId());
    }

