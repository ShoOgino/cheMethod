  @Test
  public void createsSnapshotBeforeStoppingWorkspace() throws Exception {
    WorkspaceImpl workspace = createAndMockWorkspace();
    mockRuntime(workspace, RUNNING);

    workspaceManager.stopWorkspace(workspace.getId(), true);

    captureRunAsyncCallsAndRunSynchronously();
    verify(runtimes).snapshot(workspace.getId());
  }

