  @Test(
      expectedExceptions = InfrastructureException.class,
      expectedExceptionsMessageRegExp =
          "Error occurred on retrieval of ChePlugin .*. Error: test error")
  public void throwsExceptionWhenPluginRetrievalFails() throws Exception {
    CheFeature cheFeature = testFeature();
    doReturn(cheFeature).when(retriever).getBody(any(URI.class), eq(CheFeature.class));
    doThrow(new IOException("test error"))
        .when(retriever)
        .getBody(any(URI.class), eq(ChePlugin.class));

    retriever.get(SINGLE_FEATURE_ATTRIBUTES);
  }

