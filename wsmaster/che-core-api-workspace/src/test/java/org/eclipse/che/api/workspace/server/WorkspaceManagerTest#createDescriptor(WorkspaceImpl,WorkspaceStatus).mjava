    private RuntimeDescriptor createDescriptor(WorkspaceImpl workspace, WorkspaceStatus status) {
        Optional<EnvironmentImpl> environmentOpt = workspace.getConfig().getEnvironment(workspace.getConfig().getDefaultEnv());
        assertTrue(environmentOpt.isPresent());
        EnvironmentImpl environment = environmentOpt.get();

        final WorkspaceRuntimeImpl runtime = new WorkspaceRuntimeImpl(environment.getName());
        for (MachineConfigImpl machineConfig : environment.getMachineConfigs()) {
            final MachineImpl machine = MachineImpl.builder()
                                                   .setConfig(machineConfig)
                                                   .setEnvName(environment.getName())
                                                   .setId(NameGenerator.generate("machine", 10))
                                                   .setOwner(workspace.getNamespace())
                                                   .setRuntime(new MachineRuntimeInfoImpl(emptyMap(), emptyMap(), emptyMap()))
                                                   .setWorkspaceId(workspace.getId())
                                                   .build();
            if (machineConfig.isDev()) {
                runtime.setDevMachine(machine);
            }
            runtime.getMachines().add(machine);
        }
        final RuntimeDescriptor descriptor = mock(RuntimeDescriptor.class);
        when(descriptor.getRuntimeStatus()).thenReturn(status);
        when(descriptor.getRuntime()).thenReturn(runtime);
        return descriptor;
    }

