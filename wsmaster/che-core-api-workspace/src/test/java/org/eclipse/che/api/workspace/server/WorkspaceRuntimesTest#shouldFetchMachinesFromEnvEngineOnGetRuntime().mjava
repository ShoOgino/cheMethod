    @Test
    public void shouldFetchMachinesFromEnvEngineOnGetRuntime() throws Exception {
        // given
        WorkspaceImpl workspace = createWorkspace();
        Instance devMachine = createMachine(true);
        List<Instance> machines = asList(devMachine, createMachine(false));
        when(envEngine.start(anyString(),
                             anyString(),
                             any(Environment.class),
                             anyBoolean(),
                             any()))
                .thenReturn(machines);
        when(envEngine.getMachines(WORKSPACE_ID)).thenReturn(machines);

        runtimes.start(workspace,
                       workspace.getConfig().getDefaultEnv(),
                       false);

        // when
        RuntimeDescriptor runtimeDescriptor = runtimes.get(workspace.getId());

        // then
        RuntimeDescriptor expected = new RuntimeDescriptor(WorkspaceStatus.RUNNING,
                                                           new WorkspaceRuntimeImpl(workspace.getConfig()
                                                                                             .getDefaultEnv(),
                                                                                    devMachine.getRuntime()
                                                                                              .projectsRoot(),
                                                                                    machines,
                                                                                    devMachine));
        verify(envEngine, times(2)).getMachines(workspace.getId());
        assertEquals(runtimeDescriptor, expected);
    }

