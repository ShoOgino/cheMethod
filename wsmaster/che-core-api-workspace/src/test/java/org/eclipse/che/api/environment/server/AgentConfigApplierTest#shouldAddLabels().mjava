    @Test
    public void shouldAddLabels() throws Exception {
        final ServerConfig serverConf1 = mock(ServerConfig.class);
        when(serverConf1.getPort()).thenReturn("1111/udp");
        when(serverConf1.getProtocol()).thenReturn("http");
        when(serverConf1.getPath()).thenReturn("b");

        when(sorter.sort(any())).thenReturn(singletonList(AgentKeyImpl.parse("agent1")));
        when(agent1.getServers()).thenAnswer(invocation -> singletonMap("a", serverConf1));
        CheServiceImpl service = new CheServiceImpl();

        agentConfigApplier.apply(new MachineConfigImpl(singletonList("agent1"),
                                                       emptyMap(),
                                                       emptyMap()),
                                 service);

        Map<String, String> labels = service.getLabels();
        assertEquals(labels.size(), 3);
        assertEquals(labels.get("che:server:1111/udp:ref"), "a");
        assertEquals(labels.get("che:server:1111/udp:protocol"), "http");
        assertEquals(labels.get("che:server:1111/udp:path"), "b");
    }

