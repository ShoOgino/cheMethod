    @Test
    public void shouldBeAbleToGetAllWorkspacesWithExistingRuntime() throws Exception {
        // then
        Map<String, WorkspaceRuntimes.WorkspaceState> expectedWorkspaces = new HashMap<>();
        WorkspaceImpl workspace = createWorkspace();
        runtimes.start(workspace,
                       workspace.getConfig().getDefaultEnv(),
                       false);
        expectedWorkspaces.put(workspace.getId(),
                               new WorkspaceRuntimes.WorkspaceState(RUNNING,
                                                                    workspace.getConfig().getDefaultEnv()));
        WorkspaceImpl workspace2 = spy(createWorkspace());
        when(workspace2.getId()).thenReturn("testWsId");
        when(environmentEngine.getMachines(workspace2.getId()))
                .thenReturn(Collections.singletonList(createMachine(true)));
        runtimes.start(workspace2,
                       workspace2.getConfig().getDefaultEnv(),
                       false);
        expectedWorkspaces.put(workspace2.getId(),
                               new WorkspaceRuntimes.WorkspaceState(RUNNING,
                                                                    workspace2.getConfig().getDefaultEnv()));

        // when
        Map<String, WorkspaceRuntimes.WorkspaceState> actualWorkspaces = runtimes.getWorkspaces();

        // then
        assertEquals(actualWorkspaces, expectedWorkspaces);
    }

