    @BeforeMethod
    public void setUp() throws Exception {
        CheEnvironmentEngine environmentEngine = new CheEnvironmentEngine(snapshotDao,
                                                                          machineInstanceProviders,
                                                                          "/tmp",
                                                                          2000,
                                                                          eventService,
                                                                          environmentParser,
                                                                          new DefaultServicesStartStrategy(),
                                                                          instanceProvider,
                                                                          infrastructureProvisioner,
                                                                          "http://localhost:8080/api",
                                                                          recipeDownloader,
                                                                          containerNameGenerator,
                                                                          agentRegistry);

        runtimes = new WorkspaceRuntimes(eventService,
                                         environmentEngine,
                                         agentSorter,
                                         launcherFactory,
                                         agentRegistry,
                                         snapshotDao,
                                         sharedPool);

        executor = Executors.newFixedThreadPool(
                1, new ThreadFactoryBuilder().setNameFormat(this.getClass().toString() + "-%d").build());

        EnvironmentContext.getCurrent().setSubject(new SubjectImpl("name", "id", "token", false));
    }

