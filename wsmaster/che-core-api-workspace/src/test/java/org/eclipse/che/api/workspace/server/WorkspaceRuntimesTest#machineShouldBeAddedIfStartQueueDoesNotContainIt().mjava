    @Test
    public void machineShouldBeAddedIfStartQueueDoesNotContainIt() throws Exception {
        // prepare runtime
        final WorkspaceRuntimeImpl runtime = mock(WorkspaceRuntimeImpl.class);
        final ArrayList<MachineImpl> machines = new ArrayList<>();
        when(runtime.getMachines()).thenReturn(machines);
        // prepare descriptor
        when(descriptor.getRuntime()).thenReturn(runtime);
        when(descriptor.getRuntimeStatus()).thenReturn(RUNNING);
        // register mocks
        runtimes.descriptors.put(WORKSPACE_ID, descriptor);
        runtimes.startQueues.put(WORKSPACE_ID, new ArrayDeque<>());

        final MachineImpl machine = createMachine(false);
        assertTrue(runtimes.addMachine(machine), "should be added");
        assertFalse(machines.isEmpty());
        assertEquals(machines.get(0), machine);
    }

