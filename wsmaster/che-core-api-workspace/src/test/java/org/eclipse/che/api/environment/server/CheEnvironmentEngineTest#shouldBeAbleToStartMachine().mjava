    @Test
    public void shouldBeAbleToStartMachine() throws Exception {
        // given
        List<Instance> instances = startEnv();
        String workspaceId = instances.get(0).getWorkspaceId();

        when(engine.generateMachineId()).thenReturn("newMachineId");
        Instance newMachine = mock(Instance.class);
        when(newMachine.getId()).thenReturn("newMachineId");
        when(newMachine.getWorkspaceId()).thenReturn(workspaceId);
        doReturn(newMachine).when(instanceProvider).createInstance(any(Machine.class), any(LineConsumer.class));

        MachineConfigImpl config = createConfig(false);

        // when
        Instance actualInstance = engine.startMachine(workspaceId, config);

        // then
        assertEquals(actualInstance, newMachine);
        ArgumentCaptor<Machine> argumentCaptor = ArgumentCaptor.forClass(Machine.class);
        verify(instanceProvider, times(3)).createInstance(argumentCaptor.capture(), any(LineConsumer.class));
        assertEquals(argumentCaptor.getValue().getConfig(), config);
    }

