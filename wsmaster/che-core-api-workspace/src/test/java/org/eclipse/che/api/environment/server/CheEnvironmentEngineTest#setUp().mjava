    @BeforeMethod
    public void setUp() throws Exception {
        engine = spy(new CheEnvironmentEngine(snapshotDao,
                                              machineInstanceProviders,
                                              "/tmp",
                                              DEFAULT_MACHINE_MEM_LIMIT_MB,
                                              eventService,
                                              environmentParser,
                                              new ComposeServicesStartStrategy(),
                                              composeProvider,
                                              agentConfigApplier,
                                              API_ENDPOINT,
                                              recipeDownloader));

        when(machineInstanceProviders.getProvider("docker")).thenReturn(instanceProvider);
        when(instanceProvider.getRecipeTypes()).thenReturn(Collections.singleton("dockerfile"));

        EnvironmentContext.getCurrent().setSubject(new SubjectImpl("name", "id", "token", false));
    }

