    @Test
    public void shouldBeAbleToParseComposeEnvironmentFromLocation() throws Exception {
        // given
        HashMap<String, ExtendedMachineImpl> machines = new HashMap<>();
        machines.put("machine1", new ExtendedMachineImpl(emptyList(),
                                                         emptyMap(),
                                                         emptyMap()));
        machines.put("machine2", new ExtendedMachineImpl(emptyList(),
                                                         emptyMap(),
                                                         emptyMap()));
        EnvironmentImpl environment = new EnvironmentImpl(new EnvironmentRecipeImpl("compose",
                                                                                    "application/x-yaml",
                                                                                    null,
                                                                                    "location"),
                                                          machines);
        CheServicesEnvironmentImpl expected = new CheServicesEnvironmentImpl();
        expected.getServices().put("machine1", createCheService(false));
        expected.getServices().put("machine2", createCheService(true));
        ComposeEnvironmentImpl composeEnvironment = toCompose(expected);
        when(recipeDownloader.getRecipe(eq(environment.getRecipe().getLocation()))).thenReturn("content");
        when(composeFileParser.parse(eq("content"), eq("application/x-yaml"))).thenReturn(composeEnvironment);

        // when
        CheServicesEnvironmentImpl cheServicesEnvironment = parser.parse(environment);

        // then
        assertEquals(cheServicesEnvironment, expected);
        verify(composeFileParser).parse(eq("content"), eq("application/x-yaml"));
    }

