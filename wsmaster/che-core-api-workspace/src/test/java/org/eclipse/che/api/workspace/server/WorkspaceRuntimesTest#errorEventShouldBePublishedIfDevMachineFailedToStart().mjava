    @Test
    public void errorEventShouldBePublishedIfDevMachineFailedToStart() throws Exception {
        // given
        WorkspaceImpl workspace = createWorkspace();
        when(envEngine.start(anyString(),
                             anyString(),
                             any(Environment.class),
                             anyBoolean(),
                             any()))
                .thenReturn(singletonList(createMachine(false)));

        try {
            // when
            runtimes.start(workspace,
                           workspace.getConfig().getDefaultEnv(),
                           false);

        } catch (Exception e) {
            // then
            verify(eventService).publish(DtoFactory.newDto(WorkspaceStatusEvent.class)
                                                   .withWorkspaceId(workspace.getId())
                                                   .withEventType(EventType.ERROR)
                                                   .withPrevStatus(WorkspaceStatus.STARTING));
        }
    }

