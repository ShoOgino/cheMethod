  @Test
  public void shouldBeAbleToGetWorkspacesAvailableForUser() throws Exception {
    // given
    final WorkspaceConfig config = createConfig();

    final WorkspaceImpl workspace1 = createAndMockWorkspace(config, NAMESPACE);
    final WorkspaceImpl workspace2 = createAndMockWorkspace(config, NAMESPACE_2);

    when(workspaceDao.getWorkspaces(NAMESPACE)).thenReturn(asList(workspace1, workspace2));
    mockRuntime(workspace1, STOPPED);
    mockRuntime(workspace2, RUNNING);

    // when
    final List<WorkspaceImpl> result = workspaceManager.getWorkspaces(NAMESPACE, true);

    // then
    assertEquals(result.size(), 2);

    final WorkspaceImpl res1 = result.get(0);
    assertEquals(res1.getStatus(), STOPPED);
    assertFalse(res1.isTemporary(), "Workspace must be permanent");

    final WorkspaceImpl res2 = result.get(1);
    assertEquals(
        res2.getStatus(),
        RUNNING,
        "Workspace status wasn't changed to the runtime instance status");
    assertFalse(res2.isTemporary(), "Workspace must be permanent");
  }

