    @Test
    public void shouldInjectTerminalLinkWithMachineToken() throws Exception {
        final String machineToken = "machine12";
        final MachineTokenDto tokenDto = DtoFactory.newDto(MachineTokenDto.class)
                                                          .withMachineToken(machineToken);
        final HttpJsonResponse responseMock = mock(HttpJsonResponse.class);
        when(responseMock.asDto(MachineTokenDto.class)).thenReturn(tokenDto);
        when(requestMock.request()).thenReturn(responseMock);
        final MachineDto machineDto = DtoFactory.newDto(MachineDto.class)
                                                .withId("id")
                                                .withWorkspaceId("wsId")
                                                .withRuntime(machineRuntimeInfoDtoMock);
        final List<Link> links = new ArrayList<>();
        machineLinksInjector.injectTerminalLink(machineDto, serviceContextMock, links);

        final Link resultTerminalLink = links.get(0);
        assertEquals(1, links.size());
        assertEquals(resultTerminalLink.getRel(), TERMINAL_REFERENCE);
        assertEquals(resultTerminalLink.getHref(), "ws://localhost:8080/pty?token=" + machineToken);
    }

