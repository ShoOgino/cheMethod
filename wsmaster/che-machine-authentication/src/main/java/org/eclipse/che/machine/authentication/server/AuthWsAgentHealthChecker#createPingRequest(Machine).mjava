    // modifies the ping request if it is possible to get the machine token.
    protected HttpJsonRequest createPingRequest(Machine devMachine) throws ServerException {
        final HttpJsonRequest pingRequest = super.createPingRequest(devMachine);
        final String tokenServiceUrl = UriBuilder.fromUri(apiEndpoint)
                                                 .replacePath("api/machine/token/" + devMachine.getWorkspaceId())
                                                 .build()
                                                 .toString();
        String machineToken = null;
        try {
            machineToken = httpJsonRequestFactory.fromUrl(tokenServiceUrl)
                                                 .setMethod(HttpMethod.GET)
                                                 .request()
                                                 .asDto(MachineTokenDto.class)
                                                 .getMachineToken();
        } catch (ApiException | IOException ex) {
            LOG.warn("Failed to get machine token", ex);
        }
        return machineToken == null ? pingRequest : pingRequest.setAuthorizationHeader(machineToken);
    }

