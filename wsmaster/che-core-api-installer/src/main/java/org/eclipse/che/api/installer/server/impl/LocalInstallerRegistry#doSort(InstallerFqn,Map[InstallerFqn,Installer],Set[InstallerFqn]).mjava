    private void doSort(InstallerFqn installerFqn,
                        Map<InstallerFqn, Installer> sorted,
                        Set<InstallerFqn> pending) throws InstallerException {
        if (sorted.containsKey(installerFqn)) {
            return;
        }

        Installer installer = doGet(installerFqn);

        pending.add(installerFqn);

        for (String dependency : installer.getDependencies()) {
            InstallerFqn dependencyFqn = InstallerFqn.parse(dependency);
            if (pending.contains(dependencyFqn)) {
                throw new InstallerException(
                        String.format("Installers circular dependency found between '%s' and '%s'",
                                      dependencyFqn.toString(),
                                      installerFqn));
            }
            doSort(dependencyFqn, sorted, pending);
        }

        sorted.put(installerFqn, installer);
        pending.remove(InstallerFqn.of(installer));
    }

