  @Test(
    expectedExceptions = InstallerException.class,
    expectedExceptionsMessageRegExp =
        "Installers circular dependency found between 'installer1:1.0.0'"
            + " and 'installer3:1.0.0'"
  )
  public void sortingShouldFailIfCircularDependenciesFound() throws Exception {
    when(installer1v1.getDependencies()).thenReturn(singletonList("installer2:1.0.0"));
    when(installer2v1.getDependencies()).thenReturn(singletonList("installer3:1.0.0"));
    when(installer3v1.getDependencies()).thenReturn(singletonList("installer1:1.0.0"));

    installerDao.update(new InstallerImpl(installer1v1));
    installerDao.update(new InstallerImpl(installer2v1));
    installerDao.update(new InstallerImpl(installer3v1));

    registry.getOrderedInstallers(
        asList("installer1:1.0.0", "installer2:1.0.0", "installer3:1.0.0"));
  }

