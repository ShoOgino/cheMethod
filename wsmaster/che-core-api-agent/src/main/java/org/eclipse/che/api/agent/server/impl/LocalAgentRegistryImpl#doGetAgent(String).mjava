    protected Agent doGetAgent(String name) throws AgentException {
        try {
            URL url = new URL(name);
            return doGetRemoteAgent(url);
        } catch (MalformedURLException ignored) {
            // name doesn't represent a url
        }

        Optional<Agent> agent = Optional.ofNullable(agents.get(name));
        return agent.orElseThrow(() -> new AgentNotFoundException(format("Agent %s not found", name)));
    }

