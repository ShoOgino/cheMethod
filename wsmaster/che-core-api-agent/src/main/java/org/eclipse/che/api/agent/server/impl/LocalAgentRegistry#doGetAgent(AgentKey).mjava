    private Agent doGetAgent(AgentKey key) throws AgentException {
        Optional<Agent> agent = Optional.ofNullable(agents.get(key));
        return agent.orElseThrow(() -> new AgentNotFoundException(format("Agent %s not found", key.getId())));
    }

