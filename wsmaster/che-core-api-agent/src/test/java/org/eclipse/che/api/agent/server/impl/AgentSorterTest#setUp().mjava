    @BeforeMethod
    public void setUp() throws Exception {
        when(agentRegistry.getAgent(eq(AgentKeyImpl.parse("fqn1")))).thenReturn(agent1);
        when(agentRegistry.getAgent(eq(AgentKeyImpl.parse("fqn2")))).thenReturn(agent2);
        when(agentRegistry.getAgent(eq(AgentKeyImpl.parse("fqn3")))).thenReturn(agent3);
        when(agentRegistry.getAgent(eq(AgentKeyImpl.parse("fqn4")))).thenThrow(new AgentNotFoundException("Agent not found"));

        when(agent1.getDependencies()).thenReturn(singletonList("fqn3"));
        when(agent1.getId()).thenReturn("fqn1");

        when(agent2.getDependencies()).thenReturn(singletonList("fqn3"));
        when(agent2.getId()).thenReturn("fqn2");

        when(agent3.getId()).thenReturn("fqn3");
    }

