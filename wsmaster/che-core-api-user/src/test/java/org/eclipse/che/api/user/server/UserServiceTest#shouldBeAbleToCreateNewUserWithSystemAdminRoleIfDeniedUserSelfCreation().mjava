    @Test
    public void shouldBeAbleToCreateNewUserWithSystemAdminRoleIfDeniedUserSelfCreation() throws Exception {
        when(securityContext.isUserInRole("system/admin")).thenReturn(true);
        final Field uriField = userService.getClass()
                                          .getDeclaredField("userSelfCreationAllowed");
        uriField.setAccessible(true);
        uriField.set(userService, false);

        final UserDescriptor newUser = DtoFactory.getInstance()
                                                 .createDto(UserDescriptor.class)
                                                 .withName("test")
                                                 .withEmail("test@mail.com");

        final ContainerResponse response = makeRequest(HttpMethod.POST, SERVICE_PATH + "/create", newUser);

        assertEquals(response.getStatus(), CREATED.getStatusCode());
        final UserDescriptor user = (UserDescriptor)response.getEntity();
        assertEquals(user.getName(), newUser.getName());
        assertEquals(user.getPassword(), "<none>");
        verify(userManager).create(any(User.class), eq(false));
    }

