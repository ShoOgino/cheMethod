  private void doUpdate(boolean optional, String workspaceId, Consumer<WorkspaceActivity> updater)
      throws ServerException {
    try {
      EntityManager em = managerProvider.get();
      WorkspaceActivity activity = em.find(WorkspaceActivity.class, workspaceId);
      if (activity == null) {
        if (optional) {
          return;
        }
        activity = new WorkspaceActivity();
        activity.setWorkspaceId(workspaceId);

        updater.accept(activity);

        em.persist(activity);
      } else {
        updater.accept(activity);

        em.merge(activity);
      }

      em.flush();
    } catch (RuntimeException x) {
      throw new ServerException(x.getLocalizedMessage(), x);
    }
  }

