    @Test
    public void testOldFormatIsAdaptedWhenStacksAreLoaded() throws Exception {
        final URL rootUrl = Thread.currentThread().getContextClassLoader().getResource(".");
        assertNotNull(rootUrl);
        final String path = Paths.get(rootUrl.toURI()).toString();
        final StackJsonAdapter workspaceAdapter = new StackJsonAdapter(new WorkspaceConfigJsonAdapter());
        final StackLocalStorage storageFactory = new StackLocalStorage(path, workspaceAdapter);
        final LocalStackDaoImpl stackDao = new LocalStackDaoImpl(storageFactory);

        stackDao.start();

        final StackImpl test = stackDao.getById("test");
        final EnvironmentImpl environment = test.getWorkspaceConfig()
                                                .getEnvironments()
                                                .get(test.getWorkspaceConfig().getDefaultEnv());
        assertEquals(environment.getRecipe().getType(), "dockerimage");
        assertEquals(environment.getRecipe().getLocation(), "codenvy/ubuntu_jdk8");
        assertEquals(environment.getMachines().size(), 1);
    }

