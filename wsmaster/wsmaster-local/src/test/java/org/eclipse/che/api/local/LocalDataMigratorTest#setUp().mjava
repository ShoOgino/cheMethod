    @BeforeMethod
    private void setUp() throws Exception {
        baseDir = Files.createTempDirectory(Paths.get("/tmp"), "test");
        factory = new LocalStorageFactory(baseDir.toString());
        dataMigrator = new LocalDataMigrator();
        storeTestData();
        doThrow(new NotFoundException("not-found")).when(userDao).getById(anyString());
        // needed by workspace
        when(userDao.getByName(anyString())).thenReturn(new UserImpl("id", "email", "name"));
        doThrow(new NotFoundException("not-found")).when(profileDao).getById(anyString());
        doReturn(emptyMap()).when(preferenceDao).getPreferences(anyString());
        doThrow(new NotFoundException("not-found")).when(sshDao).get(anyString(), anyString(), anyString());
        doThrow(new NotFoundException("not-found")).when(workspaceDao).get(anyString());
        doThrow(new NotFoundException("not-found")).when(snapshotDao).getSnapshot(anyString());
        doThrow(new NotFoundException("not-found")).when(recipeDao).getById(anyString());
        doThrow(new NotFoundException("not-found")).when(stackDao).getById(anyString());
    }

