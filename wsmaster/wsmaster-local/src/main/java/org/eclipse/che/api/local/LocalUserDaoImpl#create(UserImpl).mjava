    @Override
    public void create(UserImpl newUser) throws ConflictException {
        requireNonNull(newUser);
        rwLock.writeLock().lock();
        try {
            if (users.containsKey(newUser.getId())) {
                throw new ConflictException(format("Couldn't create user, user with id '%s' already exists",
                                                   newUser.getId()));
            }
            checkConflicts(newUser, "create");
            users.put(newUser.getId(), new UserImpl(newUser));
        } finally {
            rwLock.writeLock().unlock();
        }
    }

