    @Override
    public void update(ProfileImpl profile) throws NotFoundException {
        requireNonNull(profile, "Required non-null profile");
        lock.writeLock().lock();
        try {
            final Profile myProfile = profiles.get(profile.getUserId());
            if (myProfile == null) {
                throw new NotFoundException(format("Profile with id '%s' not found", profile.getUserId()));
            }
            myProfile.getAttributes().clear();
            myProfile.getAttributes().putAll(profile.getAttributes());
        } finally {
            lock.writeLock().unlock();
        }
    }

