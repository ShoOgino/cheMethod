    @Override
    public synchronized StackImpl update(StackImpl update) throws NotFoundException, ServerException, ConflictException {
        requireNonNull(update, "Stack required");
        requireNonNull(update.getId(), "Stack id required");
        String updateId = update.getId();
        if (!stacks.containsKey(updateId)) {
            throw new NotFoundException(format("Stack with id %s was not found", updateId));
        }
        if (stacks.values()
                  .stream()
                  .anyMatch(stack -> stack.getName().equals(update.getName()) && !stack.getId().equals(updateId))) {
            throw new ConflictException(format("Stack with name '%s' already exists", updateId));
        }
        stacks.replace(updateId, new StackImpl(update));
        return new StackImpl(update);
    }

