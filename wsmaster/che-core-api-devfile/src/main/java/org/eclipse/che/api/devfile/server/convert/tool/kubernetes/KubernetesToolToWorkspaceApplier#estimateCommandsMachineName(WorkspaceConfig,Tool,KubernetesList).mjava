  /**
   * Set {@link Command#MACHINE_NAME_ATTRIBUTE} to commands which are configured in the specified
   * tool.
   *
   * <p>Machine name will be set only if the specified recipe objects has the only one container.
   */
  private void estimateCommandsMachineName(
      WorkspaceConfig workspaceConfig, Tool tool, KubernetesList recipeObjects) {
    List<? extends Command> toolCommands =
        workspaceConfig
            .getCommands()
            .stream()
            .filter(
                c ->
                    tool.getName()
                        .equals(c.getAttributes().get(Constants.TOOL_NAME_COMMAND_ATTRIBUTE)))
            .collect(toList());
    if (toolCommands.isEmpty()) {
      return;
    }
    List<Pod> pods =
        recipeObjects
            .getItems()
            .stream()
            .filter(hasMetadata -> hasMetadata instanceof Pod)
            .map(hasMetadata -> (Pod) hasMetadata)
            .collect(toList());

    Pod pod;
    if (pods.size() != 1 || (pod = pods.get(0)).getSpec().getContainers().isEmpty()) {
      // recipe contains several containers
      // can not estimate commands machine name
      return;
    }

    String machineName = Names.machineName(pod, pod.getSpec().getContainers().get(0));
    toolCommands.forEach(c -> c.getAttributes().put(MACHINE_NAME_ATTRIBUTE, machineName));
  }

