  private void search(
      Collection<? extends KubernetesResource> list,
      Collection<Container> results,
      boolean insideDeployment,
      boolean insidePod) {

    for (KubernetesResource o : list) {
      if (o instanceof Container) {
        if (matchesContainer(insidePod, insideDeployment, ((Container) o).getName())) {
          results.add((Container) o);
        }
      } else if (o instanceof Pod) {
        if (matchesPod(insideDeployment, ((Pod) o).getMetadata())) {
          search(((Pod) o).getSpec().getContainers(), results, insideDeployment, true);
        }
      } else if (o instanceof Deployment) {
        Deployment d = (Deployment) o;
        PodTemplateSpec p = d.getSpec().getTemplate();

        if (matchesDeployment(d.getMetadata()) && matchesPod(true, p.getMetadata())) {
          search(p.getSpec().getContainers(), results, true, true);
        }
      } else if (o instanceof Template) {
        search(((Template) o).getObjects(), results, false, false);
      } else if (o instanceof KubernetesList) {
        search(((KubernetesList) o).getItems(), results, false, false);
      }
    }
  }

