    protected Agent doGetAgent(String id) throws AgentException {
        try {
            URL url = new URL(id);
            return doGetRemoteAgent(url);
        } catch (MalformedURLException ignored) {
            // id doesn't represent a url
        }

        Optional<Agent> agent = Optional.ofNullable(agents.get(id));
        return agent.orElseThrow(() -> new AgentNotFoundException(format("Agent %s not found", id)));
    }

