  @Test
  public void shouldStartMachineProcessWithAgentScriptExecution() throws Exception {
    // given
    String agentId = "testAgentId";
    String agentScript = "testAgentScript";
    when(agent.getId()).thenReturn(agentId);
    when(agent.getScript()).thenReturn(agentScript);
    doCallRealMethod()
        .when(launcher)
        .start(nullable(Instance.class), nullable(Agent.class), nullable(LineConsumer.class));

    // when
    launcher.launch(machine, agent);

    // then
    verify(machine).createProcess(eq(new CommandImpl(agentId, agentScript, "agent")), eq(null));
  }

