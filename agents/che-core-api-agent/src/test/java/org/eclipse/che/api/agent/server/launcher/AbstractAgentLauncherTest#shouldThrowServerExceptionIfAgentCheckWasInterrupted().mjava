    @Test(expectedExceptions = ServerException.class, expectedExceptionsMessageRegExp = "Launching agent .* is interrupted")
    public void shouldThrowServerExceptionIfAgentCheckWasInterrupted() throws Exception {
        try {
            when(agentChecker.isLaunched(any(Agent.class),
                                         any(InstanceProcess.class),
                                         any(Instance.class))).thenAnswer(invocationOnMock -> {
                Thread.currentThread().interrupt();
                return false;
            });

            // when
            launcher.launch(machine, agent);
        } finally {
            // cleanup interrupted state
            Thread.interrupted();
        }
    }

