  @Test(expectedExceptions = IllegalArgumentException.class)
  public void shouldNotRegisterAgentWithSameIdAndVersion() throws Exception {
    new AgentRegistryImpl(
        new HashSet<Agent>() {
          {
            add(DtoFactory.newDto(AgentDto.class).withId("id1").withVersion("v1").withScript("s1"));
            add(DtoFactory.newDto(AgentDto.class).withId("id1").withVersion("v1").withScript("s2"));
          }
        });
  }

