    @Test
    public void shouldSetBackInterruptedFlagIfThreadWasInterrupted() throws Exception {
        try {
            // imitate interruption of launching thread
            when(agentChecker.isLaunched(any(Agent.class),
                                         any(InstanceProcess.class),
                                         any(Instance.class))).thenAnswer(invocationOnMock -> {
                Thread.currentThread().interrupt();
                return false;
            });

            // when
            launcher.launch(machine, agent);
        } catch (ServerException e) {
            // Ensure that after exiting launcher thread is still in interrupted state
            assertTrue(Thread.currentThread().isInterrupted());
        } finally {
            // cleanup interrupted state
            Thread.interrupted();
        }
    }

