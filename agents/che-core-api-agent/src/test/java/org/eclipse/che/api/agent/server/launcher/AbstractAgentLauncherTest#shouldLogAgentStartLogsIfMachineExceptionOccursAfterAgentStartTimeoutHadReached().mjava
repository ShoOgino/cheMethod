    @Test(expectedExceptions = ServerException.class, expectedExceptionsMessageRegExp = "An error on process kill")
    public void shouldLogAgentStartLogsIfMachineExceptionOccursAfterAgentStartTimeoutHadReached() throws Exception {
        // given
        launcher = spy(new TestAgentLauncher(-1, 100, agentChecker));
        when(agentChecker.isLaunched(any(Agent.class),
                                     any(InstanceProcess.class),
                                     any(Instance.class))).thenReturn(false);

        doReturn(process).when(launcher).start(any(Instance.class), any(Agent.class), any(LineConsumer.class));
        doThrow(new MachineException("An error on process kill")).when(process).kill();

        // when
        launcher.launch(machine, agent);

        // then
        verify(launcher).logAsErrorAgentStartLogs(anyString(), anyString());
    }

