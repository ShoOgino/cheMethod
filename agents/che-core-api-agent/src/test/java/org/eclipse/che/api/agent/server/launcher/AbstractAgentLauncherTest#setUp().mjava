  @BeforeMethod
  public void setUp() throws Exception {
    launcher = spy(new TestAgentLauncher(500, 100, agentChecker));

    when(agent.getScript()).thenReturn("script content");
    doReturn(process)
        .when(launcher)
        .start(nullable(Instance.class), nullable(Agent.class), nullable(LineConsumer.class));
    when(agentChecker.isLaunched(
            nullable(Agent.class), nullable(InstanceProcess.class), nullable(Instance.class)))
        .thenReturn(true);
    when(machine.getNode()).thenReturn(mock(InstanceNode.class));
  }

