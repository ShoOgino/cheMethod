    @BeforeMethod
    public void setUp() throws Exception {
        launcher = spy(new TestAgentLauncher(500, 100, agentChecker));

        when(agent.getScript()).thenReturn("script content");
        doReturn(process).when(launcher).start(any(Instance.class), any(Agent.class), any(LineConsumer.class));
        when(agentChecker.isLaunched(any(Agent.class),
                                     any(InstanceProcess.class),
                                     any(Instance.class))).thenReturn(true);
        when(machine.getNode()).thenReturn(mock(InstanceNode.class));
    }

