  @Test
  public void workingWithAgents() {
    workspaceDetails.selectTabInWorkspaceMenu(AGENTS);

    // check all needed agents in dev-machine exist
    workspaceMachines.selectMachine("Workspace Agents", "dev-machine");
    agents.forEach(
        (name, value) -> {
          workspaceAgents.checkAgentExists(name);
        });

    // switch all agents and save changes
    agents.forEach(
        (name, value) -> {
          Assert.assertEquals(workspaceAgents.getAgentState(name), value);
          workspaceAgents.switchAgentState(name);
          WaitUtils.sleepQuietly(1);
        });
    clickOnSaveButton();

    // switch all agents, save changes and check its states are as previous(by default for the
    // Java-MySql stack)
    agents.forEach(
        (name, value) -> {
          workspaceAgents.switchAgentState(name);
          loader.waitOnClosed();
        });
    clickOnSaveButton();
    agents.forEach(
        (name, value) -> {
          Assert.assertEquals(workspaceAgents.getAgentState(name), value);
        });
  }

