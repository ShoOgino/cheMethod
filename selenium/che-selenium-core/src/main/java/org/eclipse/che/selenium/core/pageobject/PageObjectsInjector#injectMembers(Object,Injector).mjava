  public void injectMembers(Object testInstance, Injector injector) throws Exception {
    Map<Integer, Set<Field>> toInject = collectFieldsToInject(testInstance);

    for (Integer poIndex : toInject.keySet()) {
      Map<Class<?>, Object> container = new HashMap<>();
      SeleniumWebDriver seleniumWebDriver =
          new SeleniumWebDriver(browser, webDriverPort, gridMode, webDriverVersion);

      container.put(SeleniumWebDriver.class, seleniumWebDriver);
      container.putAll(getDependenciesWithWebdriver(seleniumWebDriver));

      for (Field f : toInject.get(poIndex)) {
        LoggerFactory.getLogger(this.getClass())
            .info("Inject field {} into test {}.", f, testInstance);

        try {
          injectField(f, testInstance, container, injector);
        } catch (Exception e) {
          LoggerFactory.getLogger(this.getClass())
              .error(
                  format(
                      "Error of injection member '%s' into test '%s'. %s",
                      f, testInstance, e.getMessage()),
                  e);
          throw e;
        }
      }
    }
  }

