  /** Is invoked when test or configuration is finished. */
  private void onTestFinish(ITestResult result) {
    if (result.getStatus() == ITestResult.FAILURE || result.getStatus() == ITestResult.SKIP) {
      switch (result.getStatus()) {
        case ITestResult.FAILURE:
          String errorDetails =
              result.getThrowable() != null
                  ? " Error: " + result.getThrowable().getLocalizedMessage()
                  : "";

          LOG.error("Test {} failed.{}", getCompletedTestLabel(result.getMethod()), errorDetails);
          LOG.debug(result.getThrowable().getLocalizedMessage(), result.getThrowable());

          testsWithFailure.put(result.getTestClass().getRealClass().getName(), result.getMethod());

          captureScreenshot(result);
          captureHtmlSource(result);
          captureTestWorkspaceLogs(result);
          storeWebDriverLogs(result);

          break;

        case ITestResult.SKIP:
          LOG.warn("Test {} skipped.", getCompletedTestLabel(result.getMethod()));
          break;

        default:
      }
    }
  }

