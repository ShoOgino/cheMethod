  /** Is invoked when test or configuration is finished. */
  private void onTestFinish(ITestResult result) {
    if (result.getStatus() == ITestResult.FAILURE || result.getStatus() == ITestResult.SKIP) {
      switch (result.getStatus()) {
        case ITestResult.FAILURE:
          String errorDetails =
              result.getThrowable() != null
                  ? " Error: " + result.getThrowable().getLocalizedMessage()
                  : "";

          LOG.error("Test {} failed.{}", getCompletedTestLabel(result.getMethod()), errorDetails);
          LOG.debug(result.getThrowable().getLocalizedMessage(), result.getThrowable());

          testsWithFailure.put(result.getTestClass().getRealClass().getName(), result.getMethod());

          break;

        case ITestResult.SKIP:
          LOG.warn("Test {} skipped.", getCompletedTestLabel(result.getMethod()));

          // don't capture test data if test is skipped because of previous test with higher priority
          // failed
          if (testsWithFailure.containsKey(result.getMethod().getInstance().getClass().getName())) {
            return;
          }

          break;

        default:
      }

      captureScreenshot(result);
      captureHtmlSource(result);
      captureTestWorkspaceLogs(result);
      storeWebDriverLogs(result);
    }
  }

