    @Override
    public JsonObject getState() {
        final List<Path> paths = new ArrayList<>();

        /*
           The main idea is to look up all expanded nodes in project tree and gather the last one's children.
           Then check if child is resource, then we store the path in user preference.
         */

        outer:
        for (Node node : projectExplorer.getTree().getNodeStorage().getAll()) {
            if (projectExplorer.getTree().isExpanded(node) && node instanceof ResourceNode) {

                final List<Node> childrenToStore = projectExplorer.getTree().getNodeStorage().getChildren(node);

                for (Node children : childrenToStore) {
                    if (children instanceof ResourceNode) {
                        paths.add(((ResourceNode) children).getData().getLocation());
                        continue outer;
                    }
                }
            }
        }

        JsonObject state = Json.createObject();
        JsonArray array = Json.createArray();
        state.put(PATH_PARAM_ID, array);
        int i = 0;
        for (Path path : paths) {
            array.set(i++, path.toString());
        }

        state.put(SHOW_HIDDEN_FILES, projectExplorer.isShowHiddenFiles());

        return state;
    }

