    /**
     * Connects to special WebSocket which allows get information from terminal on server side. The terminal is initialized only
     * when the method is called the first time.
     */
    public void connect() {
        if (countRetry == 0) {
            return;
        }

        if (!connected) {
            terminalHolder.getInitializerPromise().then(new Operation<Void>() {
                @Override
                public void apply(Void arg) throws OperationException {
                    final Optional<ServerImpl> terminalServer = machine.getServerByName(TERMINAL_REFERENCE);

                    if (terminalServer.isPresent()) {
                        final String terminalServerURL = terminalServer.get().getUrl();
                        // FIXME: spi
                        connectToTerminalWebSocket(terminalServerURL.replaceFirst("http", "ws") + "/pty");
                    } else {
                        throw new OperationException("Machine " + machine.getName() + " doesn't provide terminal server.");
                    }
                }
            }).catchError(new Operation<PromiseError>() {
                @Override
                public void apply(PromiseError arg) throws OperationException {
                    notificationManager.notify(locale.failedToConnectTheTerminal(),
                                               locale.terminalCanNotLoadScript(),
                                               FAIL,
                                               NOT_EMERGE_MODE);
                    reconnect();
                }
            });
        }
    }

