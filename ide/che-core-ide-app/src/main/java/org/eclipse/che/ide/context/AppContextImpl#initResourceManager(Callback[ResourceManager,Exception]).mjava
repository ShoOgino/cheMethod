  @Override
  public void initResourceManager(final Callback<ResourceManager, Exception> callback) {
    if (runtime.getDevMachine() == null) {
      //should never happened, but anyway
      callback.onFailure(new NullPointerException("Dev machine is not initialized"));
    }

    if (!rootProjects.isEmpty()) {
      for (Project project : rootProjects) {
        eventBus.fireEvent(new ResourceChangedEvent(new ResourceDeltaImpl(project, REMOVED)));
      }
      rootProjects.clear();
    }

    resourceManager = resourceManagerFactory.newResourceManager(runtime.getDevMachine());
    resourceManager
        .getWorkspaceProjects()
        .then(
            projects -> {
              rootProjects.clear();
              addAll(rootProjects, projects);
              rootProjects.sort(ResourcePathComparator.getInstance());
              callback.onSuccess(resourceManager);
              eventBus.fireEvent(new WorkspaceReadyEvent(projects));
            })
        .catchError(
            error -> {
              callback.onFailure((Exception) error.getCause());
            });
  }

