    @Override
    public Promise<CommandImpl> createCommand(String goalId,
                                              String typeId,
                                              @Nullable String name,
                                              @Nullable String commandLine,
                                              Map<String, String> attributes,
                                              ApplicableContext context) {
        final CommandType commandType = commandTypeRegistry.getCommandTypeById(typeId);

        if (commandType == null) {
            return promiseProvider.reject(new Exception("Unknown command type: '" + typeId + "'"));
        }

        final Map<String, String> attr = new HashMap<>(attributes);
        attr.put(COMMAND_PREVIEW_URL_ATTRIBUTE_NAME, commandType.getPreviewUrlTemplate());
        attr.put(COMMAND_GOAL_ATTRIBUTE_NAME, goalId);

        return createCommand(new CommandImpl(getUniqueCommandName(typeId, name),
                                             commandLine != null ? commandLine : commandType.getCommandLineTemplate(),
                                             typeId,
                                             attr,
                                             context));
    }

