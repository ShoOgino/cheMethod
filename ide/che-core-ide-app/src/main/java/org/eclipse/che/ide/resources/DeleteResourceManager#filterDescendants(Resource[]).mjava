    private Resource[] filterDescendants(Resource[] resources) {
        List<Resource> filteredElements = newArrayList(resources);

        int previousSize;

        do {
            previousSize = filteredElements.size();
            outer:
            for (Resource element : filteredElements) {
                for (Resource element2 : filteredElements) {
                    if (element == element2) {
                        continue;
                    }
                    //compare only paths to increase performance, don't operation in this case with parents
                    if (element.getLocation().isPrefixOf(element2.getLocation())) {
                        filteredElements.remove(element2);
                        break outer;
                    }
                }
            }
        }
        while (filteredElements.size() != previousSize);

        return filteredElements.toArray(new Resource[filteredElements.size()]);
    }

