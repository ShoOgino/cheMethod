  @Override
  public void start(final Callback<Component, Exception> callback) {
    preferencesManager
        .loadPreferences()
        .then(
            new Operation<Map<String, String>>() {
              @Override
              public void apply(Map<String, String> preferences) throws OperationException {
                currentUser.setPreferences(preferences);

                if (appContext instanceof AppContextImpl) {
                  ((AppContextImpl) appContext).setCurrentUser(currentUser);
                }

                setTheme();

                styleInjector.inject();
                callback.onSuccess(PreferencesComponent.this);
              }
            })
        .catchError(
            new Operation<PromiseError>() {
              @Override
              public void apply(PromiseError arg) throws OperationException {
                callback.onFailure(new Exception(locale.unableToLoadPreference(), arg.getCause()));
              }
            });
  }

