  protected Promise<ResourceDelta[]> synchronize(final ResourceDelta[] deltas) {
    Promise<Void> chain = promises.resolve(null);

    for (final ResourceDelta delta : deltas) {
      if (delta.getKind() == ADDED) {
        if (delta.getFlags() == (MOVED_FROM | MOVED_TO)) {
          chain = chain.thenPromise(ignored -> onExternalDeltaMoved(delta));
        } else {
          chain = chain.thenPromise(ignored -> onExternalDeltaAdded(delta));
        }
      } else if (delta.getKind() == REMOVED) {
        chain = chain.thenPromise(ignored -> onExternalDeltaRemoved(delta));
      } else if (delta.getKind() == UPDATED) {
        chain = chain.thenPromise(ignored -> onExternalDeltaUpdated(delta));
      }
    }
    return chain.thenPromise(ignored -> promises.resolve(deltas));
  }

