  @Inject
  public EditorPaneMenuWidget(Resources resources) {
    this.resources = resources;

    initWidget(UI_BINDER.createAndBindUi(this));

    closeTime = System.currentTimeMillis();
    addDomHandler(
        new MouseDownHandler() {
          @Override
          public void onMouseDown(MouseDownEvent event) {
            long time = System.currentTimeMillis();
            if (time - closeTime < 100) {
              return;
            }
            show();
          }
        },
        MouseDownEvent.getType());

    FlowPanel rootPanel = new FlowPanel();
    rootPanel.addStyleName(resources.partStackCss().listItemPanel());

    itemsPanel = new FlowPanel();
    actionsPanel = new FlowPanel();

    popupPanel = new PopupPanel();
    popupPanel.setAutoHideEnabled(true);
    popupPanel.removeStyleName(GWT_POPUP_STANDARD_STYLE);

    popupPanel.add(rootPanel);
    rootPanel.add(itemsPanel);
    rootPanel.add(getDelimiter());
    rootPanel.add(actionsPanel);

    popupPanel.addCloseHandler(
        new CloseHandler<PopupPanel>() {
          @Override
          public void onClose(CloseEvent<PopupPanel> event) {
            closeTime = System.currentTimeMillis();
          }
        });
  }

