  private JsonObject getPartStackState(
      PartStack partStack, WorkBenchPartController partController) {
    JsonObject state = Json.createObject();
    state.put(PART_STACK_SIZE, partController.getSize());
    state.put(PART_STACK_STATE, partStack.getPartStackState().name());

    if (partStack.getParts().isEmpty()) {
      state.put(HIDDEN_STATE, true);
    } else {
      if (partStack.getActivePart() != null) {
        state.put(ACTIVE_PART, partStack.getActivePart().getClass().getName());
      }
      state.put(HIDDEN_STATE, partController.isHidden());

      JsonArray parts = Json.createArray();
      state.put(PART_STACK_PARTS, parts);
      int i = 0;
      for (PartPresenter entry : partStack.getParts()) {
        JsonObject presenterState = Json.createObject();
        presenterState.put(PART_CLASS_NAME, entry.getClass().getName());
        parts.set(i++, presenterState);
      }
    }
    return state;
  }

