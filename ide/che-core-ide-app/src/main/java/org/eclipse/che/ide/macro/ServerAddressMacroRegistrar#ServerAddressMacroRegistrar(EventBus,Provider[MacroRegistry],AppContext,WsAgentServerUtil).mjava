  @Inject
  public ServerAddressMacroRegistrar(
      EventBus eventBus,
      Provider<MacroRegistry> macroRegistryProvider,
      AppContext appContext,
      WsAgentServerUtil wsAgentServerUtil) {
    this.macroRegistryProvider = macroRegistryProvider;
    this.appContext = appContext;
    this.wsAgentServerUtil = wsAgentServerUtil;

    eventBus.addHandler(
        BasicIDEInitializedEvent.TYPE,
        e -> {
          if (appContext.getWorkspace().getStatus() == RUNNING) {
            registerMacros();
          }
        });

    eventBus.addHandler(WorkspaceRunningEvent.TYPE, e -> registerMacros());

    eventBus.addHandler(
        WorkspaceStoppedEvent.TYPE,
        e -> {
          macros.forEach(macro -> macroRegistryProvider.get().unregister(macro));
          macros.clear();
        });
  }

