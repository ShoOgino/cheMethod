  @Override
  public FileType getFileTypeByExtension(String extension) {
    if (isNullOrEmpty(extension)) {
      return unknownFileType;
    }

    Set<FileType> typesByExtension =
        fileTypes.stream().filter(type -> extension.equals(type.getExtension())).collect(toSet());
    if (typesByExtension.isEmpty()) {
      return unknownFileType;
    }

    String nameToTest = '.' + extension;
    Optional<FileType> fileType =
        typesByExtension
            .stream()
            .filter(type -> doesFileNameMatchType(nameToTest, type))
            .findFirst();
    if (fileType.isPresent()) {
      return fileType.get();
    }

    fileType =
        typesByExtension.stream().filter(type -> type.getNamePatterns().isEmpty()).findFirst();
    return fileType.orElseGet(() -> typesByExtension.iterator().next());
  }

