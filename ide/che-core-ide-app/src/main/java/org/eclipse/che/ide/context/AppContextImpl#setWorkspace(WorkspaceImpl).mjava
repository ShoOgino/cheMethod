  /** Sets the current workspace. */
  public void setWorkspace(WorkspaceImpl workspace) {
    this.workspace = new WorkspaceImpl(workspace);

    if (appStateEventRemover != null) {
      appStateEventRemover.remove();
    }

    // in some cases IDE doesn't save preferences on window close
    // so try to save if window lost focus
    appStateEventRemover =
        Elements.getWindow()
            .addEventListener(Event.BLUR, evt -> appStateManager.get().persistWorkspaceState());
  }

