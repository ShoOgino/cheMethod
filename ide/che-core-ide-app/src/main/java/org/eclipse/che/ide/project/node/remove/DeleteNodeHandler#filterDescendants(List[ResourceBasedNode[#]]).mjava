    @NotNull
    private List<ResourceBasedNode<?>> filterDescendants(@NotNull List<ResourceBasedNode<?>> nodes) {
        List<ResourceBasedNode<?>> filteredElements = Lists.newArrayList(nodes);

        int previousSize;

        do {
            previousSize = filteredElements.size();
            outer:
            for (ResourceBasedNode<?> element : filteredElements) {
                for (ResourceBasedNode<?> element2 : filteredElements) {
                    if (element == element2) {
                        continue;
                    }
                    if (isAncestor(element, element2)) {
                        filteredElements.remove(element2);
                        break outer;
                    }
                }
            }
        }
        while (filteredElements.size() != previousSize);

        return filteredElements;
    }

