    private void fetchCommands(Callback<WsAgentComponent, Exception> callback) {
        // get all commands related to the workspace
        workspaceCommandManager.getCommands(appContext.getWorkspaceId()).then(workspaceCommands -> {
            workspaceCommands.forEach(workspaceCommand -> commands.put(workspaceCommand.getName(),
                                                                       new CommandImpl(workspaceCommand, new ApplicableContext())));

            // get all commands related to the projects
            Arrays.stream(appContext.getProjects())
                  .forEach(project -> projectCommandManager.getCommands(project).forEach(projectCommand -> {
                      final CommandImpl existedCommand = commands.get(projectCommand.getName());

                      if (existedCommand == null) {
                          commands.put(projectCommand.getName(),
                                       new CommandImpl(projectCommand, new ApplicableContext(project.getPath())));
                      } else {
                          if (projectCommand.equalsIgnoreContext(existedCommand)) {
                              existedCommand.getApplicableContext().addProject(project.getPath());
                          } else {
                              // normally, should never happen
                              Log.error(CommandManagerImpl.this.getClass(), "Different commands with the same names found");
                          }
                      }
                  }));

            callback.onSuccess(this);

            notifyCommandsLoaded();
        });
    }

