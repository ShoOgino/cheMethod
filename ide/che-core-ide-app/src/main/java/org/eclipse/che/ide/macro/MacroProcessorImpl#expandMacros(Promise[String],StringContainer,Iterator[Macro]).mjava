    private Promise<String> expandMacros(Promise<String> promise,
                                         StringContainer stringContainer,
                                         Iterator<Macro> iterator) {
        if (!iterator.hasNext()) {
            return promise;
        }

        Macro macro = iterator.next();
        Promise<String> derivedPromise = promise.thenPromise(expandMacro(stringContainer, macro));

        return expandMacros(derivedPromise, stringContainer, iterator);
    }

