  /** Start the current workspace with a default environment. */
  Promise<Void> startWorkspace(boolean restoreFromSnapshot) {
    WorkspaceImpl workspace = appContext.getWorkspace();
    String defEnvName = workspace.getConfig().getDefaultEnv();

    return workspaceServiceClient
        .startById(workspace.getId(), defEnvName, restoreFromSnapshot)
        .then(
            ws -> {
              ((AppContextImpl) appContext).setWorkspace(ws);

              if (ws.getStatus() == STARTING) {
                eventBus.fireEvent(new WorkspaceStartingEvent());
                // rarely possible case when workspace starts "immediately" in some infrastructures
              } else if (ws.getStatus() == RUNNING) {
                eventBus.fireEvent(new WorkspaceStartingEvent());
                eventBus.fireEvent(new WorkspaceRunningEvent());
              }
            })
        .then((Function<WorkspaceImpl, Void>) arg -> null);
  }

