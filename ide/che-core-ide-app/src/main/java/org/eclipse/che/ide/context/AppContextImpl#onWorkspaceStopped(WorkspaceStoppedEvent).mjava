  @Override
  public void onWorkspaceStopped(WorkspaceStoppedEvent event) {
    appStateManager
        .get()
        .persistWorkspaceState(getWorkspaceId())
        .then(
            ignored -> {
              for (Project project : rootProjects) {
                eventBus.fireEvent(
                    new ResourceChangedEvent(new ResourceDeltaImpl(project, REMOVED)));
              }

              rootProjects.clear();
              resourceManager = null;
            });

    clearRuntime();
  }

