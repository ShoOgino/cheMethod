    private Project getProject(VirtualFile file) {
        if (file == null || !(file instanceof Resource)) {
            return null;
        }

        Project project = ((Resource)file).getProject();
        return (project != null && project.exists()) ? project : null;
    }

