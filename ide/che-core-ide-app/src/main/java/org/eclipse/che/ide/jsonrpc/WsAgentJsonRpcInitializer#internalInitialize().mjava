    private void internalInitialize() {
        final WorkspaceImpl workspace = appContext.getWorkspace();
        final RuntimeImpl runtime = workspace.getRuntime();

        if (runtime == null) {
            return; // workspace is stopped
        }

        runtime.getDevMachine().ifPresent(devMachine -> {
            Optional<ServerImpl> wsAgentServer = devMachine.getServerByName(WSAGENT_REFERENCE);

            wsAgentServer.ifPresent(server -> {
                final String wsAgentBaseUrl = server.getUrl() + "/api"; // FIXME: spi ide
                final String wsAgentWebSocketUrl = wsAgentBaseUrl.replaceFirst("http", "ws") + "/ws"; // FIXME: spi ide
                final String wsAgentUrl = wsAgentWebSocketUrl.replaceFirst("(api)(/)(ws)", "websocket" + "$2" + appContext.getAppId());

                initializer.initialize("ws-agent", singletonMap("url", wsAgentUrl));
            });
        });
    }

