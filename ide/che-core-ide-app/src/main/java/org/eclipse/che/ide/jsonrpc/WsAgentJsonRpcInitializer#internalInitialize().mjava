    private void internalInitialize() {
        final WorkspaceImpl workspace = appContext.getWorkspace();
        final RuntimeImpl runtime = workspace.getRuntime();

        if (runtime == null) {
            return; // workspace is stopped
        }

        runtime.getDevMachine().ifPresent(devMachine -> {
            devMachine.getServerByName(SERVER_WS_AGENT_WEBSOCKET_REFERENCE).ifPresent(server -> {
                String separator = server.getUrl().contains("?") ? "&" : "?";
                String queryParams = appContext.getApplicationWebsocketId().map(id -> separator + "clientId=" + id).orElse("");
                Set<Runnable> initActions = appContext.getApplicationWebsocketId().isPresent() ? emptySet() : singleton(this::processWsId);

                initializer.initialize(WS_AGENT_JSON_RPC_ENDPOINT_ID, singletonMap("url", server.getUrl() + queryParams), initActions);
            });
        });
    }

