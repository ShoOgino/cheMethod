    private Promise<Void> writeStateToPreferences() {
        final String json = dtoFactory.toJson(appState);
        Log.info(getClass(), "write: " + json);
        preferencesManager.setValue(PREFERENCE_PROPERTY_NAME, json);
        return preferencesManager.flushPreferences().catchError(new Operation<PromiseError>() {
            @Override
            public void apply(PromiseError arg) throws OperationException {
                Log.error(AppStateManager.class, "Failed to store app's state to user's preferences");
            }
        });
    }

