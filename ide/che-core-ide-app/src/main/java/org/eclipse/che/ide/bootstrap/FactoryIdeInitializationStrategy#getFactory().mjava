  private Promise<FactoryDto> getFactory() {
    Map<String, String> factoryParameters = new HashMap<>();
    for (Map.Entry<String, String> queryParam : queryParameters.getAll().entrySet()) {
      String key = queryParam.getKey();
      if (key.startsWith("factory-")) {
        factoryParameters.put(key.substring("factory-".length()), queryParam.getValue());
      }
    }

    Promise<FactoryDto> factoryPromise;
    // Factory may be based on id or on parameters
    if (factoryParameters.containsKey("id")) {
      factoryPromise = factoryServiceClient.getFactory(factoryParameters.get("id"), true);
    } else {
      factoryPromise = factoryServiceClient.resolveFactory(factoryParameters, true);
    }

    return factoryPromise;
  }

