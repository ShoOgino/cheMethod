  public Promise<Void> persistWorkspaceState(String wsId) {
    JsonObject settings = Json.createObject();
    JsonObject workspace = Json.createObject();
    settings.put(WORKSPACE, workspace);

    for (StateComponent entry : persistenceComponents) {
      try {
        Log.debug(getClass(), "Persist state for the component ID: " + entry.getId());
        workspace.put(entry.getId(), entry.getState());
      } catch (Exception e) {
        Log.error(getClass(), e);
      }
    }
    JsonObject oldSettings = allWsState.getObject(wsId);
    if (oldSettings == null || !oldSettings.toJson().equals(settings.toJson())) {
      allWsState.put(wsId, settings);
      return writeStateToPreferences(allWsState);
    } else {
      return promises.resolve(null);
    }
  }

