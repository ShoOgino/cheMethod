  /** Opens new terminal for the selected machine and activates terminal tab. */
  public void newTerminal(TerminalOptionsJso options, boolean activate, boolean focusOnOpen) {
    final ProcessTreeNode selectedTreeNode = view.getSelectedTreeNode();

    final Optional<MachineImpl> devMachine = wsAgentServerUtil.getWsAgentServerMachine();

    if (selectedTreeNode == null && devMachine.isPresent()) {
      onAddTerminal(devMachine.get().getName(), options, activate, focusOnOpen);
      return;
    }

    if (selectedTreeNode == null) {
      String notificationTitle = localizationConstant.failedToConnectTheTerminal();
      String notificationContent = localizationConstant.machineNotFound("");
      notificationManager.notify(notificationTitle, notificationContent, FAIL, FLOAT_MODE);
      return;
    }

    if (selectedTreeNode.getType() == MACHINE_NODE) {
      String machineName = (String) selectedTreeNode.getData();
      onAddTerminal(machineName, options, activate, focusOnOpen);
      return;
    }

    ProcessTreeNode parent = selectedTreeNode.getParent();
    if (parent != null && parent.getType() == MACHINE_NODE) {
      String machineName = (String) parent.getData();
      onAddTerminal(machineName, options, activate, focusOnOpen);
    }
  }

