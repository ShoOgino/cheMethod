  @Override
  public Promise<CommandImpl> createCommand(CommandImpl command) {
    return doCreateCommand(command)
        .then(
            (Function<CommandImpl, CommandImpl>)
                newCommand -> {
                  // postpone the notification because
                  // listeners should be notified after returning from #createCommand method
                  Scheduler.get().scheduleDeferred(() -> notifyCommandAdded(newCommand));

                  return newCommand;
                });
  }

