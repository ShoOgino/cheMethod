    public Promise<Void> persistWorkspaceState() {
        String wsId = appContext.getWorkspace().getId();
        JsonObject settings = Json.createObject();
        JsonObject workspace = Json.createObject();
        settings.put(WORKSPACE, workspace);

        for (StateComponent entry : stateComponentRegistry.get().getComponents()) {
            try {
                Log.debug(getClass(), "Persist state for the component ID: " + entry.getId());
                workspace.put(entry.getId(), entry.getState());
            } catch (Exception e) {
                Log.error(getClass(), e);
            }
        }
        allWsState.put(wsId, settings);
        return writeStateToPreferences(allWsState);
    }

