  @Override
  public void changeBreakpointState(final int lineNumber) {
    EditorPartPresenter editor = editorAgent.getActiveEditor();
    if (editor == null) {
      return;
    }

    final VirtualFile activeFile = editor.getEditorInput().getFile();
    Optional<Breakpoint> existedBreakpoint =
        breakpointStorage.get(activeFile.getLocation().toString(), lineNumber + 1);

    if (existedBreakpoint.isPresent()) {
      deleteBreakpoint(activeFile, existedBreakpoint.get());
    } else {
      if (activeFile instanceof HasLocation) {
        addBreakpoint(
            activeFile, new BreakpointImpl(((HasLocation) activeFile).toLocation(lineNumber + 1)));
      } else {
        LOG.warning("Impossible to figure debug location for: " + activeFile.getLocation());
        return;
      }
    }
  }

