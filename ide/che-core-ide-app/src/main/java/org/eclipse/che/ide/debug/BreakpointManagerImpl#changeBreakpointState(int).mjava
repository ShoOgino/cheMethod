  @Override
  public void changeBreakpointState(final int lineNumber) {
    EditorPartPresenter editor = editorAgent.getActiveEditor();
    if (editor == null) {
      return;
    }

    final VirtualFile activeFile = editor.getEditorInput().getFile();

    List<Breakpoint> pathBreakpoints = breakpoints.get(activeFile.getLocation().toString());
    if (pathBreakpoints != null) {
      for (final Breakpoint breakpoint : pathBreakpoints) {
        if (breakpoint.getLineNumber() == lineNumber) {
          // breakpoint already exists at given line
          breakpointStorage.delete(breakpoint);
          deleteBreakpoint(activeFile, breakpoint);
          return;
        }
      }
    }

    if (isLineNotEmpty(activeFile, lineNumber)) {
      Breakpoint breakpoint =
          new Breakpoint(
              BREAKPOINT, lineNumber, activeFile.getLocation().toString(), activeFile, false);
      addBreakpoint(breakpoint);
      breakpointStorage.add(breakpoint);
    }
  }

