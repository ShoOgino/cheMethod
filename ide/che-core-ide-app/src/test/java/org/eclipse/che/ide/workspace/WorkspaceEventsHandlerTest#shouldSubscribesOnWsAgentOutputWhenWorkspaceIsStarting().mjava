    //    @Test disabled because of GWT timer usage
    public void shouldSubscribesOnWsAgentOutputWhenWorkspaceIsStarting() throws Exception {
        WorkspaceRuntimeDto runtime = mock(WorkspaceRuntimeDto.class);
        WorkspaceConfigDto workspaceConfig = mock(WorkspaceConfigDto.class);
        when(workspaceStatusEvent.getEventType()).thenReturn(STARTING);
        when(workspace.getRuntime()).thenReturn(runtime);
        when(runtime.getActiveEnv()).thenReturn(ACTIVE_ENV);
        when(workspace.getConfig()).thenReturn(workspaceConfig);
        Map<String, EnvironmentDto> environments = new HashMap<>(3);
        EnvironmentDto environment = mock(EnvironmentDto.class);
        environments.put(ACTIVE_ENV, environment);
        when(workspaceConfig.getEnvironments()).thenReturn(environments);
        MachineConfigDto devMachineConfig = mock(MachineConfigDto.class);
        when(devMachineConfig.getName()).thenReturn(MACHINE_NAME);

        workspaceEventsHandler.trackWorkspaceEvents(workspace, callback);
        workspaceEventsHandler.workspaceStatusSubscriptionHandler.onMessageReceived(workspaceStatusEvent);

        verify(workspacePromise).then(workspaceCaptor.capture());
        workspaceCaptor.getValue().apply(workspace);

        verify(messageBus, times(2)).subscribe(eq(WS_AGENT_LOG_CHANNEL), (MessageHandler)anyObject());
    }

