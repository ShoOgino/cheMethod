    @Test
    public void shouldRestoreHiddenPartStackState() throws Exception {
        JsonObject state = Json.createObject();
        JsonObject parts = Json.createObject();
        state.put("PART_STACKS", parts);
        JsonObject partStack = Json.createObject();
        parts.put("INFORMATION", partStack);
        partStack.put("HIDDEN", true);

        //PartStackPresenter should not be empty otherwise setHidden() will call twice
        final List<PartPresenter> partPresenters = new ArrayList<>();
        partPresenters.add(mock(PartPresenter.class));
        when(partStackPresenter.getParts()).thenAnswer(new Answer<List<? extends PartPresenter>>() {
            public List<? extends PartPresenter> answer(InvocationOnMock invocation) throws Throwable {
                return partPresenters;
            }

        });

        perspective.loadState(state);
        verify(workBenchController).setHidden(true);
    }

