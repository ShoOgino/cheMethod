    @Test
    public void testRemoveCommand() throws Exception {
        // given
        CommandImpl command1 = mock(CommandImpl.class);
        CommandImpl command2 = mock(CommandImpl.class);
        CommandItem commandItem1 = mock(CommandItem.class);
        CommandItem commandItem2 = mock(CommandItem.class);
        when(menuItemsFactory.newCommandItem(eq(command1))).thenReturn(commandItem1);
        when(menuItemsFactory.newCommandItem(eq(command2))).thenReturn(commandItem2);

        DataChangedHandler dataChangedHandler = mock(DataChangedHandler.class);
        provider.setDataChangedHandler(dataChangedHandler);
        provider.addCommand(command1);
        provider.addCommand(command2);

        // when
        provider.removeCommand(command1);

        // then
        assertThat(provider.getItems()).hasSize(1).containsOnly(commandItem2);
        verify(dataChangedHandler, times(3)).onDataChanged();
    }

