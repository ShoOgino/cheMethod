  @Test
  public void searchShouldBeSuccessfullyFinished() throws Exception {
    when(view.getPathToSearch()).thenReturn("/search");
    when(appContext.getWorkspaceRoot()).thenReturn(workspaceRoot);
    when(workspaceRoot.getContainer(nullable(Path.class))).thenReturn(optionalContainerPromise);
    when(searchContainer.search(nullable(QueryExpression.class))).thenReturn(searchResultPromise);
    when(searchContainer.createSearchQueryExpression(
            nullable(String.class), nullable(String.class)))
        .thenReturn(queryExpression);
    fullTextSearchPresenter.search(SEARCHED_TEXT);

    verify(optionalContainerPromise).then(optionalContainerCaptor.capture());
    optionalContainerCaptor.getValue().apply(Optional.of(searchContainer));

    verify(searchResultPromise).then(searchResultCaptor.capture());
    searchResultCaptor.getValue().apply(searchResult);

    verify(view, never()).showErrorMessage(anyString());
    verify(view).close();
    verify(findResultPresenter)
        .handleResponse(eq(searchResult), eq(queryExpression), eq(SEARCHED_TEXT));
  }

