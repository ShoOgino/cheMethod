  @Test(expected = OperationException.class)
  public void shouldShowNotificationWhenFailedToDuplicateCommand() throws Exception {
    CommandImpl command = mock(CommandImpl.class);
    when(commandManager.createCommand(any(CommandImpl.class))).thenReturn(commandPromise);
    when(commandPromise.then(any(Operation.class))).thenReturn(commandPromise);

    presenter.onCommandDuplicate(command);

    verify(commandPromise).catchError(errorOperationCaptor.capture());
    errorOperationCaptor.getValue().apply(mock(PromiseError.class));
    verify(messages).unableDuplicate();
    verify(notificationManager).notify(anyString(), anyString(), eq(FAIL), eq(EMERGE_MODE));
  }

