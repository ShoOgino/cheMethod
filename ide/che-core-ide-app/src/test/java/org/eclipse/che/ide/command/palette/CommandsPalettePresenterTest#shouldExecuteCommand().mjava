    @Test
    public void shouldExecuteCommand() throws Exception {
        // given
        WorkspaceImpl workspace = mock(WorkspaceImpl.class);
        when(appContext.getWorkspace()).thenReturn(workspace);

        RuntimeImpl workspaceRuntime = mock(RuntimeImpl.class);
        when(workspace.getRuntime()).thenReturn(workspaceRuntime);

        Map<String, MachineImpl> machines = new HashMap<>();
        MachineImpl chosenMachine = mock(MachineImpl.class);
        when(chosenMachine.getName()).thenReturn("machine_id");
        machines.put("machine_id", chosenMachine);
        when(workspaceRuntime.getMachines()).thenReturn(machines);

        when(machineChooser.show()).thenReturn(machinePromise);

        CommandImpl commandToExecute = mock(CommandImpl.class);

        // when
        presenter.onCommandExecute(commandToExecute);

        // then
        verify(view).close();
        verify(machineChooser).show();

        verify(machinePromise).then(selectedMachineCaptor.capture());
        selectedMachineCaptor.getValue().apply(chosenMachine);

        verify(commandExecutor).executeCommand(eq(commandToExecute), eq("machine_id"));
    }

