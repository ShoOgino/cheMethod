  @Test
  public void shouldExecuteCommand() throws Exception {
    // given
    Workspace workspace = mock(Workspace.class);
    when(appContext.getWorkspace()).thenReturn(workspace);

    WorkspaceRuntimeDto workspaceRuntime = mock(WorkspaceRuntimeDto.class);
    when(workspace.getRuntime()).thenReturn(workspaceRuntime);

    List<MachineDto> machines = new ArrayList<>(1);
    MachineDto chosenMachine = mock(MachineDto.class);
    machines.add(chosenMachine);
    when(workspaceRuntime.getMachines()).thenReturn(machines);

    when(machineChooser.show()).thenReturn(machinePromise);

    CommandImpl commandToExecute = mock(CommandImpl.class);

    // when
    presenter.onCommandExecute(commandToExecute);

    // then
    verify(view).close();
    verify(machineChooser).show();

    verify(machinePromise).then(selectedMachineCaptor.capture());
    selectedMachineCaptor.getValue().apply(chosenMachine);

    verify(commandExecutor).executeCommand(eq(commandToExecute), eq(chosenMachine));
  }

