  @Test
  public void shouldHandleCaseWhenDevMachineStateIsRunning() throws Exception {
    when(machine.isDev()).thenReturn(true);

    when(machineStatusChangedEvent.getEventType()).thenReturn(RUNNING);
    statusNotifier.onMachineStatusChanged(machineStatusChangedEvent);

    verify(workspaceServiceClient.getWorkspace(WORKSPACE_ID)).then(workspaceCaptor.capture());
    workspaceCaptor.getValue().apply(workspace);

    verify(appContext).setWorkspace(workspace);
    verify(handler).onMachineRunning(Matchers.anyObject());
  }

