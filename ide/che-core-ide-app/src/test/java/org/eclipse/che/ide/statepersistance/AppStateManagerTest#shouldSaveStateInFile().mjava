  @Test
  public void shouldSaveStateInFile() throws Exception {
    JsonObject object = Json.createObject();
    object.put("key1", "value1");
    when(component1.getState()).thenReturn(object);

    appStateManager.persistWorkspaceState(WS_ID);

    verify(component1).getState();
    verify(preferencesManager).setValue(anyString(), jsonArgumentCaptor.capture());
    assertThat(jsonArgumentCaptor.getValue()).isNotNull().isNotEmpty();

    String value = jsonArgumentCaptor.getValue();
    JsonObject jsonObject = Json.parse(value).getObject(WS_ID);
    JsonObject workspace = jsonObject.getObject("workspace");
    assertThat(workspace).isNotNull();

    JsonObject jsonObject1 = workspace.getObject("component1");
    assertThat(jsonObject1.jsEquals(object)).isTrue();
  }

