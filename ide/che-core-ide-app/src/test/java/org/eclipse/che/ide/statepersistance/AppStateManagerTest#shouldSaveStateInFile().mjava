  @Test
  public void shouldSaveStateInFile() throws Exception {
    JsonObject firstComponentState = Json.createObject();
    firstComponentState.put("key1", "value1");
    when(component1.getState()).thenReturn(firstComponentState);

    JsonObject secondComponentState = Json.createObject();
    secondComponentState.put("key2", "value2");
    when(component2.getState()).thenReturn(secondComponentState);

    appStateManager.persistState();

    verify(component1).getState();
    verify(component2).getState();
    verify(appStateService).saveState(saveStateArgumentCaptor.capture());

    String json = saveStateArgumentCaptor.getValue();
    assertThat(json).isNotNull();
    JsonObject appState = Json.parse(json);
    assertThat(appState).isNotNull();

    JsonObject jsonObject1 = appState.getObject(COMPONENT_ONE_ID);
    assertThat(jsonObject1.jsEquals(firstComponentState)).isTrue();

    JsonObject jsonObject2 = appState.getObject(COMPONENT_TWO_ID);
    assertThat(jsonObject2.jsEquals(secondComponentState)).isTrue();
  }

