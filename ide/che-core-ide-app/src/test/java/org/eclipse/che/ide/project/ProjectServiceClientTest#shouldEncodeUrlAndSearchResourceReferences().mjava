  @Test
  public void shouldEncodeUrlAndSearchResourceReferences() {
    QueryExpression expression = new QueryExpression();
    expression.setName(TEXT);
    expression.setText(TEXT);
    expression.setPath(resourcePath.toString());
    expression.setMaxItems(100);
    expression.setSkipCount(10);
    when(asyncRequest.send(unmarshallableSearch)).thenReturn(searchPromise);

    client.search(expression);

    verify(requestFactory).createGetRequest(any());
    verify(asyncRequest).header(ACCEPT, MimeType.APPLICATION_JSON);
    verify(loaderFactory).newLoader("Searching...");
    verify(asyncRequest).loader(messageLoader);
    verify(unmarshaller).newListUnmarshaller(SearchResultDto.class);
    verify(asyncRequest).send(unmarshallableSearch);
  }

