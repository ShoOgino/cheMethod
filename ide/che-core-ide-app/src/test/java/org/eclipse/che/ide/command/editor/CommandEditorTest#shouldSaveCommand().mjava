  @Test
  public void shouldSaveCommand() throws Exception {
    when(commandManager.updateCommand(anyString(), eq(editor.editedCommand)))
        .thenReturn(commandPromise);
    when(commandPromise.then(any(Operation.class))).thenReturn(commandPromise);

    editor.doSave();

    verify(commandManager).updateCommand(anyString(), eq(editor.editedCommand));
    verify(commandPromise).then(operationCaptor.capture());
    operationCaptor.getValue().apply(editedCommand);

    verify(view).setSaveEnabled(false);
  }

