    @Before
    public void setUp() {
        Set<StateComponent> components = new HashSet<>();
        components.add(component1);
        components.add(component2);

        when(component1.getId()).thenReturn("component1");
        when(component2.getId()).thenReturn("component2");
        when(preferencesManager.flushPreferences()).thenReturn(promise);
        when(preferencesManager.getValue(AppStateManager.PREFERENCE_PROPERTY_NAME)).thenReturn("");
        when(jsonFactory.parse(anyString())).thenReturn(pref = Json.createObject());
        appStateManager = new AppStateManager(components, preferencesManager, jsonFactory, promiseProvider);
    }

