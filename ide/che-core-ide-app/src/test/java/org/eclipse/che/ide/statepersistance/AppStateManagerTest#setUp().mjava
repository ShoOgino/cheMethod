    @Before
    public void setUp() {
        Map<String, StateComponent> components = new HashMap<>();
        components.put("component1", component1);
        components.put("component2", component2);

        when(preferencesManager.flushPreferences()).thenReturn(promise);
        when(preferencesManager.getValue(AppStateManager.PREFERENCE_PROPERTY_NAME)).thenReturn("");
        when(jsonFactory.parse(anyString())).thenReturn(pref = Json.createObject());
        appStateManager = new AppStateManager(components, preferencesManager, jsonFactory);
    }

