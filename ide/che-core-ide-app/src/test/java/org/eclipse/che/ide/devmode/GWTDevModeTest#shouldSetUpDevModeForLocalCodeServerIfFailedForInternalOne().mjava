  @Test
  public void shouldSetUpDevModeForLocalCodeServerIfFailedForInternalOne() throws Exception {
    mockInternalCodeServer();

    when(devModeScriptInjector.inject(anyString())).thenReturn(voidPromise);
    when(voidPromise.then(any(Operation.class))).thenReturn(voidPromise);

    devMode.setUp();

    verify(bookmarkletParams, never()).setParams(LOCAL_CODE_SERVER_ADDRESS, IDE_GWT_APP_SHORT_NAME);
    verify(devModeScriptInjector, never()).inject(LOCAL_CODE_SERVER_ADDRESS);

    verify(voidPromise).catchError(promiseErrorOperationCapture.capture());
    promiseErrorOperationCapture.getValue().apply(promiseError);

    verify(bookmarkletParams).setParams(INT_CODE_SERVER_URL, IDE_GWT_APP_SHORT_NAME);
    verify(devModeScriptInjector).inject(INT_CODE_SERVER_URL);
  }

