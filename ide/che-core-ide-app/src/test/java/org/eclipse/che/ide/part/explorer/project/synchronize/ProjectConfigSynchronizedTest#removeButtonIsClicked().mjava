  @Test
  public void removeButtonIsClicked() throws Exception {
    String projectRemoved = "project removed";

    when(resource.delete()).thenReturn(deleteProjectPromise);
    when(deleteProjectPromise.then(Matchers.<Operation<Void>>any()))
        .thenReturn(deleteProjectPromise);
    when(locale.projectRemoved(PROJECT_NAME)).thenReturn(projectRemoved);

    subscribeToOnBeforeLoadNodeEvent();

    verify(dialogFactory)
        .createConfirmDialog(
            eq(SYNCH_DIALOG_TITLE),
            eq(SYNCH_DIALOG_CONTENT),
            eq(IMPORT_BUTTON),
            eq(REMOVE_BUTTON),
            confirmCallbackArgumentCaptor.capture(),
            cancelCallbackArgumentCaptor.capture());
    verify(confirmDialog).show();

    cancelCallbackArgumentCaptor.getValue().cancelled();
    verify(resource).delete();

    verify(deleteProjectPromise).then(projectDeleted.capture());
    projectDeleted.getValue().apply(null);
    verify(notificationManager).notify(projectRemoved, SUCCESS, EMERGE_MODE);
  }

