  @Test
  public void restoreShouldCallLoadState() throws Exception {
    JsonObject appState = Json.createObject();
    JsonObject firstComponent = Json.createObject();
    appState.put("component1", firstComponent);
    firstComponent.put("key1", "value1");
    when(promiseProvider.resolve(nullable(Void.class))).thenReturn(sequentialRestore);

    appStateManager.restoreState(appState);

    verify(sequentialRestore).thenPromise(sequentialRestoreThenFunction.capture());
    sequentialRestoreThenFunction.getValue().apply(null);

    ArgumentCaptor<JsonObject> stateCaptor = ArgumentCaptor.forClass(JsonObject.class);
    verify(component1).loadState(stateCaptor.capture());

    JsonObject jsonObject = stateCaptor.getValue();
    assertThat(jsonObject.hasKey("key1")).isTrue();
    assertThat(jsonObject.getString("key1")).isEqualTo("value1");
  }

