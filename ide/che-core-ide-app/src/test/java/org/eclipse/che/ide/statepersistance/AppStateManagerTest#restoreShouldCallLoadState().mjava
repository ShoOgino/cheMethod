    @Test
    public void restoreShouldCallLoadState() throws Exception {
        JsonObject ws = Json.createObject();
        pref.put(WS_ID, ws);
        JsonObject workspace = Json.createObject();
        ws.put("workspace", workspace);
        JsonObject comp1 = Json.createObject();
        workspace.put("component1", comp1);
        comp1.put("key1", "value1");

        when(promiseProvider.resolve(any(Void.class))).thenReturn(sequentialRestore);

        appStateManager.restoreWorkspaceState(WS_ID);

        verify(sequentialRestore).thenPromise(sequentialRestoreThenFunction.capture());
        sequentialRestoreThenFunction.getValue().apply(null);

        ArgumentCaptor<JsonObject> stateCaptor = ArgumentCaptor.forClass(JsonObject.class);
        verify(component1).loadState(stateCaptor.capture());

        JsonObject jsonObject = stateCaptor.getValue();
        assertThat(jsonObject.hasKey("key1")).isTrue();
        assertThat(jsonObject.getString("key1")).isEqualTo("value1");
    }

