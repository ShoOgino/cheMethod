    @Test
    public void shouldStopSendingIfSessionIsClosed() {
        reSender.add(mock(WebSocketTransmission.class));
        reSender.add(mock(WebSocketTransmission.class));
        reSender.add(mock(WebSocketTransmission.class));

        final int[] i = {0};
        when(connection.isOpen()).thenAnswer(invocation -> (i[0]++ <= 1));
        reSender.resend();
        verify(connection, times(2)).send(any(WebSocketTransmission.class));

        when(connection.isOpen()).thenReturn(true);
        reSender.resend();

        verify(connection, times(3)).send(any(WebSocketTransmission.class));
    }

