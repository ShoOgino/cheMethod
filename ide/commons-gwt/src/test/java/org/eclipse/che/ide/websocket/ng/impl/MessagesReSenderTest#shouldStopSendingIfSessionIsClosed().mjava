    @Test
    public void shouldStopSendingIfSessionIsClosed() {
        reSender.add("url", "1");
        reSender.add("url", "2");
        reSender.add("url", "3");

        final int[] i = {0};
        when(connectionManager.isConnectionOpen("url")).thenAnswer(invocation -> (i[0]++ <= 1));
        reSender.reSend("url");
        verify(connectionManager, times(2)).sendMessage(eq("url"), anyString());

        when(connectionManager.isConnectionOpen("url")).thenReturn(true);
        reSender.reSend("url");

        verify(connectionManager, times(3)).sendMessage(eq("url"), anyString());
    }

