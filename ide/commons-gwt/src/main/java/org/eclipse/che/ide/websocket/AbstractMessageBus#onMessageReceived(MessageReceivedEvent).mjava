  /** {@inheritDoc} */
  @Override
  public void onMessageReceived(MessageReceivedEvent event) {
    Message message = parseMessage(event.getMessage());

    // http code 202 is "Accepted": The request has been accepted for processing,
    // but the processing has not been completed.
    // At this point, we ignore this code, since the request might or might not eventually be acted
    // upon,
    // as it might be disallowed when processing actually takes place.
    if (message.getResponseCode() == 202) {
      return;
    }

    // TODO Should be revised to remove
    List<Pair> headers = message.getHeaders().toList();
    if (headers != null) {
      for (Pair header : headers) {
        if (HTTPHeader.LOCATION.equals(header.getName()) && header.getValue().contains("async/")) {
          return;
        }
      }
    }

    if (getChannel(message) != null) {
      // this is a message received by subscription
      processSubscriptionMessage(message);
    } else {
      String uuid = message.getStringField(MessageBuilder.UUID_FIELD);
      ReplyHandler replyCallback = replyCallbackMap.remove(uuid);
      if (replyCallback != null) {
        replyCallback.onReply(message.getBody());
      } else {
        RequestCallback requestCallback = requestCallbackMap.remove(uuid);
        if (requestCallback != null) {
          requestCallback.onReply(message);
        }
      }
    }
  }

