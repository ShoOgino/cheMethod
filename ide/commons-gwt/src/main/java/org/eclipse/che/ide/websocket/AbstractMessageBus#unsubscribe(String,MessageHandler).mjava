  /** {@inheritDoc} */
  @Override
  public void unsubscribe(String channel, MessageHandler handler) throws WebSocketException {
    checkWebSocketConnectionState();

    List<MessageHandler> subscribersSet = channelToSubscribersMap.get(channel);
    if (subscribersSet == null) {
      throw new IllegalArgumentException("Handler not subscribed to any channel.");
    }

    if (subscribersSet.remove(handler) && subscribersSet.isEmpty()) {
      channelToSubscribersMap.remove(channel);
      sendUnsubscribeMessage(channel);
    }
  }

