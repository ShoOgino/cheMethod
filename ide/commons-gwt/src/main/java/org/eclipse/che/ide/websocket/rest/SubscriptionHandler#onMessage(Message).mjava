  /**
   * Perform actions when {@link Message} was received.
   *
   * @param message received {@link Message}
   */
  public void onMessage(Message message) {

    if (isSuccessful(message)) {
      try {
        if (unmarshaller != null) {
          unmarshaller.unmarshal(message);
          payload = unmarshaller.getPayload();
        }
        onMessageReceived(payload);
      } catch (UnmarshallerException e) {
        onErrorReceived(e);
      }
    } else {
      onErrorReceived(new ServerException(message));
    }
  }

