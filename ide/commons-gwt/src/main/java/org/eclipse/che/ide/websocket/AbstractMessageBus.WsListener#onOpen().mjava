    @Override
    public void onOpen() {
      // If the any timer has been started then stop it.
      reconnectionTimer.cancel();

      reconnectionAttemptsCounter = 0;
      heartbeatTimer.scheduleRepeating(HEARTBEAT_PERIOD);
      connectionOpenedHandlers.dispatch(
          new ListenerManager.Dispatcher<ConnectionOpenedHandler>() {
            @Override
            public void dispatch(ConnectionOpenedHandler listener) {
              listener.onOpen();
            }
          });

      try {
        for (String message : messages2send) {
          send(message);
        }
        messages2send.clear();
      } catch (WebSocketException e) {
        Log.error(AbstractMessageBus.class, e);
      }
    }

