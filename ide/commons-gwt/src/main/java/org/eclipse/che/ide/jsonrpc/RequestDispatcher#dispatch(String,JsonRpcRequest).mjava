    public void dispatch(String endpointId, JsonRpcRequest request) throws JsonRpcException {
        checkNotNull(endpointId, "Endpoint ID must not be null");
        checkArgument(!endpointId.isEmpty(), "Endpoint ID must not be empty");
        checkNotNull(request, "Request must not be null");

        Log.debug(getClass(), "Dispatching request: " + request + ", " + endpointId);

        String method = request.getMethod();
        JsonRpcParams params = request.getParams();

        if (request.hasId()) {
            Log.debug(getClass(), "Request has ID");

            String id = request.getId();
            RequestHandler handler = registry.getRequestHandler(method);
            checkHandler(method, handler, id);
            JsonRpcResult result = handler.handle(endpointId, params);
            JsonRpcResponse response = factory.createResponse(id, result, null);

            Log.debug(getClass(), "Transmitting back a response: " + response);
            transmitter.transmit(endpointId, response.toString());
        } else {
            Log.debug(getClass(), "Request has no ID -> it is a notification");

            NotificationHandler handler = registry.getNotificationHandler(method);
            checkHandler(method, handler, null);
            handler.handle(endpointId, params);
        }
    }

