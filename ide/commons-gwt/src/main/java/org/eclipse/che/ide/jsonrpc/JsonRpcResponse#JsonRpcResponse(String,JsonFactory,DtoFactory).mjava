    @AssistedInject
    public JsonRpcResponse(@Assisted("message") String message, JsonFactory jsonFactory, DtoFactory dtoFactory) {
        checkNotNull(message, "Message must not be null");
        checkArgument(!message.isEmpty(), "Message must not be empty");

        this.jsonFactory = jsonFactory;

        JsonObject jsonObject = jsonFactory.parse(message);

        JsonValue jsonValue = jsonObject.get("id");
        if (jsonValue.getType().equals(JsonType.STRING)) {
            id = jsonValue.asString();
        } else {
            id = Double.toString(jsonValue.asNumber());
        }

        if (jsonObject.hasKey("result")) {
            this.result = new JsonRpcResult(jsonObject.get("result").toJson(), jsonFactory, dtoFactory);
            this.error = null;
        } else {
            this.error = new JsonRpcError(jsonObject.get("error").toJson(), jsonFactory);
            this.result = null;
        }
    }

