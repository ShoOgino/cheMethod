  private void internalInitialize() {
    String protocol = "https:".equals(getProtocol()) ? "wss://" : "ws://";
    String host = getHost();
    String context = getWebsocketContext();
    String url = protocol + host + context;
    String separator = url.contains("?") ? "&" : "?";
    String queryParams =
        appContext.getApplicationWebsocketId().map(id -> separator + "clientId=" + id).orElse("");
    Set<Runnable> initActions =
        appContext.getApplicationWebsocketId().isPresent()
            ? emptySet()
            : singleton(this::processWsId);

    initializer.initialize("ws-master", singletonMap("url", url + queryParams), initActions);
  }

