  protected void addAnnotation(
      final Annotation annotation, final Position position, final boolean fireEvent) {
    annotations.put(annotation, position);
    positions.put(position, annotation);
    try {
      addPosition(position);
    } catch (BadLocationException ignore) {
      Log.error(getClass(), "BadLocation for " + annotation);
      //ignore invalid location
    }
    getAnnotationModelEvent().annotationAdded(annotation);
    if (fireEvent) {
      fireModelChanged();
    }
  }

