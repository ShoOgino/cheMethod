    @Override
    public Promise<Revision> commit(DevMachine devMachine, Path project, String message, boolean all, Path[] files, boolean amend) {
        List<String> paths = new ArrayList<>(files.length);

        for (Path file : files) {
            paths.add(file.isEmpty() ? "." : file.toString());
        }

        CommitRequest commitRequest = dtoFactory.createDto(CommitRequest.class)
                                                .withMessage(message)
                                                .withAmend(amend)
                                                .withAll(all)
                                                .withFiles(paths);
        String url = devMachine.getWsAgentBaseUrl() + COMMIT + "?projectPath=" + project;

        return asyncRequestFactory.createPostRequest(url, commitRequest)
                                  .loader(loader)
                                  .send(dtoUnmarshallerFactory.newUnmarshaller(Revision.class));
    }

