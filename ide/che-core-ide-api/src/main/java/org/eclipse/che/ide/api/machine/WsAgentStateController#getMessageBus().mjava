  public Promise<MessageBus> getMessageBus() {
    return AsyncPromiseHelper.createFromAsyncRequest(
        callback -> {
          if (messageBus != null) {
            callback.onSuccess(messageBus);
          } else {
            WsAgentStateController.this.messageBusCallbacks.add(callback);
          }
        });
  }

