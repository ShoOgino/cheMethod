  private List<TypedPosition> getEndingPositions(String category, int offset, int length)
      throws BadPositionCategoryException {
    final List<TypedPosition> positions = endPositions.get(category);
    if (positions == null) {
      throw new BadPositionCategoryException();
    }

    final int indexStart = computeIndexInPositionList(positions, offset, false);
    final int indexEnd = computeIndexInPositionList(positions, offset + length, false);

    return positions.subList(indexStart, indexEnd);
  }

