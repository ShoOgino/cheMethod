  @Override
  public ExecAgentConsumer<ProcessSubscribeResponseDto> subscribe(
      final String endpointId, int pid, List<String> eventTypes, String after) {
    Log.debug(
        getClass(),
        "Subscribing to a process. PID: "
            + pid
            + ", event types: "
            + eventTypes
            + ", after timestamp: "
            + after);

    ProcessSubscribeRequestDto dto =
        dtoFactory
            .createDto(ProcessSubscribeRequestDto.class)
            .withPid(pid)
            .withEventTypes(join(eventTypes, ","))
            .withAfter(after);

    final ExecAgentConsumer<ProcessSubscribeResponseDto> execAgentConsumer =
        new ExecAgentConsumer<>();

    transmitter
        .newRequest()
        .endpointId(endpointId)
        .methodName(PROCESS_SUBSCRIBE)
        .paramsAsDto(dto)
        .sendAndReceiveResultAsDto(ProcessSubscribeResponseDto.class)
        .onSuccess(
            (s, processSubscribeResponseDto) ->
                subscribe(endpointId, execAgentConsumer, processSubscribeResponseDto));
    return execAgentConsumer;
  }

