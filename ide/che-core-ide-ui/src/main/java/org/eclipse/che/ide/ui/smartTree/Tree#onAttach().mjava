  /** {@inheritDoc} */
  @Override
  protected void onAttach() {
    boolean isOrWasAttached = isOrWasAttached();
    super.onAttach();
    if (nodeStorage == null) {
      throw new IllegalStateException("Cannot attach a tree without a store");
    }

    if (!isOrWasAttached) {
      onAfterFirstAttach();
    }

    update();
  }

