  protected void onMouseClick(ClickEvent ce) {
    NativeTreeEvent e = ce.getNativeEvent().cast();

    if (fireSelectionChangeOnClick) {
      fireSelectionChange();
      fireSelectionChangeOnClick = false;
    }

    if (selectionMode == Mode.MULTI) {
      NodeDescriptor node = tree.getNodeDescriptor((Element) e.getEventTarget().cast());
      // on dnd prevent drag the node will be null
      if (node != null) {
        Node sel = node.getNode();
        if (e.getCtrlOrMetaKey() && isSelected(sel)) {
          doDeselect(Collections.singletonList(sel), false);
          tree.setFocus(true);

          // reset the starting location of the click when meta is used during a multiselect
          lastSelectedNode = sel;
        } else if (e.getCtrlOrMetaKey()) {
          doSelect(Collections.singletonList(sel), true, false);
          tree.setFocus(true);

          // reset the starting location of the click when meta is used during a multiselect
          lastSelectedNode = sel;
        } else if (isSelected(sel)
            && !e.getShiftKey()
            && !e.getCtrlOrMetaKey()
            && selectionStorage.size() > 0) {
          doSelect(Collections.singletonList(sel), false, false);
          tree.setFocus(true);
        }
      }
    }
  }

