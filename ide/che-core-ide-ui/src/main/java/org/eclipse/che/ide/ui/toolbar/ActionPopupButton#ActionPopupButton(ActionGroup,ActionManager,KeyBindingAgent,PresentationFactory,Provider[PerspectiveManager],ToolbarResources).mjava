  /** Create Popup Menu Button with specified icons for enabled and disabled states. */
  public ActionPopupButton(
      final ActionGroup action,
      ActionManager actionManager,
      KeyBindingAgent keyBindingAgent,
      final PresentationFactory presentationFactory,
      Provider<PerspectiveManager> managerProvider,
      ToolbarResources toolbarResources) {
    this.action = action;
    this.actionManager = actionManager;
    this.keyBindingAgent = keyBindingAgent;
    this.presentationFactory = presentationFactory;
    this.managerProvider = managerProvider;
    this.toolbarResources = toolbarResources;

    presentation = presentationFactory.getPresentation(action);

    panel = new ButtonPanel();
    initWidget(panel);

    panel.setStyleName(toolbarResources.toolbar().popupButtonPanel());

    renderImage();

    setEnabled(presentation.isEnabled());
    setVisible(presentation.isVisible());

    if (presentation.getDescription() != null) {
      tooltip =
          Tooltip.create(
              (elemental.dom.Element) panel.getElement(),
              PositionController.VerticalAlign.BOTTOM,
              PositionController.HorizontalAlign.MIDDLE,
              presentation.getDescription());
    }

    this.ensureDebugId("PopupButton/" + action.getTemplatePresentation().getText());
  }

