    @Test
    public void shouldBeAbleToSaveFactory() throws Exception {
        // given
        Factory factory = prepareFactoryWithGivenStorage("git", "http://github.com/codenvy/platform-api.git");
        URL resource = Thread.currentThread().getContextClassLoader()
                             .getResource("100x100_image.jpeg");
        assertNotNull(resource);
        Path path = Paths.get(resource.toURI());

        FactorySaveAnswer factorySaveAnswer = new FactorySaveAnswer();
        when(factoryStore.saveFactory(any(Factory.class), anySetOf(FactoryImage.class))).then(factorySaveAnswer);
        when(factoryStore.getFactory(CORRECT_FACTORY_ID)).then(factorySaveAnswer);

        // when, then
        Response response = given().auth()
                                   .basic(JettyHttpServer.ADMIN_USER_NAME, JettyHttpServer.ADMIN_USER_PASSWORD)
                                   .multiPart("factory", JsonHelper.toJson(factory), MediaType.APPLICATION_JSON)
                                   .multiPart("image", path.toFile(), "image/jpeg")
                                   .when()
                                   .post("/private" + SERVICE_PATH);

        assertEquals(response.getStatusCode(), 200);
        Factory responseFactory = dto.createDtoFromJson(response.getBody().asInputStream(), Factory.class);
        boolean found = false;
        for (Link link : responseFactory.getLinks()) {
            if (link.getRel().equals("image") && link.getProduces().equals("image/jpeg") && !link.getHref().isEmpty())
                found = true;
        }
        assertTrue(found);
    }

