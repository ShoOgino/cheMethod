    @Test
    public void shouldBeAbleToUpdatePreferences() throws Exception {
        final Map<String, String> preferences = new HashMap<>(8);
        preferences.put("test1", "test1");
        preferences.put("test2", "test2");
        preferences.put("test3", "test3");
        when(preferenceDao.getPreferences(testUser.getId())).thenReturn(preferences);
        final Map<String, String> update = singletonMap("test1", "new_value");

        final ContainerResponse response = makeRequest(HttpMethod.POST, SERVICE_PATH + "/prefs", update);

        preferences.putAll(update);
        assertEquals(response.getStatus(), OK.getStatusCode());
        assertEquals(response.getEntity(), preferences);
        verify(preferenceDao).setPreferences(testUser.getId(), preferences);
    }

