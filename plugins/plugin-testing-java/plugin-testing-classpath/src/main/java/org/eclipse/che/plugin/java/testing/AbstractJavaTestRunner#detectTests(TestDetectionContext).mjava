  @Override
  public List<TestPosition> detectTests(TestDetectionContext context) {
    IJavaProject javaProject = getJavaProject(context.getProjectPath());
    if (javaProject == null || !javaProject.exists()) {
      return Collections.emptyList();
    }

    IProject project = javaProject.getProject();
    if (project == null || !hasJavaNature(project)) {
      return Collections.emptyList();
    }

    List<TestPosition> result = new ArrayList<>();

    String filePath = context.getFilePath();
    if (filePath.endsWith(".xml")) {
      if (isTestSuite(filePath, javaProject)) {
        TestPosition testPosition =
            DtoFactory.newDto(TestPosition.class).withFrameworkName(getName());
        result.add(testPosition);
      }
      return result;
    }

    try {
      ICompilationUnit compilationUnit = findCompilationUnitByPath(javaProject, filePath);
      if (context.getOffset() == -1) {
        addAllTestsMethod(result, compilationUnit);
      } else {
        IJavaElement element = compilationUnit.getElementAt(context.getOffset());
        if (element != null && element.getElementType() == IJavaElement.METHOD) {
          if (isTestMethod((IMethod) element, compilationUnit)) {
            result.add(createTestPosition((IMethod) element));
          }
        } else {
          addAllTestsMethod(result, compilationUnit);
        }
      }
    } catch (JavaModelException e) {
      LOG.debug("Can't read all methods.", e);
    }

    return result;
  }

