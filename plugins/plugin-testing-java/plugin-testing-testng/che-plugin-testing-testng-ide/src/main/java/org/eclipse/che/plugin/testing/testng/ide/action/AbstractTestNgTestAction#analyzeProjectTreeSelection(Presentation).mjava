  private void analyzeProjectTreeSelection(Presentation presentation) {
    Resource[] resources = appContext.getResources();
    if (resources == null || resources.length > 1) {
      presentation.setEnabled(false);
      return;
    }

    Resource resource = resources[0];
    if (resource.isProject() && isJavaProject((Project) resource)) {
      testDetector.setContextType(PROJECT);
      presentation.setEnabled(true);
      return;
    }

    Project project = resource.getProject();
    if (!isJavaProject(project)) {
      presentation.setEnabled(false);
      return;
    }

    if (isJavaTestFile(resource)) {
      testDetector.setContextType(TestExecutionContext.ContextType.FILE);
    } else if (resource instanceof Container) {
      Optional<Resource> srcFolder = resource.getParentWithMarker(SourceFolderMarker.ID);
      if (!srcFolder.isPresent() || resource.getLocation().equals(srcFolder.get().getLocation())) {
        presentation.setEnabled(false);
        return;
      }
      testDetector.setContextType(TestExecutionContext.ContextType.FOLDER);
    }
    presentation.setEnabled(true);
    selectedNodePath = resource.getLocation().toString();
  }

