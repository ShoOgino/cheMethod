    @Test
    public void testListener() throws Exception {
        StringBuffer buffer = new StringBuffer();
        CheTestNGListener listener = createListener(buffer);
        String className = "the.Test";
        listener.onSuiteStart(className, true);

        TestResult setUp = new TestResult(className, "setUp");
        listener.internalOnTestStart(setUp, null, -1, true);
        listener.internalOnConfigurationSuccess(setUp);
        TestResult result = new TestResult(className, "testMethod");
        listener.internalOnTestStart(result);
        listener.onTestFinished(result);
        TestResult tearDown = new TestResult(className, "tearDown");
        listener.internalOnTestStart(tearDown, null, -1, true);
        listener.internalOnConfigurationSuccess(tearDown);

        listener.internalSuiteFinish(className);

        Assert.assertEquals(buffer.toString(), "@@<{\"name\":\"testReporterAttached\"}>\n" +
                "@@<{\"name\":\"testSuiteStarted\", \"attributes\":{\"name\":\"Test\", \"location\":\"java:suite://the.Test\"}}>\n" +
                "@@<{\"name\":\"testStarted\", \"attributes\":{\"name\":\"Test.setUp\", \"locationHint\":\"java:test://the.Test.setUp\", \"config\":\"true\"}}>\n" +
                "@@<{\"name\":\"testFinished\", \"attributes\":{\"name\":\"Test.setUp\", \"duration\":\"0\"}}>\n" +
                "@@<{\"name\":\"testStarted\", \"attributes\":{\"name\":\"Test.testMethod\", \"locationHint\":\"java:test://the.Test.testMethod[0]\", \"config\":\"false\"}}>\n" +
                "@@<{\"name\":\"testFinished\", \"attributes\":{\"name\":\"Test.testMethod\", \"duration\":\"0\"}}>\n" +
                "@@<{\"name\":\"testStarted\", \"attributes\":{\"name\":\"Test.tearDown\", \"locationHint\":\"java:test://the.Test.tearDown\", \"config\":\"true\"}}>\n" +
                "@@<{\"name\":\"testFinished\", \"attributes\":{\"name\":\"Test.tearDown\", \"duration\":\"0\"}}>\n" +
                "@@<{\"name\":\"testSuiteFinished\", \"attributes\":{\"name\":\"the.Test\"}}>\n");
    }

