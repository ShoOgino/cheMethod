    @Test
    public void shouldBuildDockerfileOnInstanceCreationFromRecipe() throws Exception {
        String generatedContainerId = "genContainerId";
        doReturn(generatedContainerId).when(containerNameGenerator).generateContainerName(eq(WORKSPACE_ID),
                                                                                          eq(MACHINE_ID),
                                                                                          eq(USER_NAME),
                                                                                          eq(MACHINE_NAME));


        createInstanceFromRecipe();


        ArgumentCaptor<BuildImageParams> argumentCaptor = ArgumentCaptor.forClass(BuildImageParams.class);
        verify(dockerConnector).buildImage(argumentCaptor.capture(),
                                           any(ProgressMonitor.class));
        BuildImageParams buildImageParams = argumentCaptor.getValue();
        assertEquals(buildImageParams.getRepository(), "eclipse-che/" + generatedContainerId);
        assertEquals((long)buildImageParams.getMemoryLimit(), (long)MEMORY_LIMIT_MB * 1024 * 1024);
        assertEquals((long)buildImageParams.getMemorySwapLimit(), (long)-1);
    }

