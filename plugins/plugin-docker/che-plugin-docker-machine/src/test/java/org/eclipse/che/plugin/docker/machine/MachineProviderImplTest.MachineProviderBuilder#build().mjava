    MachineProviderImpl build() throws IOException {
      MachineProviderImpl provider =
          spy(
              new MachineProviderImpl(
                  new MockConnectorProvider(),
                  credentialsReader,
                  dockerMachineFactory,
                  dockerInstanceStopDetector,
                  transmitter,
                  jsonRpcEndpointToMachineNameHolder,
                  devMachineServers,
                  allMachineServers,
                  devMachineVolumes,
                  allMachineVolumes,
                  doForcePullImage,
                  privilegedMode,
                  pidsLimit,
                  devMachineEnvVars,
                  allMachineEnvVars,
                  snapshotUseRegistry,
                  memorySwapMultiplier,
                  additionalNetworks,
                  networkDriver,
                  parentCgroup,
                  cpuSet,
                  cpuPeriod,
                  cpuQuota,
                  pathEscaper,
                  extraHosts,
                  dnsResolvers,
                  emptyMap()));
      doNothing()
          .when(provider)
          .readContainerLogsInSeparateThread(
              anyString(), anyString(),
              anyString(), any(LineConsumer.class));
      return provider;
    }

