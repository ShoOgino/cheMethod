    private DockerInstanceProvider getDockerInstanceProvider(boolean snapshotUseRegistry) throws Exception {
        return spy(new DockerInstanceProvider(dockerConnector,
                                              dockerConnectorConfiguration,
                                              dockerMachineFactory,
                                              dockerInstanceStopDetector,
                                              containerNameGenerator,
                                              recipeRetriever,
                                              Collections.emptySet(),
                                              Collections.emptySet(),
                                              Collections.emptySet(),
                                              Collections.emptySet(),
                                              null,
                                              workspaceFolderPathProvider,
                                              PROJECT_FOLDER_PATH,
                                              false,
                                              false,
                                              Collections.emptySet(),
                                              Collections.emptySet(),
                                              snapshotUseRegistry,
                                              MEMORY_SWAP_MULTIPLIER));
    }

