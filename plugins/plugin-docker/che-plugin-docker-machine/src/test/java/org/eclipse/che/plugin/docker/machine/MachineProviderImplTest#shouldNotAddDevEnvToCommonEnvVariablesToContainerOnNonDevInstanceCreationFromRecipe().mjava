  @Test
  public void shouldNotAddDevEnvToCommonEnvVariablesToContainerOnNonDevInstanceCreationFromRecipe()
      throws Exception {
    Set<String> commonEnv = new HashSet<>(asList("ENV_VAR1=123", "ENV_VAR2=234"));
    Set<String> devEnv =
        new HashSet<>(asList("DEV_ENV_VAR1=345", "DEV_ENV_VAR2=456", "DEV_ENV_VAR3=567"));

    provider =
        new MachineProviderBuilder()
            .setDevMachineEnvVars(devEnv)
            .setAllMachineEnvVars(commonEnv)
            .build();

    final boolean isDev = false;

    createInstanceFromRecipe(isDev);

    ArgumentCaptor<CreateContainerParams> argumentCaptor =
        ArgumentCaptor.forClass(CreateContainerParams.class);
    verify(dockerConnector).createContainer(argumentCaptor.capture());
    assertTrue(
        new HashSet<>(asList(argumentCaptor.getValue().getContainerConfig().getEnv()))
            .containsAll(commonEnv));
  }

