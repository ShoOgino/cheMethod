  @Test
  public void shouldNotRemoveImageWhenCreatingInstanceFromLocalImage() throws Exception {
    String repo = "repo1";
    String tag = "latest";
    MachineProviderImpl provider =
        new MachineProviderBuilder().setSnapshotUseRegistry(false).build();

    CheServiceImpl machine = createService();
    machine.setBuild(null);
    machine.setImage(repo + ":" + tag + "@digest");

    provider.startService(
        USER_NAME,
        WORKSPACE_ID,
        ENV_NAME,
        MACHINE_NAME,
        false,
        NETWORK_NAME,
        machine,
        LineConsumer.DEV_NULL);

    verify(dockerConnector, never()).removeImage(any(RemoveImageParams.class));
  }

