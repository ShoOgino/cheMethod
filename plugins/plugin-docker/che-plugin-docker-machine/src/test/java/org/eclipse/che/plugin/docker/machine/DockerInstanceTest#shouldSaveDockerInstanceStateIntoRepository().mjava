  @Test
  public void shouldSaveDockerInstanceStateIntoRepository() throws Exception {
    final String digest = "image12";
    dockerInstance = getDockerInstance(getMachine(), REGISTRY, CONTAINER, IMAGE, true);
    when(dockerConnectorMock.push(any(PushParams.class), any(ProgressMonitor.class)))
        .thenReturn(digest);

    final MachineSource result = dockerInstance.saveToSnapshot();

    assertTrue(result instanceof DockerMachineSource);
    DockerMachineSource dockerMachineSource = (DockerMachineSource) result;
    assertEquals(dockerMachineSource.getTag(), TAG);
    assertEquals(dockerMachineSource.getDigest(), digest);
    assertEquals(dockerMachineSource.getRegistry(), REGISTRY);
  }

