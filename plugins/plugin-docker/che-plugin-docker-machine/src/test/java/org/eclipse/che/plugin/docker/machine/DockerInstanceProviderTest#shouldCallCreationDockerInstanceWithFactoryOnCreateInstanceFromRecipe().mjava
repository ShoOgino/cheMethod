    @Test
    public void shouldCallCreationDockerInstanceWithFactoryOnCreateInstanceFromRecipe() throws Exception {
        String generatedContainerId = "genContainerId";
        doReturn(generatedContainerId).when(dockerInstanceProvider).generateContainerName(eq(WORKSPACE_ID), eq(DISPLAY_NAME));

        final MachineSourceImpl machineSource = new MachineSourceImpl("type", "location");
        final Recipe recipe = new RecipeImpl().withType("Dockerfile").withScript("FROM busybox");
        final MachineStateImpl machineState = new MachineStateImpl(false,
                                                                   "machineType",
                                                                   DISPLAY_NAME,
                                                                   machineSource,
                                                                   new LimitsImpl(64),
                                                                   "machineId",
                                                                   new ChannelsImpl("chan1", "chan2"),
                                                                   WORKSPACE_ID,
                                                                   "userId",
                                                                   "envName",
                                                                   MachineStatus.CREATING);

        createInstanceFromRecipe(recipe, machineState);


        verify(dockerMachineFactory).createInstance(eq(machineState),
                                                    eq(CONTAINER_ID),
                                                    eq("eclipse-che/" + generatedContainerId),
                                                    eq(dockerNode),
                                                    any(LineConsumer.class));
    }

