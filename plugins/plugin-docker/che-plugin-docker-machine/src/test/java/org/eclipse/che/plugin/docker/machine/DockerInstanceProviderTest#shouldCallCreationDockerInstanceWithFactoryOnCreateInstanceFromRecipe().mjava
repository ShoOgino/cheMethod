    @Test
    public void shouldCallCreationDockerInstanceWithFactoryOnCreateInstanceFromRecipe() throws Exception {
        String generatedContainerId = "genContainerId";
        doReturn(generatedContainerId).when(dockerInstanceProvider).generateContainerName(eq(WORKSPACE_ID), eq(DISPLAY_NAME));

        final MachineSourceImpl machineSource = new MachineSourceImpl("type", "location");
        final Recipe recipe = new RecipeImpl().withType("Dockerfile").withScript("FROM busybox");
        final MachineImpl machine =
                new MachineImpl(new MachineConfigImpl(false,
                                                      DISPLAY_NAME,
                                                      "machineType",
                                                      machineSource,
                                                      new LimitsImpl(MEMORY_LIMIT_MB),
                                                      asList(new ServerConfImpl("ref1", "8080", "https"),
                                                             new ServerConfImpl("ref2", "9090/udp", "someprotocol")),
                                                      Collections.singletonMap("key1", "value1")),
                                "machineId",
                                WORKSPACE_ID,
                                "envName",
                                "userId",
                                MachineStatus.CREATING,
                                null);

        createInstanceFromRecipe(recipe, machine);


        verify(dockerMachineFactory).createInstance(eq(machine),
                                                    eq(CONTAINER_ID),
                                                    eq("eclipse-che/" + generatedContainerId),
                                                    eq(dockerNode),
                                                    any(LineConsumer.class));
    }

