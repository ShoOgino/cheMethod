    @Test
    public void shouldCallCreationDockerInstanceWithFactoryOnCreateInstanceFromRecipe() throws Exception {
        String generatedContainerId = "genContainerId";
        doReturn(generatedContainerId).when(dockerInstanceProvider).generateContainerName(eq(WORKSPACE_ID), eq(DISPLAY_NAME));

        final MachineSourceImpl machineSource = new MachineSourceImpl("type", "location");
        final Recipe recipe = new RecipeImpl().withType("Dockerfile").withScript("FROM busybox");
        final MachineImpl machine = new MachineImpl(new MachineConfigImpl(false,
                                                                          DISPLAY_NAME,
                                                                          "machineType",
                                                                          machineSource,
                                                                          new LimitsImpl(MEMORY_LIMIT_MB)),
                                                    "machineId",
                                                    WORKSPACE_ID,
                                                    "envName",
                                                    "userId",
                                                    MachineStatus.CREATING,
                                                    null);

        createInstanceFromRecipe(recipe, machine);


        verify(dockerMachineFactory).createInstance(eq(machine),
                                                    eq(CONTAINER_ID),
                                                    eq("eclipse-che/" + generatedContainerId),
                                                    eq(dockerNode),
                                                    any(LineConsumer.class));
    }

