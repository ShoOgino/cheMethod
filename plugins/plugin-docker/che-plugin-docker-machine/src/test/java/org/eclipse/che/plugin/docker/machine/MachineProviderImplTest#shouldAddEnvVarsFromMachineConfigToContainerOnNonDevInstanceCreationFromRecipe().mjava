  @Test
  public void shouldAddEnvVarsFromMachineConfigToContainerOnNonDevInstanceCreationFromRecipe()
      throws Exception {
    // given
    Map<String, String> envVarsFromConfig = new HashMap<>();
    envVarsFromConfig.put("ENV_VAR1", "123");
    envVarsFromConfig.put("ENV_VAR2", "234");

    final boolean isDev = false;
    CheServiceImpl service = createService();
    service.setEnvironment(envVarsFromConfig);

    // when
    createInstanceFromRecipe(service, isDev);

    // then
    ArgumentCaptor<CreateContainerParams> argumentCaptor =
        ArgumentCaptor.forClass(CreateContainerParams.class);
    verify(dockerConnector).createContainer(argumentCaptor.capture());
    assertTrue(
        asList(argumentCaptor.getValue().getContainerConfig().getEnv())
            .containsAll(
                envVarsFromConfig
                    .entrySet()
                    .stream()
                    .map(entry -> entry.getKey() + "=" + entry.getValue())
                    .collect(Collectors.toList())));
  }

