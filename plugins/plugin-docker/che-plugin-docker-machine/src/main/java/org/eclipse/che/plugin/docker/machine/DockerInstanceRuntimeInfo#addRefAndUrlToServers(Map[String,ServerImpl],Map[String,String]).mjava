    protected Map<String, ServerImpl> addRefAndUrlToServers(final Map<String, ServerImpl> servers, final Map<String, String> labels) {
        final Map<String, ServerConfImpl> serversConfFromLabels = getServersConfFromLabels(servers.keySet(), labels);
        for (Map.Entry<String, ServerImpl> serverEntry : servers.entrySet()) {
            ServerConf serverConf = serversConf.getOrDefault(serverEntry.getKey(), serversConfFromLabels.get(serverEntry.getKey()));
            if (serverConf != null) {
                if (serverConf.getRef() != null) {
                    serverEntry.getValue().setRef(serverConf.getRef());
                }
                if (serverConf.getPath() != null) {
                    serverEntry.getValue().setPath(serverConf.getPath());
                }
                if (serverConf.getProtocol() != null) {
                    serverEntry.getValue().setProtocol(serverConf.getProtocol());

                    String url = serverConf.getProtocol() + "://" + serverEntry.getValue().getAddress();
                    if (serverConf.getPath() != null) {
                        if (serverConf.getPath().charAt(0) != '/') {
                            url = url + '/';
                        }
                        url = url + serverConf.getPath();
                    }
                    serverEntry.getValue().setUrl(url);
                }
            }
        }

        return servers;
    }

