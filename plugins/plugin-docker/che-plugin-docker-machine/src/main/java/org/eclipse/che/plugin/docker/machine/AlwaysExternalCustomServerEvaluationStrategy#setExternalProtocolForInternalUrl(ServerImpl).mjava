  private void setExternalProtocolForInternalUrl(ServerImpl server) {
    ServerPropertiesImpl properties = (ServerPropertiesImpl) server.getProperties();
    String url = properties.getInternalUrl();
    String externalProtocol = server.getProtocol();
    if (url != null && externalProtocol != null) {
      int internalUrlProtocolEnd = url.indexOf(':');
      if (internalUrlProtocolEnd > 0) {
        properties.setInternalUrl(externalProtocol.concat(url.substring(internalUrlProtocolEnd)));
      }
    }
  }

