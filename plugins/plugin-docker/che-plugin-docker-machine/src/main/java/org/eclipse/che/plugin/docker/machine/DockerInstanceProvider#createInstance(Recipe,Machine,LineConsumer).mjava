    @Override
    public Instance createInstance(Recipe recipe,
                                   Machine machine,
                                   LineConsumer creationLogsOutput) throws MachineException, UnsupportedRecipeException {
        final Dockerfile dockerfile = parseRecipe(recipe);

        final String userName = EnvironmentContext.getCurrent().getUser().getName();
        final String machineContainerName = containerNameGenerator.generateContainerName(machine.getWorkspaceId(),
                                                                                         machine.getId(),
                                                                                         userName,
                                                                                         machine.getConfig().getName());
        final String machineImageName = "eclipse-che/" + machineContainerName;
        final long memoryLimit = (long)machine.getConfig().getLimits().getRam() * 1024 * 1024;

        buildImage(dockerfile, creationLogsOutput, machineImageName, doForcePullOnBuild, memoryLimit, -1);

        return createInstance(machineContainerName,
                              machine,
                              machineImageName,
                              creationLogsOutput);
    }

