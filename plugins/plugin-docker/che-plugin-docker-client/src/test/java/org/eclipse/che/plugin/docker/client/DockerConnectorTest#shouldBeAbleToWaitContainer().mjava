  @Test
  public void shouldBeAbleToWaitContainer() throws IOException, JsonParseException {
    WaitContainerParams waitContainerParams = WaitContainerParams.create(CONTAINER);

    ContainerExitStatus containerExitStatus = new ContainerExitStatus();
    containerExitStatus.setStatusCode(CONTAINER_EXIT_CODE);

    doReturn(containerExitStatus)
        .when(dockerConnector)
        .parseResponseStreamAndClose(inputStream, ContainerExitStatus.class);

    int returnedExitCode = dockerConnector.waitContainer(waitContainerParams);

    verify(dockerConnectionFactory).openConnection(any(URI.class));
    verify(dockerConnection).method(REQUEST_METHOD_POST);
    verify(dockerConnection).path("/containers/" + waitContainerParams.getContainer() + "/wait");
    verify(dockerConnection).request();
    verify(dockerResponse).getStatus();
    verify(dockerResponse).getInputStream();

    assertEquals(returnedExitCode, containerExitStatus.getStatusCode());
  }

