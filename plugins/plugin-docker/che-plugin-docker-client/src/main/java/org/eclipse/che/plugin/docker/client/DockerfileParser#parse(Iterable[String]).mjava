  private static Dockerfile parse(Iterable<String> lines) throws DockerFileException {
    final Dockerfile dockerfile = new Dockerfile();
    DockerImage current = null;
    for (String line : lines) {
      line = line.trim();
      dockerfile.getLines().add(line);
      if (!line.isEmpty()) {
        Instruction instruction;
        if ((instruction = getInstruction(line)) == null) {
          continue;
        }

        if (instruction == Instruction.FROM) {
          if (current != null) {
            dockerfile.getImages().add(current);
          }
          current = new DockerImage();
          instruction.setInstructionArgumentsToModel(current, line);
        } else {
          if (current == null) {
            if (instruction != Instruction.COMMENT) {
              throw new DockerFileException(
                  "Error happened parsing the Docker file: Docker file must start with 'FROM' instruction");
            }
          } else {
            instruction.setInstructionArgumentsToModel(current, line);
          }
        }
      }
    }
    if (current != null) {
      dockerfile.getImages().add(current);
    }
    return dockerfile;
  }

