  private void writeHttpHeaders(
      OutputStream output, String method, String path, String query, List<Pair<String, ?>> headers)
      throws IOException {
    final Writer writer = new OutputStreamWriter(output);
    writer.write(method);
    writer.write(' ');
    writer.write(path);
    if (!Strings.isNullOrEmpty(query)) {
      writer.write("?");
      writer.write(query);
    }
    writer.write(" HTTP/1.1\r\n");
    for (Pair<String, ?> header : headers) {
      writer.write(header.first);
      writer.write(": ");
      writer.write(String.valueOf(header.second));
      writer.write("\r\n");
    }
    // Host header is mandatory in HTTP 1.1
    writer.write("Host: \r\n\r\n");
    writer.flush();
  }

