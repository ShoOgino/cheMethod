    private int execAndGetCode(String command) throws JSchException, IOException {
        ChannelExec exec = (ChannelExec)session.openChannel("exec");
        exec.setCommand(command);

        try (InputStream inStream = exec.getInputStream();
             InputStream erStream = exec.getErrStream()) {

            exec.connect(connectionTimeout);

            // read streams to wait until command finishes its work
            IoUtil.readStream(inStream);
            IoUtil.readStream(erStream);
        } finally {
            exec.disconnect();
        }

        return exec.getExitStatus();
    }

