    private String execAndGetOutput(String command) throws JSchException, MachineException, IOException {
        ChannelExec exec = null;
        try {
            exec = (ChannelExec)session.openChannel("exec");
            exec.setCommand(command);

            try (BufferedReader reader = new BufferedReader(new InputStreamReader(exec.getInputStream()))) {

                exec.connect(connectionTimeout);

                // todo fix that
                // this method is used to run commands such as "pwd" or "mkdir -p /some/path"
                // And we need to wait to check if it return 0. If command is still running method returns -1.
                try {
                    // workaround exit code -1
                    Thread.sleep(1000);
                } catch (InterruptedException ignored) {
                }
                if (exec.getExitStatus() != 0) {
                    throw new MachineException(format("Error code: %s. Error: %s",
                                                      exec.getExitStatus(),
                                                      IoUtil.readAndCloseQuietly(exec.getErrStream())));
                }

                ListLineConsumer listLineConsumer = new ListLineConsumer();
                String line;
                while ((line = reader.readLine()) != null) {
                    listLineConsumer.writeLine(line);
                }
                return listLineConsumer.getText();
            }
        } finally {
            if (exec != null) {
                exec.disconnect();
            }
        }
    }

