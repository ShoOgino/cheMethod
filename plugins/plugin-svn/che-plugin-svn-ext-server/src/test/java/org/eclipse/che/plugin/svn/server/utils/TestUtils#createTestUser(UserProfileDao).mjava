    /**
     * Creates a user and makes that user be the current user.
     *
     * @param userProfileDao
     *         the User Profile DAO
     * @throws Exception
     *         if anything goes wrong
     */
    public static void createTestUser(final UserProfileDao userProfileDao) throws Exception {
        // set current user
        EnvironmentContext.getCurrent().setSubject(new SubjectImpl("codenvy", "codenvy", null,
                                                                   Arrays.asList("workspace/developer"), false));

        // rules for mock
        final Map<String, String> profileAttributes = new HashMap<>();

        profileAttributes.put("firstName", "Codenvy");
        profileAttributes.put("lastName", "Codenvy");
        profileAttributes.put("email", "che@eclipse.org");

        Mockito.when(userProfileDao.getById("codenvy"))
               .thenReturn(new Profile().withId("codenvy").withUserId("codenvy").withAttributes(profileAttributes));
    }

