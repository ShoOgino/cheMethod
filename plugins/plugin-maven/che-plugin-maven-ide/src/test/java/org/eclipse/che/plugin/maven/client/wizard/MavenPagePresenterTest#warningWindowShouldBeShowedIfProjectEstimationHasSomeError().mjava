  @Test
  public void warningWindowShouldBeShowedIfProjectEstimationHasSomeError() throws Exception {
    final String dialogTitle = "Not valid Maven project";
    PromiseError promiseError = mock(PromiseError.class);
    MessageDialog messageDialog = mock(MessageDialog.class);
    context.put(WIZARD_MODE_KEY, UPDATE.toString());

    when(promiseError.getMessage()).thenReturn(TEXT);
    when(localization.mavenPageErrorDialogTitle()).thenReturn(dialogTitle);
    when(dialogFactory.createMessageDialog(anyString(), anyString(), anyObject()))
        .thenReturn(messageDialog);
    when(sourceEstimationPromise.then(Matchers.<Operation<SourceEstimation>>anyObject()))
        .thenReturn(sourceEstimationPromise);
    when(sourceEstimationPromise.catchError(Matchers.<Operation<PromiseError>>anyObject()))
        .thenReturn(sourceEstimationPromise);

    mavenPagePresenter.init(projectConfig);

    verify(containerPromise).then(optionContainerCapture.capture());
    optionContainerCapture.getValue().apply(optionalContainer);

    verify(sourceEstimationPromise).catchError(containerArgumentErrorCapture.capture());
    containerArgumentErrorCapture.getValue().apply(promiseError);

    verify(promiseError).getMessage();
    verify(dialogFactory).createMessageDialog(dialogTitle, TEXT, null);
    verify(messageDialog).show();
  }

