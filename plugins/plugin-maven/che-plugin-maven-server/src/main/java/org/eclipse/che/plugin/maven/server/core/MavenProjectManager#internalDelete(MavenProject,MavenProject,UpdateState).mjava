  private void internalDelete(
      MavenProject parentProject, MavenProject removedModule, UpdateState state) {
    for (MavenProject project : findModules(removedModule)) {
      internalDelete(removedModule, project, state);
    }

    writeLock.lock();
    try {
      if (parentProject == null) {
        rootProjects.remove(removedModule);
      } else {
        removeModule(parentProject, removedModule);
      }

      projectToMavenProjectMap.remove(removedModule.getProject());
      clearMavenKeyMap(removedModule);
      moduleToParentMap.remove(removedModule);
      parentToModulesMap.remove(removedModule);
    } finally {
      writeLock.unlock();
    }

    state.remove(removedModule);
  }

