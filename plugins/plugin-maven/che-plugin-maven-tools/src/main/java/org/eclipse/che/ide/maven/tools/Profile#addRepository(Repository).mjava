  private Profile addRepository(Repository repository) {
    repositories().add(repository);
    final Element repositoriesElement = element.getSingleChild("repositories");
    if (element.hasSingleChild("repositories") && repositoriesElement != null) {
      repositoriesElement.appendChild(repository.asXMLElement());
      repository.element = element.getLastChild();
    } else {
      element.insertChild(
          createElement("repositories", repository.asXMLElement()),
          beforeAnyOf("pluginRepositories", "activation", "build").or(inTheEnd()));
      if (repositoriesElement != null) {
        repository.element = repositoriesElement.getFirstChild();
      }
    }
    return this;
  }

