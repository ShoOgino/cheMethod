  @BeforeMethod
  public void setUp() throws Exception {
    keysInjector = new KeysInjector(sshManager, workspaceManager, execAgentClientFactory);

    when(execAgentClientFactory.create(anyString())).thenReturn(client);
    when(client.startProcess(anyString(), anyString(), anyString(), anyString()))
        .thenReturn(newDto(ProcessStartResponseDto.class).withPid(100));
    when(client.getProcess(anyString(), anyInt()))
        .thenReturn(
            newDto(GetProcessResponseDto.class).withAlive(false).withPid(100).withExitCode(0));
    prepareAndMockServers();

    EnvironmentContext context = new EnvironmentContext();
    context.setSubject(new SubjectImpl("name", OWNER, "token123", false));
    EnvironmentContext.setCurrent(context);
  }

