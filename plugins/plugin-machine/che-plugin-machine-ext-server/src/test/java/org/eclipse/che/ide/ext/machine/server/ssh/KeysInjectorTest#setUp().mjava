    @BeforeMethod
    public void setUp() throws Exception {
        final Map<String, String> metadataProperties = new HashMap<>();
        metadataProperties.put("id", CONTAINER_ID);
        when(metadata.getProperties()).thenReturn(metadataProperties);

        when(machineManager.getMachine(MACHINE_ID)).thenReturn(instance);
        when(instance.getOwner()).thenReturn(OWNER_ID);
        when(instance.getMetadata()).thenReturn(metadata);
        when(instance.getLogger()).thenReturn(lineConsumer);

        keysInjector.start();
        verify(eventService).subscribe(subscriberCaptor.capture());
        subscriber = subscriberCaptor.getValue();

        when(docker.createExec(anyString(), anyBoolean(), anyString())).thenReturn(exec);
        when(docker.createExec(anyString(), anyBoolean(), anyString(), anyString(), anyString())).thenReturn(exec);
        when(docker.createExec(anyString(), anyBoolean(), anyString())).thenReturn(exec);
        when(exec.getId()).thenReturn(EXEC_ID);
    }

