    @BeforeMethod
    public void setUp() throws Exception {
        final Map<String, String> metadataProperties = new HashMap<>();
        metadataProperties.put("id", CONTAINER_ID);
        when(machineRuntime.getProperties()).thenReturn(metadataProperties);

        when(environmentEngine.getMachine(WORKSPACE_ID, MACHINE_ID)).thenReturn(instance);
        when(instance.getOwner()).thenReturn(OWNER_NAME);
        when(instance.getRuntime()).thenReturn(machineRuntime);
        when(instance.getLogger()).thenReturn(lineConsumer);

        keysInjector.start();
        verify(eventService).subscribe(subscriberCaptor.capture());
        subscriber = subscriberCaptor.getValue();

        when(userManager.getByName(eq(OWNER_NAME))).thenReturn(user);
        when(user.getId()).thenReturn(USER_ID);

        when(docker.createExec(any(CreateExecParams.class))).thenReturn(exec);
        when(exec.getId()).thenReturn(EXEC_ID);
    }

