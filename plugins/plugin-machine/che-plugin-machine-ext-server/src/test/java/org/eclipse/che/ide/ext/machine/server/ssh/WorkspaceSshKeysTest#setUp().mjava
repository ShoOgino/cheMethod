    /**
     * Setup initial objects by grabbing the two event subscribers, populating the environment context and initializing workspace data.
     *
     * @throws Exception
     */
    @BeforeMethod
    public void setUp() throws Exception {

        workspaceSshKeys.start();
        verify(eventService, times(2)).subscribe(subscriberCaptor.capture());
        workspaceCreatedEventEventSubscriber = (EventSubscriber<WorkspaceCreatedEvent>)subscriberCaptor.getAllValues().get(0);
        workspaceRemovedEventEventSubscriber = (EventSubscriber<WorkspaceRemovedEvent>)subscriberCaptor.getAllValues().get(1);

        when(workspace.getId()).thenReturn(WORKSPACE_ID);
        when(workspace.getConfig()).thenReturn(workspaceConfig);
        when(workspaceConfig.getName()).thenReturn(WORKSPACE_NAME);

        EnvironmentContext.setCurrent(new EnvironmentContext() {
            @Override
            public Subject getSubject() {
                return new SubjectImpl(NAMESPACE, OWNER_ID, "token", false);
            }
        });

    }

