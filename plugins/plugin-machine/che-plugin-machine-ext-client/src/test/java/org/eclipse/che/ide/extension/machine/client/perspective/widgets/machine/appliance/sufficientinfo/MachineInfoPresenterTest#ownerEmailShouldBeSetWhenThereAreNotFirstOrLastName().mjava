    @Test
    public void ownerEmailShouldBeSetWhenThereAreNotFirstOrLastName() throws Exception {
        Map<String, String> attributes = new HashMap<>();
        attributes.put(MachineInfoPresenter.FIRST_NAME_KEY, "undefined");
        attributes.put(MachineInfoPresenter.LAST_NAME_KEY, "<none>");
        attributes.put(MachineInfoPresenter.EMAIL_KEY, "email");

        when(profileDescriptor.getAttributes()).thenReturn(attributes);
        when(wsService.getWorkspace(SOME_TEXT)).thenReturn(promise);

        presenter.update(machine);

        verify(userProfile).getCurrentProfile(profileCaptor.capture());
        AsyncRequestCallback<ProfileDescriptor> callback = profileCaptor.getValue();

        //noinspection NonJREEmulationClassesInClientCode
        Method method = callback.getClass().getDeclaredMethod("onSuccess", Object.class);

        method.setAccessible(true);

        method.invoke(callback, profileDescriptor);

        verify(view).setOwner("email");
    }

