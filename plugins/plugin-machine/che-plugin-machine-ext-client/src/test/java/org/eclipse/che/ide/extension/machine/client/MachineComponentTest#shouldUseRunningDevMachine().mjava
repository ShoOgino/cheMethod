    @Test
    public void shouldUseRunningDevMachine() throws Exception {
        when(machineServiceClient.getMachines(anyString())).thenReturn(machinesPromise);
        when(machinesPromise.then(any(Operation.class))).thenReturn(machinesPromise);
        when(machineDescriptor.getConfig()).thenReturn(machineConfigDescriptor);
        when(machineConfigDescriptor.isDev()).thenReturn(true);
        when(machineDescriptor.getStatus()).thenReturn(MachineStatus.RUNNING);
        when(machineDescriptor.getId()).thenReturn(DEV_MACHINE_ID);
        when(appContext.getWorkspace()).thenReturn(usersWorkspaceDto);
        when(usersWorkspaceDto.getId()).thenReturn(TEXT);

        machineComponent.start(componentCallback);

        verify(machineServiceClient).getMachines(anyString());
        verify(machinesPromise).then(machinesCaptor.capture());
        machinesCaptor.getValue().apply(Collections.singletonList(machineDescriptor));
        verify(machineConfigDescriptor).isDev();
        verify(machineDescriptor).getStatus();
        verify(appContext).setDevMachineId(eq(DEV_MACHINE_ID));
        verify(machineManager).onMachineRunning(eq(DEV_MACHINE_ID));
        verify(componentCallback).onSuccess(eq(machineComponent));
    }

