    @Test
    public void shouldFetchMachines() throws Exception {
        MachineDto machineDto = mock(MachineDto.class);
        when(machineDto.isDev()).thenReturn(true);
        List<MachineDto> machines = new ArrayList<>(2);
        machines.add(machineDto);

        when(appContext.getWorkspace()).thenReturn(workspace);
        DevMachineStateEvent devMachineStateEvent = mock(DevMachineStateEvent.class);
        verify(eventBus, times(2)).addHandler(anyObject(), devMachineStateHandlerCaptor.capture());

        DevMachineStateHandler devMachineStateHandler = devMachineStateHandlerCaptor.getAllValues().get(0);
        devMachineStateHandler.onMachineStarted(devMachineStateEvent);

        verify(appContext, times(2)).getWorkspaceId();
        verify(machineService, times(2)).getWorkspaceMachines(eq(WORKSPACE_ID));
        verify(machinesPromise, times(2)).then(machinesCaptor.capture());
        machinesCaptor.getValue().apply(machines);
        verify(view).setProcessesData(anyObject());
    }

