    @Test
    public void secondRecipeShouldBeCreated() throws Exception {
        NewRecipe newRecipe = mock(NewRecipe.class);

        when(dtoFactory.createDto(NewRecipe.class)).thenReturn(newRecipe);
        when(newRecipe.withType(anyString())).thenReturn(newRecipe);
        when(newRecipe.withScript(anyString())).thenReturn(newRecipe);
        when(newRecipe.withName(anyString())).thenReturn(newRecipe);
        when(newRecipe.withTags(Matchers.<List<String>>any())).thenReturn(newRecipe);
        when(service.createRecipe(newRecipe)).thenReturn(recipeDescriptorPromise);
        when(recipesContainerPresenter.getEditorPanel(Matchers.<RecipeWidget>any())).thenReturn(recipeEditorPanel);
        when(recipesContainerPresenter.getEditorStubPanel()).thenReturn(stubPanel);

        recipePartPresenter.onNewButtonClicked();

        verify(recipeDescriptorPromise).then(operationDescriptorCaptor.capture());
        operationDescriptorCaptor.getValue().apply(recipeDescriptor1);

        when(recipeDescriptor1.getName()).thenReturn("name");

        recipePartPresenter.onCloneButtonClicked();

        verify(recipeDescriptor1).getType();
        verify(recipeDescriptor1).getScript();
        verify(recipeDescriptor1).getTags();

        verify(newRecipe).withType(RECIPE_TYPE);
        verify(newRecipe).withScript("script");
        verify(newRecipe).withName("name");
        assertTrue(newRecipe.getTags().isEmpty());

        verify(service, times(2)).createRecipe(newRecipe);

        verify(recipeDescriptorPromise, times(2)).then(operationDescriptorCaptor.capture());
        operationDescriptorCaptor.getValue().apply(recipeDescriptor1);

        verify(recipePartView, times(2)).addRecipe(Matchers.<RecipeWidget>any());
        verify(recipesContainerPresenter, times(2)).addRecipePanel(Matchers.<RecipeWidget>any());
        verify(recipesContainerPresenter, times(2)).showEditorPanel(Matchers.<RecipeWidget>any());
        verify(recipesContainerPresenter, times(2)).getEditorPanel(Matchers.<RecipeWidget>any());
        verify(recipeEditorPanel, times(2)).setDelegate(recipePartPresenter);
    }

