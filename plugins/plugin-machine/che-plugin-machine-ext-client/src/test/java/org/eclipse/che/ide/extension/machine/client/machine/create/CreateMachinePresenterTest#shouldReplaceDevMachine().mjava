    @Test
    public void shouldReplaceDevMachine() throws Exception {
        DevMachine devMachine = mock(DevMachine.class);
        when(appContext.getDevMachine()).thenReturn(devMachine);
        when(devMachine.getId()).thenReturn(SOME_TEXT);
        when(machineServiceClient.getMachine(SOME_TEXT)).thenReturn(machineDescriptorPromise);

        presenter.onReplaceDevMachineClicked();

        verify(view).getMachineName();
        verify(view).getRecipeURL();
        verify(appContext, times(2)).getDevMachine();
        verify(machineServiceClient).getMachine(SOME_TEXT);
        verify(machineDescriptorPromise).then(machineCaptor.capture());
        machineCaptor.getValue().apply(mock(MachineDto.class));
        verify(machineManager).destroyMachine(any(MachineDto.class));
        verify(machineManager).startDevMachine(eq(RECIPE_URL), eq(MACHINE_NAME));
        verify(view).close();
    }

