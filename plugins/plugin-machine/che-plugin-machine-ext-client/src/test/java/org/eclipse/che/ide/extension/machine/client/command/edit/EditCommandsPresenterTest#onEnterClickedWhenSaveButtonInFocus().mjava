    @Test
    public void onEnterClickedWhenSaveButtonInFocus() throws Exception {
        when(view.isCancelButtonInFocus()).thenReturn(false);
        when(view.isCloseButtonInFocus()).thenReturn(false);
        CommandDto command = mock(CommandDto.class);
        CommandConfiguration commandConfiguration = mock(CommandConfiguration.class);
        List<CommandDto> commands = new ArrayList<>(1);
        List<CommandConfiguration> confiqurations = new ArrayList<>(1);
        commands.add(command);
        confiqurations.add(commandConfiguration);
        when(dtoFactory.createDto(CommandDto.class)).thenReturn(command);
        when(command.withName(anyString())).thenReturn(command);
        when(command.withCommandLine(anyString())).thenReturn(command);
        when(command.withType(anyString())).thenReturn(command);
        when(command.withAttributes(anyMap())).thenReturn(command);
        when(view.getSelectedConfiguration()).thenReturn(commandConfiguration);
        when(commandConfiguration.getType()).thenReturn(mock(CommandType.class));
        when(commandConfiguration.getName()).thenReturn(COMMAND_NAME);

        when(workspacePromise.thenPromise(any(Function.class))).thenReturn(workspacePromise);
        when(workspacePromise.then((Operation)anyObject())).thenReturn(workspacePromise);

        presenter.onEnterClicked();

        verify(dtoFactory).createDto(CommandDto.class);
        verify(workspaceServiceClient).updateCommand(eq(WORKSPACE_ID), anyString(), eq(command));
        verify(workspacePromise).then(workspaceCaptor.capture());
        workspaceCaptor.getValue().apply(workspace);

        verify(view).setCancelButtonState(false);
        verify(view).setSaveButtonState(false);
        verify(workspaceServiceClient).getCommands(anyString());

        verify(commandsPromise).then(commandsCaptor.capture());
        commandsCaptor.getValue().apply(commands);

        verify(commandConfigurationPromise).then(commandConfigurationCaptor.capture());
        commandConfigurationCaptor.getValue().apply(confiqurations);

        verify(view).setData(anyObject());
        verify(view).setFilterState(anyBoolean());
        verify(view).setCloseButtonInFocus();
        verify(view, never()).close();
    }

