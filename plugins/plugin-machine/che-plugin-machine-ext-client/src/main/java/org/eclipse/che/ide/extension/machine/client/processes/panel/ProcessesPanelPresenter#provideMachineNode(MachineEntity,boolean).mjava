    /**
     * Provides machine node:
     * <li>creates new machine node when this one not exist or {@code replace} is {@code true}</li>
     * <li>returns old machine node when this one exist and {@code replace} is {@code false}</li>
     *
     * @param machine
     *         machine to creating node
     * @param replace
     *         existed node will be replaced when {@code replace} is {@code true}
     * @return machine node
     */
    private ProcessTreeNode provideMachineNode(@NotNull MachineEntity machine, boolean replace) {
        final String machineId = machine.getId();
        final ProcessTreeNode existedMachineNode = findProcessTreeNodeById(machineId);
        if (!replace && existedMachineNode != null) {
            return existedMachineNode;
        }

        final ProcessTreeNode newMachineNode = new ProcessTreeNode(MACHINE_NODE, rootNode, machine, null, new ArrayList<ProcessTreeNode>());
        newMachineNode.setRunning(true);
        newMachineNode.setHasTerminalAgent(hasAgent(machine.getDisplayName(), TERMINAL_AGENT));
        newMachineNode.setHasSSHAgent(hasAgent(machine.getDisplayName(), SSH_AGENT));
        machineNodes.put(machineId, newMachineNode);

        if (rootNodes.contains(existedMachineNode)) {
            rootNodes.remove(existedMachineNode);
        }

        rootNodes.add(newMachineNode);

        view.setProcessesData(rootNode);

        if (existedMachineNode == null) {
            final OutputConsole outputConsole = commandConsoleFactory.create(machine.getConfig().getName());
            addOutputConsole(machineId, newMachineNode, outputConsole, true);
        }

        return newMachineNode;
    }

