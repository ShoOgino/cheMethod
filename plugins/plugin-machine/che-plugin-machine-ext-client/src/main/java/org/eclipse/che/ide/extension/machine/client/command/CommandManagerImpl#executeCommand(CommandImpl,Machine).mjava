    @Override
    public void executeCommand(final CommandImpl command, final Machine machine) {
        final String name = command.getName();
        final String type = command.getType();
        final String commandLine = command.getCommandLine();

        final CommandOutputConsole console = commandConsoleFactory.create(command, machine);
        final String machineId = machine.getId();

        processesPanelPresenter.addCommandOutput(machineId, console);
        macroProcessor.expandMacros(commandLine).then(new Operation<String>() {
            @Override
            public void apply(String expandedCommandLine) throws OperationException {
                Command expandedCommand = new CommandImpl(name, expandedCommandLine, type);

                execAgentCommandManager.startProcess(machineId, expandedCommand)
                                       .thenIfProcessStartedEvent(console.getProcessStartedOperation())
                                       .thenIfProcessDiedEvent(console.getProcessDiedOperation())
                                       .thenIfProcessStdOutEvent(console.getStdOutOperation())
                                       .thenIfProcessStdErrEvent(console.getStdErrOperation());
            }
        });
    }

