    @Override
    public void onCommandSelected(final CommandImpl command) {
        if (!isViewModified()) {
            handleCommandSelection(command);
            return;
        }

        final ConfirmCallback saveCallback = new ConfirmCallback() {
            @Override
            public void accepted() {
                updateCommand(editedCommand).then(new Operation<CommandImpl>() {
                    @Override
                    public void apply(CommandImpl arg) throws OperationException {
                        refreshView();
                        handleCommandSelection(command);
                    }
                });
            }
        };

        final ConfirmCallback discardCallback = new ConfirmCallback() {
            @Override
            public void accepted() {
                refreshView();
                handleCommandSelection(command);
            }
        };

        ChoiceDialog dialog = dialogFactory.createChoiceDialog(
                machineLocale.editCommandsSaveChangesTitle(),
                machineLocale.editCommandsSaveChangesConfirmation(editedCommand.getName()),
                coreLocale.save(),
                machineLocale.editCommandsSaveChangesDiscard(),
                saveCallback,
                discardCallback);

        dialog.show();
    }

