    @Inject
    public MachineExtension(final MachineResources machineResources,
                            final EventBus eventBus,
                            final WorkspaceAgent workspaceAgent,
                            final AppContext appContext,
                            final ConsolesContainerPresenter consolesContainerPresenter,
                            final ConsolesPanelPresenter consolesPanelPresenter,
                            final Provider<ServerPortProvider> machinePortProvider,
                            final PerspectiveManager perspectiveManager,
                            final IconRegistry iconRegistry,
                            final CustomCommandType arbitraryCommandType,
                            final Provider<MachineStatusNotifier> machineStatusNotifierProvider,
                            final ProjectExplorerPresenter projectExplorerPresenter) {
        machineResources.getCss().ensureInjected();
        machineStatusNotifierProvider.get();

        eventBus.addHandler(WsAgentStateEvent.TYPE, new WsAgentStateHandler() {
            @Override
            public void onWsAgentStarted(WsAgentStateEvent event) {
                machinePortProvider.get();
                /* Do not show terminal on factories by default */
                if (appContext.getFactory() == null) {
                    consolesPanelPresenter.newTerminal();
                    workspaceAgent.openPart(consolesContainerPresenter, PartStackType.INFORMATION);
                }

                workspaceAgent.setActivePart(projectExplorerPresenter);
            }

            @Override
            public void onWsAgentStopped(WsAgentStateEvent event) {
            }
        });

        Scheduler.get().scheduleDeferred(new Scheduler.ScheduledCommand() {
            @Override
            public void execute() {
                /* There is a bug in perspective management and it's unable to add Consoles part in
                 * OperationsPerspective and ProjectPerspective directly. Following code resolves the issue.
                 */

                /* Add Consoles to Operation perspective */
                perspectiveManager.setPerspectiveId(OperationsPerspective.OPERATIONS_PERSPECTIVE_ID);
                workspaceAgent.openPart(consolesContainerPresenter, PartStackType.INFORMATION);

                /* Add Consoles to Project perspective */
                perspectiveManager.setPerspectiveId(PROJECT_PERSPECTIVE_ID);
                workspaceAgent.openPart(consolesContainerPresenter, PartStackType.INFORMATION);
                if (appContext.getFactory() == null) {
                     workspaceAgent.setActivePart(consolesContainerPresenter);
                }
            }
        });

        iconRegistry.registerIcon(new Icon(arbitraryCommandType.getId() + ".commands.category.icon", machineResources.customCommandType()));
    }

