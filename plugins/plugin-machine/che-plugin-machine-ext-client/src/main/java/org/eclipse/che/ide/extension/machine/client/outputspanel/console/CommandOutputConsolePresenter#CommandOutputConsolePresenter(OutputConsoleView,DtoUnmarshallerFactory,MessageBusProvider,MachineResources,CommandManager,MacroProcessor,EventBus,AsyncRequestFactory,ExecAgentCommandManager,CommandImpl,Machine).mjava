    @Inject
    public CommandOutputConsolePresenter(final OutputConsoleView view,
                                         DtoUnmarshallerFactory dtoUnmarshallerFactory,
                                         final MessageBusProvider messageBusProvider,
                                         MachineResources resources,
                                         CommandManager commandManager,
                                         MacroProcessor macroProcessor,
                                         EventBus eventBus,
                                         AsyncRequestFactory asyncRequestFactory,
                                         ExecAgentCommandManager execAgentCommandManager,
                                         @Assisted CommandImpl command,
                                         @Assisted Machine machine) {
        this.view = view;
        this.dtoUnmarshallerFactory = dtoUnmarshallerFactory;
        this.messageBus = messageBusProvider.getMessageBus();
        this.resources = resources;
        this.asyncRequestFactory = asyncRequestFactory;
        this.execAgentCommandManager = execAgentCommandManager;
        this.command = command;
        this.machine = machine;
        this.eventBus = eventBus;
        this.commandManager = commandManager;

        view.setDelegate(this);

        final String previewUrl = command.getAttributes().get(PREVIEW_URL_ATTR);
        if (!isNullOrEmpty(previewUrl)) {
            macroProcessor.expandMacros(previewUrl).then(new Operation<String>() {
                @Override
                public void apply(String arg) throws OperationException {
                    view.showPreviewUrl(arg);
                }
            });
        } else {
            view.hidePreview();
        }
    }

