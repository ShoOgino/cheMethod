    /**
     * Fetches all recipes from the server, makes a list of targets and selects specified target.
     */
    private void updateTargets(final String targetToSelect) {
        targets.clear();
        machines.clear();

        machineService.getMachines(appContext.getWorkspaceId()).then(new Operation<List<MachineDto>>() {
            @Override
            public void apply(List<MachineDto> machineList) throws OperationException {
                for (MachineDto machine : machineList) {
                    machines.put(machine.getConfig().getName(), machine);
                }

                recipeServiceClient.getAllRecipes().then(new Operation<List<RecipeDescriptor>>() {
                    @Override
                    public void apply(List<RecipeDescriptor> recipeList) throws OperationException {
                        for (RecipeDescriptor recipe : recipeList) {
/*                            // Display only SSH_CATEGORY recipes
                           if (!SSH_CATEGORY.equalsIgnoreCase(recipe.getType())) {
                                continue;
                            }
*/
                            final MachineDto machine = machines.get(recipe.getName());
                            final String targetType;
                            if (machine == null) {
                                targetType = recipe.getType();
                            } else {
                                final MachineConfigDto machineConfig = machine.getConfig();
                                targetType = machineConfig.isDev() ? machineLocale.devMachineCategory() : machineConfig.getType();
                            }
                            final Target target = new Target(recipe.getName(), targetType, recipe);
                            target.setRecipe(recipe);
                            targets.add(target);

                            target.setConnected(isMachineRunning(machine));

                            restoreTarget(target);
                        }

                        view.showTargets(targets);

                        if (targetToSelect != null) {
                            for (Target target : targets) {
                                if (target.getName().equals(targetToSelect)) {
                                    view.selectTarget(target);
                                    break;
                                }
                            }
                        }
                    }
                });

            }
        });
    }

