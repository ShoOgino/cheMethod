    public void setTestFailed(String failureMessage, String stackTrace, boolean error) {
        checkAndSetStackTrace(stackTrace);
        TestFailedInfo failedInfo = new TestFailedInfo(failureMessage, stackTrace);
        if (stateInfo instanceof TestComparisionFailedInfo) {
            CompaundTestFailedInfo failedTests = new CompaundTestFailedInfo(failureMessage, stackTrace);
            failedTests.addFailedTest((TestFailedInfo) stateInfo);
            failedTests.addFailedTest(failedInfo);
            callNewPrintable(failedInfo);
            stateInfo = failedTests;
        } else if (stateInfo instanceof CompaundTestFailedInfo) {
            ((CompaundTestFailedInfo) stateInfo).addFailedTest(failedInfo);
            callNewPrintable(failedInfo);
        } else if (stateInfo instanceof TestFailedInfo) {
            ((TestFailedInfo) stateInfo).addError(failureMessage, stackTrace, printer);
        } else {
            if (error) {
                stateInfo = new TestErrorInfo(failureMessage, stackTrace);
            } else {
                stateInfo = failedInfo;
            }
            callNewPrintable(stateInfo);
        }

    }

