  private void openFileAndScrollToLine(
      final VirtualFile virtualFile,
      final int scrollToLine,
      final AsyncCallback<VirtualFile> callback) {
    editorAgent.openEditor(
        virtualFile,
        new EditorAgent.OpenEditorCallback() {
          @Override
          public void onEditorOpened(EditorPartPresenter editor) {
            new Timer() {
              @Override
              public void run() {
                scrollToLine(editorAgent.getActiveEditor(), scrollToLine);
                callback.onSuccess(virtualFile);
              }
            }.schedule(300);
          }

          @Override
          public void onEditorActivated(EditorPartPresenter editor) {
            new Timer() {
              @Override
              public void run() {
                scrollToLine(editorAgent.getActiveEditor(), scrollToLine);
                callback.onSuccess(virtualFile);
              }
            }.schedule(300);
          }

          @Override
          public void onInitializationFailed() {
            callback.onFailure(
                new IllegalStateException(
                    "Initialization " + virtualFile.getName() + " in the editor failed"));
          }
        });
  }

