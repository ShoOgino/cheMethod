    @Override
    public void run() {
      while (true) {
        try {
          IDbgEngineMessage message = messageQueue.take();
          if (message.getType() == NOTIFICATION_CLOSE_MESSAGE_HANDLER) break;
          if (message instanceof IDbgEngineNotification) {
            engineMessageHandler.handleNotification((IDbgEngineNotification) message);
          } else if (message instanceof IDbgEngineRequest) {
            IDbgClientResponse response =
                engineMessageHandler.handleRequest((IDbgEngineRequest<?>) message);
            engineConnectionRunnable.write(response);
          }
        } catch (Exception e) {
          ZendDebugger.LOG.error(e.getMessage(), e);
        }
      }
    }

