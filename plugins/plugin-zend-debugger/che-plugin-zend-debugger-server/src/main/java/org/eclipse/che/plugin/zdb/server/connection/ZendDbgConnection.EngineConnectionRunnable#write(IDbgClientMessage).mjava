        private void write(IDbgClientMessage clientMessage) {
            ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
            DataOutputStream dataOutputStream = new DataOutputStream(byteArrayOutputStream);
            try {
                clientMessage.serialize(dataOutputStream);
                int messageSize = byteArrayOutputStream.size();
                // Write to connection output
                outputStream.writeInt(messageSize);
                byteArrayOutputStream.writeTo(outputStream);
                outputStream.flush();
            } catch (Exception e) {
                ZendDebugger.LOG.error(e.getMessage(), e);
            }
            if (clientMessage.getType() == NOTIFICATION_CLOSE_SESSION) {
                purge();
            }
        }

