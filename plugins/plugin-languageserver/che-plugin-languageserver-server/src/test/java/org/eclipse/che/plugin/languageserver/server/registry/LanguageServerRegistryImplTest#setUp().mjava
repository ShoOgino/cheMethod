    @BeforeMethod
    public void setUp() throws Exception {
        when(completableFuture.get()).thenReturn(initializeResult);
        when(initializeResult.getCapabilities()).thenReturn(serverCapabilities);
//        when(serverCapabilities.isMultiplyProjectsProvider()).thenReturn(true);

        when(languageServerLauncher.getLanguageDescription()).thenReturn(languageDescription);
        when(languageDescription.getLanguageId()).thenReturn(JsonLanguageServerLauncher.LANGUAGE_ID);
        when(languageDescription.getFileExtensions()).thenReturn(asList(JsonLanguageServerLauncher.EXTENSIONS));
        when(languageDescription.getMimeTypes()).thenReturn(asList(JsonLanguageServerLauncher.MIME_TYPES));

        when(languageServer.getTextDocumentService()).thenReturn(mock(TextDocumentService.class));
        when(languageServer.getWindowService()).thenReturn(mock(WindowService.class));
        when(languageServer.initialize(any(InitializeParams.class))).thenReturn(completableFuture);

        registry = spy(new LanguageServerRegistryImpl(Collections.singleton(languageServerLauncher),
                                                      null,
                                                      initializer));

        when(initializer.initialize(any(LanguageServerLauncher.class), anyString())).thenAnswer(invocation -> {
            Object[] arguments = invocation.getArguments();
            registry.onServerInitialized(languageServer, serverCapabilities, languageDescription, (String)arguments[1]);
            return languageServer;
        });

        doReturn(PROJECT_PATH).when(registry).extractProjectPath(FILE_PATH);
    }

