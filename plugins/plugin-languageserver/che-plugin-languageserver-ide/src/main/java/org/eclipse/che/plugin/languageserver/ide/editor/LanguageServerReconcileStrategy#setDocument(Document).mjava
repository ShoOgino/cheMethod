    @Override
    public void setDocument(Document document) {
        document.getDocumentHandle().getDocEventBus().addHandler(DocumentChangedEvent.TYPE, new DocumentChangedHandler() {
            @Override
            public void onDocumentChanged(DocumentChangedEvent event) {
                synchronize.syncTextDocument(event.getDocument().getDocument(), lastEventStart, lastEventEnd, event.getText(), ++version);
            }
        });
        document.getDocumentHandle().getDocEventBus().addHandler(DocumentChangingEvent.TYPE, new DocumentChangingHandler() {
            @Override
            public void onDocumentChanging(DocumentChangingEvent event) {
                lastEventStart= event.getDocument().getDocument().getPositionFromIndex(event.getOffset());
                lastEventEnd= event.getDocument().getDocument().getPositionFromIndex(event.getOffset()+event.getRemoveCharCount());
            }
        });

    }

