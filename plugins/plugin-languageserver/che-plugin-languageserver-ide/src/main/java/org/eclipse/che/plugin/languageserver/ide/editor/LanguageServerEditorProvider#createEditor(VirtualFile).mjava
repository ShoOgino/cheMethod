  @Override
  public Promise<EditorPartPresenter> createEditor(VirtualFile file) {
    if (!(file instanceof File)) {
      return null;
    }

    return registry
        .getOrInitializeServer(file)
        .then(
            (Function<ServerCapabilities, EditorPartPresenter>)
                capabilities -> {
                  if (editorBuilder == null) {
                    Log.debug(
                        AbstractTextEditorProvider.class,
                        "No builder registered for default editor type - giving up.");
                    return null;
                  }

                  final TextEditor editor = editorBuilder.buildEditor();
                  TextEditorConfiguration configuration =
                      capabilities == null
                          ? new DefaultTextEditorConfiguration()
                          : editorConfigurationFactory.build(editor, capabilities);
                  editor.initialize(configuration);
                  return editor;
                });
  }

