  @Override
  public void format(Document document) {

    TextRange selectedRange = document.getSelectedTextRange();
    if (selectedRange != null
        && !selectedRange.getFrom().equals(selectedRange.getTo())
        && capabilities.getDocumentRangeFormattingProvider()) {
      //selection formatting
      formatRange(selectedRange, document);
    } else if (capabilities.getDocumentFormattingProvider()) {
      //full document formatting
      formatFullDocument(document);
    }
  }

