  @Override
  public String getDisplayString() {
    SafeHtmlBuilder builder = new SafeHtmlBuilder();

    String label = completionItem.getItem().getLabel();
    int pos = 0;
    for (Match highlight : highlights) {
      if (highlight.getStart() == highlight.getEnd()) {
        continue;
      }

      if (pos < highlight.getStart()) {
        appendPlain(builder, label.substring(pos, highlight.getStart()));
      }

      appendHighlighted(builder, label.substring(highlight.getStart(), highlight.getEnd()));
      pos = highlight.getEnd();
    }

    if (pos < label.length()) {
      appendPlain(builder, label.substring(pos));
    }

    if (completionItem.getItem().getDetail() != null) {
      appendDetail(builder, completionItem.getItem().getDetail());
    }

    return builder.toSafeHtml().asString();
  }

