        @Override
        public void apply(Document document) {
            if (completionItem.getTextEdit() != null) {
                Range range = completionItem.getTextEdit().getRange();
                int startOffset = document.getIndexFromPosition(
                        new TextPosition(range.getStart().getLine(), range.getStart().getCharacter()));
                int endOffset = offset + document.getIndexFromPosition(
                        new TextPosition(range.getEnd().getLine(), range.getEnd().getCharacter()));
                document.replace(startOffset, endOffset - startOffset, completionItem.getTextEdit().getNewText());
            } else {
                int currentWordLength = currentWord.length();
                int cursorOffset = document.getCursorOffset();
                if (completionItem.getInsertText() == null) {
                    document.replace(cursorOffset - currentWordLength, currentWordLength, completionItem.getLabel());
                } else {
                    document.replace(cursorOffset - offset, offset, completionItem.getInsertText());
                }
            }
        }

