    private TextEdit adjustForOffset(TextEdit textEdit, TextPosition pos, int delta) {
      Range range = textEdit.getRange();
      int originalStart = pos.getCharacter() - delta;
      if (range.getStart().getLine() != pos.getLine()
          || textEdit.getRange().getEnd().getCharacter() < originalStart) {
        return textEdit;
      } else if (originalStart < range.getStart().getCharacter()) {
        return new TextEdit(
            newRange(
                range.getStart().getLine(),
                range.getStart().getCharacter() + delta,
                range.getEnd().getLine(),
                range.getEnd().getCharacter() + delta),
            textEdit.getNewText());
      } else {
        return new TextEdit(
            newRange(
                range.getStart().getLine(),
                range.getStart().getCharacter(),
                range.getEnd().getLine(),
                range.getEnd().getCharacter() + delta),
            textEdit.getNewText());
      }
    }

