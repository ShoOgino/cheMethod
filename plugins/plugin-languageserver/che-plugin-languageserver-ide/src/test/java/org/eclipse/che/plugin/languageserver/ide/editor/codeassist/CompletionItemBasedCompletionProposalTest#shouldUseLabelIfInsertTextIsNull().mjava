  @Test
  public void shouldUseLabelIfInsertTextIsNull() throws Exception {
    when(serverCapabilities.getCompletionProvider()).thenReturn(completionOptions);
    when(completionOptions.getResolveProvider()).thenReturn(false);

    when(document.getCursorPosition()).thenReturn(new TextPosition(0, 5));
    when(completion.getInsertText()).thenReturn(null);
    when(completion.getLabel()).thenReturn("bar");

    Completion[] completions = new Completion[1];
    proposal.getCompletion(completion -> completions[0] = completion);

    completions[0].apply(document);

    verify(document).getCursorPosition();
    verify(document, times(1)).replace(eq(0), eq(5), eq(0), eq(5), eq("bar"));
    verify(document, times(1)).replace(anyInt(), anyInt(), anyInt(), anyInt(), anyString());
  }

