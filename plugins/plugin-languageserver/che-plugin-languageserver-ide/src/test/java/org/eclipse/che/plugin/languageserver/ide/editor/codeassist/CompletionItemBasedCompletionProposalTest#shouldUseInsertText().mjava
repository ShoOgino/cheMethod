  @Test
  public void shouldUseInsertText() throws Exception {
    when(serverCapabilities.getCompletionProvider()).thenReturn(completionOptions);
    when(completionOptions.getResolveProvider()).thenReturn(false);

    when(document.getCursorOffset()).thenReturn(5);
    when(completion.getInsertText()).thenReturn("foo");

    Completion[] completions = new Completion[1];
    proposal.getCompletion(completion -> completions[0] = completion);

    completions[0].apply(document);

    verify(document).getCursorOffset();
    verify(document, times(1)).replace(eq(5), eq(0), eq("foo"));
    verifyNoMoreInteractions(document);
  }

