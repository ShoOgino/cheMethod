  @Test
  public void shouldStopByCondition() throws Exception {
    Breakpoint breakpoint =
        new BreakpointImpl(
            new LocationImpl(
                "/test/src/org/eclipse/BreakpointsByConditionTest.java",
                19,
                false,
                null,
                "/test",
                null,
                -1),
            true,
            new BreakpointConfigurationImpl("i==5"));

    debugger.addBreakpoint(breakpoint);

    DebuggerEvent debuggerEvent = events.take();
    assertTrue(debuggerEvent instanceof BreakpointActivatedEvent);

    debugger.resume(new ResumeActionImpl());

    debuggerEvent = events.take();
    assertTrue(debuggerEvent instanceof SuspendEvent);

    assertEquals("5", debugger.evaluate("i"));
    assertEquals("4", debugger.evaluate("k"));

    debugger.resume(new ResumeActionImpl());

    debuggerEvent = events.take();
    assertTrue(debuggerEvent instanceof DisconnectEvent);
  }

