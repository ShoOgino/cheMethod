  private StackFrame getJdiStackFrame(long threadId, int frameIndex) throws DebuggerException {
    try {
      for (ThreadReference t : vm.allThreads()) {
        if (t.uniqueID() == threadId) {
          return t.frame(frameIndex);
        }
      }

      throw new DebuggerException(
          format("Frame '%d' in thread '%d' not found.", frameIndex, threadId));
    } catch (IncompatibleThreadStateException e) {
      throw new DebuggerException("Thread is not suspended", e);
    } catch (IndexOutOfBoundsException e) {
      throw new DebuggerException(
          format("Frame '%d' in thread '%d' not found.", frameIndex, threadId));
    }
  }

