    @Override
    public void handleEvents(com.sun.jdi.event.EventSet eventSet) throws DebuggerException {
        boolean resume = true;
        try {
            for (com.sun.jdi.event.Event event : eventSet) {
                LOG.debug("New event: {}", event);
                if (event instanceof com.sun.jdi.event.BreakpointEvent) {
                    lock.lock();
                    try {
                        resume = processBreakPointEvent((com.sun.jdi.event.BreakpointEvent)event);
                    } finally {
                        lock.unlock();
                    }
                } else if (event instanceof com.sun.jdi.event.StepEvent) {
                    lock.lock();
                    try {
                        resume = processStepEvent((com.sun.jdi.event.StepEvent)event);
                    } finally {
                        lock.unlock();
                    }
                } else if (event instanceof com.sun.jdi.event.VMDisconnectEvent) {
                    resume = processDisconnectEvent();
                } else if (event instanceof com.sun.jdi.event.ClassPrepareEvent) {
                    resume = processClassPrepareEvent((com.sun.jdi.event.ClassPrepareEvent)event);
                }
            }
        } finally {
            if (resume) {
                eventSet.resume();
            }
        }
    }

