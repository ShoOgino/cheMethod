    @Before
    public void setUp() {
        super.setUp();

        when(file.getData()).thenReturn(fileReference);
        when(dtoFactory.createDto(Location.class)).thenReturn(mock(Location.class));
        when(dtoFactory.createDto(BreakPoint.class)).thenReturn(mock(BreakPoint.class));
        when(resolverFactory.getResolver(anyString())).thenReturn(mock(FqnResolver.class));
        when(appContext.getCurrentProject()).thenReturn(currentProject);
        when(currentProject.getRootProject()).thenReturn(project);
        when(messageBusProvider.getMachineMessageBus()).thenReturn(messageBus);

        when(localStorageProvider.get()).thenReturn(localStorage);
        when(localStorage.getItem(DebuggerPresenter.LOCAL_STORAGE_DEBUGGER_KEY)).thenReturn(DEBUG_INFO);
        when(dtoFactory.createDtoFromJson(DEBUG_INFO, DebuggerInfo.class)).thenReturn(debuggerInfo);

        verify(eventBus).addHandler(eq(WsAgentStateEvent.TYPE), extServerStateHandlerCaptor.capture());
        extServerStateHandlerCaptor.getValue().onWsAgentStarted(WsAgentStateEvent.createWsAgentStartedEvent());

        FileType fileType = mock(FileType.class);
        when(fileType.getMimeTypes()).thenReturn(Collections.singletonList("application/java"));
        when(fileTypeRegistry.getFileTypeByFile(eq(file))).thenReturn(fileType);
    }

