  @Test
  public void previewPageIsNotReadyAndShowNotificationMessage() throws Exception {
    renamePresenter.show(refactorInfo);

    verify(refactorService).createRenameRefactoring(createRenameRefactoringDto);
    verify(renameRefactoringSessionPromise).then(renameRefactoringSessionCaptor.capture());
    renameRefactoringSessionCaptor.getValue().apply(session);

    renamePresenter.onPreviewButtonClicked();

    verify(refactoringSession).setSessionId(SESSION_ID);

    verifyPreparingRenameSettingsDto();
    verifyPreparingRenameChanges();

    verify(changeCreationResultPromise).catchError(promiseErrorCaptor.capture());
    promiseErrorCaptor.getValue().apply(promiseError);
    verify(promiseError).getMessage();
    verify(notificationManager)
        .notify(
            nullable(String.class),
            nullable(String.class),
            any(StatusNotification.Status.class),
            any(DisplayMode.class));
  }

