    @Test
    public void performIfSelectionChanged() throws Exception {
        when(refactoringPreview.getId()).thenReturn("id");
        when(refactoringPreview.isEnabled()).thenReturn(true);
        when(refactoringSession.getSessionId()).thenReturn(SESSION_ID);

        presenter.show(SESSION_ID, refactorInfo);
        presenter.onSelectionChanged(refactoringPreview);

        verify(changePreviewPromise).then(changePreviewOperation.capture());
        changePreviewOperation.getValue().apply(changePreview);
        verify(view).showDiff(changePreview);
    }

