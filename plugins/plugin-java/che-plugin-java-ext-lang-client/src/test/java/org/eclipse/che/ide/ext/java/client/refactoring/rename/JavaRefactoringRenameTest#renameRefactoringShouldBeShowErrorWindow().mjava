  @Test
  public void renameRefactoringShouldBeShowErrorWindow() throws OperationException {
    PromiseError arg = Mockito.mock(PromiseError.class);
    MessageDialog dialog = Mockito.mock(MessageDialog.class);

    when(result.getSeverity()).thenReturn(OK);
    when(locale.renameRename()).thenReturn("renameTitle");
    when(locale.renameOperationUnavailable()).thenReturn("renameBody");
    when(dialogFactory.createMessageDialog(anyString(), anyString(), anyObject()))
        .thenReturn(dialog);

    refactoringRename.refactor(textEditor);

    verify(createRenamePromise).then(renameRefCaptor.capture());
    renameRefCaptor.getValue().apply(session);
    verify(createRenamePromise).catchError(refactoringErrorCaptor.capture());
    refactoringErrorCaptor.getValue().apply(arg);

    verify(dialogFactory).createMessageDialog("renameTitle", "renameBody", null);
    verify(dialog).show();
  }

