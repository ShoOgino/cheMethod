  @Test
  public void testSnippetMatching() {

    ElementNode[] node = new ElementNode[1];
    result("bar")
        .children(
            result("foo")
                .children(
                    result("foo")
                        .process(
                            n -> {
                              node[0] = n;
                            })
                        .match(200, 37)))
        .build(null);

    FindUsagesPresenter presenter =
        new FindUsagesPresenter(
            null, null, mock(FindUsagesView.class), null, service, null, null, null, null, null);
    presenter
        .computeMatches(node[0])
        .then(
            nodes -> {
              assertEquals(1, nodes.size());
              MatchNode match = nodes.get(0);
              assertEquals(
                  new SnippetResult(
                      new LinearRange(200, 37), "foofoo", 37, new LinearRange(70, 18)),
                  match.getSnippet());
            });
  }

