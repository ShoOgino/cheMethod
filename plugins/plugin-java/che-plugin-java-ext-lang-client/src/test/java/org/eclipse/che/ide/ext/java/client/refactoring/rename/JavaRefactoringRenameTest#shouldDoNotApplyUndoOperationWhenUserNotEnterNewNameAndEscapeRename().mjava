  @Test
  public void shouldDoNotApplyUndoOperationWhenUserNotEnterNewNameAndEscapeRename()
      throws OperationException {
    // use case: user hit Refactoring -> Rename action, DO NOT type a new name and press escape
    // button

    refactoringRename.refactor(textEditor);

    verify(refactoringServiceClient).createRenameRefactoring(createRenameRefactoringDto);
    verify(createRenamePromise).then(renameRefCaptor.capture());
    renameRefCaptor.getValue().apply(session);

    verify(fileTrackingSuspendEventPromise).then(clientServerSuspendOperation.capture());
    clientServerSuspendOperation.getValue().apply(null);

    verify(linkedMode).addListener(inputArgumentCaptor.capture());
    inputArgumentCaptor.getValue().onLinkedModeExited(false, -1, -1);

    verify(fileTrackingResumeEventPromise).then(clientServerResumeOperation.capture());
    clientServerResumeOperation.getValue().apply(null);

    verify(refactoringServiceClient, never()).applyLinkedModeRename(anyObject());
    verify((UndoableEditor) textEditor, never()).getUndoRedo();
    verify(undoRedo, never()).undo();
    verify((EditorWithAutoSave) textEditor).enableAutoSave();
  }

