  @Before
  public void setUp() {
    when(preferencesManager.loadPreferences()).thenReturn(mapPromise);
    when(mapPromise.then(Matchers.<Operation<Map<String, String>>>anyObject()))
        .thenReturn(mapPromise);
    when(propertyFactory.create(Matchers.<ErrorWarningsOptions>anyObject())).thenReturn(widget);

    presenter.setUpdateDelegate(dirtyStateListener);
  }

