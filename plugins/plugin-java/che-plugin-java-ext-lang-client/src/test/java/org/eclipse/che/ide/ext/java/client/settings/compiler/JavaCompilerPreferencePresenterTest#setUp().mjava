  @Before
  public void setUp() {
    when(preferencesManager.loadPreferences()).thenReturn(mapPromise);
    when(mapPromise.then(org.mockito.ArgumentMatchers.<Operation<Map<String, String>>>anyObject()))
        .thenReturn(mapPromise);
    when(propertyFactory.create(org.mockito.ArgumentMatchers.<ErrorWarningsOptions>anyObject()))
        .thenReturn(widget);

    presenter.setUpdateDelegate(dirtyStateListener);
  }

