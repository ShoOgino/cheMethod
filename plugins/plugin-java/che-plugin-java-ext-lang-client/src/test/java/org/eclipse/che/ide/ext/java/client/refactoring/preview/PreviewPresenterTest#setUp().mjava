    @Before
    public void setUp() throws Exception {
        NavigableMap<String, EditorPartPresenter> editors = new TreeMap<>();
        editors.put("", editor);
        when(editorAgent.getActiveEditor()).thenReturn(activeEditor);
        when(dtoFactory.createDto(RefactoringSession.class)).thenReturn(refactoringSession);
        when(dtoFactory.createDto(ChangeEnabledState.class)).thenReturn(changeEnableState);
        when(dtoFactory.createDto(RefactoringChange.class)).thenReturn(refactoringChanges);
        when(refactoringService.getRefactoringPreview(refactoringSession)).thenReturn(refactoringPreviewPromise);
        when(refactoringService.applyRefactoring(anyObject())).thenReturn(refactoringStatusPromise);
        when(refactoringService.getChangePreview(refactoringChanges)).thenReturn(changePreviewPromise);
        when(refactoringService.changeChangeEnabledState(changeEnableState)).thenReturn(changeEnableStatePromise);
        when(editorAgent.getOpenedEditors()).thenReturn(editors);

        presenter = new PreviewPresenter(view,
                                         movePresenterProvider,
                                         renamePresenterProvider,
                                         dtoFactory,
                                         editorAgent,
                                         refactoringUpdater,
                                         refactoringService);
    }

