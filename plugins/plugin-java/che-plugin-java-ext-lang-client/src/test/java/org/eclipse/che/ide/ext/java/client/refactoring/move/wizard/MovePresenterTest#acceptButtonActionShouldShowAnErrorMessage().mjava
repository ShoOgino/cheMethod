  @Test
  public void acceptButtonActionShouldShowAnErrorMessage() throws Exception {
    when(moveSettings.isUpdateQualifiedNames()).thenReturn(true);
    when(changeCreationResult.isCanShowPreviewPage()).thenReturn(false);
    when(changeCreationResult.getStatus()).thenReturn(refactoringStatus);

    presenter.onAcceptButtonClicked();

    verify(moveSettings).setSessionId(nullable(String.class));
    verify(moveSettings).setUpdateReferences(anyBoolean());
    verify(moveSettings).setUpdateQualifiedNames(anyBoolean());
    verify(moveSettings).setFilePatterns(nullable(String.class));
    verify(session).setSessionId(nullable(String.class));

    verify(moveSettingsPromise).thenPromise(changeCreationFunction.capture());
    changeCreationFunction.getValue().apply(any());
    verify(refactorService).createChange(session);

    verify(changeCreationResultPromise).then(changeResultOperation.capture());
    changeResultOperation.getValue().apply(changeCreationResult);
    verify(moveView).showErrorMessage(refactoringStatus);
  }

