  @Test
  public void changesShouldBeReverted() throws Exception {
    initWidgets();

    when(widget.getSelectedValue()).thenReturn(VALUE_2);
    when(preferencesManager.getValue(anyString())).thenReturn(VALUE_1);

    presenter.onWsAgentStarted(wsAgentStateEvent);
    presenter.go(container);

    verify(mapPromise).then(operationCaptor.capture());
    operationCaptor.getValue().apply(getAllProperties());

    presenter.onPropertyChanged();
    presenter.revertChanges();

    verify(preferencesManager, times(36)).getValue(anyString());
    verify(widget, times(36)).selectPropertyValue(anyString());
    verify(widget, times(18)).getSelectedValue();
  }

