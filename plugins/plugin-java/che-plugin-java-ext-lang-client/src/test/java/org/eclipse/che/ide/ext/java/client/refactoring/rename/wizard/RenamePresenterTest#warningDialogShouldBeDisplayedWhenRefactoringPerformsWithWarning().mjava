  @Test
  public void warningDialogShouldBeDisplayedWhenRefactoringPerformsWithWarning()
      throws OperationException {
    renamePresenter.show(session);

    ConfirmDialog dialog = mock(ConfirmDialog.class);
    RefactoringStatusEntry statusEntry = mock(RefactoringStatusEntry.class);
    List<RefactoringStatusEntry> entries = Collections.singletonList(statusEntry);

    when(refactoringStatus.getEntries()).thenReturn(entries);
    when(refactoringStatus.getSeverity()).thenReturn(2);
    when(dialogFactory.createConfirmDialog(
            nullable(String.class),
            nullable(String.class),
            nullable(String.class),
            nullable(String.class),
            org.mockito.ArgumentMatchers.<ConfirmCallback>anyObject(),
            org.mockito.ArgumentMatchers.<CancelCallback>anyObject()))
        .thenReturn(dialog);
    renamePresenter.onAcceptButtonClicked();

    verify(changeCreationResultPromise).then(changeCreationResultCaptor.capture());
    changeCreationResultCaptor.getValue().apply(changeCreationResult);

    verify(dialogFactory)
        .createConfirmDialog(
            nullable(String.class),
            nullable(String.class),
            nullable(String.class),
            nullable(String.class),
            org.mockito.ArgumentMatchers.<ConfirmCallback>anyObject(),
            org.mockito.ArgumentMatchers.<CancelCallback>anyObject());
    verify(dialog).show();
  }

