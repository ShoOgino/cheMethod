    @Test
    public void sendRequestToServerIfEnablingStateOfChangeIsChanging() throws Exception {
        when(refactoringPreview.getId()).thenReturn("id");
        when(refactoringPreview.isEnabled()).thenReturn(true);
        when(refactoringSession.getSessionId()).thenReturn(SESSION_ID);

        presenter.show(SESSION_ID, refactorInfo);
        presenter.onEnabledStateChanged(refactoringPreview);

        verify(changeEnableState).setChangeId("id");
        changeEnableState.setSessionId(SESSION_ID);
        changeEnableState.setEnabled(true);

        verify(changeEnableStatePromise).then(changeEnableStateOperation.capture());
        changeEnableStateOperation.getValue().apply(any());
        verify(refactoringChanges).setChangeId("id");
        verify(refactoringChanges).setSessionId(SESSION_ID);
        verify(changePreviewPromise).then(changePreviewOperation.capture());
        changePreviewOperation.getValue().apply(changePreview);
        verify(view).showDiff(changePreview);
    }

