    @Test
    public void changesShouldNotBeAppliedAndShowErrorMessage() throws Exception {
        RefactoringStatus refactoringStatus = mock(RefactoringStatus.class);
        when(refactoringStatus.getSeverity()).thenReturn(4);
        when(changeCreationResult.isCanShowPreviewPage()).thenReturn(false);
        when(changeCreationResult.getStatus()).thenReturn(refactoringStatus);

        renamePresenter.show(refactorInfo);

        verify(refactorService).createRenameRefactoring(createRenameRefactoringDto);
        verify(renameRefactoringSessionPromise).then(renameRefactoringSessionCaptor.capture());
        renameRefactoringSessionCaptor.getValue().apply(session);

        renamePresenter.onAcceptButtonClicked();

        verify(refactoringSession).setSessionId(SESSION_ID);

        verifyPreparingRenameSettingsDto();
        verifyPreparingRenameChanges();

        verify(changeCreationResultPromise).then(changeCreationResultCaptor.capture());
        changeCreationResultCaptor.getValue().apply(changeCreationResult);
        verify(view).showErrorMessage(any());
    }

