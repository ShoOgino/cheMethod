    /* @see org.eclipse.jface.text.ILineTracker#getLineNumberOfOffset(int) */
    public final int getLineNumberOfOffset(int position) throws BadLocationException {
        if (position < 0 || position > fTextLength)
            throw new BadLocationException();

        if (position == fTextLength) {

            int lastLine = fLines.size() - 1;
            if (lastLine < 0)
                return 0;

            Line l = (Line)fLines.get(lastLine);
            return (l.delimiter != null ? lastLine + 1 : lastLine);
        }

        return findLine(position);
    }

