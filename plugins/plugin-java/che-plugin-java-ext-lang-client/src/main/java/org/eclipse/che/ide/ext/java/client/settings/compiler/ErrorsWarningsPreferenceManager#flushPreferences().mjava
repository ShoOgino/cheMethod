    @Override
    public Promise<Void> flushPreferences() {
        if (changedPreferences.isEmpty()) {
            return Promises.resolve(null);
        }

        return service.applyCompileParameters(changedPreferences).then(new Operation<Void>() {
            @Override
            public void apply(Void aVoid) throws OperationException {
                persistedPreferences.putAll(changedPreferences);
                changedPreferences.clear();
            }
        });
    }

