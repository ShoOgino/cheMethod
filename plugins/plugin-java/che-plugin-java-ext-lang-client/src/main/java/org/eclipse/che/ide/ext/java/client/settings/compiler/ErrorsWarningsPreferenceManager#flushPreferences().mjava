  @Override
  public Promise<Void> flushPreferences() {
    if (changedPreferences.isEmpty()) {
      return promiseProvider.resolve(null);
    }

    JavaCoreOptions javaCoreOptions = dtoFactory.createDto(JavaCoreOptions.class);
    javaCoreOptions.setOptions(changedPreferences);

    return service
        .updateJavaCoreOptions(javaCoreOptions)
        .then(
            (Function<Boolean, Void>)
                result -> {
                  persistedPreferences.putAll(changedPreferences);
                  changedPreferences.clear();
                  return null;
                });
  }

