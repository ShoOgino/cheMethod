  private void sendMessageToWS(
      final @NotNull Message message, final @NotNull RequestCallback<?> callback) {
    wsAgentStateController
        .getMessageBus()
        .then(
            new Operation<MessageBus>() {
              @Override
              public void apply(MessageBus arg) throws OperationException {
                try {
                  arg.send(message, callback);
                } catch (WebSocketException e) {
                  throw new OperationException(e.getMessage(), e);
                }
              }
            });
  }

