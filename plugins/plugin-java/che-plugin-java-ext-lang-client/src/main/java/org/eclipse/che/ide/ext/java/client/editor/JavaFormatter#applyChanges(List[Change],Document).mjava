    private void applyChanges(List<Change> changes, Document document) {
        HandlesUndoRedo undoRedo = null;
        EditorPartPresenter editorPartPresenter = editorAgent.getActiveEditor();
        if (editorPartPresenter instanceof UndoableEditor) {
            undoRedo = ((UndoableEditor)editorPartPresenter).getUndoRedo();
        }
        try {
            if (undoRedo != null) {
                undoRedo.beginCompoundChange();
            }
            for (Change change : changes) {
                document.replace(change.getOffset(), change.getLength(), change.getText());
            }
        } catch (final Exception e) {
            Log.error(getClass(), e);
        } finally {
            if (undoRedo != null) {
                undoRedo.endCompoundChange();
            }
        }
    }

