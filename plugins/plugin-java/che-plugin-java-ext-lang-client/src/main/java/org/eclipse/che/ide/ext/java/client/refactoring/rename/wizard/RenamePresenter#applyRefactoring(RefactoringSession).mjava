    private void applyRefactoring(RefactoringSession session) {
        refactorService.applyRefactoring(session).then(refactoringResult -> {
            List<ChangeInfo> changes = refactoringResult.getChanges();
            if (refactoringResult.getSeverity() == OK) {
                view.hide();
                updateAfterRefactoring(changes)
                        .then(refactoringUpdater.handleMovingFiles(changes)
                                                .then(clientServerEventService.sendFileTrackingResumeEvent()));
            } else {
                view.showErrorMessage(refactoringResult);
                refactoringUpdater.handleMovingFiles(changes)
                                  .then(clientServerEventService.sendFileTrackingResumeEvent());
            }
        });
    }

