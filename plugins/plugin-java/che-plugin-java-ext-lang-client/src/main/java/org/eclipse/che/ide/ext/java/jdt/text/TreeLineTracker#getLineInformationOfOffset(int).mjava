  /* @see org.eclipse.jface.text.ILineTracker#getLineInformationOfOffset(int) */
  public final Region getLineInformationOfOffset(final int offset) throws BadLocationException {
    // Inline nodeByOffset start as we need both node and offset
    int remaining = offset;
    Node node = fRoot;
    final int lineOffset;

    while (true) {
      if (node == null) fail(offset);

      if (remaining < node.offset) {
        node = node.left;
      } else {
        remaining -= node.offset;
        if (remaining < node.length
            || remaining == node.length && node.right == null) { // last line
          lineOffset = offset - remaining;
          break;
        }
        remaining -= node.length;
        node = node.right;
      }
    }
    // Inline nodeByOffset end
    return new RegionImpl(lineOffset, node.pureLength());
  }

