  /* @see TextEdit#performDocumentUpdating */
  int performDocumentUpdating(Document document) throws BadLocationException {
    String source = fSource.getContent();
    document.replace(getOffset(), getLength(), source);
    fDelta = source.length() - getLength();

    MultiTextEdit sourceRoot = fSource.getSourceRoot();
    if (sourceRoot != null) {
      sourceRoot.internalMoveTree(getOffset());
      TextEdit[] sourceChildren = sourceRoot.removeChildren();
      List<TextEdit> children = new ArrayList<TextEdit>(sourceChildren.length);
      for (int i = 0; i < sourceChildren.length; i++) {
        TextEdit child = sourceChildren[i];
        child.internalSetParent(this);
        children.add(child);
      }
      internalSetChildren(children);
    }
    fSource.clearContent();
    return fDelta;
  }

