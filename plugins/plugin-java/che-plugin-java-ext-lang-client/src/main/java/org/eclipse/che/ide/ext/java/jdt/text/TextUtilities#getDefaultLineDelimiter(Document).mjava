  /**
   * Returns the default line delimiter for the given document. This is either the delimiter of the
   * first line, or the platform line delimiter if it is a legal line delimiter or the first one of
   * the legal line delimiters. The default line delimiter should be used when performing document
   * manipulations that span multiple lines.
   *
   * @param document the document
   * @return the document's default line delimiter
   */
  public static String getDefaultLineDelimiter(Document document) {

    // if (document instanceof IDocumentExtension4)
    // return ((IDocumentExtension4)document).getDefaultLineDelimiter();

    String lineDelimiter = null;

    try {
      lineDelimiter = document.getLineDelimiter(0);
    } catch (BadLocationException x) {
    }

    if (lineDelimiter != null) return lineDelimiter;

    String sysLineDelimiter = "\n"; // System.getProperty("line.separator"); //$NON-NLS-1$
    String[] delimiters = document.getLegalLineDelimiters();
    Assert.isTrue(delimiters.length > 0);
    for (int i = 0; i < delimiters.length; i++) {
      if (delimiters[i].equals(sysLineDelimiter)) {
        lineDelimiter = sysLineDelimiter;
        break;
      }
    }

    if (lineDelimiter == null) lineDelimiter = delimiters[0];

    return lineDelimiter;
  }

