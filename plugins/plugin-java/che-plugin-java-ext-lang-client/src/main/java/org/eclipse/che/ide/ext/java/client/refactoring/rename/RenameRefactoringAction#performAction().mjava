  private void performAction() {
    if (editorInFocus) {
      final EditorPartPresenter editorPart = editorAgent.getActiveEditor();
      if (editorPart == null || !(editorPart instanceof TextEditor)) {
        return;
      }

      javaRefactoringRename.refactor((TextEditor) editorPart);
    } else {
      final Resource[] resources = appContext.getResources();

      if (resources == null || resources.length > 1) {
        return;
      }

      final Resource resource = resources[0];

      final Project project = resource.getProject();

      if (!isJavaProject(project)) {
        return;
      }

      final Optional<Resource> srcFolder = resource.getParentWithMarker(SourceFolderMarker.ID);

      if (!srcFolder.isPresent() || resource.getLocation().equals(srcFolder.get().getLocation())) {
        return;
      }

      RefactoredItemType renamedItemType = null;

      if (resource.getResourceType() == FILE && isJavaFile((File) resource)) {
        renamedItemType = RefactoredItemType.COMPILATION_UNIT;
      } else if (resource instanceof Container) {
        renamedItemType = RefactoredItemType.PACKAGE;
      }

      if (renamedItemType == null) {
        return;
      }

      renamePresenter.show(RefactorInfo.of(renamedItemType, resources));
    }
  }

