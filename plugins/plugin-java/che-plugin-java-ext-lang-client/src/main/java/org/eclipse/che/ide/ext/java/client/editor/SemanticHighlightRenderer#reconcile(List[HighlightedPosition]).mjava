  public void reconcile(List<HighlightedPosition> positions) {
    for (HasTextMarkers.MarkerRegistration marker : markers) {
      marker.clearMark();
    }
    markers.clear();

    for (HighlightedPosition position : positions) {
      final TextPosition from = this.document.getPositionFromIndex(position.getOffset());
      final TextPosition to =
          this.document.getPositionFromIndex(position.getOffset() + position.getLength());
      HasTextMarkers.MarkerRegistration registration =
          editor.addMarker(new TextRange(from, to), styleMap.get(position.getType()));
      if (registration != null) {
        markers.add(registration);
      }
    }
  }

