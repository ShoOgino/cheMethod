  UndoEdit executeUndo() throws BadLocationException {
    UndoCollector collector = new UndoCollector(fRoot);
    try {
      if (createUndo()) collector.connect(fDocument);
      TextEdit[] edits = fRoot.getChildren();
      for (int i = edits.length - 1; i >= 0; i--) {
        edits[i].performDocumentUpdating(fDocument);
      }
    } finally {
      collector.disconnect(fDocument);
    }
    return collector.undo;
  }

