    private IJavaElement[] getJavaElements(Object[] elements) {
        if (elements.length == 0)
            return new IJavaElement[0];

        Set<IJavaElement> result = new HashSet<IJavaElement>(elements.length);
        for (int i = 0; i < elements.length; i++) {
            Object selectedElement = elements[i];
            if (selectedElement instanceof IJavaElement) {
                addJavaElements(result, (IJavaElement)selectedElement);
            } else if (selectedElement instanceof IResource) {
                addJavaElements(result, (IResource)selectedElement);
            } else if (selectedElement instanceof LogicalPackage) {
                addJavaElements(result, (LogicalPackage)selectedElement);
            } else if (selectedElement instanceof IWorkingSet) {
                IWorkingSet ws = (IWorkingSet)selectedElement;
                addJavaElements(result, ws);
            } else if (selectedElement instanceof IAdaptable) {
                IResource resource = (IResource)((IAdaptable)selectedElement).getAdapter(IResource.class);
                if (resource != null)
                    addJavaElements(result, resource);
            }

        }
        return result.toArray(new IJavaElement[result.size()]);
    }

