  private static void analyzeChanges(
      ICompilationUnit cu,
      TextChange change,
      SearchMatch[] oldMatches,
      SearchMatch[] newMatches,
      String newElementName,
      RefactoringStatus result) {
    Map<Integer, SearchMatch> updatedOldOffsets = getUpdatedChangeOffsets(change, oldMatches);
    for (int i = 0; i < newMatches.length; i++) {
      SearchMatch newMatch = newMatches[i];
      Integer offsetInNew = new Integer(newMatch.getOffset());
      SearchMatch oldMatch = updatedOldOffsets.remove(offsetInNew);
      if (oldMatch == null) {
        addReferenceShadowedError(cu, newMatch, newElementName, result);
      }
    }
    for (Iterator<SearchMatch> iter = updatedOldOffsets.values().iterator(); iter.hasNext(); ) {
      // remaining old matches are not found any more -> they have been shadowed
      SearchMatch oldMatch = iter.next();
      addShadowsError(cu, oldMatch, result);
    }
  }

