	@Override
	public RefactoringStatus checkFinalConditions(IProgressMonitor pm) throws CoreException {
		try {
			pm.beginTask(RefactoringCoreMessages.ExtractTempRefactoring_checking_preconditions, 4);

			fCURewrite = new CompilationUnitRewrite(fCu, fCompilationUnitNode);
			fCURewrite.getASTRewrite().setTargetSourceRangeComputer(new NoCommentSourceRangeComputer());

			doCreateChange(new SubProgressMonitor(pm, 2));

			fChange = fCURewrite
					.createChange(RefactoringCoreMessages.ExtractTempRefactoring_change_name, true, new SubProgressMonitor(pm, 1));

			RefactoringStatus result = new RefactoringStatus();
			if (Arrays.asList(getExcludedVariableNames()).contains(fTempName))
				result.addWarning(Messages.format(RefactoringCoreMessages.ExtractTempRefactoring_another_variable,
												  BasicElementLabels.getJavaElementName(fTempName)));

			result.merge(checkMatchingFragments());

			fChange.setKeepPreviewEdits(true);

			if (fCheckResultForCompileProblems) {
				checkNewSource(new SubProgressMonitor(pm, 1), result);
			}

			return result;
		} finally {
			pm.done();
		}
	}

