  private void renamePackage(
      IPackageFragment pack, IProgressMonitor pm, IPath newPath, String newName)
      throws JavaModelException, CoreException {
    if (!pack.exists()) return; // happens if empty parent with single subpackage is renamed, see
    // https://bugs.eclipse.org/bugs/show_bug.cgi?id=199045
    pack.rename(newName, false, pm);
    if (fCompilationUnitStamps != null) {
      IPackageFragment newPack =
          (IPackageFragment)
              JavaCore.create(ResourcesPlugin.getWorkspace().getRoot().getFolder(newPath));
      if (newPack.exists()) {
        ICompilationUnit[] units = newPack.getCompilationUnits();
        for (int i = 0; i < units.length; i++) {
          IResource resource = units[i].getResource();
          if (resource != null) {
            Long stamp = fCompilationUnitStamps.get(resource);
            if (stamp != null) {
              resource.revertModificationStamp(stamp.longValue());
            }
          }
        }
      }
    }
  }

