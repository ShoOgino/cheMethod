  protected final int guessMethodContextInformationPosition(
      ContentAssistInvocationContext context) {
    final int contextPosition = context.getInvocationOffset();

    IDocument document = context.getDocument();
    JavaHeuristicScanner scanner = new JavaHeuristicScanner(document);
    int bound = Math.max(-1, contextPosition - 2000);

    // try the innermost scope of parentheses that looks like a method call
    int pos = contextPosition - 1;
    do {
      int paren = scanner.findOpeningPeer(pos, bound, '(', ')');
      if (paren == JavaHeuristicScanner.NOT_FOUND) break;
      int token = scanner.previousToken(paren - 1, bound);
      // next token must be a method name (identifier) or the closing angle of a
      // constructor call of a parameterized type.
      if (token == Symbols.TokenIDENT || token == Symbols.TokenGREATERTHAN) return paren + 1;
      pos = paren - 1;
    } while (true);

    return contextPosition;
  }

