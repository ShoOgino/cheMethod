  private int getContentUntilNextTag(StringBuffer buffer) throws IOException {
    int c = nextChar();
    boolean blockStartRead = false;
    while (c != -1) {
      if (c == '@') {
        int index = buffer.length();
        while (--index >= 0 && Character.isWhitespace(buffer.charAt(index))) {
          switch (buffer.charAt(index)) {
            case '\n':
            case '\r':
              return c;
          }
          if (index <= 0) {
            return c;
          }
        }
      }
      if (blockStartRead) {
        buffer.append(processBlockTag());
        blockStartRead = false;
      } else {
        buffer.append((char) c);
      }

      c = nextChar();
      blockStartRead = c == '{';
    }
    return c;
  }

