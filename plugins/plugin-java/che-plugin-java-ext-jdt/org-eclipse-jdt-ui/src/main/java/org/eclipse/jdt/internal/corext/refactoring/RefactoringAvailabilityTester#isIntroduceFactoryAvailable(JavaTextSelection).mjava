  public static boolean isIntroduceFactoryAvailable(final JavaTextSelection selection)
      throws JavaModelException {
    final IJavaElement[] elements = selection.resolveElementAtOffset();
    if (elements.length == 1 && elements[0] instanceof IMethod)
      return isIntroduceFactoryAvailable((IMethod) elements[0]);

    // there's no IMethod for the default constructor
    if (!Checks.isAvailable(selection.resolveEnclosingElement())) return false;
    ASTNode node = selection.resolveCoveringNode();
    if (node == null) {
      ASTNode[] selectedNodes = selection.resolveSelectedNodes();
      if (selectedNodes != null && selectedNodes.length == 1) {
        node = selectedNodes[0];
        if (node == null) return false;
      } else {
        return false;
      }
    }

    if (node.getNodeType() == ASTNode.CLASS_INSTANCE_CREATION) return true;

    node = ASTNodes.getNormalizedNode(node);
    if (node.getLocationInParent() == ClassInstanceCreation.TYPE_PROPERTY) return true;

    return false;
  }

