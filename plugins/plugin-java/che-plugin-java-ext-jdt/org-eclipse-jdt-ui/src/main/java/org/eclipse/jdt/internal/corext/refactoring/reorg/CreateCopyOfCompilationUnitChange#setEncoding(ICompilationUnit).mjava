  private void setEncoding(ICompilationUnit unit) {
    IResource resource = unit.getResource();
    // no file so the encoding is taken from the target
    if (!(resource instanceof IFile)) return;
    IFile file = (IFile) resource;
    try {
      String encoding = file.getCharset(false);
      if (encoding != null) {
        setEncoding(encoding, true);
      } else {
        encoding = file.getCharset(true);
        if (encoding != null) {
          setEncoding(encoding, false);
        }
      }
    } catch (CoreException e) {
      // Take encoding from target
    }
  }

