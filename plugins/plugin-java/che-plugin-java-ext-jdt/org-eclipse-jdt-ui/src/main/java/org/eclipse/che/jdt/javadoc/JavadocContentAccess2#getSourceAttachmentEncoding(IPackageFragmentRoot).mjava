    private static String getSourceAttachmentEncoding(IPackageFragmentRoot root) throws JavaModelException {
        String encoding = ResourcesPlugin.getEncoding();
        IClasspathEntry entry = root.getRawClasspathEntry();

        if (entry != null) {
            int kind = entry.getEntryKind();
            if (kind == IClasspathEntry.CPE_LIBRARY || kind == IClasspathEntry.CPE_VARIABLE) {
                IClasspathAttribute[] extraAttributes = entry.getExtraAttributes();
                for (int i = 0; i < extraAttributes.length; i++) {
                    IClasspathAttribute attrib = extraAttributes[i];
                    if (IClasspathAttribute.SOURCE_ATTACHMENT_ENCODING.equals(attrib.getName())) {
                        return attrib.getValue();
                    }
                }
            }
        }

        return encoding;
    }

