    /**
     * Applies an text edit to a compilation unit. Filed bug 117694 against jdt.core.
     * 	@param cu the compilation unit to apply the edit to
     * 	@param edit the edit to apply
     * @param save is set, save the CU after the edit has been applied
     * @param monitor the progress monitor to use
     * @throws CoreException Thrown when the access to the CU failed
     * @throws ValidateEditException if validate edit fails
     */
    public static void applyEdit(ICompilationUnit cu, TextEdit edit, boolean save, IProgressMonitor monitor) throws CoreException,
                                                                                                                    ValidateEditException {
        IFile file= (IFile) cu.getResource();
        if (!save || !file.exists()) {
            cu.applyTextEdit(edit, monitor);
        } else {
            if (monitor == null) {
                monitor= new NullProgressMonitor();
            }
            monitor.beginTask(CorextMessages.JavaModelUtil_applyedit_operation, 2);
            try {
//                IStatus status= Resources.makeCommittable(file, null);
//                if (!status.isOK()) {
//                    throw new ValidateEditException(status);
//                }

                cu.applyTextEdit(edit, new SubProgressMonitor(monitor, 1));

                cu.save(new SubProgressMonitor(monitor, 1), true);
            } finally {
                monitor.done();
            }
        }
    }

