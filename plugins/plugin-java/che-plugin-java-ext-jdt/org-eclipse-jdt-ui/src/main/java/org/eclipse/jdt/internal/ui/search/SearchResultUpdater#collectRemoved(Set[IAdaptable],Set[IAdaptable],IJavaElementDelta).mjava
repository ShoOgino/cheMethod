  private void collectRemoved(
      Set<IAdaptable> potentiallyRemovedSet,
      Set<IAdaptable> removedElements,
      IJavaElementDelta delta) {
    if (delta.getKind() == IJavaElementDelta.REMOVED) removedElements.add(delta.getElement());
    else if (delta.getKind() == IJavaElementDelta.CHANGED) {
      int flags = delta.getFlags();
      if ((flags & REMOVED_FLAGS) != 0) {
        potentiallyRemovedSet.add(delta.getElement());
      } else {
        IJavaElementDelta[] childDeltas = delta.getAffectedChildren();
        for (int i = 0; i < childDeltas.length; i++) {
          collectRemoved(potentiallyRemovedSet, removedElements, childDeltas[i]);
        }
      }
    }
    IResourceDelta[] resourceDeltas = delta.getResourceDeltas();
    if (resourceDeltas != null) {
      for (int i = 0; i < resourceDeltas.length; i++) {
        collectRemovals(removedElements, resourceDeltas[i]);
      }
    }
  }

