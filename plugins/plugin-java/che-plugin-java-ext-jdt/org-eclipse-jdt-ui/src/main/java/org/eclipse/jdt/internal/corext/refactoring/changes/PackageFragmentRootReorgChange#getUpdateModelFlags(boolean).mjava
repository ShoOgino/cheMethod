  protected int getUpdateModelFlags(boolean isCopy) throws JavaModelException {
    final int destination = IPackageFragmentRoot.DESTINATION_PROJECT_CLASSPATH;
    final int replace = IPackageFragmentRoot.REPLACE;
    final int originating;
    final int otherProjects;
    if (isCopy) {
      originating = 0; // ORIGINATING_PROJECT_CLASSPATH does not apply to copy
      otherProjects = 0; // OTHER_REFERRING_PROJECTS_CLASSPATH does not apply to copy
    } else {
      originating = IPackageFragmentRoot.ORIGINATING_PROJECT_CLASSPATH;
      otherProjects = IPackageFragmentRoot.OTHER_REFERRING_PROJECTS_CLASSPATH;
    }

    IJavaElement javaElement = JavaCore.create(getDestination());
    if (javaElement == null || !javaElement.exists()) return replace | originating;

    if (fUpdateClasspathQuery == null) return replace | originating | destination;

    IJavaProject[] referencingProjects = JavaElementUtil.getReferencingProjects(getRoot());
    if (referencingProjects.length <= 1) return replace | originating | destination;

    boolean updateOtherProjectsToo =
        fUpdateClasspathQuery.confirmManipulation(getRoot(), referencingProjects);
    if (updateOtherProjectsToo) return replace | originating | destination | otherProjects;
    else return replace | originating | destination;
  }

