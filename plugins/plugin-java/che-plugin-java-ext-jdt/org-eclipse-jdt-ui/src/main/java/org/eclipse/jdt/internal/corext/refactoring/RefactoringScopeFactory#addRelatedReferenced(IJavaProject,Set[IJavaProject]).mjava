  private static void addRelatedReferenced(IJavaProject focus, Set<IJavaProject> projects)
      throws CoreException {
    IProject[] referencedProjects = focus.getProject().getReferencedProjects();
    for (int i = 0; i < referencedProjects.length; i++) {
      IJavaProject candidate = JavaCore.create(referencedProjects[i]);
      if (candidate == null || projects.contains(candidate) || !candidate.exists())
        continue; // break cycle
      IClasspathEntry entry = getReferencingClassPathEntry(focus, candidate);
      if (entry != null) {
        projects.add(candidate);
        if (entry.isExported()) {
          addRelatedReferenced(candidate, projects);
          addRelatedReferencing(candidate, projects);
        }
      }
    }
  }

