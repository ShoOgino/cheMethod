  @Override
  protected IFile getOldFile(IProgressMonitor monitor) throws OperationCanceledException {
    try {
      monitor.beginTask("", 12); // $NON-NLS-1$
      String oldSource = super.getSource();
      IPath oldPath = super.getPath();
      String newTypeName = fNameQuery.getNewName();
      try {
        String newSource =
            getCopiedFileSource(new SubProgressMonitor(monitor, 9), fOldCu, newTypeName);
        setSource(newSource);
        setPath(
            fOldCu
                .getResource()
                .getParent()
                .getFullPath()
                .append(JavaModelUtil.getRenamedCUName(fOldCu, newTypeName)));
        return super.getOldFile(new SubProgressMonitor(monitor, 1));
      } catch (CoreException e) {
        setSource(oldSource);
        setPath(oldPath);
        return super.getOldFile(new SubProgressMonitor(monitor, 2));
      }
    } finally {
      monitor.done();
    }
  }

