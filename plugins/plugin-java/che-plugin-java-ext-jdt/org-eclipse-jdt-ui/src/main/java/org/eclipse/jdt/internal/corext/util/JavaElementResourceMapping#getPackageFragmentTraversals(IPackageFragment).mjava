  private static ResourceTraversal[] getPackageFragmentTraversals(IPackageFragment pack)
      throws CoreException {
    ArrayList<ResourceTraversal> res = new ArrayList<ResourceTraversal>();
    IContainer container = (IContainer) pack.getResource();

    if (container != null) {
      res.add(new ResourceTraversal(new IResource[] {container}, IResource.DEPTH_ONE, 0));
      if (pack.exists()) { // folder may not exist any more, see
        // https://bugs.eclipse.org/bugs/show_bug.cgi?id=269167
        Object[] nonJavaResources = pack.getNonJavaResources();
        for (int i = 0; i < nonJavaResources.length; i++) {
          Object resource = nonJavaResources[i];
          if (resource instanceof IFolder) {
            res.add(
                new ResourceTraversal(
                    new IResource[] {(IResource) resource}, IResource.DEPTH_INFINITE, 0));
          }
        }
      }
    }

    return res.toArray(new ResourceTraversal[res.size()]);
  }

