  /* (non-Javadoc)
   * @see org.eclipse.jdt.core.dom.ASTVisitor#visit(org.eclipse.jdt.core.dom.MethodDeclaration)
   */
  @Override
  public ITypeConstraint[] create(MethodDeclaration declaration) {
    List<ITypeConstraint> result = new ArrayList<ITypeConstraint>();
    IMethodBinding methodBinding = declaration.resolveBinding();
    if (methodBinding == null) return new ITypeConstraint[0];
    ITypeConstraint[] constraints =
        fTypeConstraintFactory.createDefinesConstraint(
            fConstraintVariableFactory.makeDeclaringTypeVariable(methodBinding),
            fConstraintVariableFactory.makeRawBindingVariable(methodBinding.getDeclaringClass()));
    result.addAll(Arrays.asList(constraints));
    if (!methodBinding.isConstructor() && !methodBinding.getReturnType().isPrimitive()) {
      ConstraintVariable returnTypeBindingVariable =
          fConstraintVariableFactory.makeReturnTypeVariable(methodBinding);
      ConstraintVariable returnTypeVariable =
          fConstraintVariableFactory.makeTypeVariable(declaration.getReturnType2());
      ITypeConstraint[] defines =
          fTypeConstraintFactory.createDefinesConstraint(
              returnTypeBindingVariable, returnTypeVariable);
      result.addAll(Arrays.asList(defines));
    }
    for (int i = 0, n = declaration.parameters().size(); i < n; i++) {
      SingleVariableDeclaration paramDecl =
          (SingleVariableDeclaration) declaration.parameters().get(i);
      ConstraintVariable parameterTypeVariable =
          fConstraintVariableFactory.makeParameterTypeVariable(methodBinding, i);
      ConstraintVariable parameterNameVariable =
          fConstraintVariableFactory.makeExpressionOrTypeVariable(
              paramDecl.getName(), getContext());
      ITypeConstraint[] constraint =
          fTypeConstraintFactory.createDefinesConstraint(
              parameterTypeVariable, parameterNameVariable);
      result.addAll(Arrays.asList(constraint));
    }
    if (MethodChecks.isVirtual(methodBinding)) {
      Collection<ITypeConstraint> constraintsForOverriding =
          getConstraintsForOverriding(methodBinding);
      result.addAll(constraintsForOverriding);
    }
    return result.toArray(new ITypeConstraint[result.size()]);
  }

