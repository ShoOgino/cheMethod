  public static RefactoringStatus checkMethodSyntaxErrors(
      int selectionStart,
      int selectionLength,
      CompilationUnit cuNode,
      String invalidSelectionMessage) {
    SelectionAnalyzer analyzer =
        new SelectionAnalyzer(
            Selection.createFromStartLength(selectionStart, selectionLength), true);
    cuNode.accept(analyzer);
    ASTNode coveringNode = analyzer.getLastCoveringNode();
    if (!(coveringNode instanceof Block)
        || !(coveringNode.getParent() instanceof MethodDeclaration))
      return RefactoringStatus.createFatalErrorStatus(invalidSelectionMessage);
    if (ASTNodes.getMessages(coveringNode, ASTNodes.NODE_ONLY).length == 0)
      return RefactoringStatus.createFatalErrorStatus(invalidSelectionMessage);

    MethodDeclaration methodDecl = (MethodDeclaration) coveringNode.getParent();
    String message =
        Messages.format(
            RefactoringCoreMessages.CodeRefactoringUtil_error_message,
            BasicElementLabels.getJavaElementName(methodDecl.getName().getIdentifier()));
    return RefactoringStatus.createFatalErrorStatus(message);
  }

