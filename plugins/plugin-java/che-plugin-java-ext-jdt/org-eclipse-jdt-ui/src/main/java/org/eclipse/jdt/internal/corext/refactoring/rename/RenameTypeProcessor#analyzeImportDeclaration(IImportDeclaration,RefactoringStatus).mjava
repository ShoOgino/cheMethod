  private void analyzeImportDeclaration(IImportDeclaration imp, RefactoringStatus result)
      throws CoreException {
    if (!imp.isOnDemand()) return; //analyzed earlier

    IJavaElement imported = convertFromImportDeclaration(imp);
    if (imported == null) return;

    if (imported instanceof IPackageFragment) {
      ICompilationUnit[] cus = ((IPackageFragment) imported).getCompilationUnits();
      for (int i = 0; i < cus.length; i++) {
        analyzeImportedTypes(cus[i].getTypes(), result, imp);
      }
    } else {
      //cast safe: see JavaModelUtility.convertFromImportDeclaration
      analyzeImportedTypes(((IType) imported).getTypes(), result, imp);
    }
  }

