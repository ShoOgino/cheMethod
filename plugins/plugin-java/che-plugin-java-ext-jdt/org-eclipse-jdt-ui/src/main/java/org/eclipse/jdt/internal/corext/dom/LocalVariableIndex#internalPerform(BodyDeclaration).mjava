  private static int internalPerform(BodyDeclaration methodOrInitializer) {
    // we have to find the outermost method/initializer/field declaration since a local or anonymous
    // type can reference final variables from the outer scope.
    BodyDeclaration target = methodOrInitializer;
    ASTNode parent = target.getParent();
    while (parent != null) {
      if (parent instanceof MethodDeclaration
          || parent instanceof Initializer
          || parent instanceof FieldDeclaration) {
        target = (BodyDeclaration) parent;
      }
      parent = parent.getParent();
    }

    return doPerform(target);
  }

