  public IBinding[] getDeclarationsInScope(int offset, int flags) {
    org.eclipse.jdt.core.dom.NodeFinder finder =
        new org.eclipse.jdt.core.dom.NodeFinder(fRoot, offset, 0);
    ASTNode node = finder.getCoveringNode();
    if (node == null) {
      return NO_BINDING;
    }

    if (node instanceof SimpleName) {
      return getDeclarationsInScope((SimpleName) node, flags);
    }

    try {
      ITypeBinding binding = Bindings.getBindingOfParentType(node);
      DefaultBindingRequestor requestor = new DefaultBindingRequestor(binding, flags);
      addLocalDeclarations(node, offset, flags, requestor);
      if (binding != null) {
        addTypeDeclarations(binding, flags, requestor);
      }
      List<IBinding> result = requestor.getResult();
      return result.toArray(new IBinding[result.size()]);
    } finally {
      clearLists();
    }
  }

