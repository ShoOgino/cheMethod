    private void addJavaElements(Set<IJavaElement> javaElements, IWorkingSet workingSet) {
        if (workingSet == null)
            return;

        if (workingSet.isAggregateWorkingSet() && workingSet.isEmpty()) {
            try {
                IJavaProject[] projects = JavaCore.create(ResourcesPlugin.getWorkspace().getRoot()).getJavaProjects();
                javaElements.addAll(Arrays.asList(projects));
            } catch (JavaModelException e) {
                JavaPlugin.log(e);
            }
            return;
        }

        IAdaptable[] elements = workingSet.getElements();
        for (int i = 0; i < elements.length; i++) {
            IJavaElement javaElement = (IJavaElement)elements[i].getAdapter(IJavaElement.class);
            if (javaElement != null) {
                addJavaElements(javaElements, javaElement);
                continue;
            }
            IResource resource = (IResource)elements[i].getAdapter(IResource.class);
            if (resource != null) {
                addJavaElements(javaElements, resource);
            }

            // else we don't know what to do with it, ignore.
        }
    }

