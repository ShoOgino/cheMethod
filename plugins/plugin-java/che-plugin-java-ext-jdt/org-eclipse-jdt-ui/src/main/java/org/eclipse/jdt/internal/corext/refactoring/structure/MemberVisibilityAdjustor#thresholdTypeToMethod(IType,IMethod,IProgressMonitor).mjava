  /**
   * Returns the visibility threshold from a type to a method.
   *
   * @param referencing the referencing type
   * @param referenced the referenced method
   * @param monitor the progress monitor to use
   * @return the visibility keyword corresponding to the threshold, or <code>null</code> for default
   *     visibility
   * @throws JavaModelException if the java elements could not be accessed
   */
  private ModifierKeyword thresholdTypeToMethod(
      final IType referencing, final IMethod referenced, final IProgressMonitor monitor)
      throws JavaModelException {
    final ICompilationUnit referencedUnit = referenced.getCompilationUnit();
    ModifierKeyword keyword = ModifierKeyword.PUBLIC_KEYWORD;
    if (referenced.getDeclaringType().equals(referencing))
      keyword = ModifierKeyword.PRIVATE_KEYWORD;
    else {
      final ITypeHierarchy hierarchy =
          getTypeHierarchy(referencing, new SubProgressMonitor(monitor, 1));
      final IType[] types = hierarchy.getSupertypes(referencing);
      IType superType = null;
      for (int index = 0; index < types.length; index++) {
        superType = types[index];
        if (superType.equals(referenced.getDeclaringType())) {
          keyword = ModifierKeyword.PROTECTED_KEYWORD;
          return keyword;
        }
      }
    }
    final ICompilationUnit typeUnit = referencing.getCompilationUnit();
    if (referencedUnit != null && referencedUnit.equals(typeUnit)) {
      if (referenced.getDeclaringType().getDeclaringType() != null) keyword = null;
      else keyword = ModifierKeyword.PRIVATE_KEYWORD;
    } else if (referencedUnit != null && referencedUnit.getParent().equals(typeUnit.getParent()))
      keyword = null;
    return keyword;
  }

