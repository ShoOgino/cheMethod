  public static Message[] getMessages(ASTNode node, int flags) {
    ASTNode root = node.getRoot();
    if (!(root instanceof CompilationUnit)) return EMPTY_MESSAGES;
    Message[] messages = ((CompilationUnit) root).getMessages();
    if (root == node) return messages;
    final int iterations = computeIterations(flags);
    List<Message> result = new ArrayList<Message>(5);
    for (int i = 0; i < messages.length; i++) {
      Message message = messages[i];
      ASTNode temp = node;
      int count = iterations;
      do {
        int nodeOffset = temp.getStartPosition();
        int messageOffset = message.getStartPosition();
        if (nodeOffset <= messageOffset && messageOffset < nodeOffset + temp.getLength()) {
          result.add(message);
          count = 0;
        } else {
          count--;
        }
      } while ((temp = temp.getParent()) != null && count > 0);
    }
    return result.toArray(new Message[result.size()]);
  }

