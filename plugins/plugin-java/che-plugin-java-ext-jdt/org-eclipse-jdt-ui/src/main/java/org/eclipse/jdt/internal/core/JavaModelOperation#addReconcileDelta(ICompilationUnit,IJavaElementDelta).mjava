    /*
     * Registers the given reconcile delta with the Java Model Manager.
     */
    protected void addReconcileDelta(ICompilationUnit workingCopy, IJavaElementDelta delta) {
        HashMap reconcileDeltas = JavaModelManager.getJavaModelManager().getDeltaProcessor().reconcileDeltas;
        org.eclipse.jdt.internal.core.JavaElementDelta previousDelta = (org.eclipse.jdt.internal.core.JavaElementDelta)reconcileDeltas.get(workingCopy);
        if (previousDelta != null) {
            IJavaElementDelta[] children = delta.getAffectedChildren();
            for (int i = 0, length = children.length; i < length; i++) {
                org.eclipse.jdt.internal.core.JavaElementDelta child = (org.eclipse.jdt.internal.core.JavaElementDelta)children[i];
                previousDelta.insertDeltaTree(child.getElement(), child);
            }
            // note that the last delta's AST always takes precedence over the existing delta's AST
            // since it is the result of the last reconcile operation
            if ((delta.getFlags() & IJavaElementDelta.F_AST_AFFECTED) != 0) {
                previousDelta.changedAST(delta.getCompilationUnitAST());
            }

        } else {
            reconcileDeltas.put(workingCopy, delta);
        }
    }

