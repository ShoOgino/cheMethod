        public TypeReferenceProcessor(Set<String> oldSingleImports, Set<String> oldDemandImports, CompilationUnit root,
                                      ImportRewrite impStructure, boolean ignoreLowerCaseNames) {
            fOldSingleImports = oldSingleImports;
            fOldDemandImports = oldDemandImports;
            fImpStructure = impStructure;
            fDoIgnoreLowerCaseNames = ignoreLowerCaseNames;

            ICompilationUnit cu = impStructure.getCompilationUnit();

            fImplicitImports = new HashSet<String>(3);
            fImplicitImports.add(""); //$NON-NLS-1$
            fImplicitImports.add("java.lang"); //$NON-NLS-1$
            fImplicitImports.add(cu.getParent().getElementName());

            fAnalyzer = new ScopeAnalyzer(root);

            fCurrPackage = (IPackageFragment)cu.getParent();

            fAllowDefaultPackageImports = cu.getJavaProject().getOption(JavaCore.COMPILER_SOURCE, true).equals(JavaCore.VERSION_1_3);

            fImportsAdded = new HashSet<String>();
            fUnresolvedTypes = new HashMap<String, UnresolvedTypeData>();
        }

