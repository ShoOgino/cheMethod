  private void addAllResourceModifications(
      IPackageFragment rootPackage,
      RenameArguments args,
      boolean renameSubPackages,
      IPackageFragment[] allSubPackages)
      throws CoreException {
    IFolder target = addResourceModifications(rootPackage, args, rootPackage, renameSubPackages);
    if (renameSubPackages) {
      IContainer container = (IContainer) rootPackage.getResource();
      if (container == null) return;
      boolean removeContainer = !container.contains(target);
      for (int i = 0; i < allSubPackages.length; i++) {
        IPackageFragment pack = allSubPackages[i];
        IFolder subTarget = addResourceModifications(rootPackage, args, pack, renameSubPackages);
        if (container.contains(subTarget)) removeContainer = false;
      }
      if (removeContainer) {
        getResourceModifications().addDelete(container);
      }
    }
  }

