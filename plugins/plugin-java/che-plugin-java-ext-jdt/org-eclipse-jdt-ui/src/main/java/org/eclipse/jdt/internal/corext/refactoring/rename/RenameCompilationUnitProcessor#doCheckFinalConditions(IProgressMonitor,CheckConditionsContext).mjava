  @Override
  protected RefactoringStatus doCheckFinalConditions(
      IProgressMonitor pm, CheckConditionsContext context) throws CoreException {
    try {
      if (fWillRenameType && (!fCu.isStructureKnown())) {
        RefactoringStatus result1 = new RefactoringStatus();

        RefactoringStatus result2 = new RefactoringStatus();
        result2.merge(
            Checks.checkCompilationUnitNewName(fCu, removeFileNameExtension(getNewElementName())));
        if (result2.hasFatalError())
          result1.addError(
              Messages.format(
                  RefactoringCoreMessages.RenameCompilationUnitRefactoring_not_parsed_1,
                  BasicElementLabels.getFileName(fCu)));
        else
          result1.addError(
              Messages.format(
                  RefactoringCoreMessages.RenameCompilationUnitRefactoring_not_parsed,
                  BasicElementLabels.getFileName(fCu)));
        result1.merge(result2);
      }

      if (fWillRenameType) {
        return fRenameTypeProcessor.checkFinalConditions(pm, context);
      } else {
        return Checks.checkCompilationUnitNewName(
            fCu, removeFileNameExtension(getNewElementName()));
      }
    } finally {
      pm.done();
    }
  }

