  private static TextChangeManager createChangeManager(
      IProgressMonitor monitor, ICompilationUnit copy, String newName) throws CoreException {
    TextChangeManager manager = new TextChangeManager();
    SearchResultGroup refs = getReferences(copy, monitor);
    if (refs == null) return manager;
    if (refs.getCompilationUnit() == null) return manager;

    String name = RefactoringCoreMessages.CopyRefactoring_update_ref;
    SearchMatch[] results = refs.getSearchResults();
    for (int j = 0; j < results.length; j++) {
      SearchMatch searchResult = results[j];
      if (searchResult.getAccuracy() == SearchMatch.A_INACCURATE) continue;
      int offset = searchResult.getOffset();
      int length = searchResult.getLength();
      TextChangeCompatibility.addTextEdit(
          manager.get(copy), name, new ReplaceEdit(offset, length, newName));
    }
    return manager;
  }

