  /**
   * Serializes a XML document into a string - encoded in UTF8 format, with platform line
   * separators.
   *
   * @param doc document to serialize
   * @return the document as a string
   * @throws TransformerException if an unrecoverable error occurs during the serialization
   * @throws IOException if the encoding attempted to be used is not supported
   */
  private static String serializeDocumentInt(Document doc)
      throws TransformerException, IOException {
    ByteArrayOutputStream s = new ByteArrayOutputStream();
    TransformerFactory factory = TransformerFactory.newInstance();
    Transformer transformer = factory.newTransformer();
    transformer.setOutputProperty(OutputKeys.METHOD, "xml"); // $NON-NLS-1$
    transformer.setOutputProperty(OutputKeys.INDENT, "yes"); // $NON-NLS-1$
    DOMSource source = new DOMSource(doc);
    StreamResult outputTarget = new StreamResult(s);
    transformer.transform(source, outputTarget);
    return s.toString("UTF8"); // $NON-NLS-1$
  }

