  public int getLineOfOffset(int offset) throws CoreException {
    if (fDocument != null) {
      try {
        return fDocument.getLineOfOffset(offset);
      } catch (BadLocationException e) {
        String message = "Illegal offset: " + offset; // $NON-NLS-1$
        throw new CoreException(createError(DOCUMENT_ERROR, message, e));
      }
    }
    return getScanner().getLineNumber(offset);
  }

