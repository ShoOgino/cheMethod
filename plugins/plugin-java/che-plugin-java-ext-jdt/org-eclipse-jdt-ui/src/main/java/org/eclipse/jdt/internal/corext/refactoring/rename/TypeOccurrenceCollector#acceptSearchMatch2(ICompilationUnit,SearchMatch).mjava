  public SearchMatch acceptSearchMatch2(ICompilationUnit unit, SearchMatch match)
      throws CoreException {
    int start = match.getOffset();
    int length = match.getLength();

    //unqualified:
    String matchText = unit.getBuffer().getText(start, length);
    if (fOldName.equals(matchText)) {
      return match;
    }

    //(partially) qualified:
    if (fOldQualifiedName.endsWith(matchText)) {
      //e.g. rename B and p.A.B ends with match A.B
      int simpleNameLenght = fOldName.length();
      match.setOffset(start + length - simpleNameLenght);
      match.setLength(simpleNameLenght);
      return match;
    }

    //Not a standard reference -- use scanner to find last identifier token:
    IScanner scanner = getScanner(unit);
    scanner.setSource(matchText.toCharArray());
    int simpleNameStart = -1;
    int simpleNameEnd = -1;
    try {
      int token = scanner.getNextToken();
      while (token != ITerminalSymbols.TokenNameEOF) {
        if (token == ITerminalSymbols.TokenNameIdentifier) {
          simpleNameStart = scanner.getCurrentTokenStartPosition();
          simpleNameEnd = scanner.getCurrentTokenEndPosition();
        }
        token = scanner.getNextToken();
      }
    } catch (InvalidInputException e) {
      //ignore
    }
    if (simpleNameStart != -1) {
      match.setOffset(start + simpleNameStart);
      match.setLength(simpleNameEnd + 1 - simpleNameStart);
    }
    return match;
  }

