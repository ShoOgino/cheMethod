  private static String getContentsFromInputStream(InputStream in, String encoding)
      throws CoreException {
    final int defaultFileSize = 15 * 1024;
    StringBuffer buffer = new StringBuffer(defaultFileSize);
    Reader reader = null;

    try {
      reader = new BufferedReader(new InputStreamReader(in, encoding), defaultFileSize);

      char[] readBuffer = new char[2048];
      int charCount = reader.read(readBuffer);

      while (charCount > 0) {
        buffer.append(readBuffer, 0, charCount);
        charCount = reader.read(readBuffer);
      }

    } catch (IOException e) {
      throw new CoreException(
          new Status(IStatus.ERROR, "JavaPlugin.getPluginId()", e.getMessage(), e));
    } finally {
      try {
        if (reader != null) {
          reader.close(); // this will also close the InputStream wrapped in the reader
        }
      } catch (IOException e) {
        // ignore
      }
    }
    return buffer.toString();
  }

