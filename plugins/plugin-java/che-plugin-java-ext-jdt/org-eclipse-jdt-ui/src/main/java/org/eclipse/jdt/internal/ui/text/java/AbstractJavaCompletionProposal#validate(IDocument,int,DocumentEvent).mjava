  /*
   * @see org.eclipse.jface.text.contentassist.ICompletionProposalExtension2#validate(org.eclipse.jface.text.IDocument, int, org.eclipse.jface.text.DocumentEvent)
   */
  public boolean validate(IDocument document, int offset, DocumentEvent event) {

    if (!isOffsetValid(offset)) return fIsValidated = false;

    fIsValidated = isValidPrefix(getPrefix(document, offset));

    if (fIsValidated && event != null) {
      // adapt replacement range to document change
      int delta = (event.fText == null ? 0 : event.fText.length()) - event.fLength;
      final int newLength = Math.max(getReplacementLength() + delta, 0);
      setReplacementLength(newLength);
    }

    return fIsValidated;
  }

