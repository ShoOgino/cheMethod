  /**
   * Helper method that generate a move or copy delta for a sub-tree of resources being moved or
   * copied.
   */
  private void moveOrCopyDeep(IResource resource, IPath destination, final boolean move) {
    final IPath sourcePrefix = resource.getFullPath();
    final IPath destinationPrefix = destination;
    try {
      //build delta for the entire sub-tree if available
      if (resource.isAccessible()) {
        resource.accept(
            new IResourceVisitor() {
              public boolean visit(IResource child) {
                return moveOrCopy(child, sourcePrefix, destinationPrefix, move);
              }
            });
      } else {
        //just build a delta for the single resource
        moveOrCopy(resource, sourcePrefix, destination, move);
      }
    } catch (CoreException e) {
      fail(e);
    }
  }

