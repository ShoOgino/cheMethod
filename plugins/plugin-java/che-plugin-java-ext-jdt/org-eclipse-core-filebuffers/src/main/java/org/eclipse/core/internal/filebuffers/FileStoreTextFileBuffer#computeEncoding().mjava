  private String computeEncoding() {
    // Make sure cache is up to date
    if (!fIsCacheUpdated) cacheEncodingState();

    // User-defined encoding has first priority
    if (fExplicitEncoding != null) return fExplicitEncoding;

    //		// Probe content
    //		Reader reader= new DocumentReader(fDocument);
    //		try {
    //			QualifiedName[] options= new QualifiedName[] { IContentDescription.CHARSET,
    // IContentDescription.BYTE_ORDER_MARK };
    //			IContentDescription description= Platform.getContentTypeManager().getDescriptionFor(reader,
    // fFileStore.getName(), options);
    //			if (description != null) {
    //				String encoding= description.getCharset();
    //				if (encoding != null)
    //					return encoding;
    //			}
    //		} catch (IOException ex) {
    //			// Try next strategy
    //		} finally {
    //			try {
    //				reader.close();
    //			} catch (IOException x) {
    //			}
    //		}

    // Use file's encoding if the file has a BOM
    if (fHasBOM) return fEncoding;

    // Use global default
    return fManager.getDefaultEncoding();
  }

