  /**
   * Acquires a document from the file buffer manager.
   *
   * @param monitor the progress monitor to use
   * @return the document
   * @throws CoreException if the document could not successfully be acquired
   */
  private IDocument acquireDocument(final IProgressMonitor monitor) throws CoreException {
    if (fCount > 0) return fBuffer.getDocument();

    final ITextFileBufferManager manager = FileBuffers.getTextFileBufferManager();
    final IPath path = fFile.getFullPath();

    manager.connect(path, LocationKind.IFILE, monitor);
    fCount++;

    fBuffer = manager.getTextFileBuffer(path, LocationKind.IFILE);

    final IDocument document = fBuffer.getDocument();
    fContentStamp = ContentStamps.get(fFile, document);

    return document;
  }

