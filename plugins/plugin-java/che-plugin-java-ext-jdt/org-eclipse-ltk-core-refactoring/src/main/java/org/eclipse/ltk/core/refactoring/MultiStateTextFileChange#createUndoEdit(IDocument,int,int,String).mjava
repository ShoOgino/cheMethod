	/**
	 * Creates the corresponding text edit to the event.
	 *
	 * @param document
	 *            the document
	 * @param offset
	 *            the offset of the event
	 * @param length
	 *            the length of the event
	 * @param text
	 *            the text of the event
	 * @return the undo edit
	 */
	private ReplaceEdit createUndoEdit(final IDocument document, final int offset, final int length, final String text) {
		String currentText= null;
		try {
			currentText= document.get(offset, length);
		} catch (BadLocationException cannotHappen) {
			// Cannot happen
		}

		if (fCachedString != null && fCachedString.equals(currentText))
			currentText= fCachedString;
		else
			fCachedString= currentText;

		return new ReplaceEdit(offset, text != null ? text.length() : 0, currentText);
	}

