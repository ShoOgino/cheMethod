    /**
     * Prints the given element.
     *
     * @param element the element to print
     */
    public void printElement(Element element) {
      // Ensure extra whitespace is not emitted next to a Text node,
      // as that will result in a situation where the restored text data is not the
      // same as the saved text data.
      boolean hasChildren = element.hasChildNodes();
      startTag(element, hasChildren);
      if (hasChildren) {
        boolean prevWasText = false;
        NodeList children = element.getChildNodes();
        for (int i = 0; i < children.getLength(); i++) {
          Node node = children.item(i);
          if (node instanceof Element) {
            if (!prevWasText) {
              println();
            }
            printElement((Element) children.item(i));
            prevWasText = false;
          } else if (node instanceof Text) {
            print(getEscaped(node.getNodeValue()));
            prevWasText = true;
          }
        }
        if (!prevWasText) {
          println();
        }
        endTag(element);
      }
    }

