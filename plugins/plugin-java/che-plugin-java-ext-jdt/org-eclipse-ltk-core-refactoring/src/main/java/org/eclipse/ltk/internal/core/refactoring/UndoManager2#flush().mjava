  public void flush() {
    if (fActiveOperation != null) {
      if (fIsOpen) {
        fOperationHistory.closeOperation(false, false, IOperationHistory.EXECUTE);
      }
      /* the triggering operation is invalid, but we must ensure that any
       * other operations executed while it was open remain in the undo
       * history.  We accomplish this by adding the invalid operation,
       * since disposing the context later will cause it to be broken up into
       * its atomic parts.
       */
      fOperationHistory.add(fActiveOperation);
    }
    fActiveOperation = null;
    fIsOpen = false;
    fOperationHistory.dispose(RefactoringCorePlugin.getUndoContext(), true, true, false);
  }

