  private IDocument getDocument(ICompilationUnit ancestor) throws JavaModelException {
    IDocument document;
    IBuffer buffer = ancestor.getBuffer();
    if (buffer instanceof org.eclipse.jdt.internal.ui.javaeditor.DocumentAdapter) {
      document = ((org.eclipse.jdt.internal.ui.javaeditor.DocumentAdapter) buffer).getDocument();
    } else {
      document = new DocumentAdapter(buffer);
    }
    return document;
  }

