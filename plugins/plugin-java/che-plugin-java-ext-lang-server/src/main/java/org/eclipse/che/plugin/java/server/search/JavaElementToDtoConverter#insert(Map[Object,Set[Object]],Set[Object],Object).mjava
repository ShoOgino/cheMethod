  private void insert(Map<Object, Set<Object>> toAdd, Set<Object> toUpdate, Object child) {
    Object parent = getParent(child);
    while (parent != null) {
      if (insertChild(parent, child)) {
        if (toAdd != null) insertInto(parent, child, toAdd);
      } else {
        if (toUpdate != null) toUpdate.add(parent);
        return;
      }
      child = parent;
      parent = getParent(child);
    }
    if (insertChild(result, child)) {
      if (toAdd != null) insertInto(result, child, toAdd);
    }
  }

