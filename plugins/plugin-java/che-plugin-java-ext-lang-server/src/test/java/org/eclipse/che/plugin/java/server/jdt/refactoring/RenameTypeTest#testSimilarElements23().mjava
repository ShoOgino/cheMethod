  @Test
  public void testSimilarElements23() throws Exception {
    // Test transplanter for elements inside types inside fields

    ParticipantTesting.reset();
    ICompilationUnit cu = createCUfromTestFile(getPackageP(), "SomeClass");
    IType someClass = getType(cu, "SomeClass");

    List handleList = new ArrayList();
    List argumentList = new ArrayList();

    List similarOldHandleList = new ArrayList();
    List similarNewNameList = new ArrayList();
    List similarNewHandleList = new ArrayList();

    final String newName = "SomeNewClass";

    // some field
    IField anotherSomeClass = someClass.getField("anotherSomeClass");
    similarOldHandleList.add(anotherSomeClass.getHandleIdentifier());
    similarNewNameList.add("anotherSomeNewClass");
    similarNewHandleList.add("Lp/SomeNewClass;.anotherSomeNewClass");

    // field in class in method in field declaration ;)
    IField inInner =
        anotherSomeClass
            .getType("", 1)
            .getMethod("foo", new String[0])
            .getType("X", 1)
            .getField("someClassInInner");
    similarOldHandleList.add(inInner.getHandleIdentifier());
    similarNewNameList.add("someNewClassInInner");
    similarNewHandleList.add("Lp/SomeNewClass$1$X;.someNewClassInInner");

    // Type Stuff
    handleList.add(someClass);
    argumentList.add(new RenameArguments(newName, true));
    handleList.add(cu);
    argumentList.add(new RenameArguments(newName + ".java", true));
    handleList.add(cu.getResource());
    argumentList.add(new RenameArguments(newName + ".java", true));

    String[] handles = ParticipantTesting.createHandles(handleList.toArray());
    RenameArguments[] arguments = (RenameArguments[]) argumentList.toArray(new RenameArguments[0]);

    RenameJavaElementDescriptor descriptor = createRefactoringDescriptor(someClass, newName);
    setTheOptions(descriptor, true, false, true, null, RenamingNameSuggestor.STRATEGY_EMBEDDED);
    RefactoringStatus status = performRefactoring(descriptor);
    Assert.assertNull("was supposed to pass", status);

    checkResultInClass(newName);

    ParticipantTesting.testRename(handles, arguments);
    ParticipantTesting.testSimilarElements(
        similarOldHandleList, similarNewNameList, similarNewHandleList);
  }

