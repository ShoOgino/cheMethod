  @Override
  public void onServerInitialized(
      LanguageServerLauncher launcher,
      LanguageServer server,
      ServerCapabilities capabilities,
      String projectPath) {
    boolean mustRun = false;
    synchronized (launchLock) {
      if (state < State.INITIALIZED) {
        throw new IllegalStateException();
      } else if (state == State.INITIALIZED) {
        state = State.POST_INITIALIZING;
        launchLock.notifyAll();
        mustRun = true;
      } else if (state == State.POST_INITIALIZED) {
        return;
      } else {
        while (state == State.POST_INITIALIZING) {
          try {
            launchLock.wait();
          } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            return;
          }
        }
      }
    }
    if (mustRun) {
      wrappedLauncher.onServerInitialized(wrappedLauncher, server, capabilities, "/");
      synchronized (launchLock) {
        state = State.POST_INITIALIZED;
        launchLock.notifyAll();
      }
    }
  }

