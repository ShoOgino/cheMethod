    @Override
    public JdiVariable[] getVariables() {
        if (variables == null) {
            if (isPrimitive()) {
                variables = new JdiVariable[0];
            } else {
                if (isArray()) {
                    ArrayReference array = (ArrayReference)value;
                    int length = array.length();
                    variables = new JdiVariable[length];
                    for (int i = 0; i < length; i++) {
                        variables[i] = new JdiArrayElementImpl(i, array.getValue(i));
                    }
                } else {
                    ObjectReference object = (ObjectReference)value;
                    ReferenceType type = object.referenceType();
                    List<Field> fields = type.allFields();
                    variables = new JdiVariable[fields.size()];
                    int i = 0;
                    for (Field f : fields) {
                        variables[i++] = new JdiFieldImpl(f, object);
                    }
                    // See JdiFieldImpl#compareTo(JdiFieldImpl).
                    Arrays.sort(variables);
                }
            }
        }
        return variables;
    }

