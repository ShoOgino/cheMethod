    @Test
    public void shouldCeaseToTrackTheWorkspaceActivityAfterStopping() throws Exception {
        final String wsId = "testWsId";
        final long expiredTime = 1000L;
        activityManager.update(wsId, expiredTime);
        activityManager.subscribe();
        verify(eventService).subscribe(captor.capture());
        final EventSubscriber<WorkspaceStatusEvent> subscriber = captor.getValue();

        final Map<String, Long> activeWorkspaces = getActiveWorkspaces(activityManager);
        final boolean contains = activeWorkspaces.containsKey(wsId);
        subscriber.onEvent(DtoFactory.newDto(WorkspaceStatusEvent.class)
                                     .withEventType(WorkspaceStatusEvent.EventType.STOPPED)
                                     .withWorkspaceId(wsId));

        assertTrue(contains);
        assertTrue(activeWorkspaces.isEmpty());
    }

