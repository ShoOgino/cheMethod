    /**
     * Apply the merging of project config dto including source storage dto into the existing factory
     * <p>
     * here are the following rules
     * <ul>
     * <li>no projects --> add whole project</li>
     * <li>if projects
     * <ul>
     * <li>: if there is only one project: add source if missing</li>
     * <li> if many projects: do nothing</li>
     * </ul></li>
     * </ul>
     *
     * @param factory
     * @param computedProjectConfig
     * @return
     */
    public FactoryDto merge(FactoryDto factory, ProjectConfigDto computedProjectConfig) {

        final List<ProjectConfigDto> projects = factory.getWorkspace().getProjects();
        if (projects == null || projects.isEmpty()) {
            factory.getWorkspace().setProjects(singletonList(computedProjectConfig));
            return factory;
        }

        // if we're here, they are projects
        if (projects.size() == 1) {
            ProjectConfigDto projectConfig = projects.get(0);
            if (projectConfig.getSource() == null)
                projectConfig.setSource(computedProjectConfig.getSource());
        }

        return factory;
    }

