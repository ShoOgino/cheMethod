    @Test
    public void onAuthenticatedWhenGenerateKeysIsSuccess() throws Exception {
        String userId = "userId";
        OAuthStatus authStatus = mock(OAuthStatus.class);
        SshKeyUploader keyProvider = mock(SshKeyUploader.class);

        CurrentUser user = mock(CurrentUser.class);
        ProfileDescriptor profile = mock(ProfileDescriptor.class);
        when(view.isGenerateKeysSelected()).thenReturn(true);
        when(registry.getUploader(GITHUB_HOST)).thenReturn(keyProvider);

        when(appContext.getCurrentUser()).thenReturn(user);
        when(user.getProfile()).thenReturn(profile);
        when(profile.getId()).thenReturn(userId);

        gitHubAuthenticator.authenticate(null, getCallBack());
        gitHubAuthenticator.onAuthenticated(authStatus);

        verify(keyProvider).uploadKey(eq(userId), generateKeyCallbackCaptor.capture());
        AsyncCallback<Void> generateKeyCallback = generateKeyCallbackCaptor.getValue();
        generateKeyCallback.onSuccess(null);

        verify(view).isGenerateKeysSelected();
        verify(registry).getUploader(eq(GITHUB_HOST));
        verify(appContext).getCurrentUser();
        verify(notificationManager).notify(anyString(), eq(SUCCESS), eq(FLOAT_MODE));
    }

