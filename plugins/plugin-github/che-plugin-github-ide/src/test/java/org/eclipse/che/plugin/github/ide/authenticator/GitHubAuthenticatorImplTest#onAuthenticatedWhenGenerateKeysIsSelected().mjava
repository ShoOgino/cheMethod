  @Test
  public void onAuthenticatedWhenGenerateKeysIsSelected() throws Exception {
    String userId = "userId";
    OAuthStatus authStatus = mock(OAuthStatus.class);

    SshKeyUploader sshKeyUploader = mock(SshKeyUploader.class);

    CurrentUser user = mock(CurrentUser.class);
    when(view.isGenerateKeysSelected()).thenReturn(true);

    when(registry.getUploader(GITHUB_HOST)).thenReturn(sshKeyUploader);

    when(appContext.getCurrentUser()).thenReturn(user);
    when(user.getId()).thenReturn(userId);

    gitHubAuthenticator.onAuthenticated(authStatus);

    verify(view).isGenerateKeysSelected();
    verify(registry).getUploader(eq(GITHUB_HOST));
    verify(appContext).getCurrentUser();
    verify(sshKeyUploader)
        .uploadKey(eq(userId), org.mockito.ArgumentMatchers.<AsyncCallback<Void>>anyObject());
  }

