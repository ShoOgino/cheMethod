    private void addSelectedAndCommit(final String message, final boolean commitAll, final boolean amend) {
        service.add(appContext.getDevMachine(), project.getLocation(), false, toRelativePaths(appContext.getResources()))
               .then(new Operation<Void>() {
                   @Override
                   public void apply(Void ignored) throws OperationException {
                       doCommit(message, false, commitAll, amend);
                   }
               });
    }

