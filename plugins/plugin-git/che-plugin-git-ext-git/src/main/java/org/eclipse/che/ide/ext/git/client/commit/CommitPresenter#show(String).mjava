  private void show(@Nullable String diff) {
    Map<String, Status> files = toFileStatusMap(diff);
    filesToCommit.clear();
    allFiles = files.keySet();

    view.setEnableCommitButton(!view.getMessage().isEmpty());
    view.focusInMessageField();
    view.showDialog();
    changesPanelPresenter.show(files);
    view.setMarkedCheckBoxes(
        stream(appContext.getResources())
            .map(resource -> resource.getLocation().removeFirstSegments(1))
            .collect(Collectors.toSet()));
  }

