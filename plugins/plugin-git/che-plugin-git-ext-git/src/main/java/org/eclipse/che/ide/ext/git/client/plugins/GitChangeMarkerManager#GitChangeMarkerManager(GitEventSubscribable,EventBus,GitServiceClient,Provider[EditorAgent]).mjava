  @Inject
  public GitChangeMarkerManager(
      GitEventSubscribable subscribeToGitEvents,
      EventBus eventBus,
      GitServiceClient gitServiceClient,
      Provider<EditorAgent> editorAgentProvider) {
    this.editorAgentProvider = editorAgentProvider;

    eventBus.addHandler(
        EditorOpenedEvent.TYPE,
        event -> {
          if (!(event.getFile() instanceof HasVcsStatus)) {
            return;
          }
          HasVcsStatus file = (HasVcsStatus) event.getFile();
          if (file.getVcsStatus() != MODIFIED) {
            return;
          }
          VcsChangeMarkerRender render =
              ((HasVcsChangeMarkerRender) event.getEditor()).getVcsChangeMarkersRender();

          Path location = event.getFile().getLocation();
          gitServiceClient
              .getEditedRegions(location.uptoSegment(1), location.removeFirstSegments(1))
              .then(
                  edition -> {
                    handleEditedRegions(edition, render);
                  });
        });

    subscribeToGitEvents.addSubscriber(this);
  }

