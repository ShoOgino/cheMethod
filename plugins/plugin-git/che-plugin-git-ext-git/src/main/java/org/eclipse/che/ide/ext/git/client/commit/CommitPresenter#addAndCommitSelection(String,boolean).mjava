    protected void addAndCommitSelection(final String message, final boolean amend) {
        final Resource[] resources = appContext.getResources();

        if (isNullOrEmpty(resources)) {
            doCommit(message, false, amend);
        } else {
            service.add(appContext.getDevMachine(), project.getLocation(), false, toRelativePaths(resources))
                   .then(new Operation<Void>() {
                       @Override
                       public void apply(Void ignored) throws OperationException {
                           doCommit(message, false, amend);
                       }
                   });
        }
    }

