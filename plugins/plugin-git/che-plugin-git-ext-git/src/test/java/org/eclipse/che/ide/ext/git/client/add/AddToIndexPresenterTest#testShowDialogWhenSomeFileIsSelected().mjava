    @Test
    public void testShowDialogWhenSomeFileIsSelected() throws Exception {
        String filePath = PROJECT_PATH + PROJECT_NAME;
        Selection selection = mock(Selection.class);
        FileReferenceNode file = mock(FileReferenceNode.class);
        when(file.getPath()).thenReturn(filePath);
        when(selection.getHeadElement()).thenReturn(file);
        when(selection.isEmpty()).thenReturn(false);
        when(selection.isSingleSelection()).thenReturn(true);
        when(file.getStorablePath()).thenReturn(filePath);
        when(selection.getHeadElement()).thenReturn(file);
        when(projectExplorer.getSelection()).thenReturn(selection);
        when(constant.addToIndexFile(anyString())).thenReturn(SAFE_HTML);
        when(SAFE_HTML.asString()).thenReturn(MESSAGE);
        when(this.statusResponse.isClean()).thenReturn(false);

        presenter.showDialog();

        verify(service).status(eq(devMachine), eq(rootProjectConfig), asyncRequestCallbackStatusCaptor.capture());
        AsyncRequestCallback<Status> callback = asyncRequestCallbackStatusCaptor.getValue();

        //noinspection NonJREEmulationClassesInClientCode
        Method onSuccess = GwtReflectionUtils.getMethod(callback.getClass(), "onSuccess");
        onSuccess.invoke(callback, this.statusResponse);

        verify(appContext).getCurrentProject();
        verify(constant).addToIndexFile(eq(PROJECT_NAME));
        verify(view).setMessage(eq(MESSAGE), Matchers.<List<String>>eq(null));
        verify(view).setUpdated(anyBoolean());
        verify(view).showDialog();
    }

