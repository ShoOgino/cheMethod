    @Test
    public void testOnDiffWithPrevCommitClicked() throws Exception {
        List<Revision> revisions = new ArrayList<Revision>();
        revisions.add(selectedRevision);
        revisions.add(selectedRevision);
        when(logResponse.getCommits()).thenReturn(revisions);
        doAnswer(new Answer() {
            @Override
            public Object answer(InvocationOnMock invocation) throws Throwable {
                Object[] arguments = invocation.getArguments();
                AsyncRequestCallback<String> callback = (AsyncRequestCallback<String>)arguments[2];
                Method onSuccess = GwtReflectionUtils.getMethod(callback.getClass(), "onSuccess");
                onSuccess.invoke(callback, logResponse);
                return callback;
            }
        }).when(service).log(anyObject(), anyObject(), null, anyBoolean(), (AsyncRequestCallback<LogResponse>)anyObject());

        presenter.onRefreshClicked();
        presenter.onDiffWithWorkTreeClicked();
        presenter.onRevisionSelected(selectedRevision);
        reset(view);
        reset(service);
        presenter.onDiffWithPrevCommitClicked();

        verify(view).selectDiffWithPrevVersionButton(eq(SELECTED_ITEM));
        verify(view).selectDiffWithIndexButton(eq(UNSELECTED_ITEM));
        verify(view).selectDiffWithWorkingTreeButton(eq(UNSELECTED_ITEM));
        verify(service, never())
                .diff(anyObject(), anyObject(), (List<String>)anyObject(), (DiffRequest.DiffType)anyObject(), anyBoolean(), anyInt(),
                      anyString(),
                      anyBoolean(), (AsyncRequestCallback<String>)anyObject());
        verify(service)
                .diff(anyObject(), anyObject(), (List<String>)anyObject(), (DiffRequest.DiffType)anyObject(), anyBoolean(), anyInt(),
                      anyString(), anyString(), (AsyncRequestCallback<String>)anyObject());
        verify(service)
                .log(anyObject(), eq(rootProjectConfig), null, eq(TEXT_NOT_FORMATTED), (AsyncRequestCallback<LogResponse>)anyObject());
    }

