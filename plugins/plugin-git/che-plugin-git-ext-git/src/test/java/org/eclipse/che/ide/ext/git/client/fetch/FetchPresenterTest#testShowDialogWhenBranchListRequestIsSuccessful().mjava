  @Test
  public void testShowDialogWhenBranchListRequestIsSuccessful() throws Exception {
    final List<Remote> remotes = new ArrayList<>();
    remotes.add(mock(Remote.class));
    final List<Branch> branches = new ArrayList<>();
    branches.add(branch);

    presenter.showDialog(project);

    verify(remoteListPromise).then(remoteListCaptor.capture());
    remoteListCaptor.getValue().apply(remotes);

    verify(branchListPromise).then(branchListCaptor.capture());
    branchListCaptor.getValue().apply(branches);

    verify(branchListPromise, times(2)).then(branchListCaptor.capture());
    branchListCaptor.getValue().apply(branches);

    verify(view).setEnableFetchButton(eq(ENABLE_BUTTON));
    verify(view).setRepositories(anyObject());
    verify(view).setRemoveDeleteRefs(eq(NO_REMOVE_DELETE_REFS));
    verify(view).setFetchAllBranches(eq(FETCH_ALL_BRANCHES));
    verify(view).showDialog();
    verify(view).setRemoteBranches(anyObject());
    verify(view).setLocalBranches(anyObject());
  }

