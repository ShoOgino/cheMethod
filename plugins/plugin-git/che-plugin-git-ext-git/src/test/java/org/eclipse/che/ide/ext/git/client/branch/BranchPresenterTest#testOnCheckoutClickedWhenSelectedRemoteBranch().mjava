  @Test
  public void testOnCheckoutClickedWhenSelectedRemoteBranch() throws Exception {
    when(service.checkout(any(Path.class), any(CheckoutRequest.class))).thenReturn(stringPromise);
    when(stringPromise.then(any(Operation.class))).thenReturn(stringPromise);
    when(stringPromise.catchError(any(Operation.class))).thenReturn(stringPromise);

    when(dtoFactory.createDto(CheckoutRequest.class)).thenReturn(checkoutRequest);

    selectBranch();
    presenter.onCheckoutClicked();

    verify(stringPromise).then(stringCaptor.capture());
    stringCaptor.getValue().apply(null);

    verify(checkoutRequest).setTrackBranch(eq(BRANCH_NAME));
    verifyNoMoreInteractions(checkoutRequest);
  }

