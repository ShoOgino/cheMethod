  @Test
  public void shouldShowCompareWhenOneFileChangedInCurrentRevision() throws Exception {
    final String diff = "M\tfile";
    final AlteredFiles alteredFiles = new AlteredFiles(project, diff);
    Revision parentRevision = mock(Revision.class);
    Revision selectedRevision = mock(Revision.class);
    when(parentRevision.getId()).thenReturn("commitA");
    when(selectedRevision.getId()).thenReturn("commitB");
    LogResponse logResponse = mock(LogResponse.class);
    List<Revision> revisions = new ArrayList<>();
    revisions.add(selectedRevision);
    revisions.add(parentRevision);
    when(logResponse.getCommits()).thenReturn(revisions);

    presenter.show();
    presenter.onRevisionSelected(selectedRevision);
    verify(logPromise).then(logCaptor.capture());
    logCaptor.getValue().apply(logResponse);
    presenter.onCompareClicked();
    verify(stringPromise).then(stringCaptor.capture());
    stringCaptor.getValue().apply(diff);

    verify(comparePresenter)
        .showCompareBetweenRevisions(eq(alteredFiles), anyString(), eq("commitA"), eq("commitB"));
  }

