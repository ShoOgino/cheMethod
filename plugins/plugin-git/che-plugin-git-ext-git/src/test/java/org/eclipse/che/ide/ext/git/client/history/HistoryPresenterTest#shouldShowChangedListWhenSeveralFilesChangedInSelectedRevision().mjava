  @Test
  public void shouldShowChangedListWhenSeveralFilesChangedInSelectedRevision() throws Exception {
    final String diff = "M\tfile1\nM\tfile2";
    final AlteredFiles alteredFiles = new AlteredFiles(project, diff);
    Revision revisionA = mock(Revision.class);
    Revision revisionB = mock(Revision.class);
    when(revisionA.getId()).thenReturn("commitA");
    when(revisionB.getId()).thenReturn("commitB");
    LogResponse logResponse = mock(LogResponse.class);
    List<Revision> revisions = new ArrayList<>();
    revisions.add(revisionA);
    revisions.add(revisionB);
    when(logResponse.getCommits()).thenReturn(revisions);

    presenter.show();
    presenter.onRevisionSelected(revisionA);
    verify(logPromise).then(logCaptor.capture());
    logCaptor.getValue().apply(logResponse);
    presenter.onCompareClicked();
    verify(stringPromise).then(stringCaptor.capture());
    stringCaptor.getValue().apply(diff);

    verify(changesListPresenter).show(eq(alteredFiles), eq("commitB"), eq("commitA"));
  }

