  @Test
  public void shouldShowDialog() throws Exception {
    final String diff = "M\tfile";
    final AlteredFiles alteredFiles = new AlteredFiles(project, diff);
    ConfirmDialog dialog = mock(ConfirmDialog.class);
    when(dialogFactory.createConfirmDialog(
            anyString(),
            anyString(),
            anyString(),
            anyString(),
            any(ConfirmCallback.class),
            eq(null)))
        .thenReturn(dialog);

    presenter.showDialog(project);
    verify(stringPromise).then(stringCaptor.capture());
    stringCaptor.getValue().apply("M\tfile");
    verify(logPromise).then(logCaptor.capture());
    logCaptor.getValue().apply(null);

    verify(view).setEnableAmendCheckBox(true);
    verify(view).setEnablePushAfterCommitCheckBox(true);
    verify(changesPanelPresenter).show(eq(alteredFiles));
    verify(view).focusInMessageField();
    verify(view).setEnableCommitButton(eq(DISABLE_BUTTON));
    verify(view).getMessage();
    verify(view).showDialog();
    verify(view).setMarkedCheckBoxes(anySet());
  }

