  @Test
  public void shouldShowDialog() throws Exception {
    ConfirmDialog dialog = mock(ConfirmDialog.class);
    when(dialogFactory.createConfirmDialog(
            anyString(),
            anyString(),
            anyString(),
            anyString(),
            any(ConfirmCallback.class),
            eq(null)))
        .thenReturn(dialog);

    presenter.showDialog(project);
    verify(stringPromise).then(stringCaptor.capture());
    stringCaptor.getValue().apply("M file");
    verify(logPromise).then(logCaptor.capture());
    logCaptor.getValue().apply(null);

    verify(view).setEnableAmendCheckBox(true);
    verify(view).setEnablePushAfterCommitCheckBox(true);
    verify(changesPanelPresenter).show(eq(singletonMap("file", MODIFIED)));
    verify(view).focusInMessageField();
    verify(view).setEnableCommitButton(eq(DISABLE_BUTTON));
    verify(view).getMessage();
    verify(view).showDialog();
    verify(view).setMarkedCheckBoxes(anySet());
  }

