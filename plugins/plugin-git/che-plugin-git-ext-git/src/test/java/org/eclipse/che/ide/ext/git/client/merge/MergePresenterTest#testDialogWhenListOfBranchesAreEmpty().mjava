    @Test
    public void testDialogWhenListOfBranchesAreEmpty() throws Exception {
        final ArrayList<Reference> emptyReferenceList = new ArrayList<>();
        final List<Branch> emptyBranchList = new ArrayList<>();

        doAnswer(invocation -> {
            Object[] arguments = invocation.getArguments();
            AsyncRequestCallback<List<Branch>> callback = (AsyncRequestCallback<List<Branch>>)arguments[2];
            Method onSuccess = GwtReflectionUtils.getMethod(callback.getClass(), "onSuccess");
            onSuccess.invoke(callback, emptyBranchList);
            return callback;
        }).when(service).branchList(anyString(), anyObject(), eq(LIST_LOCAL), (AsyncRequestCallback<List<Branch>>)anyObject());

        doAnswer(invocation -> {
            Object[] arguments = invocation.getArguments();
            AsyncRequestCallback<List<Branch>> callback = (AsyncRequestCallback<List<Branch>>)arguments[2];
            Method onSuccess = GwtReflectionUtils.getMethod(callback.getClass(), "onSuccess");
            onSuccess.invoke(callback, emptyBranchList);
            return callback;
        }).when(service).branchList(anyString(), anyObject(), eq(LIST_REMOTE), (AsyncRequestCallback<List<Branch>>)anyObject());

        presenter.showDialog();

        verify(view).showDialog();
        verify(view).setLocalBranches(eq(emptyReferenceList));
        verify(view).setRemoteBranches(eq(emptyReferenceList));
    }

