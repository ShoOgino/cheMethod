    @Test
    public void testShowBranchesWhenGetBranchesRequestIsFailed() throws Exception {
        presenter.showBranches();

        verify(service).branchList(anyString(), eq(rootProjectConfig), eq(LIST_ALL), branchListCallbackCaptor.capture());
        AsyncRequestCallback<List<Branch>> branchListCallback = branchListCallbackCaptor.getValue();
        GwtReflectionUtils.callOnFailure(branchListCallback, mock(Throwable.class));

        verify(appContext).getCurrentProject();
        verify(view, never()).showDialogIfClosed();
        verify(gitOutputConsoleFactory).create(BRANCH_LIST_COMMAND_NAME);
        verify(console).printError(anyString());
        verify(consolesPanelPresenter).addCommandOutput(anyString(), eq(console));
        verify(notificationManager).notify(anyString(), anyObject(), eq(true), eq(rootProjectConfig));
        verify(constant, times(2)).branchesListFailed();
    }

