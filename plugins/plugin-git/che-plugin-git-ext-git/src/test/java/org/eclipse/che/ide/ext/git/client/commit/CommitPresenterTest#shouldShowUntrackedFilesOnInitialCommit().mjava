  @Test
  public void shouldShowUntrackedFilesOnInitialCommit() throws Exception {
    final String diff = "A\tfile";
    final AlteredFiles alteredFiles = new AlteredFiles(project, diff);
    PromiseError error = mock(PromiseError.class);
    ServerException exception = mock(ServerException.class);
    when(exception.getErrorCode()).thenReturn(ErrorCodes.INIT_COMMIT_WAS_NOT_PERFORMED);
    when(error.getCause()).thenReturn(exception);
    Status status = mock(Status.class);
    when(status.getUntracked()).thenReturn(singletonList("file"));

    presenter.showDialog(project);
    verify(stringPromise).then(stringCaptor.capture());
    stringCaptor.getValue().apply(null);
    verify(logPromise).catchError(promiseErrorCaptor.capture());
    promiseErrorCaptor.getValue().apply(error);
    verify(statusPromise).then(statusPromiseCaptor.capture());
    statusPromiseCaptor.getValue().apply(status);

    verify(view).setEnableAmendCheckBox(false);
    verify(view).setEnablePushAfterCommitCheckBox(false);
    verify(changesPanelPresenter).show(eq(alteredFiles));
    verify(view).focusInMessageField();
    verify(view).setEnableCommitButton(eq(DISABLE_BUTTON));
    verify(view).getMessage();
    verify(view).showDialog();
    verify(view).setMarkedCheckBoxes(anySet());
  }

