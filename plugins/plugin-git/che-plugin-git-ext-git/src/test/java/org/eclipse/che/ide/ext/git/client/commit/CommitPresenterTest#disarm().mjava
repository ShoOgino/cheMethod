    @Override
    public void disarm() {
        super.disarm();

        presenter = spy(new CommitPresenter(view,
                                            service,
                                            constant,
                                            notificationManager,
                                            dialogFactory,
                                            appContext,
                                            dateTimeFormatter,
                                            gitOutputConsoleFactory,
                                            processesPanelPresenter));

        when(view.getMessage()).thenReturn(EMPTY_TEXT);

        when(appContext.getResources()).thenReturn(new Resource[]{});
        when(appContext.getRootProject()).thenReturn(mock(Project.class));

        when(voidPromise.then(any(Operation.class))).thenReturn(voidPromise);
        when(voidPromise.catchError(any(Operation.class))).thenReturn(voidPromise);
        when(revisionPromise.then(any(Operation.class))).thenReturn(revisionPromise);
        when(revisionPromise.catchError(any(Operation.class))).thenReturn(revisionPromise);
        when(service.add(any(Path.class), anyBoolean(), any(Path[].class))).thenReturn(voidPromise);
        when(service.commit(any(Path.class), anyString(), anyBoolean(), any(Path[].class), anyBoolean()))
                .thenReturn(revisionPromise);
    }

