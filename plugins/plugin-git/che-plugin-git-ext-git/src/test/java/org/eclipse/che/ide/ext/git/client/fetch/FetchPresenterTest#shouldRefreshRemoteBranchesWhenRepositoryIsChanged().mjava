  @Test
  public void shouldRefreshRemoteBranchesWhenRepositoryIsChanged() throws Exception {
    final List<Remote> remotes = new ArrayList<>();
    remotes.add(mock(Remote.class));
    final List<Branch> branches = new ArrayList<>();
    branches.add(branch);
    when(branch.isActive()).thenReturn(ACTIVE_BRANCH);

    presenter.showDialog(project);
    presenter.onRemoteRepositoryChanged();

    verify(branchListPromise).then(branchListCaptor.capture());
    branchListCaptor.getValue().apply(branches);

    verify(branchListPromise, times(2)).then(branchListCaptor.capture());
    branchListCaptor.getValue().apply(branches);

    verify(view).setRemoteBranches(anyObject());
    verify(view).setLocalBranches(anyObject());
    verify(view).selectRemoteBranch(anyString());
  }

