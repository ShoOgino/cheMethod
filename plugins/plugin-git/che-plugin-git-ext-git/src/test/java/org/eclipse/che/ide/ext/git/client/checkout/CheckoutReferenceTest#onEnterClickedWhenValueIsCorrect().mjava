    @Test
    public void onEnterClickedWhenValueIsCorrect() throws Exception {
        when(appContext.getRootProject()).thenReturn(project);
        when(dtoFactory.createDto(CheckoutRequest.class)).thenReturn(checkoutRequest);
        when(checkoutRequest.withName(anyString())).thenReturn(checkoutRequest);
        when(checkoutRequest.withCreateNew(anyBoolean())).thenReturn(checkoutRequest);
        reset(service);
        when(service.checkout(any(Path.class), any(CheckoutRequest.class))).thenReturn(stringPromise);
        when(stringPromise.then(any(Operation.class))).thenReturn(stringPromise);
        when(stringPromise.catchError(any(Operation.class))).thenReturn(stringPromise);
        when(view.getReference()).thenReturn(CORRECT_REFERENCE);

        presenter.showDialog(project);
        presenter.onEnterClicked();

        verify(stringPromise).then(stringCaptor.capture());
        stringCaptor.getValue().apply(null);

        verify(synchronizePromise).then(synchronizeCaptor.capture());
        synchronizeCaptor.getValue().apply(new Resource[0]);

        verify(view).close();
        verify(service).checkout(any(Path.class), any(CheckoutRequest.class));
        verify(checkoutRequest).withName(CORRECT_REFERENCE);
        verifyNoMoreInteractions(checkoutRequest);
    }

