    @Override
    public ProfileImpl getById(String userId) throws NotFoundException, ServerException {
        requireNonNull(userId, "Required non-null id");
        try {
            URL url = new URL(authServerUrl + "/realms/" + realm + "/protocol/openid-connect/userinfo");
            HttpURLConnection conn = (HttpURLConnection)url.openConnection();
            conn.setRequestMethod("GET");
            conn.setRequestProperty("Authorization", "bearer " + EnvironmentContext.getCurrent().getSubject().getToken());
            LOG.info("Pulling profile from URL : {}", url);
            try (BufferedReader in = new BufferedReader(new InputStreamReader(conn.getInputStream()))) {
                ObjectMapper mapper = new ObjectMapper();
                //noinspection unchecked
                Map<String, String> profileAttributes =  mapper.readValue(in, Map.class);
                return new ProfileImpl(userId, profileAttributes);
            }
        } catch (IOException e) {
            LOG.error("Exception during retrieval of the Keycloak user profile", e);
            throw new ServerException("Exception during retrieval of the Keycloak user profile", e);
        }
    }

