  @Override
  public void disconnect() {
    unsubscribeFromDebuggerEvents();

    Promise<Void> disconnect;
    if (isConnected()) {
      disconnect = service.disconnect(debugSessionDto.getId());
    } else {
      disconnect = Promises.resolve(null);
    }

    invalidateDebugSession();
    preserveDebuggerState();

    disconnect
        .then(
            it -> {
              for (DebuggerObserver observer : observers) {
                observer.onDebuggerDisconnected();
              }
              debuggerManager.setActiveDebugger(null);
            })
        .catchError(
            error -> {
              for (DebuggerObserver observer : observers) {
                observer.onDebuggerDisconnected();
              }
              debuggerManager.setActiveDebugger(null);
            });
  }

