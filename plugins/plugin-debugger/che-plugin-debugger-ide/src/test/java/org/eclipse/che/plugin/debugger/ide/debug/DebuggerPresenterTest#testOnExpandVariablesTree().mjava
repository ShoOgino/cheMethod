  @Test
  public void testOnExpandVariablesTree() throws OperationException {
    SimpleValueDto valueDto = mock(SimpleValueDto.class);

    List<MutableVariable> rootVariables = mock(List.class);
    doReturn(true).when(rootVariables).isEmpty();
    doReturn(rootVariables).when(selectedVariable).getVariables();

    doReturn(promiseValue).when(debugger).getValue(selectedVariable);
    doReturn(promiseValue).when(promiseValue).then((Operation<SimpleValueDto>) any());

    presenter.onExpandVariablesTree();

    verify(promiseValue).then(operationValueCaptor.capture());
    operationValueCaptor.getValue().apply(valueDto);
    verify(view).setVariablesIntoSelectedVariable(any());
    verify(view).updateSelectedVariable();

    verify(promiseValue).catchError(operationPromiseErrorCaptor.capture());
    operationPromiseErrorCaptor.getValue().apply(promiseError);
    notificationManager.notify(any(), eq(ERROR_MESSAGE), eq(FAIL), eq(FLOAT_MODE));
    verify(constant).failedToGetVariableValueTitle();
  }

