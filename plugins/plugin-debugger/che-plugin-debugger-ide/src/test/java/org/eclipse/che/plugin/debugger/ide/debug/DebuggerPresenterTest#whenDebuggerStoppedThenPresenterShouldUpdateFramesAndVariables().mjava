  @Test
  public void whenDebuggerStoppedThenPresenterShouldUpdateFramesAndVariables() throws Exception {
    Location executionPoint = mock(Location.class);
    doReturn(THREAD_ID).when(executionPoint).getThreadId();
    doReturn(promiseThreadDump).when(debugger).getThreadDump();
    doReturn(promiseThreadDump).when(promiseThreadDump).then((Operation<List<ThreadState>>) any());
    doNothing().when(presenter).updateStackFrameDump(THREAD_ID);
    doNothing().when(presenter).updateVariables(THREAD_ID, 0);

    presenter.onBreakpointStopped(null, executionPoint);

    verify(promiseThreadDump).then(operationThreadDumpCaptor.capture());
    operationThreadDumpCaptor.getValue().apply(threadDump);
    verify(presenter).updateStackFrameDump(THREAD_ID);
    verify(presenter).updateVariables(THREAD_ID, 0);
    verify(view).setThreadDump(eq(threadDump), anyInt());
  }

