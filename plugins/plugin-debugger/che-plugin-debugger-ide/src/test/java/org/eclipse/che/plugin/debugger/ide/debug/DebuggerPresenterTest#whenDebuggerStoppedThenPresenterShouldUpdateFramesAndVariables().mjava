  @Test
  public void whenDebuggerStoppedThenPresenterShouldUpdateFramesAndVariables() throws Exception {
    Location executionPoint = mock(Location.class);
    doReturn(THREAD_ID).when(executionPoint).getThreadId();
    doReturn(promiseThreadDump).when(debugger).getThreadDump();
    doReturn(promiseThreadDump).when(promiseThreadDump).then((Operation<List<ThreadState>>) any());

    presenter.onBreakpointStopped(null, executionPoint);

    verify(promiseThreadDump).then(operationThreadDumpCaptor.capture());
    operationThreadDumpCaptor.getValue().apply(threadDump);
    verify(presenter).refreshView();
    verify(view).setThreadDump(eq(threadDump), anyLong());
  }

