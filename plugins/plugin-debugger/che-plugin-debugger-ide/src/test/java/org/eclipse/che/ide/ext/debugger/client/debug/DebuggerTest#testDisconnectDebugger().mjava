    @Test
    public void testDisconnectDebugger() throws Exception {
        doReturn(promiseVoid).when(service).disconnect(DEBUGGER_ID);
        doReturn(promiseVoid).when(promiseVoid).then((Operation<Void>)any());

        doReturn(true).when(messageBus).isHandlerSubscribed(any(), any());

        debugger.disconnectDebugger();

        assertFalse(debugger.isConnected());
        verify(localStorage).setItem(eq(AbstractDebugger.LOCAL_STORAGE_DEBUGGER_KEY), eq(""));
        verify(messageBus, times(1)).unsubscribe(anyString(), any());

        verify(promiseVoid).then(operationVoidCaptor.capture());
        verify(promiseVoid).catchError(operationPromiseErrorCaptor.capture());

        operationVoidCaptor.getValue().apply(null);
        operationPromiseErrorCaptor.getValue().apply(promiseError);
        verify(observer, times(2)).onDebuggerDisconnected();
        verify(debuggerManager, times(2)).setActiveDebugger(eq(null));
    }

