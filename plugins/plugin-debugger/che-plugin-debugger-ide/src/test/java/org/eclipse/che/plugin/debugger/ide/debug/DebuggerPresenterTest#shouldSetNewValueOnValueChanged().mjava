  @Test
  public void shouldSetNewValueOnValueChanged() throws Exception {
    SimpleValueDto valueDto = mock(SimpleValueDto.class);
    doReturn(promiseValue)
        .when(debugger)
        .getValue(eq(selectedVariable), eq(THREAD_ID), eq(FRAME_INDEX));
    doReturn(promiseValue).when(promiseValue).then((Operation<SimpleValueDto>) any());

    presenter.onValueChanged(selectedVariable, THREAD_ID, FRAME_INDEX);

    verify(promiseValue).then(operationValueCaptor.capture());
    operationValueCaptor.getValue().apply(valueDto);
    verify(debugger).getValue(eq(selectedVariable), eq(THREAD_ID), eq(FRAME_INDEX));
    verify(view).setVariableValue(selectedVariable, valueDto);
  }

