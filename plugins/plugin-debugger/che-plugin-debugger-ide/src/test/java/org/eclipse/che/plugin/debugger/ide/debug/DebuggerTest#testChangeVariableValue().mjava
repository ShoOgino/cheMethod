  @Test
  public void testChangeVariableValue() throws Exception {
    final List<String> path = mock(List.class);
    final String newValue = "new-value";

    VariablePath variablePath = mock(VariablePathDto.class);
    doReturn(path).when(variablePath).getPath();

    VariableDto variableDto = mock(VariableDto.class);
    doReturn(variableDto).when(dtoFactory).createDto(VariableDto.class);

    Variable variable = mock(Variable.class);
    doReturn(mock(VariablePathDto.class)).when(dtoFactory).createDto(VariablePathDto.class);
    doReturn(variablePath).when(variable).getVariablePath();
    doReturn(newValue).when(variable).getValue();
    doReturn(Collections.emptyList()).when(variable).getVariables();

    doReturn(promiseVoid).when(service).setValue(SESSION_ID, variableDto);
    doReturn(promiseVoid).when(promiseVoid).then((Operation<Void>) any());

    debugger.setValue(variable);

    verify(promiseVoid).then(operationVoidCaptor.capture());
    operationVoidCaptor.getValue().apply(null);
    verify(observer).onValueChanged(path, newValue);

    verify(promiseVoid).catchError(operationPromiseErrorCaptor.capture());
    operationPromiseErrorCaptor.getValue().apply(promiseError);
    verify(promiseError).getMessage();
  }

