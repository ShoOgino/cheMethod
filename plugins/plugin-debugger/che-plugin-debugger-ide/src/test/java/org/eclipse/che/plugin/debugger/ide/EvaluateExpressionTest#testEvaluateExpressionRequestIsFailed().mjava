  @Test
  public void testEvaluateExpressionRequestIsFailed() throws Exception {
    when(view.getExpression()).thenReturn(EXPRESSION);
    when(debugger.evaluate(view.getExpression(), THREAD_ID, FRAME_INDEX)).thenReturn(promise);
    when(promise.then((Operation) anyObject())).thenReturn(promise);
    when(promise.catchError(org.mockito.ArgumentMatchers.<Operation<PromiseError>>anyObject()))
        .thenReturn(promise);
    when(debuggerManager.getActiveDebugger()).thenReturn(debugger);
    when(promiseError.getMessage()).thenReturn(FAIL_REASON);

    presenter.showDialog();
    presenter.onEvaluateClicked();

    verify(view, atLeastOnce()).setEnableEvaluateButton(eq(DISABLE_BUTTON));
    verify(debugger).evaluate(EXPRESSION, THREAD_ID, FRAME_INDEX);
    verify(promise).catchError(errorCaptor.capture());

    errorCaptor.getValue().apply(promiseError);

    verify(view).setEnableEvaluateButton(eq(!DISABLE_BUTTON));
    verify(constants).evaluateExpressionFailed(FAIL_REASON);
  }

