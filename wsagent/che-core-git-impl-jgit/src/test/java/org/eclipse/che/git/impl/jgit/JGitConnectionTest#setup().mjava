  @BeforeMethod
  public void setup() {
    jGitConnection =
        spy(new JGitConnection(repository, credentialsLoader, sshKeyProvider, userResolver));

    RepositoryState repositoryState = mock(RepositoryState.class);
    GitUser gitUser = mock(GitUser.class);
    when(repositoryState.canAmend()).thenReturn(true);
    when(repositoryState.canCommit()).thenReturn(true);
    when(repository.getRepositoryState()).thenReturn(repositoryState);
    when(gitUser.getName()).thenReturn("username");
    when(gitUser.getEmail()).thenReturn("email");
    when(userResolver.getUser()).thenReturn(gitUser);
  }

