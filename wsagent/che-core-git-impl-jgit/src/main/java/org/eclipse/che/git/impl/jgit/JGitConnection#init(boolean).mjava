  @Override
  public void init(boolean isBare) throws GitException {
    File workDir = repository.getWorkTree();
    if (!workDir.exists()) {
      throw new GitException(format(ERROR_INIT_FOLDER_MISSING, workDir));
    }
    // If create fails and the .git folder didn't exist we want to remove it.
    // We have to do this here because the create command doesn't revert its own changes in case of failure.
    boolean removeIfFailed = !repository.getDirectory().exists();

    try {
      repository.create(isBare);
    } catch (IOException exception) {
      if (removeIfFailed) {
        deleteRepositoryFolder();
      }
      throw new GitException(exception.getMessage(), exception);
    }
  }

