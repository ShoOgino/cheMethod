    @Test
    public void testSendNotification() throws Exception {
        ArgumentCaptor<ServerInitializerObserver> argumentCaptor = ArgumentCaptor.forClass(ServerInitializerObserver.class);
        watcher = new LanguageServerFileWatcher(watcherManager, initializer);
        verify(initializer).addObserver(argumentCaptor.capture());
        ServerInitializerObserver value = argumentCaptor.getValue();

        LanguageServerDescription description =
                new LanguageServerDescription("foo", Collections.singletonList("bar"), Collections.emptyList(),
                                              Collections.singletonList("glob:*.foo"));
        when(launcher.getDescription()).thenReturn(description);

        WorkspaceService workspaceService = mock(WorkspaceService.class);
        when(server.getWorkspaceService()).thenReturn(workspaceService);

        value.onServerInitialized(launcher, server, null, null);

        verify(watcherManager).registerByMatcher(any(), any(), changedCaptor.capture(), any());

        changedCaptor.getValue().accept("/p/bar.foo");

        verify(workspaceService).didChangeWatchedFiles(any());

    }

