  private List<TextEditDto> formatting(DocumentFormattingParams documentFormattingParams) {
    try {
      String uri = prefixURI(documentFormattingParams.getTextDocument().getUri());
      documentFormattingParams.getTextDocument().setUri(uri);
      InitializedLanguageServer server =
          languageServerRegistry
              .getApplicableLanguageServers(uri)
              .stream()
              .flatMap(Collection::stream)
              .filter(
                  s ->
                      truish(
                          s.getInitializeResult()
                              .getCapabilities()
                              .getDocumentFormattingProvider()))
              .findFirst()
              .get();
      return server == null
          ? Collections.emptyList()
          : server
              .getServer()
              .getTextDocumentService()
              .formatting(documentFormattingParams)
              .get(5000, TimeUnit.MILLISECONDS)
              .stream()
              .map(TextEditDto::new)
              .collect(Collectors.toList());

    } catch (InterruptedException
        | ExecutionException
        | LanguageServerException
        | TimeoutException e) {
      throw new JsonRpcException(-27000, e.getMessage());
    }
  }

