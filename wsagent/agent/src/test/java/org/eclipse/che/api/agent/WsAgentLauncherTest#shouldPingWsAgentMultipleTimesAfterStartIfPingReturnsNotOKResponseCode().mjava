  @Test
  public void shouldPingWsAgentMultipleTimesAfterStartIfPingReturnsNotOKResponseCode()
      throws Exception {
    Mockito.when(pingResponse.getCode())
        .thenReturn(
            HttpURLConnection.HTTP_CREATED,
            HttpURLConnection.HTTP_NO_CONTENT,
            HttpURLConnection.HTTP_OK);

    wsAgentLauncher.launch(machine, agent);

    Mockito.verify(wsAgentHealthChecker, Mockito.times(2 + WS_AGENT_PING_SUCCESS_THRESHOLD))
        .check(any(Machine.class));
    Mockito.verify(pingResponse, Mockito.times(2 + WS_AGENT_PING_SUCCESS_THRESHOLD)).getCode();
  }

