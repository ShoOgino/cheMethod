  @Test
  public void shouldContinuePingWsAgentAfterNotConsecutiveSuccessThresholdPing() throws Exception {
    Mockito.when(wsAgentHealthChecker.check(any(Machine.class)))
        .thenReturn(pingResponse)
        .thenThrow(new ServerException(""))
        .thenReturn(pingResponse);

    wsAgentLauncher.launch(machine, agent);

    Mockito.verify(wsAgentHealthChecker, Mockito.times(2 + WS_AGENT_PING_SUCCESS_THRESHOLD))
        .check(any(Machine.class));
    Mockito.verify(pingResponse, Mockito.times(1 + WS_AGENT_PING_SUCCESS_THRESHOLD)).getCode();
  }

