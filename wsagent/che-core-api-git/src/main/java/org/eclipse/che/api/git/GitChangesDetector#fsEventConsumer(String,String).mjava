  private Consumer<String> fsEventConsumer(String endpointId, String wsPath) {
    return it -> {
      try {
        String normalizedPath = wsPath.startsWith("/") ? wsPath.substring(1) : wsPath;
        String itemPath = normalizedPath.substring(normalizedPath.indexOf("/") + 1);
        String projectName = normalizedPath.split("/")[0];
        if (!projectManager.isRegistered(absolutize(projectName))) {
          throw new NotFoundException("Project '" + projectName + "' is not found");
        }
        String projectFsPath = pathTransformer.transform(projectName).toString();
        GitConnection gitConnection = gitConnectionFactory.getConnection(projectFsPath);
        Status status = gitConnection.status(singletonList(itemPath));
        FileChangedEventDto.Status fileStatus;
        if (status.getAdded().contains(itemPath)) {
          fileStatus = ADDED;
        } else if (status.getUntracked().contains(itemPath)) {
          fileStatus = UNTRACKED;
        } else if (status.getModified().contains(itemPath)
            || status.getChanged().contains(itemPath)) {
          fileStatus = MODIFIED;
        } else {
          fileStatus = NOT_MODIFIED;
        }

        transmitter
            .newRequest()
            .endpointId(endpointId)
            .methodName(OUTGOING_METHOD)
            .paramsAsDto(
                newDto(FileChangedEventDto.class)
                    .withPath(wsPath)
                    .withStatus(fileStatus)
                    .withEditedRegions(gitConnection.getEditedRegions(itemPath)))
            .sendAndSkipResult();
      } catch (NotFoundException | ServerException e) {
        String errorMessage = e.getMessage();
        if (!("Not a git repository".equals(errorMessage))) {
          LOG.error(errorMessage);
        }
      }
    };
  }

