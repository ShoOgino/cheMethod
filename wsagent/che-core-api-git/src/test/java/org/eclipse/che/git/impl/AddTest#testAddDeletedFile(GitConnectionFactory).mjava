    @Test(dataProvider = "GitConnectionFactory", dataProviderClass = GitConnectionFactoryProvider.class)
    public void testAddDeletedFile(GitConnectionFactory connectionFactory) throws GitException, IOException {
        // given
        GitConnection connection = connectToInitializedGitRepository(connectionFactory, repository);
        addFile(connection, "README.txt", CONTENT);
        addFile(connection, "CHANGELOG.txt", "WE'VE FIXED ALL BUGS");
        connection.add(AddParams.create(ImmutableList.of("README.txt", "CHANGELOG.txt")));
        connection.commit(CommitParams.create("Initial add"));

        // when
        // remove file from disk
        deleteFile(connection, "CHANGELOG.txt");
        // add all files to index
        connection.add(AddParams.create(AddRequest.DEFAULT_PATTERN));

        // then
        // the deleted file is added to index, so it becomes removed for git
        List<String> stagedDeletedFiles = connection.status(StatusFormat.SHORT).getRemoved();
        assertEquals(stagedDeletedFiles.size(), 1);
        assertEquals(stagedDeletedFiles.get(0), "CHANGELOG.txt");
    }

