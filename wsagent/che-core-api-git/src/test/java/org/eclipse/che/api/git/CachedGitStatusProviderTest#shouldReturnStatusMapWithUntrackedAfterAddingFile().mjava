  @Test
  public void shouldReturnStatusMapWithUntrackedAfterAddingFile() throws Exception {
    // given
    OngoingStubbing<Status> whenStatusCalled =
        when(gitConnection.status(singletonList(NORMALIZED_PATH)));
    Status status = newDto(Status.class);
    status.setUntracked(new ArrayList<>(singletonList(NORMALIZED_PATH)));
    // Fill the cached status map with actual status, second call will check file changes.
    whenStatusCalled.thenReturn(newDto(Status.class));
    gitStatusProvider.getStatus(NORMALIZED_PATH, singletonList(NORMALIZED_PATH));

    // when
    // Create new file
    Files.write(projectPath.resolve(NORMALIZED_PATH), "content".getBytes());
    whenStatusCalled.thenReturn(status);
    Map<String, VcsStatus> statusMap =
        gitStatusProvider.getStatus(NORMALIZED_PATH, singletonList(NORMALIZED_PATH));

    // then
    assertTrue(statusMap.get(PATH) == UNTRACKED);
  }

