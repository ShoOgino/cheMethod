  @Test(
    dataProvider = "GitConnectionFactory",
    dataProviderClass = org.eclipse.che.git.impl.GitConnectionFactoryProvider.class
  )
  public void testDiffNameStatusWithCommits(GitConnectionFactory connectionFactory)
      throws GitException, IOException {
    //given
    GitConnection connection = connectToInitializedGitRepository(connectionFactory, repository);
    makeCommitInMaster(connection);
    //change README.txt
    connection.add(AddParams.create(AddRequest.DEFAULT_PATTERN));
    connection.rm(RmParams.create(singletonList("README.txt")));
    connection.commit(CommitParams.create("testDiffNameStatusWithCommits"));

    //when
    List<String> diff =
        readDiff(
            DiffParams.create()
                .withFileFilter(null)
                .withType(DiffType.NAME_STATUS)
                .withRenameLimit(0)
                .withCommitA("HEAD^")
                .withCommitB("HEAD"),
            connection);

    //then
    assertEquals(diff.size(), 2);
    assertTrue(diff.contains("D\tREADME.txt"));
    assertTrue(diff.contains("A\taaa"));
  }

