  @Test(
    dataProvider = "GitConnectionFactory",
    dataProviderClass = org.eclipse.che.git.impl.GitConnectionFactoryProvider.class
  )
  public void testDiffNameOnlyCached(GitConnectionFactory connectionFactory)
      throws GitException, IOException {
    // given
    GitConnection connection = connectToInitializedGitRepository(connectionFactory, repository);
    makeCommitInMaster(connection);

    // when
    connection.add(AddParams.create(singletonList("aaa")));
    List<String> diff =
        readDiff(
            DiffParams.create()
                .withFileFilter(null)
                .withType(DiffType.NAME_ONLY)
                .withNoRenames(false)
                .withRenameLimit(0)
                .withCommitA("HEAD")
                .withCached(true),
            connection);

    // then
    assertEquals(diff.size(), 1);
    assertTrue(diff.contains("aaa"));
  }

