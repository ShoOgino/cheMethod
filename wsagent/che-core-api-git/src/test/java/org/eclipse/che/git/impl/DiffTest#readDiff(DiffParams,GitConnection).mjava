  private List<String> readDiff(DiffParams params, GitConnection connection)
      throws GitException, IOException {
    DiffPage diffPage = connection.diff(params);
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    diffPage.writeTo(out);
    BufferedReader reader =
        new BufferedReader(new InputStreamReader(new ByteArrayInputStream(out.toByteArray())));

    String line;
    List<String> diff = new ArrayList<>();
    while ((line = reader.readLine()) != null) diff.add(line);

    return diff;
  }

