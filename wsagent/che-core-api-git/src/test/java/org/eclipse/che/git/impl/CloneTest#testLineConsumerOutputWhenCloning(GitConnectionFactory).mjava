  @Test(
    dataProvider = "GitConnectionFactory",
    dataProviderClass = GitConnectionFactoryProvider.class
  )
  public void testLineConsumerOutputWhenCloning(GitConnectionFactory connectionFactory)
      throws ServerException, IOException, UnauthorizedException, URISyntaxException {
    //given
    GitConnection remoteConnection =
        connectToGitRepositoryWithContent(connectionFactory, remoteRepo);
    GitConnection localConnection = connectionFactory.getConnection(localRepo.getAbsolutePath());

    LineConsumerFactory lineConsumerFactory = mock(LineConsumerFactory.class);
    LineConsumer lineConsumer = mock(LineConsumer.class);
    when(lineConsumerFactory.newLineConsumer()).thenReturn(lineConsumer);
    localConnection.setOutputLineConsumerFactory(lineConsumerFactory);

    //when
    localConnection.clone(CloneParams.create(remoteConnection.getWorkingDir().getAbsolutePath()));

    //then
    verify(lineConsumer, atLeastOnce()).writeLine(anyString());
  }

