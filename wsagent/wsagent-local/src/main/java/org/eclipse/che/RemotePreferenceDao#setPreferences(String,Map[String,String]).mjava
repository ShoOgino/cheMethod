    @Override
    public void setPreferences(String userId, Map<String, String> preferences) throws ServerException {
        requireNonNull(preferences, "Required non-null preferences");
        checkUserId(requireNonNull(userId, "Required non-null user id"));
        try {
            requestFactory.fromUrl(prefsUrl)
                          .usePostMethod()
                          .setBody(preferences)
                          .request();
        } catch (IOException | UnauthorizedException | ForbiddenException | ConflictException | NotFoundException | BadRequestException ex) {
            throw new ServerException(ex.getLocalizedMessage(), ex);
        }
    }

