  @Test
  public void closesVirtualFileSystemWhenProviderIsClosed() throws Exception {
    AtomicReference fileSystemReference = getFileSystemReference();
    VirtualFileSystem fileSystem = mock(VirtualFileSystem.class);
    fileSystemReference.set(fileSystem);

    fileSystemProvider.close();

    verify(fileSystem).close();
  }

