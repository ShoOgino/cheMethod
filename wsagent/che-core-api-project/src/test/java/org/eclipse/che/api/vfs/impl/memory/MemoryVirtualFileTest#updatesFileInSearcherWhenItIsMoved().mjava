  @Test
  public void updatesFileInSearcherWhenItIsMoved() throws Exception {
    VirtualFile file = getRoot().createFile(generateFileName(), DEFAULT_CONTENT);
    VirtualFile newParent = getRoot().createFolder(generateFolderName());
    String oldPath = file.getPath().toString();
    Mockito.reset(searcher);
    VirtualFile moved = file.moveTo(newParent);
    verify(searcher).add(moved);
    verify(searcher).delete(oldPath, true);
  }

