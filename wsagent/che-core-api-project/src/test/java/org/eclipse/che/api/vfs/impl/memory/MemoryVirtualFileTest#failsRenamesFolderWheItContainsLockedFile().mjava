    @Test
    public void failsRenamesFolderWheItContainsLockedFile() throws Exception {
        VirtualFile folder = getRoot().createFolder(generateFolderName());
        VirtualFile lockedFile = folder.createFile(generateFileName(), DEFAULT_CONTENT);
        lockedFile.lock(0);
        Path renamedFolderPath = Path.of("/new_name");

        try {
            folder.rename("new_name");
            thrown.expect(ForbiddenException.class);
        } catch (ForbiddenException e) {
            assertNull(getRoot().getChild(renamedFolderPath.newPath(lockedFile.getName())));
            assertNull(getRoot().getChild(renamedFolderPath));

            assertNotNull(getRoot().getChild(folder.getPath()));
            assertEquals(DEFAULT_CONTENT, lockedFile.getContentAsString());
            assertTrue(lockedFile.isLocked());
        }
    }

