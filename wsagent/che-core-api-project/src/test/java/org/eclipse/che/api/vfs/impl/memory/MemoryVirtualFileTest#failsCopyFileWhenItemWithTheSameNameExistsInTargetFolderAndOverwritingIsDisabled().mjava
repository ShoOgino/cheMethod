  @Test
  public void failsCopyFileWhenItemWithTheSameNameExistsInTargetFolderAndOverwritingIsDisabled()
      throws Exception {
    VirtualFile root = getRoot();
    VirtualFile file = root.createFile(generateFileName(), DEFAULT_CONTENT);
    VirtualFile targetFolder = root.createFolder(generateFolderName());
    VirtualFile conflictFile = targetFolder.createFile("existed_name", "xxx");

    try {
      file.copyTo(targetFolder, "existed_name", false);
      thrown.expect(ConflictException.class);
    } catch (ConflictException e) {
      assertEquals("xxx", conflictFile.getContentAsString());
      assertEquals(DEFAULT_CONTENT, file.getContentAsString());
    }
  }

