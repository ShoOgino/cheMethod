  @Test
  public void movesLockedFileWithLockToken() throws Exception {
    VirtualFile file = getRoot().createFile(generateFileName(), DEFAULT_CONTENT);
    String lockToken = file.lock(0);
    Path filePath = file.getPath();
    VirtualFile targetFolder = getRoot().createFolder(generateFolderName());

    VirtualFile movedFile = file.moveTo(targetFolder, null, false, lockToken);

    assertionHelper.assertThatIoFileHasContent(movedFile.getPath(), DEFAULT_CONTENT_BYTES);
    assertionHelper.assertThatLockIoFileDoesNotExist(movedFile.getPath());
    assertionHelper.assertThatIoFileDoesNotExist(filePath);
    assertionHelper.assertThatLockIoFileDoesNotExist(filePath);
  }

