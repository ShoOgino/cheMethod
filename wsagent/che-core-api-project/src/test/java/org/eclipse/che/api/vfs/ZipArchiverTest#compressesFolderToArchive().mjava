  @Test
  public void compressesFolderToArchive() throws Exception {
    VirtualFile folder = createFileTreeForArchiving();
    ByteArrayOutputStream compressedFolder = new ByteArrayOutputStream();
    Map<String, String> entries =
        getFileTreeAsList(folder)
            .stream()
            .collect(toMap(f -> getZipEntryName(folder, f), this::readContentUnchecked));

    new ZipArchiver(folder).compress(compressedFolder);
    assertThatZipArchiveContainsAllEntries(
        new ByteArrayInputStream(compressedFolder.toByteArray()), entries);
  }

