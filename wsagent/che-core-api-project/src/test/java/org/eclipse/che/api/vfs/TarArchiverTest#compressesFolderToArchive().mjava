  @Test
  public void compressesFolderToArchive() throws Exception {
    VirtualFile folder = createFileTreeForArchiving();
    ByteArrayOutputStream compressedFolder = new ByteArrayOutputStream();
    Map<String, String> entries =
        getFileTreeAsList(folder)
            .stream()
            .collect(toMap(f -> getTarEntryName(folder, f), this::readContentUnchecked));

    new TarArchiver(folder).compress(compressedFolder);
    assertThatTarArchiveContainsAllEntries(
        new ByteArrayInputStream(compressedFolder.toByteArray()), entries);
  }

