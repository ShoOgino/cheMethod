  @Test
  public void movesFileUnderNewNameAndOverwriteExistedFile() throws Exception {
    VirtualFile file = getRoot().createFile(generateFileName(), DEFAULT_CONTENT);
    file.setProperty("property1", "value1");
    Path filePath = file.getPath();
    VirtualFile targetFolder = getRoot().createFolder(generateFolderName());
    targetFolder.createFolder("new_name");

    VirtualFile movedFile = file.moveTo(targetFolder, "new_name", true, null);

    assertionHelper.assertThatMetadataIoFileHasContent(
        movedFile.getPath(), serializeVirtualFileMetadata(ImmutableMap.of("property1", "value1")));
    assertionHelper.assertThatIoFileHasContent(movedFile.getPath(), DEFAULT_CONTENT_BYTES);
    assertionHelper.assertThatIoFileDoesNotExist(filePath);
    assertionHelper.assertThatMetadataIoFileDoesNotExist(filePath);
  }

