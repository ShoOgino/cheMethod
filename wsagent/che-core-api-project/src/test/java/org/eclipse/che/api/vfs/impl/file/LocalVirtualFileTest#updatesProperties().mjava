    @Test
    public void updatesProperties() throws Exception {
        VirtualFile root = getRoot();
        VirtualFile file = root.createFile(generateFileName(), "");
        file.updateProperties(ImmutableMap.of("property1", "valueX",
                                              "new property1", "value3"));

        Map<String, String> expected = ImmutableMap.of("property1", "valueX",
                                                       "new property1", "value3");
        assertionHelper.assertThatMetadataIoFileHasContent(file.getPath(), serializeVirtualFileMetadata(expected));
        assertEquals(expected, file.getProperties());
    }

