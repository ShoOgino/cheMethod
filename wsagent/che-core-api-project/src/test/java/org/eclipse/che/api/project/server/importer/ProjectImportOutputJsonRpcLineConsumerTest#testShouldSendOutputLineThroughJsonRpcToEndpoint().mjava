  @Test
  public void testShouldSendOutputLineThroughJsonRpcToEndpoint() throws Exception {
    // given
    when(registrar.getRegisteredEndpoints()).thenReturn(Collections.singleton("endpointId"));

    final EndpointIdConfigurator endpointIdConfigurator = mock(EndpointIdConfigurator.class);
    when(requestTransmitter.newRequest()).thenReturn(endpointIdConfigurator);

    final MethodNameConfigurator methodNameConfigurator = mock(MethodNameConfigurator.class);
    when(endpointIdConfigurator.endpointId(anyString())).thenReturn(methodNameConfigurator);

    final ParamsConfigurator paramsConfigurator = mock(ParamsConfigurator.class);
    when(methodNameConfigurator.methodName(anyString())).thenReturn(paramsConfigurator);

    final SendConfiguratorFromOne sendConfiguratorFromOne = mock(SendConfiguratorFromOne.class);
    when(paramsConfigurator.paramsAsDto(any())).thenReturn(sendConfiguratorFromOne);

    // when
    consumer.sendOutputLine("message");

    // then
    verify(sendConfiguratorFromOne).sendAndSkipResult();
  }

