    @Test
    public void renamesFolder() throws Exception {
        VirtualFile folder = getRoot().createFolder(generateFolderName());
        Path folderPath = folder.getPath();
        folder.setProperty("property1", "value1");
        VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
        String fileName = file.getName();
        file.setProperty("property2", "value2");

        VirtualFile renamed = folder.rename("new_name");


        assertNotNull(getRoot().getChild(renamed.getPath()));
        assertEquals(ImmutableMap.of("property1", "value1"), renamed.getProperties());

        Path newFilePath = renamed.getPath().newPath(fileName);
        assertEquals(DEFAULT_CONTENT, getRoot().getChild(newFilePath).getContentAsString());
        assertEquals(ImmutableMap.of("property2", "value2"), getRoot().getChild(newFilePath).getProperties());

        assertNull(getRoot().getChild(folderPath.newPath(fileName)));
        assertNull(getRoot().getChild(folderPath));
    }

