  private List<VirtualFile> getFileTreeAsList(VirtualFile rootOfTree) throws Exception {
    List<VirtualFile> list = newArrayList();
    rootOfTree.accept(
        new VirtualFileVisitor() {
          @Override
          public void visit(VirtualFile virtualFile) throws ServerException {
            list.add(virtualFile);
            if (virtualFile.isFolder()) {
              for (VirtualFile child : virtualFile.getChildren()) {
                child.accept(this);
              }
            }
          }
        });
    return list;
  }

