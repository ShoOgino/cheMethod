  @Test
  public void renamesLockedFileWithLockToken() throws Exception {
    VirtualFile folder = getRoot().createFolder(generateFolderName());
    VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
    Path filePath = file.getPath();
    String lockToken = file.lock(0);

    VirtualFile renamedFile = file.rename("new name", lockToken);

    assertFalse(renamedFile.isLocked());
    assertEquals(renamedFile, getRoot().getChild(renamedFile.getPath()));
    assertEquals(DEFAULT_CONTENT, renamedFile.getContentAsString());

    assertNull(getRoot().getChild(filePath));
  }

