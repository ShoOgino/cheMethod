  @Test
  public void compressesFolderToArchiveWithFilter() throws Exception {
    VirtualFile folder = createFileTreeForArchiving();
    ByteArrayOutputStream compressedFolder = new ByteArrayOutputStream();
    Map<String, String> entries =
        getFileTreeAsList(folder)
            .stream()
            .filter(f -> f.isFolder() || f.getName().equals("_a.txt"))
            .collect(toMap(f -> getZipEntryName(folder, f), this::readContentUnchecked));

    new ZipArchiver(folder)
        .compress(compressedFolder, f -> f.isFolder() || f.getName().equals("_a.txt"));
    assertThatZipArchiveContainsAllEntries(
        new ByteArrayInputStream(compressedFolder.toByteArray()), entries);
  }

