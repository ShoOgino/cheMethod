    @Test
    public void copiesFileUnderNewName() throws Exception {
        VirtualFile root = getRoot();
        VirtualFile file = root.createFile(generateFileName(), DEFAULT_CONTENT);
        file.setProperty("property1", "value1");
        VirtualFile targetFolder = root.createFolder(generateFolderName());

        VirtualFile copy = file.copyTo(targetFolder, "new name", false);

        assertEquals(file.getContentAsString(), copy.getContentAsString());
        assertEquals(file.getProperties(), copy.getProperties());
    }

