  private void assertThatZipArchiveContainsAllEntries(InputStream in, Map<String, String> entries)
      throws Exception {
    try (ZipInputStream zip = new ZipInputStream(in)) {
      ZipEntry zipEntry;
      while ((zipEntry = zip.getNextEntry()) != null) {
        String name = zipEntry.getName();
        assertTrue(String.format("Unexpected entry %s in zip", name), entries.containsKey(name));
        if (!zipEntry.isDirectory()) {
          String content = new String(ByteStreams.toByteArray(zip));
          assertEquals(
              String.format("Invalid content of file %s", name), entries.get(name), content);
        }
        entries.remove(name);
        zip.closeEntry();
      }
    }
    assertTrue(String.format("Expected but were not found in zip %s", entries), entries.isEmpty());
  }

