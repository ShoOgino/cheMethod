  @Test
  public void failsMoveFolderWhenTargetFolderContainsItemWithTheSameNameAndOverwritingIsDisabled()
      throws Exception {
    VirtualFile folder = getRoot().createFolder(generateFolderName());
    VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
    VirtualFile targetFolder = getRoot().createFolder(generateFolderName());
    VirtualFile conflictFolder = targetFolder.createFolder(folder.getName());

    try {
      folder.moveTo(targetFolder);
      thrown.expect(ConflictException.class);
    } catch (ConflictException expected) {
      assertionHelper.assertThatIoFileDoesNotExist(
          conflictFolder.getPath().newPath(file.getName()));

      assertionHelper.assertThatIoFileExists(folder.getPath());
      assertionHelper.assertThatIoFileHasContent(file.getPath(), DEFAULT_CONTENT_BYTES);
    }
  }

