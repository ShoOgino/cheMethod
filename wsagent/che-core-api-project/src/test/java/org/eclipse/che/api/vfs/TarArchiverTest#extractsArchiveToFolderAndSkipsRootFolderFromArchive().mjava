  @Test
  public void extractsArchiveToFolderAndSkipsRootFolderFromArchive() throws Exception {
    byte[] archive = createTestTarArchive();
    VirtualFile folder = vfsRoot.createFolder("folder");
    new TarArchiver(folder).extract(new ByteArrayInputStream(archive), false, 1);

    Map<String, String> entries =
        getFileTreeAsList(folder)
            .stream()
            .collect(toMap(f -> getTarEntryName(folder, f), this::readContentUnchecked));

    Map<String, String> originalArchiveEntriesWithoutFirstPathSegment =
        readArchiveEntries(new ByteArrayInputStream(archive))
            .entrySet()
            .stream()
            .filter(e -> !"arc/".equals(e.getKey()))
            .collect(toMap(e -> e.getKey().replace("arc/", ""), Map.Entry::getValue));
    assertEquals(originalArchiveEntriesWithoutFirstPathSegment, entries);
  }

