  @Test
  public void renamesFile() throws Exception {
    VirtualFile folder = getRoot().createFolder(generateFolderName());
    VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
    file.setProperty("property1", "value1");
    Path filePath = file.getPath();

    VirtualFile renamedFile = file.rename("new name");

    assertionHelper.assertThatIoFileHasContent(renamedFile.getPath(), DEFAULT_CONTENT_BYTES);
    assertionHelper.assertThatMetadataIoFileHasContent(
        renamedFile.getPath(),
        serializeVirtualFileMetadata(ImmutableMap.of("property1", "value1")));
    assertionHelper.assertThatIoFileDoesNotExist(filePath);
    assertionHelper.assertThatMetadataIoFileDoesNotExist(filePath);
  }

