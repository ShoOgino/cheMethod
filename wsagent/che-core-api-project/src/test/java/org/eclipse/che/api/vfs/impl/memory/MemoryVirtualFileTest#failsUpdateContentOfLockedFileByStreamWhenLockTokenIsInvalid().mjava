  @Test
  public void failsUpdateContentOfLockedFileByStreamWhenLockTokenIsInvalid() throws Exception {
    VirtualFile root = getRoot();
    VirtualFile file = root.createFile(generateFileName(), DEFAULT_CONTENT);
    String invalidLockToken = invalidateLockToken(file.lock(0));

    try {
      file.updateContent(new ByteArrayInputStream("updated content".getBytes()), invalidLockToken);
      thrown.expect(ForbiddenException.class);
    } catch (ForbiddenException expected) {
      assertEquals(DEFAULT_CONTENT, file.getContentAsString());
    }
  }

