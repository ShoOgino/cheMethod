  @Test
  public void failsRenameFolderWhenParentContainsItemWithSameName() throws Exception {
    VirtualFile folder = getRoot().createFolder(generateFolderName());
    VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
    VirtualFile conflictFolder = getRoot().createFolder("new_name");

    try {
      folder.rename("new_name");
      thrown.expect(ConflictException.class);
    } catch (ConflictException expected) {
      assertNull(getRoot().getChild(conflictFolder.getPath().newPath(file.getName())));

      assertNotNull(getRoot().getChild(folder.getPath()));
      assertEquals(DEFAULT_CONTENT, file.getContentAsString());
    }
  }

