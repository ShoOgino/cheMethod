  @Test
  public void shouldInjectVcsStatusIntoListOfItemsToNestedProject() throws Exception {
    // given
    when(itemReference.getProject()).thenReturn("/project/nestedProject");
    when(itemReference.getPath()).thenReturn("/project/nestedProject/file");
    when(projectManager.get("/project/nestedProject")).thenReturn(Optional.of(project));
    when(vcsStatusProvider.getStatus("/project/nestedProject", singletonList("file")))
        .thenReturn(singletonMap("/project/nestedProject/file", ADDED));

    // when
    vcsStatusInjector.injectVcsStatus(singletonList(itemReference));

    // then
    verify(itemReference).setAttributes(argumentCaptor.capture());
    assertTrue(argumentCaptor.getValue().size() == 1);
    assertEquals(argumentCaptor.getValue().get("vcs.status"), ADDED.toString());
  }

