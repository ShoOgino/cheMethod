  @Test
  public void
      failsMoveFolderUnderNewNameWhenTargetFolderContainsItemWithTheSameNameAndOverwritingIsDisabled()
          throws Exception {
    VirtualFile folder = getRoot().createFolder(generateFolderName());
    VirtualFile file = folder.createFile(generateFileName(), DEFAULT_CONTENT);
    VirtualFile targetFolder = getRoot().createFolder(generateFolderName());
    VirtualFile conflictFolder = targetFolder.createFolder("new_name");

    try {
      folder.moveTo(targetFolder, "new_name", false, null);
      thrown.expect(ConflictException.class);
    } catch (ConflictException expected) {
      assertNull(getRoot().getChild(conflictFolder.getPath().newPath(file.getName())));

      assertNotNull(getRoot().getChild(folder.getPath()));
      assertEquals(DEFAULT_CONTENT, file.getContentAsString());
    }
  }

