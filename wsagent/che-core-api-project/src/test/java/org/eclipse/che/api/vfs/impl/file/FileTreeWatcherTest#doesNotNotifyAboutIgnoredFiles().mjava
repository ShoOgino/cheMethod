    @Test
    public void doesNotNotifyAboutIgnoredFiles() throws Exception {
        FileWatcherNotificationHandler notificationHandler = aNotificationHandler();
        PathMatcher excludeMatcher =  FileSystems.getDefault().getPathMatcher("glob:*.{foo,bar}");
        fileWatcher = new FileTreeWatcher(testDirectory, newHashSet(excludeMatcher), notificationHandler);
        fileWatcher.startup();

        Thread.sleep(500);

        String file = fileWatcherTestTree.createFile("");
        fileWatcherTestTree.createFile("", "xxx.bar");
        fileWatcherTestTree.createFile("", "xxx.foo");

        Set<String> created = newHashSet(file);

        Thread.sleep(5000);

        verify(notificationHandler, never()).errorOccurred(eq(testDirectory), any(Throwable.class));
        verify(notificationHandler, never()).handleFileWatcherEvent(eq(DELETED), eq(testDirectory), anyString(), anyBoolean());
        verify(notificationHandler, never()).handleFileWatcherEvent(eq(MODIFIED), eq(testDirectory), anyString(), anyBoolean());

        ArgumentCaptor<String> createdEvents = ArgumentCaptor.forClass(String.class);
        verify(notificationHandler, times(1)).handleFileWatcherEvent(eq(CREATED), eq(testDirectory), createdEvents.capture(), anyBoolean());
        assertEquals(newHashSet(created), newHashSet(createdEvents.getAllValues()));
    }

