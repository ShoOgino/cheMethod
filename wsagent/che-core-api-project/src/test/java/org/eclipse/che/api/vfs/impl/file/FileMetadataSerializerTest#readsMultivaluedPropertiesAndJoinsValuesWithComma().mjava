  @Test
  public void readsMultivaluedPropertiesAndJoinsValuesWithComma() throws Exception {
    DataInput data = mock(DataInput.class);
    when(data.readInt()).thenReturn(2, 3, 3);
    when(data.readUTF()).thenReturn("a", "x", "y", "z", "b", "z", "y", "x");
    Map<String, String> expected =
        ImmutableMap.of(
            "a", "x,y,z",
            "b", "z,y,x");
    assertEquals(expected, metadataSerializer.read(data));
  }

