    /**
     * Creates RegisteredProject and caches it.
     *
     * @param config
     *         project config
     * @param folder
     *         base folder of project
     * @param updated
     *         whether this configuration was updated
     * @param detected
     *         whether this is automatically detected or explicitly defined project
     * @return project
     * @throws ServerException
     * @throws ConflictException
     * @throws NotFoundException
     */
    RegisteredProject putProject(ProjectConfig config,
                                 FolderEntry folder,
                                 boolean updated,
                                 boolean detected) throws ServerException,
                                                          ConflictException,
                                                          NotFoundException {
        final RegisteredProject project = new RegisteredProject(folder, config, updated, detected, this.projectTypeRegistry);
        Optional<RegisteredProject> updatedProjectOptional = Optional.ofNullable(projects.put(project.getPath(), project));

        // check whether it isn't during #initProjects()
        if (initialized) {
            if (updatedProjectOptional.isPresent()) {
                workspaceHolder.updateProject(project);
            } else {
                workspaceHolder.addProject(project);
            }
        }

        return project;
    }

