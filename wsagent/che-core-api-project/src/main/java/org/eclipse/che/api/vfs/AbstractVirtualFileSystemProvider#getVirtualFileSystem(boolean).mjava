  @Override
  public VirtualFileSystem getVirtualFileSystem(boolean create) throws ServerException {
    VirtualFileSystem fileSystem = fileSystemReference.get();
    if (fileSystem == null && create) {
      VirtualFileSystem newFileSystem =
          createVirtualFileSystem(() -> fileSystemReference.set(null));
      fileSystemReference.compareAndSet(null, newFileSystem);
      fileSystem = fileSystemReference.get();
    }
    return fileSystem;
  }

