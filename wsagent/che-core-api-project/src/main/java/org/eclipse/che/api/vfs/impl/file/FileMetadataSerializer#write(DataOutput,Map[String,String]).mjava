  @Override
  public void write(DataOutput output, Map<String, String> props) throws IOException {
    output.writeInt(props.size());
    for (Map.Entry<String, String> entry : props.entrySet()) {
      String value = entry.getValue();
      if (value != null) {
        final String name = entry.getKey();
        output.writeUTF(name);
        final List<String> asList = Splitter.on(',').splitToList(value);
        output.writeInt(asList.size());
        for (String single : asList) {
          output.writeUTF(single);
        }
      }
    }
  }

