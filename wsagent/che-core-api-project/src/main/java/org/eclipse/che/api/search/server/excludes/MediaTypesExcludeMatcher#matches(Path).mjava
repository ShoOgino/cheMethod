  @Override
  public boolean matches(Path fsPath) {
    if (!fsPath.toFile().exists()) {
      return false;
    }

    if (!fsPath.toFile().isFile()) {
      return false;
    }

    if (fsPath.toFile().length() == 0) {
      return false;
    }

    String wsPath = pathTransformer.transform(fsPath);

    MediaType mimeType;
    try (InputStream content = fsManager.read(wsPath)) {
      mimeType = new TikaConfig().getDetector().detect(content, new Metadata());
    } catch (TikaException
        | IOException
        | NotFoundException
        | ServerException
        | ConflictException e0) {
      try {
        // https://issues.apache.org/jira/browse/TIKA-2395
        byte[] content = fsManager.readAsString(wsPath).getBytes();
        ByteArrayInputStream bais = new ByteArrayInputStream(content);
        mimeType = new TikaConfig().getDetector().detect(bais, new Metadata());
      } catch (TikaException
          | IOException
          | NotFoundException
          | ServerException
          | ConflictException e1) {
        return true;
      }
    }

    return excludedMediaTypes.contains(mimeType) || excludedTypes.contains(mimeType.getType());
  }

