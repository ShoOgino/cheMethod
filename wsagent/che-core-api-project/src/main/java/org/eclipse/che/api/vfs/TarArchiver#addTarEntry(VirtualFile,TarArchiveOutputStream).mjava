    private void addTarEntry(VirtualFile virtualFile, TarArchiveOutputStream tarOutputStream) throws ServerException {
        try {
            TarArchiveEntry tarEntry = new TarArchiveEntry(getTarEntryName(virtualFile));
            if (virtualFile.isFolder()) {
                tarEntry.setModTime(0);
                tarOutputStream.putArchiveEntry(tarEntry);
            } else {
                tarEntry.setSize(virtualFile.getLength());
                tarEntry.setModTime(virtualFile.getLastModificationDate());
                tarOutputStream.putArchiveEntry(tarEntry);
                try (InputStream content = virtualFile.getContent()) {
                    ByteStreams.copy(content, tarOutputStream);
                }
            }
            tarOutputStream.closeArchiveEntry();
        } catch (ForbiddenException e) {
            throw new ServerException(e.getServiceError());
        } catch (IOException e) {
            throw new ServerException(e.getMessage(), e);
        }
    }

