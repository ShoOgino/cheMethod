  @Override
  public VirtualFile unlock(String lockToken) throws ForbiddenException, ConflictException {
    checkExistence();
    if (isFile()) {
      final LockHolder theLock = lock;
      if (theLock == null) {
        throw new ConflictException("File is not locked");
      } else if (isExpired(theLock)) {
        lock = null;
        throw new ConflictException("File is not locked");
      }
      if (theLock.lockToken.equals(lockToken)) {
        lock = null;
        lastModificationDate = System.currentTimeMillis();
      } else {
        throw new ForbiddenException("Unable remove lock from file. Lock token does not match");
      }
      lastModificationDate = System.currentTimeMillis();
      return this;
    } else {
      throw new ForbiddenException(
          String.format("Unable unlock '%s'. Locking allowed for files only", getPath()));
    }
  }

