  String lock(LocalVirtualFile virtualFile, long timeout)
      throws ForbiddenException, ConflictException, ServerException {
    if (virtualFile.isFile()) {
      final PathLockFactory.PathLock pathLock =
          pathLockFactory.getLock(virtualFile.getPath(), true).acquire(WAIT_FOR_FILE_LOCK_TIMEOUT);
      try {
        return doLock(virtualFile, timeout);
      } finally {
        pathLock.release();
      }
    } else {
      throw new ForbiddenException(
          String.format("Unable lock '%s'. Locking allowed for files only", virtualFile.getPath()));
    }
  }

