    Map<String, String> getProperties(LocalVirtualFile virtualFile) throws ServerException {
        final PathLockFactory.PathLock metadataFilePathLock =
                pathLockFactory.getLock(virtualFile.getPath(), false).acquire(WAIT_FOR_FILE_LOCK_TIMEOUT);
        try {
            return newLinkedHashMap(metadataCache.get(virtualFile.getPath()));
        } catch (ExecutionException e) {
            String errorMessage = String.format("Unable read properties of file '%s'", virtualFile.getPath());
            LOG.error(errorMessage + "\n" + e.getCause().getMessage(), e.getCause());
            throw new ServerException(errorMessage);
        } finally {
            metadataFilePathLock.release();
        }
    }

