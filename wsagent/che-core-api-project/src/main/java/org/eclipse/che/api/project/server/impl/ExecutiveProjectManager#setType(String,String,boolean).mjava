  @Override
  public synchronized RegisteredProject setType(String wsPath, String type, boolean asMixin)
      throws ConflictException, NotFoundException, ServerException, BadRequestException,
          ForbiddenException {

    RegisteredProject registeredProject = projectConfigRegistry.getOrNull(wsPath);

    if (registeredProject == null) {
      NewProjectConfig newProjectConfig =
          new NewProjectConfigImpl(
              wsPath, type, new ArrayList<>(), nameOf(wsPath), nameOf(wsPath), null, null, null);
      return projectConfigRegistry.put(newProjectConfig, true, true);
    }

    List<String> newMixins = registeredProject.getMixins();
    String newType = registeredProject.getType();
    if (asMixin) {
      if (!newMixins.contains(type)) {
        newMixins.add(type);
      }
    } else {
      newType = type;
    }

    NewProjectConfig newProjectConfig =
        new NewProjectConfigImpl(
            registeredProject.getPath(),
            newType,
            newMixins,
            registeredProject.getName(),
            registeredProject.getDescription(),
            registeredProject.getAttributes(),
            null,
            registeredProject.getSource());

    return projectConfigRegistry.put(newProjectConfig, true, registeredProject.isDetected());
  }

