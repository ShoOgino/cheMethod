  @SuppressWarnings("unchecked")
  public LocalVirtualFileSystem(
      File ioRoot,
      ArchiverFactory archiverFactory,
      SearcherProvider searcherProvider,
      AbstractVirtualFileSystemProvider.CloseCallback closeCallback) {
    this.ioRoot = ioRoot;
    this.archiverFactory = archiverFactory;
    this.searcherProvider = searcherProvider;
    this.closeCallback = closeCallback;

    root = new LocalVirtualFile(ioRoot, Path.ROOT, this);
    pathLockFactory = new PathLockFactory(FILE_LOCK_MAX_THREADS);

    locksSerializer = new FileLockSerializer();
    lockTokensCache =
        CacheBuilder.newBuilder()
            .concurrencyLevel(8)
            .maximumSize(256)
            .expireAfterAccess(10, MINUTES)
            .build(new LockTokenCacheLoader());

    metadataSerializer = new FileMetadataSerializer();
    metadataCache =
        CacheBuilder.newBuilder()
            .concurrencyLevel(8)
            .maximumSize(256)
            .expireAfterAccess(10, MINUTES)
            .build(new FilePropertiesCacheLoader());
  }

