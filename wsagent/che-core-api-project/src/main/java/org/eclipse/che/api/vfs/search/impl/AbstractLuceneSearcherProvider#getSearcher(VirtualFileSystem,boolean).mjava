    @Override
    public Searcher getSearcher(VirtualFileSystem virtualFileSystem, boolean create) throws ServerException {
        Searcher cachedSearcher = searcherReference.get();
        if (cachedSearcher == null && create) {
            LuceneSearcher searcher = createLuceneSearcher(() -> searcherReference.set(null));
            if (searcherReference.compareAndSet(null, searcher)) {
                searcher.init(virtualFileSystem);
            }
            cachedSearcher = searcherReference.get();
        }
        return cachedSearcher;
    }

