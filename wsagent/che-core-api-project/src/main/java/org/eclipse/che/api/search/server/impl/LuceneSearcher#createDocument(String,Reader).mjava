  private Document createDocument(String wsPath, Reader reader) throws ServerException {
    String name = nameOf(wsPath);
    Document doc = new Document();
    doc.add(new StringField(PATH_FIELD, wsPath, Field.Store.YES));
    doc.add(new TextField(NAME_FIELD, name, Field.Store.YES));
    try {
      doc.add(new TextField(TEXT_FIELD, CharStreams.toString(reader), Field.Store.YES));
    } catch (MalformedInputException e) {
      LOG.warn("Can't index file: {}", wsPath);
    } catch (IOException e) {
      LOG.error("Can't index file: {}", wsPath);
      throw new ServerException(e.getLocalizedMessage(), e);
    }
    return doc;
  }

