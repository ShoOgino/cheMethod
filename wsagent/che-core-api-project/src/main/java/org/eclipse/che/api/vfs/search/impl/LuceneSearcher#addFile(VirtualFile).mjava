  protected void addFile(VirtualFile virtualFile) throws ServerException {
    if (virtualFile.exists()) {
      try (Reader fContentReader =
          shouldIndexContent(virtualFile)
              ? new BufferedReader(new InputStreamReader(virtualFile.getContent()))
              : null) {
        getIndexWriter()
            .updateDocument(
                new Term(PATH_FIELD, virtualFile.getPath().toString()),
                createDocument(virtualFile, fContentReader));
      } catch (OutOfMemoryError oome) {
        close();
        throw oome;
      } catch (IOException e) {
        throw new ServerException(e.getMessage(), e);
      } catch (ForbiddenException e) {
        throw new ServerException(e.getServiceError());
      }
    }
  }

