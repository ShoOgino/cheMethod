  private void doCopy(LocalVirtualFile from, LocalVirtualFile to) throws ServerException {
    try {
      // First copy metadata (properties) for source. If we do in this way and fail cause to any i/o
      // or other error client
      // will see error and may try to copy again. But if we successfully copy tree (or single file)
      // and then fail to copy
      // metadata client may not try to copy again because copy destination already exists.

      final File fromMetadataFile = getMetadataIoFile(from.getPath());
      final File toMetadataFile = getMetadataIoFile(to.getPath());
      if (fromMetadataFile.exists()) {
        IoUtil.copy(fromMetadataFile, toMetadataFile, null);
      }

      IoUtil.copy(from.toIoFile(), to.toIoFile(), VFS_LOCK_FILTER);
    } catch (IOException e) {
      String errorMessage = String.format("Unable copy '%s' to '%s'", from, to);
      LOG.error(errorMessage + "\n" + e.getMessage(), e);
      throw new ServerException(errorMessage);
    }
  }

