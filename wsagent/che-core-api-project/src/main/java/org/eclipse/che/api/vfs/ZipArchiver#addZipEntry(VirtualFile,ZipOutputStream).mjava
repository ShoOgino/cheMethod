  private void addZipEntry(VirtualFile virtualFile, ZipOutputStream zipOutputStream)
      throws ServerException {
    try {
      ZipEntry zipEntry = new ZipEntry(getZipEntryName(virtualFile));
      zipOutputStream.putNextEntry(zipEntry);
      if (virtualFile.isFolder()) {
        zipEntry.setTime(0);
      } else {
        try (InputStream content = virtualFile.getContent()) {
          ByteStreams.copy(content, zipOutputStream);
        }
        zipEntry.setTime(virtualFile.getLastModificationDate());
      }
      zipOutputStream.closeEntry();
    } catch (ForbiddenException e) {
      throw new ServerException(e.getServiceError());
    } catch (IOException e) {
      throw new ServerException(e.getMessage(), e);
    }
  }

