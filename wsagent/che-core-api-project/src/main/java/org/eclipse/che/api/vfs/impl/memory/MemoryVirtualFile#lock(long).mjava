  @Override
  public String lock(long timeout) throws ForbiddenException, ConflictException {
    checkExistence();
    if (isFile()) {
      if (this.lock != null) {
        throw new ConflictException("File already locked");
      }
      final String lockToken = NameGenerator.generate(null, 32);
      this.lock = new LockHolder(lockToken, timeout);
      lastModificationDate = System.currentTimeMillis();
      return lockToken;
    } else {
      throw new ForbiddenException(
          String.format("Unable lock '%s'. Locking allowed for files only", getPath()));
    }
  }

