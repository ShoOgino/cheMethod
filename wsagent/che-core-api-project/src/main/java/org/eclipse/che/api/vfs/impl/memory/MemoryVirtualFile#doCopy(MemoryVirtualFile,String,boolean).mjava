    private VirtualFile doCopy(MemoryVirtualFile parent, String newName, boolean overwrite)
            throws ConflictException, ForbiddenException, ServerException {
        if (overwrite) {
            MemoryVirtualFile existedItem = parent.children.get(newName);
            if (existedItem != null) {
                existedItem.delete();
            }
        }

        MemoryVirtualFile virtualFile;
        if (isFile()) {
            virtualFile = newFile(parent, newName, Arrays.copyOf(content, content.length));
        } else {
            virtualFile = newFolder(parent, newName);
            for (VirtualFile child : getChildren()) {
                child.copyTo(virtualFile);
            }
        }

        virtualFile.properties.putAll(this.properties);

        if (parent.addChild(virtualFile)) {
            return virtualFile;
        }
        throw new ConflictException(String.format("Item '%s' already exists", parent.getPath().newPath(newName)));
    }

