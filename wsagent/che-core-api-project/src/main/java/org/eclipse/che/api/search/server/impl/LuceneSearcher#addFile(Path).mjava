  private void addFile(Path fsPath) throws ServerException {
    if (!fsPath.toFile().exists()) {
      return;
    }

    if (!isNotExcluded(fsPath)) {
      return;
    }

    String wsPath = pathTransformer.transform(fsPath);

    try (Reader reader =
        new BufferedReader(new InputStreamReader(new FileInputStream(fsPath.toFile()), "utf-8"))) {
      luceneIndexWriter.updateDocument(
          new Term(PATH_FIELD, wsPath), createDocument(wsPath, reader));
    } catch (OutOfMemoryError oome) {
      doTerminate();
      throw oome;
    } catch (IOException e) {
      throw new ServerException(e.getMessage(), e);
    }
  }

