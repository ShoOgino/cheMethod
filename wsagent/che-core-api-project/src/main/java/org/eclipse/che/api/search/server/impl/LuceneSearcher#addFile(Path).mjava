  private void addFile(Path fsPath) {
    if (!fsPath.toFile().exists()) {
      return;
    }

    if (!isNotExcluded(fsPath)) {
      return;
    }
    String wsPath = pathTransformer.transform(fsPath);
    LOG.debug("Adding file {} ", wsPath);

    try (Reader reader =
        new BufferedReader(new InputStreamReader(new FileInputStream(fsPath.toFile()), "utf-8"))) {
      String name = nameOf(wsPath);
      Document doc = new Document();
      doc.add(new StringField(PATH_FIELD, wsPath, Field.Store.YES));
      doc.add(new SortedDocValuesField(PATH_FIELD, new BytesRef(wsPath)));
      doc.add(new TextField(NAME_FIELD, name, Field.Store.YES));
      try {
        doc.add(new TextField(TEXT_FIELD, CharStreams.toString(reader), Field.Store.YES));
      } catch (MalformedInputException e) {
        LOG.warn("Can't index file: {}", wsPath);
      }
      luceneIndexWriter.updateDocument(new Term(PATH_FIELD, wsPath), doc);

    } catch (IOException oome) {
      LOG.warn("Can't index file: {}", wsPath);
    }
  }

