  @Override
  public VirtualFile updateProperties(Map<String, String> update, String lockToken)
      throws ForbiddenException {
    checkExistence();
    if (isFile() && fileIsLockedAndLockTokenIsInvalid(lockToken)) {
      throw new ForbiddenException(
          String.format("Unable update properties of item '%s'. Item is locked", getPath()));
    }
    for (Map.Entry<String, String> entry : update.entrySet()) {
      if (entry.getValue() == null) {
        properties.remove(entry.getKey());
      } else {
        properties.put(entry.getKey(), entry.getValue());
      }
    }
    lastModificationDate = System.currentTimeMillis();
    return this;
  }

