  @Override
  public final void delete(Path fsPath) throws ServerException {
    String wsPath = pathTransformer.transform(fsPath);
    try {
      if (fsPath.toFile().isFile()) {
        Term term = new Term(PATH_FIELD, wsPath);
        luceneIndexWriter.deleteDocuments(term);
      } else {
        Term term = new Term(PATH_FIELD, wsPath + '/');
        luceneIndexWriter.deleteDocuments(new PrefixQuery(term));
      }
    } catch (OutOfMemoryError oome) {
      doTerminate();
      throw oome;
    } catch (IOException e) {
      throw new ServerException(e.getMessage(), e);
    }
  }

