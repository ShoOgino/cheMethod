  @Override
  public void update(String wsPath, BiConsumer<InputStream, OutputStream> updater)
      throws NotFoundException, ConflictException, ServerException {
    Path fsPath = pathTransformer.transform(wsPath);
    Path tmpFsPath = pathTransformer.transform(wsPath + ".tmp");

    try {
      try (InputStream input = fsOperations.read(fsPath);
          OutputStream output = fsOperations.write(tmpFsPath)) {
        updater.accept(input, output);
      }

      fsOperations.deleteIfExists(fsPath);
      fsOperations.move(tmpFsPath, fsPath);
    } catch (IOException e) {
      throw new ServerException(e);
    }
  }

