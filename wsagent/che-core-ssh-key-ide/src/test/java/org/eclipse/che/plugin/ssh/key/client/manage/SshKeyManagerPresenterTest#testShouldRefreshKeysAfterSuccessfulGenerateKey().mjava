  @Test
  public void testShouldRefreshKeysAfterSuccessfulGenerateKey() throws OperationException {
    List<SshPairDto> sshPairDtoArray = new ArrayList<>();
    when(dialogFactory.createInputDialog(
            nullable(String.class),
            nullable(String.class),
            nullable(InputCallback.class),
            nullable(CancelCallback.class)))
        .thenReturn(inputDialog);

    presenter.onGenerateClicked();

    verify(dialogFactory)
        .createInputDialog(
            nullable(String.class), nullable(String.class),
            inputCallbackCaptor.capture(), cancelCallbackCaptor.capture());
    InputCallback inputCallback = inputCallbackCaptor.getValue();
    inputCallback.accepted(GITHUB_HOST);

    verify(sshPairDTOPromise).then(operationSshPairDTOCapture.capture());
    operationSshPairDTOCapture.getValue().apply(null);

    verify(sshPairDTOsPromise).then(operationSshPairDTOsCapture.capture());
    operationSshPairDTOsCapture.getValue().apply(sshPairDtoArray);

    verify(service)
        .generatePair(Matchers.eq(SshKeyManagerPresenter.VCS_SSH_SERVICE), eq(GITHUB_HOST));
    verify(service).getPairs(Matchers.eq(SshKeyManagerPresenter.VCS_SSH_SERVICE));
    verify(view).setPairs(eq(sshPairDtoArray));
  }

