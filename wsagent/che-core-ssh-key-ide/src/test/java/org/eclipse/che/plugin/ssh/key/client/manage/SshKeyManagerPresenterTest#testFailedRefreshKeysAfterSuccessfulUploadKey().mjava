  @Test
  public void testFailedRefreshKeysAfterSuccessfulUploadKey() throws OperationException {
    List<SshPairDto> sshPairDtoArray = new ArrayList<>();

    presenter.onUploadClicked();

    verify(uploadSshKeyPresenter).showDialog(asyncCallbackCaptor.capture());
    AsyncCallback<Void> asyncCallback = asyncCallbackCaptor.getValue();
    asyncCallback.onSuccess(null);

    verify(sshPairDTOsPromise).catchError(operationErrorCapture.capture());
    operationErrorCapture.getValue().apply(JsPromiseError.create(""));

    verify(service).getPairs(eq(SshKeyManagerPresenter.VCS_SSH_SERVICE));
    verify(view, never()).setPairs(eq(sshPairDtoArray));
  }

