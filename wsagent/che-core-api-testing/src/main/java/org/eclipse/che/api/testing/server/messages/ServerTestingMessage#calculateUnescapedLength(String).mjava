  private static int calculateUnescapedLength(String text) {
    int result = 0;
    int length = text.length();

    for (int i = 0; i < length; i++) {
      char c = text.charAt(i);
      if (c == ESCAPE_SEPARATOR && i < length - 1) {
        char nextChar = text.charAt(i + 1);
        if (unescape(nextChar) != 0) {
          i++;
        }
      }
      result++;
    }
    return result;
  }

