    /** @see GitCommand#execute() */
    @Override
    public Void execute() throws GitException {
        if (message == null) {
            throw new GitException("Message wasn't set");
        }
        if (committer == null) {
            throw new GitException("Committer can't be null");
        }
        if (committer.getName() == null || committer.getEmail() == null) {
            throw new GitException("Git user name and (or) email wasn't set", ErrorCodes.NO_COMMITTER_NAME_OR_EMAIL_DEFINED);
        }
        reset();
        commandLine.add("commit");
        if (amend) {
            commandLine.add("--amend");
        }
        if (all) {
            commandLine.add("-a");
        }
        Path commitMsgFile = null;
        if (message.contains("\n")) {
            try {
                commitMsgFile = Files.createTempFile("git-commit-message-", null);
                Files.write(commitMsgFile, message.getBytes());
                commandLine.add("-F", commitMsgFile.toString());
            } catch (IOException e) {
                // allow to commit but message will be in 'one-line' format
                commandLine.add("-m", message);
            }
        } else if (SystemInfo.isWindows()) {
            commandLine.add(String.format("-m \"%s\"", message));
        } else {
            commandLine.add("-m", message);
        }

        setCommandEnvironment("GIT_COMMITTER_NAME", committer.getName());
        setCommandEnvironment("GIT_COMMITTER_EMAIL", committer.getEmail());

        String name;
        String email;
        if (author != null) {
            name = author.getName();
            email = author.getEmail();
        } else {
            name = committer.getName();
            email = committer.getEmail();
        }

        if (SystemInfo.isWindows()) {
            commandLine.add(String.format("--author=\"%s <%s>\"", name, email));
        } else {
            commandLine.add(String.format("--author=%s \\<%s>", name, email));
        }

        if (files != null) {
            commandLine.add(files);
        }

        start();
        if (commitMsgFile != null) {
            try {
                Files.deleteIfExists(commitMsgFile);
            } catch (IOException e) {
                LOG.error("Can not delete temporary file with commit message", e);
            }
        }
        return null;
    }

