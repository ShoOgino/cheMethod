    @BeforeMethod
    public void setUp() throws Exception {
        requestTokenExtractor = new HeaderRequestTokenExtractor();
        machineLoginFilter = new MachineLoginFilter(API_ENDPOINT, requestFactoryMock, requestTokenExtractor);
        httpJsonRequestMock = mock(HttpJsonRequest.class, new SelfReturningAnswer());
        EnvironmentContext.reset();
        when(requestFactoryMock.fromUrl(anyString())).thenReturn(httpJsonRequestMock);
        when(httpJsonRequestMock.request()).thenReturn(jsonResponseMock);
        when(httpJsonRequestMock.useGetMethod().setAuthorizationHeader(anyString())).thenReturn(httpJsonRequestMock);
        when(userMock.getName()).thenReturn(USERNAME);
        when(userMock.getId()).thenReturn(USER_ID);
        machineSubject = new SubjectImpl(USERNAME,
                                         USER_ID,
                                         MACHINE_TOKEN,
                                         false);
    }

