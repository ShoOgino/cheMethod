    @Test
    public void shouldNotProcessingRequestWithInvalidTokenAndShowUnauthorisedServletResponse() throws Exception {
        // token service response mocking
        when(jsonResponseMock.asDto(UserDto.class)).thenReturn(userMock);
        // mocking for setting the principal in http session
        doNothing().when(sessionMock).setAttribute(anyString(), any());
        when(httpJsonRequestMock.request()).thenThrow(new NotFoundException("User with token " + MACHINE_TOKEN + " Not found"));

        machineLoginFilter.doFilter(getRequestMock(null, MACHINE_TOKEN), servletResponseMock, chainMock);

        verify(servletResponseMock).sendError(HttpServletResponse.SC_UNAUTHORIZED,
                                              "Authentication on machine failed, token " + MACHINE_TOKEN + " is invalid");
    }

