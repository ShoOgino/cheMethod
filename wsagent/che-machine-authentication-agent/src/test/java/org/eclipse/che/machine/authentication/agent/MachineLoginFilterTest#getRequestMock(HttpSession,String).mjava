    // if the session is null it means that there will be created new one
    private HttpServletRequest getRequestMock(HttpSession session, String token) {
        final HttpServletRequest request = mock(HttpServletRequest.class);
        when(request.getSession(false)).thenReturn(session);
        when(request.getSession(true)).thenReturn(sessionMock);
        when(request.getHeader(HttpHeaders.AUTHORIZATION)).thenReturn(token);
        return request;
    }

