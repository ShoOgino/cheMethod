  @Test
  public void shouldProcessingRequestThenCreateHttpSessionAndPutUserIntoHttpSession()
      throws Exception {
    // token service response mocking
    when(jsonResponseMock.asDto(UserDto.class)).thenReturn(userMock);
    // mocking for setting the principal in http session
    doNothing().when(sessionMock).setAttribute(anyString(), any());

    machineLoginFilter.doFilter(
        getRequestMock(null, MACHINE_TOKEN), servletResponseMock, chainMock);

    verify(sessionMock).setAttribute("principal", machineSubject);
  }

