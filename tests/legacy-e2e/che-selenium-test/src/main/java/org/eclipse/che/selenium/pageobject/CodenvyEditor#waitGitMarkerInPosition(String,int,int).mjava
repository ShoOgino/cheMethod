  /**
   * Wait specific git marker at giving positions. Since operation is not atomic the {@link
   * StaleElementReferenceException} might occur. That's why it is necessary to give one more try
   * until throwing an exception.
   *
   * @param marker the marker to wait
   * @param startLine the first line of git marker
   * @param endLine the last line of git marker
   */
  public void waitGitMarkerInPosition(String marker, int startLine, int endLine) {
    seleniumWebDriverHelper.waitNoExceptions(
        () ->
            seleniumWebDriverHelper.waitSuccessCondition(
                webDriver -> {
                  List<String> classAttrs;

                  for (int i = 0; ; i++) {
                    try {
                      classAttrs =
                          getListGitMarkers()
                              .stream()
                              .map(webElement -> webElement.getAttribute("class"))
                              .collect(toList());
                      break;
                    } catch (StaleElementReferenceException e) {
                      if (i == 2) {
                        throw e;
                      }
                    }
                  }

                  for (int i = 0; i < classAttrs.size(); i++) {
                    if (startLine - 1 <= i && i <= endLine - 1) {
                      if (!marker.equals(classAttrs.get(i))) {
                        return false;
                      }
                    }
                  }

                  return true;
                },
                REDRAW_UI_ELEMENTS_TIMEOUT_SEC),
        StaleElementReferenceException.class);
  }

