  private <R> Promise<R> doAfterKeycloakInitAndUpdate(Sender<R> sender) {
    return keycloakProvider
        .getUpdatedToken(5)
        .thenPromise(
            new Function<String, Promise<R>>() {
              @Override
              public Promise<R> apply(String keycloakToken) {
                addAuthorizationHeader(keycloakToken);
                try {
                  return sender.doSend();
                } catch (Throwable t) {
                  Log.error(getClass(), t);
                  throw t;
                }
              }
            });
  }

