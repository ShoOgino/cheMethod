  @Test
  public void shouldSend401IfTokenIsExpired() throws Exception {
    when(tokenExtractor.getToken(any(HttpServletRequest.class))).thenReturn("token");
    when(jwtParser.parse(anyString())).thenThrow(ExpiredJwtException.class);

    authenticationFilter.doFilter(request, response, chain);

    verify(response).setStatus(401);
    verify(servletOutputStream).write(eq("The specified token is expired".getBytes()));
    verifyNoMoreInteractions(chain);
  }

