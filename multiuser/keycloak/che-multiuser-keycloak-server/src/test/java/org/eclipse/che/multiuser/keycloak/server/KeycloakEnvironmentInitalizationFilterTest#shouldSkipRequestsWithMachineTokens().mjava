  @Test
  public void shouldSkipRequestsWithMachineTokens() throws Exception {

    EnvironmentContext context = EnvironmentContext.getCurrent();
    // given
    when(tokenExtractor.getToken(any(HttpServletRequest.class))).thenReturn("machine123123token");

    // when
    filter.doFilter(request, response, chain);

    // then
    verify(chain).doFilter(eq(request), eq(response));
    verifyNoMoreInteractions(userManager);
    verifyNoMoreInteractions(context);
  }

