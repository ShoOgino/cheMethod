  @BeforeMethod
  public void setup() throws Exception {
    final KeyPairGenerator kpg = KeyPairGenerator.getInstance("RSA");
    kpg.initialize(512);
    final KeyPair keyPair = kpg.generateKeyPair();
    final Map<String, Object> header = new HashMap<>();
    header.put("kind", MACHINE_TOKEN_KIND);
    machineToken =
        Jwts.builder()
            .setPayload("payload")
            .setHeader(header)
            .signWith(RS256, keyPair.getPrivate())
            .compact();

    when(signatureKeyManager.getKeyPair()).thenReturn(keyPair);
    when(request.getRequestURI()).thenReturn(null);
  }

