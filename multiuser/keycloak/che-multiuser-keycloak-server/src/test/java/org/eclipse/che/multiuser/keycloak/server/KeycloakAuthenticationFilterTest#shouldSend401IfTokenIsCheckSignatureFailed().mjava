  @Test
  public void shouldSend401IfTokenIsCheckSignatureFailed() throws Exception {
    when(tokenExtractor.getToken(any(HttpServletRequest.class))).thenReturn("token");
    when(jwtParser.parse(anyString())).thenThrow(new JwtException("bad signature"));

    authenticationFilter.doFilter(request, response, chain);

    verify(response).setStatus(401);
    verify(servletOutputStream).write(eq("Token validation failed: bad signature".getBytes()));
    verifyNoMoreInteractions(chain);
  }

