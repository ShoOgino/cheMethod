  private User getOrCreateUser(String id, String email, String username)
      throws ServerException, ConflictException {
    try {
      return userManager.getById(id);
    } catch (NotFoundException e) {
      synchronized (this) {
        final UserImpl cheUser = new UserImpl(id, email, username, generate("", 12), emptyList());
        try {
          return userManager.create(cheUser, false);
        } catch (ConflictException ex) {
          cheUser.setName(generate(cheUser.getName(), 4));
          return userManager.create(cheUser, false);
        }
      }
    }
  }

