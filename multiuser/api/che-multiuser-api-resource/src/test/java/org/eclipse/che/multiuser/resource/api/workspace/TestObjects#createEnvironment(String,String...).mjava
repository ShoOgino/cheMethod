  public static EnvironmentImpl createEnvironment(String devMachineRam, String... machineRams)
      throws Exception {
    Map<String, ExtendedMachineImpl> machines = new HashMap<>();
    machines.put(
        "dev-machine",
        new ExtendedMachineImpl(
            singletonList("org.eclipse.che.ws-agent"),
            emptyMap(),
            singletonMap("memoryLimitBytes", Long.toString(Size.parseSize(devMachineRam)))));
    HashMap<String, ComposeServiceImpl> services = new HashMap<>(1 + machineRams.length);
    services.put("dev-machine", createService());
    for (int i = 0; i < machineRams.length; i++) {
      services.put("machine" + i, createService());
      // null is allowed to reproduce situation with default RAM size
      if (machineRams[i] != null) {
        machines.put(
            "machine" + i,
            new ExtendedMachineImpl(
                null,
                null,
                singletonMap("memoryLimitBytes", Long.toString(Size.parseSize(machineRams[i])))));
      }
    }
    ComposeEnvironment composeEnvironment = new ComposeEnvironment();
    composeEnvironment.setServices(services);
    String yaml = YAML_PARSER.writeValueAsString(composeEnvironment);
    EnvironmentRecipeImpl recipe =
        new EnvironmentRecipeImpl("compose", "application/x-yaml", yaml, null);

    return new EnvironmentImpl(recipe, machines);
  }

