  @BeforeClass
  public void setupEntities() throws Exception {
    recipe =
        new OldRecipeImpl(
            "recipe1",
            "test",
            "creator",
            "dockerfile",
            "FROM test",
            singletonList("test"),
            "test recipe");
    users = new UserImpl[3];
    for (int i = 0; i < 3; i++) {
      users[i] = new UserImpl("user" + i, "user" + i + "@test.com", "username" + i);
    }
    recipePermissions = new RecipePermissionsImpl[3];
    for (int i = 0; i < 3; i++) {
      recipePermissions[i] =
          new RecipePermissionsImpl(users[i].getId(), recipe.getId(), asList("read", "update"));
    }

    Injector injector = Guice.createInjector(new MultiuserMachineJpaModule(), new JpaTestModule());

    manager = injector.getInstance(EntityManager.class);
    recipeDao = injector.getInstance(JpaRecipeDao.class);
    recipePermissionsDao = injector.getInstance(JpaRecipePermissionsDao.class);

    subscriber = injector.getInstance(RemovePermissionsBeforeRecipeRemovedEventSubscriber.class);
    subscriber.subscribe();
  }

