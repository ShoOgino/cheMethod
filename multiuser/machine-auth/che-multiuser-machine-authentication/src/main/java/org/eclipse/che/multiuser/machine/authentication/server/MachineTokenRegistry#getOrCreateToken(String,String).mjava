  /**
   * Gets or creates machine security token for user and workspace. For running workspace, there is
   * always at least one token for user who performed start.
   *
   * @param userId id of user to get token
   * @param workspaceId id of workspace to get token
   * @return machine security token for for given user and workspace
   */
  public String getOrCreateToken(String userId, String workspaceId) {
    lock.writeLock().lock();
    try {
      final Map<String, String> wsRow = tokens.row(workspaceId);
      String token = wsRow.get(userId);

      if (token == null) {
        token = generate("machine", 128);
        tokens.put(workspaceId, userId, token);
      }
      return token;
    } finally {
      lock.writeLock().unlock();
    }
  }

