  @Override
  public Object invoke(MethodInvocation invocation) throws Throwable {
    Workspace workspaceToStart = (Workspace) invocation.getArguments()[0];
    // generate machine token for user who starts the workspace
    String workspaceId = workspaceToStart.getId();

    tokenRegistry.generateToken(
        EnvironmentContext.getCurrent().getSubject().getUserId(), workspaceId);
    try {
      return invocation.proceed();
    } catch (Exception e) {
      tokenRegistry.removeTokens(workspaceId);
      throw e;
    }
  }

