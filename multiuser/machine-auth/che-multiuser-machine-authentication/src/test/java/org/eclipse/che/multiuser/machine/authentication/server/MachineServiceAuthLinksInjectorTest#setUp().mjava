  @BeforeMethod
  public void setUp() throws Exception {
    final UriBuilder uriBuilder = new UriBuilderImpl();
    uriBuilder.uri(URI_BASE);
    requestMock = mock(HttpJsonRequest.class, new SelfReturningAnswer());
    when(requestFactoryMock.fromUrl(anyString())).thenReturn(requestMock);
    machineLinksInjector = new MachineAuthLinksInjector(API_ENDPOINT, requestFactoryMock);
    when(serviceContextMock.getBaseUriBuilder()).thenReturn(uriBuilder);
    when(serverDtoMock.getRef()).thenReturn(TERMINAL_REFERENCE);
    when(serverDtoMock.getUrl()).thenReturn(URI_BASE);
    when(machineRuntimeInfoDtoMock.getServers())
        .thenReturn(ImmutableMap.of("server", serverDtoMock));
  }

