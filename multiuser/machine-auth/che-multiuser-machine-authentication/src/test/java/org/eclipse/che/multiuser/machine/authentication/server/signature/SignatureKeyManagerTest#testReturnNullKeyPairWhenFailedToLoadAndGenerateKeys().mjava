  @Test
  public void testReturnNullKeyPairWhenFailedToLoadAndGenerateKeys() throws Exception {
    doReturn(new Page<>(emptyList(), 0, 1, 0)).when(signatureKeyDao).getAll(anyInt(), anyLong());
    when(signatureKeyDao.create(any(SignatureKeyPairImpl.class)))
        .thenThrow(new ServerException("unexpected end of stack"));

    final KeyPair cachedPair = signatureKeyManager.getKeyPair();

    verify(signatureKeyDao).getAll(anyInt(), anyLong());
    verify(signatureKeyDao).create(any(SignatureKeyPairImpl.class));
    assertNull(cachedPair);
  }

