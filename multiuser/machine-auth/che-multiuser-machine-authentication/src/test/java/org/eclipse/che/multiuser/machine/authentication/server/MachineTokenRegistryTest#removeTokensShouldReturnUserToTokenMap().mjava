  @Test
  public void removeTokensShouldReturnUserToTokenMap() throws Exception {
    final MachineTokenRegistry registry = new MachineTokenRegistry();

    final Map<String, String> userToToken = new HashMap<>();
    userToToken.put("user1", registry.getOrCreateToken("user1", "workspace123"));
    userToToken.put("user2", registry.getOrCreateToken("user2", "workspace123"));
    userToToken.put("user3", registry.getOrCreateToken("user3", "workspace123"));
    final String tokenNotToRemove = registry.getOrCreateToken("user1", "workspace234");

    final Map<String, String> removedTokens = registry.removeTokens("workspace123");

    assertEquals(removedTokens, userToToken);

    assertEquals(registry.getOrCreateToken("user1", "workspace234"), tokenNotToRemove);
    assertFalse(
        registry.getOrCreateToken("user1", "workspace123").equals(userToToken.get("user1")));
    assertFalse(
        registry.getOrCreateToken("user2", "workspace123").equals(userToToken.get("user2")));
    assertFalse(
        registry.getOrCreateToken("user2", "workspace123").equals(userToToken.get("user3")));
  }

