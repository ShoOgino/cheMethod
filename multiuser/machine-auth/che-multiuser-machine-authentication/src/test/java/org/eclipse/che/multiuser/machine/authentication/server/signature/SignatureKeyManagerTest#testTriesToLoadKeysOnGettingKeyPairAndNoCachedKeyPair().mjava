  @Test
  public void testTriesToLoadKeysOnGettingKeyPairAndNoCachedKeyPair() throws Exception {
    String wsId = "WS_id_1";
    final SignatureKeyPairImpl kp = newKeyPair(wsId);
    when(signatureKeyDao.create(any(SignatureKeyPairImpl.class))).thenReturn(kp);
    when(signatureKeyDao.get(anyString())).thenThrow(new NotFoundException("not found"));

    signatureKeyManager.getKeyPair("ws1");

    verify(signatureKeyDao).get(anyString());
    verify(signatureKeyDao).create(any(SignatureKeyPairImpl.class));
  }

