  @Test(expectedExceptions = ServerException.class)
  public void testThrowsExceptionWhenFailedToLoadAndGenerateKeys() throws Exception {
    doThrow(NotFoundException.class).when(signatureKeyDao).get(anyString());
    when(signatureKeyDao.create(any(SignatureKeyPairImpl.class)))
        .thenThrow(new ServerException("unexpected end of stack"));

    signatureKeyManager.getKeyPair("ws1");

    verify(signatureKeyDao).get(anyString());
    verify(signatureKeyDao).create(any(SignatureKeyPairImpl.class));
  }

