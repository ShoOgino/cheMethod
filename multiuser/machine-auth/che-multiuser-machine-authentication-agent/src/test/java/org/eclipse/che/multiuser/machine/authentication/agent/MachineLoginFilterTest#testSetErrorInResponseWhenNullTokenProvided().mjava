  @Test
  public void testSetErrorInResponseWhenNullTokenProvided() throws Exception {
    when(tokenExtractorMock.getToken(any(HttpServletRequest.class))).thenReturn(null);

    machineLoginFilter.doFilter(getRequestMock(null, machineToken), responseMock, chainMock);

    verify(tokenExtractorMock).getToken(any(HttpServletRequest.class));
    verify(responseMock)
        .sendError(SC_UNAUTHORIZED, "Authentication on machine failed, token is missed.");
  }

