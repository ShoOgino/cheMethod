  @Test
  public void testProcessRequestWithValidTokenAndCreateSession() throws Exception {
    machineLoginFilter.doFilter(getRequestMock(null, machineToken), responseMock, chainMock);

    verify(tokenExtractorMock).getToken(any(HttpServletRequest.class));
    verify(sessionMock).setAttribute(PRINCIPAL, subject);
    verifyZeroInteractions(responseMock);
  }

