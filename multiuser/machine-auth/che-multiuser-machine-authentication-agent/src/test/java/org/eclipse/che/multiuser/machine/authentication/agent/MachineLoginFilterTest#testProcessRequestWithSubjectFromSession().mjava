  @Test
  public void testProcessRequestWithSubjectFromSession() throws Exception {
    when(sessionMock.getAttribute(PRINCIPAL)).thenReturn(subject);

    machineLoginFilter.doFilter(getRequestMock(sessionMock, machineToken), responseMock, chainMock);

    verify(sessionMock).getAttribute(PRINCIPAL);
    verifyZeroInteractions(tokenExtractorMock);
  }

