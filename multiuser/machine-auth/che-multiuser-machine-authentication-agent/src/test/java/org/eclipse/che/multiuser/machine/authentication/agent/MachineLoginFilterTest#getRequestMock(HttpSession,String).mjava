  // if the session is null it means that there will be created new one
  private HttpServletRequest getRequestMock(HttpSession session, String token) {
    final HttpServletRequest request = mock(HttpServletRequest.class);
    lenient().when(request.getSession(false)).thenReturn(session);
    lenient().when(request.getSession(true)).thenReturn(sessionMock);
    lenient().when(request.getHeader(HttpHeaders.AUTHORIZATION)).thenReturn(token);
    return request;
  }

