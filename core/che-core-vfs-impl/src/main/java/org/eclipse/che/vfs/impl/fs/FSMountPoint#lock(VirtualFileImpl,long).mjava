    String lock(VirtualFileImpl virtualFile, long timeout) throws ForbiddenException, ConflictException, ServerException {
        if (!virtualFile.isFile()) {
            throw new ForbiddenException(String.format("Unable lock '%s'. Locking allowed for files only. ", virtualFile.getPath()));
        }

        if (!hasPermission(virtualFile, BasicPermissions.WRITE.value(), true)) {
            throw new ForbiddenException(String.format("Unable lock '%s'. Operation not permitted. ", virtualFile.getPath()));
        }
        return doLock(virtualFile, timeout);
    }

