    public void update(List<AccessControlEntry> acl, boolean override) {
        if (acl.isEmpty() && !override) {
            // Nothing to do if there is no updates and override flag is not set.
            return;
        }

        if (override) {
            // remove all existed permissions
            permissionMap.clear();
        }

        for (AccessControlEntry ace : acl) {
            final Principal principal = DtoFactory.getInstance().clone(ace.getPrincipal());
            List<String> acePermissions = ace.getPermissions();
            if (acePermissions == null || acePermissions.isEmpty()) {
                permissionMap.remove(principal);
            } else {
                Set<String> permissions = permissionMap.get(principal);
                if (permissions == null) {
                    permissionMap.put(principal, permissions = new HashSet<>(4));
                } else {
                    permissions.clear();
                }
                permissions.addAll(acePermissions);
            }
        }
    }

