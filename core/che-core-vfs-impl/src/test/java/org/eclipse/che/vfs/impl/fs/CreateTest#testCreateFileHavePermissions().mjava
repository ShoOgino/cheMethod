    public void testCreateFileHavePermissions() throws Exception {
        String name = "testCreateFileHavePermissions";
        String content = "test create file";
        ByteArrayContainerResponseWriter writer = new ByteArrayContainerResponseWriter();
        String requestPath = SERVICE_URI + "file/" + protectedFolderId + '?' + "name=" + name;
        // Replace default principal by principal who has write permission.
        EnvironmentContext.getCurrent().setUser(new UserImpl("andrew", "andrew", null, Arrays.asList("workspace/developer"), false));
        // --
        ContainerResponse response =
                launcher.service(HttpMethod.POST, requestPath, BASE_URI, null, content.getBytes(), writer, null);
        assertEquals("Error: " + response.getEntity(), 200, response.getStatus());
        String expectedPath = protectedFolderPath + '/' + name;
        assertTrue("File was not created in expected location. ", exists(expectedPath));
        assertEquals(content, new String(readFile(expectedPath)));
    }

