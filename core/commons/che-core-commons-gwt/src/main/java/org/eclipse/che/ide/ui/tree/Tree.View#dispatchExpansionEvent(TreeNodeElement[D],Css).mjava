        private void dispatchExpansionEvent(TreeNodeElement<D> treeNode, Css css) {

            // Is the node opened or closed?
            if (treeNode.isOpen()) {
                getDelegate().onNodeClosed(treeNode);
            } else {

                // We might have set the CSS to say it is closed, but the animation
                // takes a little while. As such, we check to make sure the children
                // container is set to display:none before trying to dispatch an open.
                // Otherwise we can get into an inconsistent state if we click really
                // fast.
                Element childrenContainer = treeNode.getChildrenContainer();
                if (childrenContainer != null /*&& !CssUtils.isVisible(childrenContainer)*/) {
                    getDelegate().onNodeExpanded(treeNode);
                }
            }
        }

