    @Test
    public void shouldBeAbleToSetEnvContextInSameThread() {
        //given
        EnvironmentContext expected = EnvironmentContext.getCurrent();
        expected.setWorkspaceId("ws1");
        expected.setWorkspaceTemporary(true);
        expected.setSubject(new SubjectImpl("user", "id", "token", Collections.singleton("role"), false));

        EnvironmentContext actual = EnvironmentContext.getCurrent();
        assertEquals(actual.getWorkspaceId(), "ws1");
        assertTrue(actual.isWorkspaceTemporary());
        Subject actualSubject = actual.getSubject();
        assertEquals(actualSubject.getUserName(), "user");
        assertEquals(actualSubject.getUserId(), "id");
        assertEquals(actualSubject.getToken(), "token");
        assertTrue(actualSubject.isMemberOf("role"));
        assertFalse(actualSubject.isTemporary());
    }

