    @Test
    public void shouldBeAbleToSetEnvContextInSameThread() {
        //given
        EnvironmentContext expected = EnvironmentContext.getCurrent();
        expected.setAccountId("acc1");
        expected.setWorkspaceId("ws1");
        expected.setWorkspaceTemporary(true);
        expected.setUser(new UserImpl("user", "id", "token", Collections.singleton("role"), false));

        EnvironmentContext actual = EnvironmentContext.getCurrent();
        assertEquals(actual.getAccountId(), "acc1");
        assertEquals(actual.getWorkspaceId(), "ws1");
        assertTrue(actual.isWorkspaceTemporary());
        User actualUser = actual.getUser();
        assertEquals(actualUser.getName(), "user");
        assertEquals(actualUser.getId(), "id");
        assertEquals(actualUser.getToken(), "token");
        assertTrue(actualUser.isMemberOf("role"));
        assertFalse(actualUser.isTemporary());
    }

