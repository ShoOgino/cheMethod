    private static void addDirectoryRecursively(ZipOutputStream zipOut, String parentPath, File dir, FilenameFilter filter)
            throws IOException {
        final int parentPathLength = parentPath.length() + 1;
        final LinkedList<File> q = new LinkedList<>();
        q.add(dir);
        while (!q.isEmpty()) {
            final File current = q.pop();
            final File[] list = current.listFiles();
            if (list != null) {
                for (File f : list) {
                    if (filter.accept(current, f.getName())) {
                        final String entryName = f.getAbsolutePath().substring(parentPathLength).replace('\\', '/');
                        if (f.isDirectory()) {
                            addDirectoryEntry(zipOut, entryName);
                            q.push(f);
                        } else if (f.isFile()) {
                            addFileEntry(zipOut, entryName, f);
                        }
                    }
                }
            }
        }
    }

