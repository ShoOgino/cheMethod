    private void doAddBreakpoint(VirtualFile activeFile, Breakpoint breakpoint) {
        String path = breakpoint.getPath();

        List<Breakpoint> fileBreakpoints = breakpoints.get(path);
        if (fileBreakpoints == null) {
            fileBreakpoints = new ArrayList<Breakpoint>();
            breakpoints.put(path, fileBreakpoints);
        }

        fileBreakpoints.add(breakpoint);

        final BreakpointRenderer breakpointRenderer = getBreakpointRendererForFile(activeFile);
        if (breakpointRenderer != null) {
            breakpointRenderer.addBreakpointMark(breakpoint.getLineNumber(), new LineChangeAction() {
                @Override
                public void onLineChange(VirtualFile file, int firstLine, int linesAdded, int linesRemoved) {
                    BreakpointManagerImpl.this.onLineChange(file, firstLine, linesAdded, linesRemoved);
                }
            });
            breakpointRenderer.setBreakpointActive(breakpoint.getLineNumber(), breakpoint.isActive());
        }

        preserveBreakpoints();
    }

