    private void renderChildren(Node parent) {
        int depth = nodeStorage.getDepth(parent);
        List<Node> children = parent == null ? nodeStorage.getRootItems() : nodeStorage.getChildren(parent);
        if (children.size() == 0) {
            emptyText.paint();
            return;
        }

        Element container = getContainer(parent);

        if (container == null) {
            return;
        }

        for (Node child : children) {
            Element element = renderNode(child, depth);
            container.appendChild(element);
        }

        for (Node child : children) {
            NodeDescriptor nodeDescriptor = getNodeDescriptor(child);
            if (autoExpand) {
                setExpanded(child, true);
            } else if (nodeDescriptor.isExpand() && !isLeaf(nodeDescriptor.getNode())) {
                nodeDescriptor.setExpand(false);
                setExpanded(child, true);
            } else if (nodeLoader != null) {
                if (autoLoad) {
                    if (nodeLoader.mayHaveChildren(child)) {
                        nodeLoader.loadChildren(child);
                    }
                }
            } else if (autoLoad) {
                renderChildren(child);
            }
        }

        if (parent == null) {
            ensureFocusElement();
        }
        update();
    }

