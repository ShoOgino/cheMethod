    private String register(Node node) {
        String id = getUniqueId(node);
        if (nodeStorage.getNodeMap().containsKey(id)) {
            NodeDescriptor nodeDescriptor = nodeStorage.getNodeMap().get(id);
            if (nodeDescriptor.getDomId() == null || nodeDescriptor.getDomId().isEmpty()) {
                String domId = Document.get().createUniqueId();
                nodeDescriptor.setDomId(domId);
            }
            nodeDescriptor.reset();
            nodeDescriptor.clearElements();
            nodesByDom.put(nodeDescriptor.getDomId(), nodeDescriptor);
            return nodeDescriptor.getDomId();
        } else {
            NodeDescriptor nodeDescriptor = nodeStorage.wrap(node);
            String domId = Document.get().createUniqueId();
            nodeDescriptor.setDomId(domId);

            nodesByDom.put(nodeDescriptor.getDomId(), nodeDescriptor);
            return domId;
        }
    }

