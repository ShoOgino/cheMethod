    /*
     * @see org.eclipse.jface.text.IDocument#addPosition(java.lang.String, org.eclipse.jface.text.Position)
     */
    @Override
    public void addPosition(String category, TypedPosition position) throws BadLocationException,
                                                                    BadPositionCategoryException {

        if ((0 > position.offset) || (0 > position.length) || (position.offset + position.length > this.contentLength)) {
            throw new BadLocationException();
        }

        if (category == null) {
            throw new BadPositionCategoryException();
        }

        final List<TypedPosition> list = this.positions.get(category);
        if (list == null) {
            throw new BadPositionCategoryException();
        }
        list.add(computeIndexInPositionList(list, position.offset, true), position);

        final List<TypedPosition> endPositions = this.endPositions.get(category);
        if (endPositions == null) {
            throw new BadPositionCategoryException();
        }
        endPositions.add(computeIndexInPositionList(endPositions,
                                                    position.offset + position.length - 1,
                                                    false),
                         position);
    }

