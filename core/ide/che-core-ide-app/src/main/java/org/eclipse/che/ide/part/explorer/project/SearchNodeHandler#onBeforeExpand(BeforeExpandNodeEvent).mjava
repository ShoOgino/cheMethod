    @Override
    public void onBeforeExpand(BeforeExpandNodeEvent event) {
        if (!isInSearchMode()) {
            return;
        }

        Node node = event.getNode();

        if (tree.isExpanded(node)) {

            if (forceUpdate) {
                tree.getNodeLoader().loadChildren(node);
                return;
            }

            List<Node> children = tree.getNodeStorage().getChildren(node);

            for (Node child : children) {
                if (!(child instanceof HasStorablePath)) {
                    continue;
                }

                String childPath = ((HasStorablePath)child).getStorablePath();
                if (path.getStorablePath().equals(childPath)) {
                    callback.onSuccess(child);
                    inSearchMode = false;
                    return;
                } else if (path.getStorablePath().startsWith(childPath + (child.isLeaf() ? "" : "/"))) {
                    event.setCancelled(true); //disallow to continue expanding current node
                    tree.setExpanded(child, true);
                    return;
                }
            }

            //node wasn't found, try to make request to load the same children, may be there is a new nodes on server were created
            tree.getNodeLoader().loadChildren(node);
        }
    }

