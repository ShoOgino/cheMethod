    @Test
    public void moduleShouldBeCreated() {
        Selection selection = mock(Selection.class);
        //noinspection unchecked
        when(selectionAgent.getSelection()).thenReturn(selection);
        when(dtoUnmarshallerFactory.newUnmarshaller(ProjectConfigDto.class)).thenReturn(projectConfigUnmarshallable);
        prepareWizard(CREATE_MODULE);

        wizard.complete(completeCallback);

        verify(projectServiceClient).updateProject(eq(devMachine), anyString(), eq(dataObject), callbackCaptor.capture());
        GwtReflectionUtils.callOnSuccess(callbackCaptor.getValue(), projectConfig);

        verify(eventBus).fireEvent(Matchers.<ModuleCreatedEvent>anyObject());
        verify(completeCallback).onCompleted();
    }

