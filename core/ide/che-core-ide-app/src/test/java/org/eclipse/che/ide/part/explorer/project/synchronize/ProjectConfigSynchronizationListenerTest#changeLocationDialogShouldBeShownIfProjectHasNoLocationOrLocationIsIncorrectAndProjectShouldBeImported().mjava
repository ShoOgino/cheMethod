    @Test
    public void changeLocationDialogShouldBeShownIfProjectHasNoLocationOrLocationIsIncorrectAndProjectShouldBeImported() {
        when(sourceStorage.getLocation()).thenReturn(null);
        ProjectProblemDto problem = newDto(ProjectProblemDto.class).withCode(10);

        problems.add(problem);

        listener.onBeforeExpand(event);

        verify(dialogFactory).createConfirmDialog(anyString(),
                                                  anyString(),
                                                  anyString(),
                                                  anyString(),
                                                  confirmCaptor.capture(),
                                                  Matchers.<CancelCallback>anyObject());
        confirmCaptor.getValue().accepted();

        verify(locale).locationDialogTitle();
        verify(dialogFactory).createConfirmDialog(anyString(),
                                                  eq(changeLocationWidget),
                                                  confirmCaptor.capture(),
                                                  Matchers.<CancelCallback>anyObject());

        confirmCaptor.getValue().accepted();

        verify(changeLocationWidget).getText();
        verify(sourceStorage).setLocation(anyString());

        verify(projectImporter).checkFolderExistenceAndImport(Matchers.<Wizard.CompleteCallback>anyObject(), eq(projectConfig));
    }

