    @Test
    public void shouldUseRunningDevMachine() throws Exception {
        when(machineDescriptor.getStatus()).thenReturn(MachineStatus.RUNNING);

        devMachineLauncher.startDevMachine(startedCallback);

        verify(machineServiceClient).getMachines(anyString());
        verify(machinesPromise).then(machinesCaptor.capture());

        machinesCaptor.getValue().apply(Collections.singletonList(machineDescriptor));
        verify(machineConfigDescriptor).isDev();

        verify(machineDescriptor).getStatus();
        verify(appContext).setDevMachineId(DEV_MACHINE_ID);
        verify(appContext).setWsAgentURL(WS_AGENT_URL + "/pathToWsAgent");

        verify(machineManager).onMachineRunning(DEV_MACHINE_ID);
        verify(startedCallback).onStarted();
    }

