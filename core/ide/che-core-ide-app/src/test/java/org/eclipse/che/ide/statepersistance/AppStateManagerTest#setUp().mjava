    @Before
    public void setUp() {
        WorkspaceDto usersWorkspaceDto = mock(WorkspaceDto.class);
        when(appContext.getWorkspace()).thenReturn(usersWorkspaceDto);
        when(usersWorkspaceDto.getId()).thenReturn(WS_ID);
        when(preferencesManager.getValue(PREFERENCE_PROPERTY_NAME)).thenReturn(JSON);
        when(dtoFactory.createDtoFromJson(JSON, AppState.class)).thenReturn(appState);

        Map<String, WorkspaceState> workspaceStates = new HashMap<>();
        workspaceStates.put(WS_ID, workspaceState);

        when(appState.getWorkspaces()).thenReturn(workspaceStates);

        Set<PersistenceComponent> persistenceComponents = new HashSet<>(Collections.singletonList(persistenceComponent));

        appStateManager = new AppStateManager(persistenceComponents,
                                              preferencesManager,
                                              appContext,
                                              dtoFactory,
                                              actionManager,
                                              presentationFactory,
                                              perspectiveManagerProvider,
                                              eventBus);
    }

