  private boolean checkPort(int port) {
    if (portsInUse.putIfAbsent(port, Boolean.TRUE) == null) {
      ServerSocket ss = null;
      DatagramSocket ds = null;
      try {
        ss = new ServerSocket(port);
        ds = new DatagramSocket(port);
        LOG.debug("Acquire port {}", port);
        return true;
      } catch (IOException ignored) {
        portsInUse.remove(port);
      } finally {
        if (ds != null) {
          ds.close();
        }
        if (ss != null) {
          try {
            ss.close();
          } catch (IOException ignored) {
          }
        }
      }
    }
    return false;
  }

