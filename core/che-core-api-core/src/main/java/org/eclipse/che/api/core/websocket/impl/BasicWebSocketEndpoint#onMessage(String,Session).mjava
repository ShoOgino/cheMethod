  @OnMessage
  public void onMessage(String message, Session session) {
    Optional<String> endpointIdOptional = registry.get(session);

    String combinedEndpointId;
    if (endpointIdOptional.isPresent()) {
      combinedEndpointId = endpointIdOptional.get();

      LOG.debug("Receiving a web socket message.");
      LOG.debug("Endpoint: {}", combinedEndpointId);
      LOG.debug("Message: {}", message);

    } else {
      combinedEndpointId = getOrGenerateCombinedEndpointId(session);

      LOG.warn("Processing messing within unidentified session");
    }
    receiver.receive(combinedEndpointId, message);
  }

