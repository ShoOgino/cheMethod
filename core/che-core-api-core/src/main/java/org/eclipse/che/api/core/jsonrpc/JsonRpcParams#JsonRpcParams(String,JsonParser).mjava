    @AssistedInject
    public JsonRpcParams(@Assisted("message") String message, JsonParser jsonParser) {
        this.jsonParser = jsonParser;

        checkNotNull(message, "Message must not be null");
        checkArgument(!message.isEmpty(), "Message must not be empty");

        JsonElement jsonElement = jsonParser.parse(message);
        if (jsonElement.isJsonArray()) {
            JsonArray jsonArray = jsonParser.parse(message).getAsJsonArray();
            this.params = new ArrayList<>(jsonArray.size());
            for (JsonElement element : jsonArray) {
                if (element.isJsonPrimitive()) {
                    JsonPrimitive primitiveElement = element.getAsJsonPrimitive();
                    Param<?> paramCandidate;
                    if (primitiveElement.isBoolean()) {
                        paramCandidate = new Param<>(Boolean.class, primitiveElement.getAsBoolean());
                    } else if (primitiveElement.isNumber()) {
                        paramCandidate = new Param<>(Double.class, primitiveElement.getAsDouble());
                    } else {
                        paramCandidate = new Param<>(String.class, primitiveElement.getAsString());
                    }
                    this.params.add(paramCandidate);
                } else {
                    this.params.add(new Param<>(Object.class, element.getAsJsonObject()));
                }
            }

            this.param = null;
        } else if (jsonElement.isJsonPrimitive()) {
            JsonPrimitive primitiveElement = jsonElement.getAsJsonPrimitive();
            if (primitiveElement.isBoolean()) {
                this.param = new Param<>(Boolean.class, primitiveElement.getAsBoolean());
            } else if (primitiveElement.isNumber()) {
                this.param = new Param<>(Double.class, primitiveElement.getAsDouble());
            } else {
                this.param = new Param<>(String.class, primitiveElement.getAsString());
            }

            this.params = null;
        } else if (jsonElement.isJsonObject()) {
            this.param = new Param<>(Object.class, jsonElement.getAsJsonObject());

            this.params = null;
        } else {
            this.params = null;
            this.param = null;
        }
    }

