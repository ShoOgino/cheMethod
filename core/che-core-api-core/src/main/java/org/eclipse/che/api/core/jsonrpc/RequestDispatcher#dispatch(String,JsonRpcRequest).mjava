    public void dispatch(String endpointId, JsonRpcRequest request) throws JsonRpcException {
        checkNotNull(endpointId, "Endpoint ID must not be null");
        checkArgument(!endpointId.isEmpty(), "Endpoint ID must not be empty");
        checkNotNull(request, "Request must not be null");

        LOG.debug("Dispatching request: {}, endpoint: {}", request, endpointId);

        String method = request.getMethod();
        JsonRpcParams params = request.getParams();

        if (request.hasId()) {
            LOG.debug("Request has ID");

            String id = request.getId();
            RequestHandler handler = registry.getRequestHandler(method);
            checkHandler(method, handler, id);
            JsonRpcResult result = handler.handle(endpointId, params);
            JsonRpcResponse response = factory.createResponse(id, result, null);

            LOG.debug("Transmitting back a response: {}", response);
            transmitter.transmit(endpointId, response.toString());
        } else {
            LOG.debug("Request has no ID -> it is a notification");

            NotificationHandler handler = registry.getNotificationHandler(method);
            checkHandler(method, handler, null);
            handler.handle(endpointId, params);
        }
    }

