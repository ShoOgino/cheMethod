    @Override
    public Object invokeMethod(Object resource, GenericMethodResource genericMethodResource, ApplicationContext context) {
        WSConnection wsConnection = (WSConnection)org.everrest.core.impl.EnvironmentContext.getCurrent().get(WSConnection.class);
        if (wsConnection != null) {

            EnvironmentContext environmentContext = (EnvironmentContext)wsConnection.getAttribute(ENVIRONMENT_CONTEXT);
            if (environmentContext != null) {
                try {

                    EnvironmentContext.setCurrent(environmentContext);

                    LOG.debug("Websocket {} in http session {} context of ws {} is temporary {}",
                             wsConnection.getId(),
                             wsConnection.getHttpSession(),
                             EnvironmentContext.getCurrent().getWorkspaceName(),
                             EnvironmentContext.getCurrent().isWorkspaceTemporary());
                    return super.invokeMethod(resource, genericMethodResource, context);
                } finally {
                    EnvironmentContext.reset();
                }
            } else {
                LOG.warn("EnvironmentContext  is null");
            }
        }
        return super.invokeMethod(resource, genericMethodResource, context);
    }

