  private static String toJson(Object event) throws Exception {
    final String type = event.getClass().getName();
    final JsonValue json = JsonGenerator.createJsonObject(event);
    json.addElement("$type", new StringValue(type));
    final Writer w = new StringWriter();
    json.writeTo(new JsonWriter(w));
    return w.toString();
  }

