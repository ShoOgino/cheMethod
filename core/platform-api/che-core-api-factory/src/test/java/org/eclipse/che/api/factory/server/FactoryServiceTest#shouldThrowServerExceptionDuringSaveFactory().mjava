    @Test
    public void shouldThrowServerExceptionDuringSaveFactory() throws Exception {
        // given
        Factory factory = prepareFactoryWithGivenStorage("git", "http://github.com/codenvy/che-core.git");
        URL resource = Thread.currentThread().getContextClassLoader().getResource("100x100_image.jpeg");
        assertNotNull(resource);
        Path path = Paths.get(resource.toURI());
        doThrow(IOException.class).when(factoryStore).saveFactory(any(Factory.class), anySetOf(FactoryImage.class));

        // when, then
        Response response = given().auth()
                               .basic(JettyHttpServer.ADMIN_USER_NAME, JettyHttpServer.ADMIN_USER_PASSWORD)
                               .multiPart("factory", JsonHelper.toJson(factory), MediaType.APPLICATION_JSON)
                               .multiPart("image", path.toFile(), "image/jpeg")
                               .when()
                               .post("/private" + SERVICE_PATH);
        assertEquals(response.getStatusCode(), Status.INTERNAL_SERVER_ERROR.getStatusCode());
    }

