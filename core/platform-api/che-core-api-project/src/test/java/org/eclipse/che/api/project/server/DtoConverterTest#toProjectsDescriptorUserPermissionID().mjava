    /**
     * Check user permission is based on userID and not username.
     *
     * @throws Exception
     *         if something is going wrong
     */
    @Test
    public void toProjectsDescriptorUserPermissionID() throws Exception {

        String userId = "florentID";
        String userName = "florent";

        List<String> permissions = Arrays.asList("read", "write");

        // setup project
        Project project = mock(Project.class);

        // project permissions
        AccessControlEntry accessControlEntry = mock(AccessControlEntry.class);
        List<AccessControlEntry> acl = Arrays.asList(accessControlEntry);
        doReturn(acl).when(project).getPermissions();
        ProjectConfig projectConfig = mock(ProjectConfig.class);
        when(project.getConfig()).thenReturn(projectConfig);
        when(projectConfig.getSource()).thenReturn(mock(SourceStorage.class));
        Principal principal = mock(Principal.class);
        doReturn(principal).when(accessControlEntry).getPrincipal();
        doReturn(permissions).when(accessControlEntry).getPermissions();

        // VFS permissions are set on user id
        doReturn(Principal.Type.USER).when(principal).getType();
        doReturn(userId).when(principal).getName();


        // environment context
        EnvironmentContext customEnvironment = mock(EnvironmentContext.class);
        User user = mock(User.class);
        doReturn(user).when(customEnvironment).getUser();
        doReturn(userId).when(user).getId();
        doReturn(userName).when(user).getName();

        // launch convert and before set env context
        EnvironmentContext old = EnvironmentContext.getCurrent();
        ProjectConfigDto projectConfigDto;
        try {
            EnvironmentContext.setCurrent(customEnvironment);
            projectConfigDto = DtoConverter.toProjectConfig(project, null);
        } finally {
            // reset
            EnvironmentContext.setCurrent(old);
        }

        Assert.assertNotNull(projectConfigDto);
    }

