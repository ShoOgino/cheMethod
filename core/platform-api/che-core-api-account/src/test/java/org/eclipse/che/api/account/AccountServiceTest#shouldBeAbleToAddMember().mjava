    @Test
    public void shouldBeAbleToAddMember() throws Exception {
        when(accountDao.getById(ACCOUNT_ID)).thenReturn(account);
        final NewMembership newMembership = DtoFactory.getInstance().createDto(NewMembership.class)
                                                      .withUserId(USER_ID)
                                                      .withRoles(singletonList("account/member"));

        final ContainerResponse response = makeRequest(POST,
                                                       SERVICE_PATH + "/" + account.getId() + "/members",
                                                       MediaType.APPLICATION_JSON,
                                                       newMembership);

        assertEquals(response.getStatus(), Response.Status.CREATED.getStatusCode());
        final MemberDescriptor descriptor = (MemberDescriptor)response.getEntity();
        assertEquals(descriptor.getUserId(), newMembership.getUserId());
        assertEquals(descriptor.getAccountReference().getId(), ACCOUNT_ID);
        assertEquals(descriptor.getRoles(), newMembership.getRoles());
        verify(accountDao).addMember(any(Member.class));
    }

