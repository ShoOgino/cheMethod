    @Override
    public Map<String, String> getPreferences(String userId, String filter) throws ServerException {
        lock.readLock().lock();
        try {
            return filter(getPreferences(userId), filter);
        } finally {
            lock.readLock().unlock();
        }
    }

