    @Override
    public synchronized void saveSnapshot(SnapshotImpl snapshot) throws SnapshotException {
        Objects.requireNonNull(snapshot, "Required non-null snapshot");
        final Optional<SnapshotImpl> opt = doGetSnapshot(snapshot.getWorkspaceId(), snapshot.getEnvName(), snapshot.getMachineName());
        if (opt.isPresent()) {
            snapshots.remove(opt.get().getId());
        }
        snapshots.put(snapshot.getId(), snapshot);
    }

