    protected String prepareState(URL requestUrl, String userId) {
        StringBuilder state = new StringBuilder();
        String query = requestUrl.getQuery();
        if (query != null) {
            if (state.length() > 0) {
                state.append('&');
            }
            state.append(query);
        }
        if (userId != null) {
            if (state.length() > 0) {
                state.append('&');
            }
            state.append("userId=");
            state.append(userId);
        }
        return state.toString();
    }

