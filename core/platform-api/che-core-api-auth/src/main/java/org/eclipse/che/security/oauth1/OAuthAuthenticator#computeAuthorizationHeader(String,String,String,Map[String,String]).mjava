    /**
     * Compute the Authorization header to sign the OAuth 1 request.
     *
     * @param userId
     *         the user id.
     * @param requestMethod
     *         the HTTP request method.
     * @param requestUrl
     *         the HTTP request url with encoded query parameters.
     * @param requestParameters
     *         the HTTP request parameters. HTTP request parameters must include raw values of application/x-www-form-urlencoded POST
     *         parameters.
     * @return the authorization header value, or {@code null}.
     * @throws IOException
     *         if something wrong occurs.
     */
    public String computeAuthorizationHeader(@NotNull final String userId,
                                             @NotNull final String requestMethod,
                                             @NotNull final String requestUrl,
                                             @NotNull final Map<String, String> requestParameters) throws IOException {

        final OAuthCredentialsResponse credentials = getToken(userId);
        if (credentials != null && credentials.token != null && credentials.tokenSecret != null) {
            return computeAuthorizationHeader(requestMethod, requestUrl, requestParameters, credentials.token, credentials.tokenSecret);
        }
        return null;
    }

