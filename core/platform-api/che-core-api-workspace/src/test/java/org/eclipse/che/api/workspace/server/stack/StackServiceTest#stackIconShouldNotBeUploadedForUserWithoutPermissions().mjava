    @Test
    public void stackIconShouldNotBeUploadedForUserWithoutPermissions() throws NotFoundException, ServerException {
        File file = new File(Resources.getResource("stack_img").getPath(), "type-java.svg");
        when(stackDao.getById(foreignStack.getId())).thenReturn(foreignStack);
        when(checker.hasAccess(any(), any(), any())).thenReturn(false);

        Response response = given().auth()
                                   .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
                                   .when()
                                   .multiPart("type-java.svg", file, "image/svg+xml")
                                   .contentType(MULTIPART_FORM_DATA)
                                   .post(SECURE_PATH + "/stack/" + stackImpl.getId() + "/icon");

        assertEquals(response.getStatusCode(), 403);
        String expectedErrorMessage = format("User '%s' doesn't has access to stack with id '%s'", USER_ID, STACK_ID);
        assertEquals(unwrapDto(response, ServiceError.class).getMessage(), expectedErrorMessage);
        verify(stackDao).getById(foreignStack.getId());
        verify(stackDao, never()).update(any());
    }

