    @Test
    public void workspaceShouldNotHaveRuntimeIfDevMachineCreationFailed() throws Exception {
        final MachineManager machineManagerMock = mock(MachineManager.class);
        final RuntimeWorkspaceRegistry registry = new RuntimeWorkspaceRegistry(machineManagerMock);
        final UsersWorkspaceImpl workspaceMock = workspaceMock();
        when(machineManagerMock.createMachineSync(any(), any(), any())).thenThrow(new MachineException("Creation error"));

        try {
            registry.start(workspaceMock, workspaceMock.getDefaultEnv());
        } catch (MachineException ex) {
            assertFalse(registry.hasRuntime(workspaceMock.getId()));
        }
    }

