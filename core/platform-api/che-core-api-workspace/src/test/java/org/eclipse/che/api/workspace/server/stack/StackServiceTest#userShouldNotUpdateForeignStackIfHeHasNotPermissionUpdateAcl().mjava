    @Test
    public void userShouldNotUpdateForeignStackIfHeHasNotPermissionUpdateAcl() throws ServerException, NotFoundException {
        StackDto updatedStackDto = DtoFactory.getInstance().createDto(StackDto.class)
                                             .withId(STACK_ID)
                                             .withName(NAME)
                                             .withDescription(DESCRIPTION)
                                             .withScope(SCOPE)
                                             .withTags(tags)
                                             .withSource(stackSourceDto)
                                             .withComponents(componentsDto)
                                             .withPermissions(permissionsDescriptor);

        when(checker.hasAccess(any(StackImpl.class), anyString(), eq("write"))).thenReturn(true);
        when(checker.hasAccess(any(StackImpl.class), anyString(), eq("update_acl"))).thenReturn(false);

        when(stackDao.getById(anyString())).thenReturn(foreignStack);
        when(checker.hasPublicSearchPermission(any())).thenReturn(false);

        Response response = given().auth()
                                   .basic(ADMIN_USER_NAME, ADMIN_USER_PASSWORD)
                                   .contentType(APPLICATION_JSON)
                                   .content(updatedStackDto)
                                   .when()
                                   .put(SECURE_PATH + "/stack/" + STACK_ID);

        assertEquals(response.getStatusCode(), 403);
        String expectedMessage = format("User '%s' doesn't has access to update stack '%s' permissions", USER_ID, stackImpl.getId());
        assertEquals(unwrapDto(response, ServiceError.class).getMessage(), expectedMessage);
        verify(stackDao).getById(STACK_ID);
        verify(stackDao, never()).update(any());
    }

