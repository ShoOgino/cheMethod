    @Test(expectedExceptions = BadRequestException.class,
          expectedExceptionsMessageRegExp = "Environment should contain exactly 1 dev machine, but '.*' contains '2'")
    public void shouldFailValidationIf2DevMachinesFound() throws Exception {
        final WorkspaceConfigDto config = createConfig();
        final Optional<MachineConfigDto> devMachine = config.getEnvironments()
                                                     .get(0)
                                                     .getMachineConfigs()
                                                     .stream()
                                                     .filter(MachineConfigDto::isDev)
                                                     .findAny();
        config.getEnvironments()
              .get(0)
              .getMachineConfigs()
              .add(devMachine.get().withName("other-name"));


        wsValidator.validate(config);
    }

