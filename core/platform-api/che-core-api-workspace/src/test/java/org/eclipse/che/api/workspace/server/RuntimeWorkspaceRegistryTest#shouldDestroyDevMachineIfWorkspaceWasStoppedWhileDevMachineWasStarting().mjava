    @Test
    public void shouldDestroyDevMachineIfWorkspaceWasStoppedWhileDevMachineWasStarting() throws Exception {
        final UsersWorkspaceImpl workspaceMock = workspaceMock();
        registry = spy(new RuntimeWorkspaceRegistry(machineManagerMock));
        doReturn(false).when(registry).addRunningMachine(any());

        try {
            registry.start(workspaceMock, workspaceMock.getDefaultEnv());
        } catch (ServerException ex) {
            assertEquals(ex.getMessage(), "Workspace 'workspace123' had been stopped before its dev-machine was started");
        }

        verify(machineManagerMock, never()).destroy(any(), anyBoolean());
    }

