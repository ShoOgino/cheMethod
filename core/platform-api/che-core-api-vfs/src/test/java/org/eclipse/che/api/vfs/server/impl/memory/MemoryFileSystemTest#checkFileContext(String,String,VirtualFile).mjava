    protected void checkFileContext(String expectedBody, String expectedMediaType, VirtualFile file) throws Exception {
        assertEquals(expectedMediaType, file.getMediaType());
        ContentStream contentStream = file.getContent();
        InputStream in = contentStream.getStream();
        byte[] b = new byte[(int)contentStream.getLength()];
        int r;
        int offset = 0;
        while ((r = in.read(b, offset, b.length - offset)) > 0) {
            offset += r;
        }
        assertEquals(expectedBody, new String(b));
    }

