    protected void addFile(VirtualFile virtualFile) throws ServerException {
        if (virtualFile.exists()) {
            if (!filter.accept(virtualFile)) {
                return;
            }
            try (Reader fContentReader = new BufferedReader(new InputStreamReader(virtualFile.getContent().getStream()))) {
                getIndexWriter().updateDocument(new Term("path", virtualFile.getPath()), createDocument(virtualFile, fContentReader));
            } catch (OutOfMemoryError oome) {
                close();
                throw oome;
            } catch (IOException e) {
                throw new ServerException(e.getMessage(), e);
            } catch (ForbiddenException e) {
                throw new ServerException(e.getServiceError());
            }
        }
    }

