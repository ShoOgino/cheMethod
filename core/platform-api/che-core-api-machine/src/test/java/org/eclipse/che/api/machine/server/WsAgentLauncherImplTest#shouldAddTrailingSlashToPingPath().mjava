    @Test
    public void shouldAddTrailingSlashToPingPath() throws Exception {
        String pingUrlWithoutTrailingSlash = WS_AGENT_SERVER_URL.substring(0, WS_AGENT_SERVER_URL.length() - 1);
        ServerImpl server = new ServerImpl(SERVER);
        server.setUrl(pingUrlWithoutTrailingSlash);
        doReturn(Collections.<String, Server>singletonMap(WS_AGENT_PORT, server)).when(machineMetadata).getServers();

        wsAgentLauncher.startWsAgent(WS_ID);

        verify(requestFactory).fromUrl(UriBuilder.fromUri(pingUrlWithoutTrailingSlash + "/")
                                                 .replacePath(API_ENDPOINT_PATH)
                                                 .build()
                                                 .toString());
        verify(pingRequest).setMethod(HttpMethod.OPTIONS);
        verify(pingRequest).setTimeout(WS_AGENT_PING_CONN_TIMEOUT_MS);
        verify(pingRequest).request();
        verify(pingResponse).getResponseCode();
    }

