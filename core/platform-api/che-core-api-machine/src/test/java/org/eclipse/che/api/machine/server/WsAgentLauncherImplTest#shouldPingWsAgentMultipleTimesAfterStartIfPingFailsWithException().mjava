    @Test
    public void shouldPingWsAgentMultipleTimesAfterStartIfPingFailsWithException() throws Exception {
        when(pingRequest.request()).thenThrow(new ServerException(""),
                                              new BadRequestException(""),
                                              new IOException())
                                   .thenReturn(pingResponse);

        wsAgentLauncher.startWsAgent(WS_ID);

        verify(requestFactory).fromUrl(UriBuilder.fromUri(WS_AGENT_SERVER_URL)
                                                 .replacePath(API_ENDPOINT_PATH)
                                                 .build()
                                                 .toString());
        verify(pingRequest).setMethod(HttpMethod.OPTIONS);
        verify(pingRequest).setTimeout(WS_AGENT_PING_CONN_TIMEOUT_MS);
        verify(pingRequest, times(4)).request();
        verify(pingResponse).getResponseCode();
    }

