    @BeforeMethod
    public void setUpMethod() throws Exception {
        String serverAddress = "localhost:" + jettyServer.getURI().getPort();
        Map<String, Server> machineServers = Collections.<String, Server>singletonMap(String.valueOf(EXTENSIONS_API_PORT),
                                                                                      new ServerImpl(null,
                                                                                                     serverAddress,
                                                                                                     "http://" + serverAddress));

        MachineMetadata machineMetadata = new MachineMetadataImpl(null, null, machineServers);

        machineManager = mock(MachineManager.class);

        machine = mock(Instance.class);

        extensionApiResponse = spy(new ExtensionApiResponse());

        extensionApiRequest = new ExtensionApiRequest();

        proxyServlet = new MachineExtensionProxyServlet(4301, machineManager);

        when(machineManager.getDevMachine(WORKSPACE_ID)).thenReturn(machine);
        when(machine.getMetadata()).thenReturn(machineMetadata);
    }

