    /**
     * Destroy machine with specified id
     *
     * @param machineId
     *         id of machine that should be destroyed
     * @param async
     *         should destroying be asynchronous or not
     * @throws NotFoundException
     *         if machine with specified id not found
     * @throws MachineException
     *         if other error occur
     */
    public void destroy(final String machineId, boolean async) throws NotFoundException, MachineException {
        final Instance machine = getMachine(machineId);

        machine.setStatus(MachineStatus.DESTROYING);

        final MachineStateImpl machineState = machineRegistry.getState(machineId);

        eventService.publish(newDto(MachineStatusEvent.class)
                                     .withEventType(MachineStatusEvent.EventType.DESTROYING)
                                     .withMachineId(machineId)
                                     .withDev(machine.isDev())
                                     .withWorkspaceId(machineState.getWorkspaceId())
                                     .withMachineName(machineState.getName()));

        if (async) {
            executor.execute(ThreadLocalPropagateContext.wrap(() -> {
                try {
                    doDestroy(machine);
                } catch (NotFoundException | MachineException e) {
                    LOG.error(e.getLocalizedMessage(), e);
                }
            }));
        } else {
            doDestroy(machine);
        }
    }

