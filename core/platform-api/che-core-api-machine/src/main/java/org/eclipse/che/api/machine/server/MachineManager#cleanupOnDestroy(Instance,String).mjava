    private void cleanupOnDestroy(Instance machine, String message) throws NotFoundException, MachineException {
        try {
            if (!Strings.isNullOrEmpty(message)) {
                machine.getLogger().writeLine(message);
            }
            machine.getLogger().close();
        } catch (IOException ignore) {
        }

        final MachineStateImpl machineState = machineRegistry.getState(machine.getId());

        machineRegistry.remove(machine.getId());

        eventService.publish(newDto(MachineStatusEvent.class)
                                     .withEventType(MachineStatusEvent.EventType.DESTROYED)
                                     .withDev(machine.isDev())
                                     .withMachineId(machine.getId())
                                     .withWorkspaceId(machineState.getWorkspaceId())
                                     .withMachineName(machineState.getName()));
    }

