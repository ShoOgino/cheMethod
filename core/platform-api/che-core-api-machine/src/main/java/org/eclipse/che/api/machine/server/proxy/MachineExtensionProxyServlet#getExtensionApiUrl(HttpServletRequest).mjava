    private String getExtensionApiUrl(HttpServletRequest req) throws NotFoundException, ServerException {
        String workspaceId;
        final Matcher matcher = EXTENSION_API_URI.matcher(req.getRequestURI());
        if (matcher.matches()) {
            workspaceId = matcher.group("workspaceId");
        } else {
            throw new NotFoundException("No workspace id is found in request.");
        }

        final Machine machine = machineManager.getDevMachine(workspaceId);
        final Server server = machine.getRuntime().getServers().get(Integer.toString(extServicesPort));
        if (server == null) {
            throw new ServerException("No extension server found in machine.");
        }

        final UriBuilder uriBuilder = UriBuilder.fromUri(server.getUrl())
                                                .replacePath(req.getRequestURI())
                                                .replaceQuery(req.getQueryString());

        return uriBuilder.build().toString();
    }

