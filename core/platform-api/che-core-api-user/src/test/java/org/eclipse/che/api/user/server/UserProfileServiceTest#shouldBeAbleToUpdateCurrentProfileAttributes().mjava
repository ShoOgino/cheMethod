    @Test
    public void shouldBeAbleToUpdateCurrentProfileAttributes() throws Exception {
        final Profile profile = new Profile().withId(testUser.getId())
                                             .withAttributes(new HashMap<>(singletonMap("existed", "old")));
        when(profileDao.getById(profile.getId())).thenReturn(profile);
        final Map<String, String> attributes = new HashMap<>(4);
        attributes.put("existed", "new");
        attributes.put("new", "value");

        final ContainerResponse response = makeRequest(HttpMethod.POST, SERVICE_PATH, attributes);

        assertEquals(response.getStatus(), OK.getStatusCode());
        verify(profileDao, times(1)).update(profile);
        assertEquals(((ProfileDescriptor)response.getEntity()).getAttributes(), attributes);
    }

