    /**
     * Converts {@link Profile} to {@link ProfileDescriptor}
     */
    /* package-private used in tests*/ProfileDescriptor toDescriptor(Profile profile, SecurityContext context) {
        final UriBuilder uriBuilder = getServiceContext().getServiceUriBuilder();
        final List<Link> links = new LinkedList<>();
        if (context.isUserInRole("user")) {
            links.add(LinksHelper.createLink(HttpMethod.GET,
                                             uriBuilder.clone()
                                                       .path(getClass(), "getCurrent")
                                                       .build()
                                                       .toString(),
                                             null,
                                             APPLICATION_JSON,
                                             LINK_REL_GET_CURRENT_USER_PROFILE));
            links.add(LinksHelper.createLink(HttpMethod.GET,
                                             uriBuilder.clone()
                                                       .path(getClass(), "getById")
                                                       .build(profile.getId())
                                                       .toString(),
                                             null,
                                             APPLICATION_JSON,
                                             LINK_REL_GET_USER_PROFILE_BY_ID));
            links.add(LinksHelper.createLink(HttpMethod.POST,
                                             uriBuilder.clone()
                                                       .path(getClass(), "updateCurrent")
                                                       .build()
                                                       .toString(),
                                             APPLICATION_JSON,
                                             APPLICATION_JSON,
                                             LINK_REL_UPDATE_CURRENT_USER_PROFILE));
            links.add(LinksHelper.createLink(HttpMethod.POST,
                                             uriBuilder.clone()
                                                       .path(getClass(), "updatePreferences")
                                                       .build()
                                                       .toString(),
                                             APPLICATION_JSON,
                                             APPLICATION_JSON,
                                             LINK_REL_UPDATE_PREFERENCES));
        }
        if (context.isUserInRole("system/admin") || context.isUserInRole("system/manager")) {
            links.add(LinksHelper.createLink(HttpMethod.GET,
                                             uriBuilder.clone()
                                                       .path(getClass(), "getById")
                                                       .build(profile.getId())
                                                       .toString(),
                                             null,
                                             APPLICATION_JSON,
                                             LINK_REL_GET_USER_PROFILE_BY_ID));
        }
        if (context.isUserInRole("system/admin")) {
            links.add(LinksHelper.createLink(HttpMethod.POST,
                                             uriBuilder.clone()
                                                       .path(getClass(), "update")
                                                       .build(profile.getId())
                                                       .toString(),
                                             APPLICATION_JSON,
                                             APPLICATION_JSON,
                                             LINK_REL_UPDATE_USER_PROFILE_BY_ID));
        }
        return DtoFactory.getInstance().createDto(ProfileDescriptor.class)
                         .withId(profile.getId())
                         .withUserId(profile.getUserId())
                         .withAttributes(profile.getAttributes())
                         .withLinks(links);
    }

