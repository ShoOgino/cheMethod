  @Override
  public void provision(
      InternalEnvironment environment, OpenShiftEnvironment osEnv, RuntimeIdentity identity)
      throws InfrastructureException {

    String devMachineName =
        WsAgentMachineFinderUtil.getWsAgentServerMachine(environment)
            .orElseThrow(() -> new InfrastructureException("Machine with wsagent not found"));

    for (Pod pod : osEnv.getPods().values()) {
      String podName = pod.getMetadata().getName();
      for (Container container : pod.getSpec().getContainers()) {
        String containerName = container.getName();
        String machineName = podName + "/" + containerName;
        InternalMachineConfig machineConf = environment.getMachines().get(machineName);

        for (Installer installer : machineConf.getInstallers()) {
          provisionEnv(container, installer.getProperties());
        }

        // CHE_API is used by installers for agent binary downloading
        putEnv(container.getEnv(), "CHE_API", cheServerEndpoint);

        putEnv(
            container.getEnv(),
            "USER_TOKEN",
            machineTokenProvider.getToken(identity.getWorkspaceId()));

        // TODO incorrect place for env variable addition. workspace ID is needed for wsagent server, not installer
        // WORKSPACE_ID is required only by workspace agent
        if (devMachineName.equals(machineName)) {
          putEnv(container.getEnv(), "CHE_WORKSPACE_ID", identity.getWorkspaceId());
        }
      }
    }
  }

