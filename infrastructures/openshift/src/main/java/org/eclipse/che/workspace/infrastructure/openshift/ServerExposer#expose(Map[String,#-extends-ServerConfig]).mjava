  /**
   * Exposes specified servers.
   *
   * <p>Note that created OpenShift objects will select the corresponding pods by {@link
   * Constants#CHE_ORIGINAL_NAME_LABEL} label. That should be added by {@link
   * UniqueNamesProvisioner}.
   *
   * @param servers servers to expose
   * @see UniqueNamesProvisioner#provision(InternalEnvironment, OpenShiftEnvironment,
   *     RuntimeIdentity)
   */
  public void expose(Map<String, ? extends ServerConfig> servers) {
    Map<String, ServicePort> portToServicePort = exposePort(servers.values());

    Service service =
        new ServiceBuilder()
            .withName(generate(SERVER_PREFIX, SERVER_UNIQUE_PART_SIZE) + '-' + machineName)
            .withSelectorEntry(CHE_ORIGINAL_NAME_LABEL, machineName.split("/")[0])
            .withPorts(new ArrayList<>(portToServicePort.values()))
            .build();

    String serviceName = service.getMetadata().getName();
    openShiftEnvironment.getServices().put(serviceName, service);

    for (ServicePort servicePort : portToServicePort.values()) {
      int port = servicePort.getTargetPort().getIntVal();
      Map<String, ServerConfig> routesServers =
          servers
              .entrySet()
              .stream()
              .filter(e -> parseInt(e.getValue().getPort().split("/")[0]) == port)
              .collect(toMap(Map.Entry::getKey, Map.Entry::getValue));

      Route route =
          new RouteBuilder()
              .withName(serviceName + '-' + servicePort.getName())
              .withTargetPort(servicePort.getName())
              .withServers(routesServers)
              .withTo(serviceName)
              .build();
      openShiftEnvironment.getRoutes().put(route.getMetadata().getName(), route);
    }
  }

