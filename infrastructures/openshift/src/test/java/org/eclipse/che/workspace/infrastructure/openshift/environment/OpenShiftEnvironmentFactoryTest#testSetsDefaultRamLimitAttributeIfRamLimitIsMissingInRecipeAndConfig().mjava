  @Test
  public void testSetsDefaultRamLimitAttributeIfRamLimitIsMissingInRecipeAndConfig()
      throws Exception {
    final long firstMachineRamLimit = 3072 * BYTES_IN_MB;
    when(machineConfig1.getAttributes()).thenReturn(new HashMap<>());
    when(machineConfig2.getAttributes()).thenReturn(new HashMap<>());
    final Set<Pod> pods =
        ImmutableSet.of(
            mockPod(MACHINE_NAME_1, firstMachineRamLimit), mockPod(MACHINE_NAME_2, null));

    osEnvironmentFactory.addRamLimitAttribute(machines, pods);

    final long[] actual = machinesRam(machines.values());
    final long[] expected = new long[] {firstMachineRamLimit, DEFAULT_RAM_LIMIT_MB * BYTES_IN_MB};
    assertTrue(Arrays.equals(actual, expected));
  }

