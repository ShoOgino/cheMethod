    @Test
    public void provisionInstallerConfig() throws Exception {
        final String podName = "test";
        final Container container = mockContainer("machine");
        final Pod pod = mockPod(podName, singletonList(container));
        when(osEnv.getPods()).thenReturn(ImmutableMap.of(podName, pod));
        final MachineConfigImpl devMachine = mock(MachineConfigImpl.class);
        final Map<String, MachineConfigImpl> machines = ImmutableMap.of("test/machine", devMachine);
        when(environment.getMachines()).thenReturn(machines);
        final List<String> installerIds = singletonList(WSAGENT_INSTALLER);
        when(devMachine.getInstallers()).thenReturn(installerIds);
        final Installer installer = mock(Installer.class);
        when(registry.getOrderedInstallers(installerIds)).thenReturn(singletonList(installer));
        final Map<String, String> envVars = ImmutableMap.of("environment", "CHE_HOST=localhost");
        when(installer.getProperties()).thenReturn(envVars);
        final List<EnvVar> envVariables = new ArrayList<>();
        when(container.getEnv()).thenReturn(envVariables);
        when(installer.getServers()).thenReturn(emptyMap());

        installerConfigProvisioner.provision(environment, osEnv, runtimeIdentity);

        verify(osEnv, times(1)).getPods();
        verify(runtimeIdentity, atLeast(1)).getWorkspaceId();
        verify(environment, times(1)).getMachines();
        assertTrue(envVariables.size() == 3);
    }

