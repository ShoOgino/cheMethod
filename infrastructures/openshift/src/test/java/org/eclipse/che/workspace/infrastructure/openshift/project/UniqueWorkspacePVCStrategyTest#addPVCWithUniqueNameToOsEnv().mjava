  @Test
  public void addPVCWithUniqueNameToOsEnv() throws Exception {
    final Pod pod = mock(Pod.class);
    final PodSpec podSpec = mock(PodSpec.class);
    final Container container = mock(Container.class);
    final List<Volume> volumes = new ArrayList<>();
    final List<VolumeMount> volumeMounts = new ArrayList<>();
    final Map<String, PersistentVolumeClaim> pvcs = new HashMap<>();
    mockName(pod, POD_NAME);
    when(pod.getSpec()).thenReturn(podSpec);
    when(osEnv.getPersistentVolumeClaims()).thenReturn(pvcs);
    when(osEnv.getPods()).thenReturn(singletonMap(POD_NAME, pod));
    when(podSpec.getContainers()).thenReturn(singletonList(container));
    when(podSpec.getVolumes()).thenReturn(volumes);
    when(container.getName()).thenReturn(CONTAINER_NAME);
    when(container.getVolumeMounts()).thenReturn(volumeMounts);

    uniqueWorkspacePVCStrategy.prepare(env, osEnv, WORKSPACE_ID);

    verify(container).getVolumeMounts();
    verify(podSpec).getVolumes();
    assertFalse(volumeMounts.isEmpty());
    assertFalse(volumes.isEmpty());
    assertFalse(pvcs.isEmpty());
    assertTrue(pvcs.containsKey(PVC_UNIQUE_NAME));
  }

