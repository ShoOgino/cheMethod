  /** Creates new docker machine instance from the full container description. */
  public DockerMachine create(ContainerInfo container) {
    NetworkSettings networkSettings = container.getNetworkSettings();
    String hostname;
    if (internalDockerIP != null) {
      hostname = internalDockerIP;
    } else {
      hostname = networkSettings.getGateway();
    }
    Map<String, ServerConfig> configs =
        Labels.newDeserializer(container.getConfig().getLabels()).servers();

    return new DockerMachine(
        container.getId(),
        container.getConfig().getImage(),
        docker,
        new ServersMapper(hostname).map(networkSettings.getPorts(), configs),
        registry,
        snapshotUseRegistry,
        registryNamespace,
        dockerMachineStopDetector);
  }

