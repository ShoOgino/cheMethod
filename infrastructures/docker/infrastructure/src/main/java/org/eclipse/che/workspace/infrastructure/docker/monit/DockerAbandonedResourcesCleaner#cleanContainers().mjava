  /** Cleans up CHE inactive machine docker containers. */
  @VisibleForTesting
  void cleanContainers() {
    List<String> activeContainers = new ArrayList<>();
    try {
      for (ContainerListEntry container : dockerConnector.listContainers()) {
        String containerName = container.getNames()[0];

        String machineName = container.getLabels().get(Labels.LABEL_MACHINE_NAME);
        String workspaceId = container.getLabels().get(Labels.LABEL_WORKSPACE_ID);

        if (!isNullOrEmpty(machineName) && !isNullOrEmpty(workspaceId)) {
          try {
            WorkspaceImpl workspace = workspaceManager.getWorkspace(workspaceId);
            if (workspace.getRuntime() != null
                && workspace.getRuntime().getMachines().containsKey(machineName)) {
              activeContainers.add(containerName);
              continue;
            }
          } catch (NotFoundException e) {
            // cleanup container
          } catch (Exception e) {
            LOG.error(
                format(
                    "Failed to check activity for container with name '%s'. Cause: %s",
                    containerName, e.getLocalizedMessage()),
                e);
          }
          cleanUpContainer(container);
        }
      }
    } catch (IOException e) {
      LOG.error("Failed to get list docker containers", e);
    } catch (Exception e) {
      LOG.error("Failed to clean up inactive containers", e);
    }
    LOG.info("List containers registered in the api: " + activeContainers);
  }

