  @Override
  public void saveSnapshot(SnapshotImpl snapshot) throws SnapshotException {
    requireNonNull(snapshot, "Required non-null snapshot");
    try {
      doSave(snapshot);
    } catch (DuplicateKeyException x) {
      throw new SnapshotException(
          String.format(
              "Snapshot with id '%s' or for machine '%s:%s:%s' already exists",
              snapshot.getId(),
              snapshot.getWorkspaceId(),
              snapshot.getEnvName(),
              snapshot.getMachineName()));
    } catch (RuntimeException x) {
      throw new SnapshotException(x.getLocalizedMessage(), x);
    }
  }

