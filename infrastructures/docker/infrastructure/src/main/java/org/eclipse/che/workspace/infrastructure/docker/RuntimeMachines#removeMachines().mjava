  /**
   * Removes all the machine and returns them. Is supposed to be called on normal/abnormal runtime
   * stop.
   *
   * @throws InfrastructureException if there is no machines anymore. Might happen on concurrent
   *     modification.
   */
  public synchronized Map<String, DockerMachine> removeMachines() throws InfrastructureException {
    if (machines == null) {
      throw new InfrastructureException("Runtime doesn't have machines to remove");
    }
    Map<String, DockerMachine> machines = this.machines;
    // unset to identify error if method called second time
    this.machines = null;
    return machines;
  }

