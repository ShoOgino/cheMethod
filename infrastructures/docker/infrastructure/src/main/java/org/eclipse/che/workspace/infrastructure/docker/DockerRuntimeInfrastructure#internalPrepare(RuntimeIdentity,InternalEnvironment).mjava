  @Override
  protected DockerRuntimeContext internalPrepare(
      RuntimeIdentity identity, InternalEnvironment environment)
      throws ValidationException, InfrastructureException {

    DockerEnvironment dockerEnvironment = dockerEnvironmentParser.parse(environment);
    dockerEnvironmentValidator.validate(environment, dockerEnvironment);

    // modify environment with everything needed to use docker machines on particular (cloud)
    // infrastructure
    infrastructureProvisioner.provision(environment, dockerEnvironment, identity);
    // check that containers start order can be resolved
    // NOTE: it should be performed before environmentNormalizer.normalize because normalization
    // changes links, volumes from which will fail order evaluation
    // It can be changed after reimplementing strategy to respect normalization
    List<String> containersOrder = startStrategy.order(dockerEnvironment);
    // normalize env to provide environment description with absolutely everything expected in
    environmentNormalizer.normalize(environment, dockerEnvironment, identity);

    return contextFactory.create(this, identity, environment, dockerEnvironment, containersOrder);
  }

