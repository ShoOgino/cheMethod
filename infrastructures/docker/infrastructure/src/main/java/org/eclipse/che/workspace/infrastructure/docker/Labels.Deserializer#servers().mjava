    /** Retrieves server configuration from docker labels and returns (ref -> server config) map. */
    public Map<String, ServerConfig> servers() {
      Map<String, ServerConfig> servers = new HashMap<>();
      for (Map.Entry<String, String> entry : labels.entrySet()) {
        Matcher refMatcher = SERVER_LABEL_PATTERN.matcher(entry.getKey());
        if (refMatcher.matches()) {
          String ref = refMatcher.group("ref");
          if (!servers.containsKey(ref)) {
            servers.put(
                ref,
                new ServerConfigImpl(
                    labels.get(String.format(SERVER_PORT_LABEL_FMT, ref)),
                    labels.get(String.format(SERVER_PROTOCOL_LABEL_FMT, ref)),
                    labels.get(String.format(SERVER_PATH_LABEL_FMT, ref)),
                    GSON.fromJson(
                        labels.get(String.format(SERVER_ATTR_LABEL_FMT, ref)), mapTypeToken)));
          }
        }
      }
      return servers;
    }

