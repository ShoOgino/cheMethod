  private DockerEnvironment createDockerEnvironment(
      String nameOfMachineWithWsagentServer, String... machinesNames) {
    Map<String, InternalMachineConfig> machines = new HashMap<>();
    for (String machineName : machinesNames) {
      InternalMachineConfig machine = mock(InternalMachineConfig.class);
      machines.put(machineName, machine);
      if (machineName.equals(nameOfMachineWithWsagentServer)) {
        lenient()
            .when(machine.getServers())
            .thenReturn(
                singletonMap(Constants.SERVER_WS_AGENT_HTTP_REFERENCE, new ServerConfigImpl()));
      }
    }

    DockerEnvironment environment = new DockerEnvironment(null, machines, null);
    for (String machineName : machinesNames) {
      environment.getContainers().put(machineName, new DockerContainerConfig());
    }

    return environment;
  }

