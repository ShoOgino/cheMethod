  @Test
  public void deserialization() {
    ImmutableMap<String, String> labels =
        ImmutableMap.<String, String>builder()
            .put("custom-label", "value")
            .put("org.eclipse.che.machine.unknown-label", "value")
            .put("org.eclipse.che.machine.name", "dev-machine")
            .put("org.eclipse.che.workspace.id", "workspace123")
            .put("org.eclipse.che.workspace.env", "my-env")
            .put("org.eclipse.che.workspace.owner", "owner")
            .put("org.eclipse.che.server.my-server1/http.port", "8000/tcp")
            .put("org.eclipse.che.server.my-server1/http.protocol", "http")
            .put("org.eclipse.che.server.my-server1/http.path", "/api/info")
            .put("org.eclipse.che.server.my-server2.port", "8080/tcp")
            .put("org.eclipse.che.server.my-server2.protocol", "ws")
            .put("org.eclipse.che.server.my-server2.path", "/connect")
            .put("org.eclipse.che.server.my-server3.port", "7070/tcp")
            .put("org.eclipse.che.server.my-server3.protocol", "http")
            .put("org.eclipse.che.server.my.dot.separated.server.port", "9090/tcp")
            .put("org.eclipse.che.server.my.dot.separated.server.protocol", "http")
            .build();

    Labels.Deserializer deserializer = Labels.newDeserializer(labels);
    Map<String, ServerConfig> expectedServers = new HashMap<>();
    expectedServers.put("my-server1/http", new ServerConfigImpl("8000/tcp", "http", "/api/info"));
    expectedServers.put("my-server2", new ServerConfigImpl("8080/tcp", "ws", "/connect"));
    expectedServers.put("my-server3", new ServerConfigImpl("7070/tcp", "http", null));
    expectedServers.put("my.dot.separated.server", new ServerConfigImpl("9090/tcp", "http", null));

    assertEquals(deserializer.machineName(), "dev-machine");

    RuntimeIdentity runtimeId = deserializer.runtimeId();
    assertEquals(runtimeId.getWorkspaceId(), "workspace123", "workspace id");
    assertEquals(runtimeId.getEnvName(), "my-env", "workspace environment name");
    assertEquals(runtimeId.getOwner(), "owner", "workspace owner");

    Map<String, ServerConfig> servers = deserializer.servers();
    assertEquals(servers, expectedServers);
  }

