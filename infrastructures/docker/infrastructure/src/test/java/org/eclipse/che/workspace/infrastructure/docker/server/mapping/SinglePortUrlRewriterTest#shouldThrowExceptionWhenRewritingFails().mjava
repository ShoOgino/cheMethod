  @Test(
    expectedExceptions = InternalInfrastructureException.class,
    expectedExceptionsMessageRegExp =
        "Rewriting of host 'server.machine1.ws123.172.12.0.2.nip.io' in URL ':' failed. Error: .*"
  )
  public void shouldThrowExceptionWhenRewritingFails() throws Exception {
    Provider<SinglePortHostnameBuilder> provider =
        () -> new SinglePortHostnameBuilder("172.12.0.2", "127.0.0.1", null);
    SinglePortUrlRewriter rewriter = new SinglePortUrlRewriter(8080, provider);
    rewriter.rewriteURL(
        new RuntimeIdentityImpl("ws123", null, null, null), "machine1", "server", ":");
  }

