  private InternalEnvironment createEnvironment(
      String nameOfMachineWithWsagentServer, String... machinesNames) {

    Map<String, InternalMachineConfig> machines = new HashMap<>();
    for (String machineName : machinesNames) {
      InternalMachineConfig machine = mock(InternalMachineConfig.class);
      machines.put(machineName, machine);
      if (machineName.equals(nameOfMachineWithWsagentServer)) {
        when(machine.getServers())
            .thenReturn(
                singletonMap(Constants.SERVER_WS_AGENT_HTTP_REFERENCE, new ServerConfigImpl()));
      }
    }
    InternalEnvironment environment = mock(InternalEnvironment.class);
    when(environment.getMachines()).thenReturn(machines);
    return environment;
  }

