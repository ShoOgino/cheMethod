  @Test(
    expectedExceptions = ValidationException.class,
    expectedExceptionsMessageRegExp =
        "Environment should contain exactly 1 machine with wsagent, but contains '.*'. All machines with this agent: .*",
    dataProvider = "severalWsAgentsProvider"
  )
  public void shouldFailIfThereIsMoreThan1MachineWithWsAgent(
      Map<String, InternalMachineConfig> machines, Map<String, DockerContainerConfig> containers)
      throws Exception {
    // given
    when(environment.getMachines()).thenReturn(machines);
    when(dockerEnvironment.getContainers()).thenReturn(containers);

    // when
    environmentValidator.validate(environment, dockerEnvironment);
  }

