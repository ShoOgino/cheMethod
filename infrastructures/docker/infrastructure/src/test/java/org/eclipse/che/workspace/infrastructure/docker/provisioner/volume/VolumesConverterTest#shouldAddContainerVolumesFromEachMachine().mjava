  @Test
  public void shouldAddContainerVolumesFromEachMachine() throws Exception {
    // given
    String volume1Name = "vol1";
    String volume1Path = "/some/path";
    String volume2Name = "vol2";
    String volume2Path = "/another/path";

    List<String> machine1ActualVolumes = new ArrayList<>();
    List<String> machine2ActualVolumes = new ArrayList<>();

    when(machineConfig1.getVolumes())
        .thenReturn(singletonMap(volume1Name, new VolumeImpl().withPath(volume1Path)));
    when(machineConfig2.getVolumes())
        .thenReturn(
            ImmutableMap.of(
                volume1Name,
                new VolumeImpl().withPath(volume1Path),
                volume2Name,
                new VolumeImpl().withPath(volume2Path)));
    when(container1.getVolumes()).thenReturn(machine1ActualVolumes);
    when(container2.getVolumes()).thenReturn(machine2ActualVolumes);

    // when
    converter.provision(internalEnvironment, runtimeIdentity);

    // then
    verify(container1).getVolumes();
    verify(container2, times(2)).getVolumes();
    assertEquals(
        machine1ActualVolumes,
        singletonList(VolumeNames.generate(WS_ID, volume1Name) + ":" + volume1Path));
    assertEquals(
        machine2ActualVolumes,
        asList(
            VolumeNames.generate(WS_ID, volume1Name) + ":" + volume1Path,
            VolumeNames.generate(WS_ID, volume2Name) + ":" + volume2Path));
  }

