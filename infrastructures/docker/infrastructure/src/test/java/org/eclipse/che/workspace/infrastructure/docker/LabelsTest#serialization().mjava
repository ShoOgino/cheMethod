  @Test
  public void serialization() {
    Map<String, String> serialized =
        Labels.newSerializer()
            .machineName("dev-machine")
            .runtimeId(new RuntimeIdentityImpl("workspace123", "my-env", "owner"))
            .server("my-server1/http", new ServerConfigImpl("8000/tcp", "http", "/api/info"))
            .server("my-server2", new ServerConfigImpl("8080/tcp", "ws", "/connect"))
            .server("my-server3", new ServerConfigImpl("7070/tcp", "http", null))
            .server("my.dot.separated.server", new ServerConfigImpl("9090/tcp", "http", null))
            .labels();
    Map<String, String> expected =
        ImmutableMap.<String, String>builder()
            .put("org.eclipse.che.machine.name", "dev-machine")
            .put("org.eclipse.che.workspace.id", "workspace123")
            .put("org.eclipse.che.workspace.env", "my-env")
            .put("org.eclipse.che.workspace.owner", "owner")
            .put("org.eclipse.che.server.my-server1/http.port", "8000/tcp")
            .put("org.eclipse.che.server.my-server1/http.protocol", "http")
            .put("org.eclipse.che.server.my-server1/http.path", "/api/info")
            .put("org.eclipse.che.server.my-server2.port", "8080/tcp")
            .put("org.eclipse.che.server.my-server2.protocol", "ws")
            .put("org.eclipse.che.server.my-server2.path", "/connect")
            .put("org.eclipse.che.server.my-server3.port", "7070/tcp")
            .put("org.eclipse.che.server.my-server3.protocol", "http")
            .put("org.eclipse.che.server.my.dot.separated.server.port", "9090/tcp")
            .put("org.eclipse.che.server.my.dot.separated.server.protocol", "http")
            .build();

    assertEquals(serialized, expected);
  }

