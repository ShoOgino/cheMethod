  @Test(expectedExceptions = InfrastructureException.class)
  public void throwsExceptionWhenOneMachineStartFailed() throws Exception {
    final String msg = "container start failed";
    mockInstallersBootstrap();
    mockContainerStartFailed(new InfrastructureException(msg));

    try {
      dockerRuntime.start(emptyMap());
    } catch (InfrastructureException ex) {
      verify(starter, times(1))
          .startContainer(nullable(String.class), nullable(String.class), any(), any(), any());
      verify(eventService, times(3)).publish(any(MachineStatusEvent.class));
      verifyEventsOrder(
          newEvent(DEV_MACHINE, STARTING, null),
          newEvent(DEV_MACHINE, FAILED, msg),
          newEvent(DEV_MACHINE, STOPPED, null));
      throw ex;
    }
  }

