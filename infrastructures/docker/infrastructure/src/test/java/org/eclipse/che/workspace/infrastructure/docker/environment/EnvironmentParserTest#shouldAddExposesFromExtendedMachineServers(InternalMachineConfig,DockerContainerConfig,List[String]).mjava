  @Test(dataProvider = "environmentWithServersProvider")
  public void shouldAddExposesFromExtendedMachineServers(
      InternalMachineConfig machineConfig,
      DockerContainerConfig parsedContainer,
      List<String> expectedExposes)
      throws Exception {

    // given
    when(environment.getMachines()).thenReturn(singletonMap(DEFAULT_MACHINE_NAME, machineConfig));
    when(dockerEnv.getContainers()).thenReturn(singletonMap(DEFAULT_MACHINE_NAME, parsedContainer));

    // when
    DockerEnvironment actual = parser.parse(environment);

    // then
    // prevent failures because of reordered entries of expose field
    assertEquals(actual.getContainers().size(), 1);
    assertEqualsNoOrder(
        actual.getContainers().get(DEFAULT_MACHINE_NAME).getExpose().toArray(),
        expectedExposes.toArray(),
        String.format(
            "Arrays are not equal. Actual: '%s'. Expected: '%s'",
            Arrays.toString(actual.getContainers().get(DEFAULT_MACHINE_NAME).getExpose().toArray()),
            Arrays.toString(expectedExposes.toArray())));
  }

