    @Test(dependsOnMethods = "shouldFindSnapshotsByWorkspaceAndNamespace")
    public void replacesSnapshots() throws Exception {
        final SnapshotImpl newSnapshot = createSnapshot("new-snapshot",
                                                        snapshots[0].getWorkspaceId(),
                                                        snapshots[0].getEnvName(),
                                                        snapshots[0].getMachineName());

        final List<SnapshotImpl> replaced = snapshotDao.replaceSnapshots(newSnapshot.getWorkspaceId(),
                                                                         newSnapshot.getEnvName(),
                                                                         singletonList(newSnapshot));

        assertEquals(new HashSet<>(replaced), Sets.newHashSet(snapshots[0], snapshots[1]));
        final HashSet<SnapshotImpl> actual = new HashSet<>(snapshotDao.findSnapshots(this.snapshots[0].getWorkspaceId()));
        final HashSet<SnapshotImpl> expected = Sets.newHashSet(newSnapshot, this.snapshots[2]);
        assertEquals(actual, expected);
    }

