    @Test
    public void shouldAddExposedPorts() throws Exception {
        final ServerConfig serverConf1 = mock(ServerConfig.class);
        final ServerConfig serverConfig = mock(ServerConfig.class);
        when(serverConf1.getPort()).thenReturn("1111/udp");
        when(serverConfig.getPort()).thenReturn("2222/tcp");

        when(sorter.sort(any())).thenReturn(asList(AgentKeyImpl.parse("agent1"),
                                                   AgentKeyImpl.parse("agent2"),
                                                   AgentKeyImpl.parse("agent3")));
        when(agent1.getServers()).thenAnswer(invocation -> singletonMap("a", serverConf1));
        when(agent2.getServers()).thenAnswer(invocation -> singletonMap("b", serverConfig));
        when(agent3.getServers()).thenReturn(emptyMap());
        DockerContainerConfig service = new DockerContainerConfig();

        agentConfigApplier.apply(new MachineConfigImpl(asList("agent1", "agent2", "agent3"),
                                                       emptyMap(),
                                                       emptyMap()),
                                 service);

        List<String> exposedPorts = service.getExpose();
        assertTrue(exposedPorts.contains("1111/udp"));
        assertTrue(exposedPorts.contains("2222/tcp"));
    }

