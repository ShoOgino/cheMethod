  @Test
  public void shouldOverrideMemoryLimitFromExtendedMachineInAnEnv() throws Exception {
    // given
    Map<String, InternalMachineConfig> machines =
        ImmutableMap.of(
            "machine1", mockMachine(singletonMap("memoryLimitBytes", "101010")),
            "machine2", mockMachine());
    when(environment.getMachines()).thenReturn(machines);

    DockerEnvironment dockerEnv = new DockerEnvironment();
    dockerEnv.getContainers().put("machine1", new DockerContainerConfig());
    dockerEnv.getContainers().put("machine2", new DockerContainerConfig());
    when(envParser.parse(environment)).thenReturn(dockerEnv);

    DockerEnvironment expected = new DockerEnvironment();
    expected.getContainers().put("machine1", new DockerContainerConfig().setMemLimit(101010L));
    expected.getContainers().put("machine2", new DockerContainerConfig());

    // when
    DockerEnvironment actual = parser.parse(environment);

    // then
    assertEquals(actual, expected);
  }

