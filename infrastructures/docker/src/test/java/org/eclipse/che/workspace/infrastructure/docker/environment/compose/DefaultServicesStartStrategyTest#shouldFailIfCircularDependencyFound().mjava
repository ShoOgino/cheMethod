    @Test(expectedExceptions = IllegalArgumentException.class,
          expectedExceptionsMessageRegExp = "Launch order of machines '.*, .*' can't be evaluated. Circular dependency.")
    public void shouldFailIfCircularDependencyFound() throws Exception {
        // given
        CheServicesEnvironmentImpl composeEnvironment = new CheServicesEnvironmentImpl();
        composeEnvironment.getServices().put("second", new CheServiceImpl().withDependsOn(singletonList("third")));
        composeEnvironment.getServices().put("third", new CheServiceImpl().withDependsOn(singletonList("second")));
        composeEnvironment.getServices().put("first", new CheServiceImpl());

        // when
        strategy.order(composeEnvironment);
    }

