  private static Environment environment(String... names) {
    Map<String, MachineConfig> configs = new HashMap<>();
    for (String name : names) {
      configs.put(name, mock(MachineConfig.class));
    }

    Environment environment = mock(Environment.class);
    doReturn(configs).when(environment).getMachines();
    when(environment.toString()).thenReturn(Arrays.toString(names));
    return environment;
  }

