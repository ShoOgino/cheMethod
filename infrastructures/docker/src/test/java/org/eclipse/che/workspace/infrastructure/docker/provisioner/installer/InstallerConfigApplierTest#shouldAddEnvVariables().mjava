  @Test
  public void shouldAddEnvVariables() throws Exception {
    when(installerRegistry.getOrderedInstallers(any())).thenReturn(asList(installer1, installer2));
    when(installer1.getProperties()).thenReturn(singletonMap("environment", "p1=v1,p2=v2"));
    when(installer2.getProperties()).thenReturn(singletonMap("environment", "p3=v3"));
    DockerContainerConfig service = new DockerContainerConfig();

    installerConfigApplier.apply(
        new MachineConfigImpl(asList("installer1", "installer2"), emptyMap(), emptyMap()), service);

    Map<String, String> env = service.getEnvironment();
    assertEquals(env.size(), 3);
    assertEquals(env.get("p1"), "v1");
    assertEquals(env.get("p2"), "v2");
    assertEquals(env.get("p3"), "v3");
  }

