    private String prepareImage(String machineName,
                                DockerService service,
                                ProgressMonitor progressMonitor)
            throws ServerException,
                   NotFoundException {

        String imageName = "eclipse-che/" + service.getContainerName();
        if ((service.getBuild() == null || (service.getBuild().getContext() == null &&
                                            service.getBuild().getDockerfileContent() == null)) &&
            service.getImage() == null) {

            throw new ServerException(format("Che service '%s' doesn't have neither build nor image fields",
                                             machineName));
        }

        if (service.getBuild() != null && (service.getBuild().getContext() != null ||
                                           service.getBuild().getDockerfileContent() != null)) {
            buildImage(service, imageName, doForcePullOnBuild, progressMonitor);
        } else {
            pullImage(service, imageName, progressMonitor);
        }

        return imageName;
    }

