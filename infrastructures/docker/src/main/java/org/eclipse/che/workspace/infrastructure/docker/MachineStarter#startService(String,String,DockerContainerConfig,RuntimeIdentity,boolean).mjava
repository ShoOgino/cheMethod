    /**
     * Start Docker machine by performing all needed operations such as pull, build, create container, etc.
     *
     * @param networkName
     *         name of a network Docker container should use
     * @param machineName
     *         name of Docker machine
     * @param containerConfig
     *         configuration of container to start
     * @param identity
     *         identity of user that starts machine
     * @param isDev
     *         whether machine is dev or not
     * @return {@link DockerMachine} instance that represents started container
     * @throws InternalInfrastructureException
     *         if internal error occurs
     * @throws SourceNotFoundException
     *         if image for container creation is missing
     * @throws InfrastructureException
     *         if any other error occurs
     */
    public DockerMachine startService(String networkName,
                                      String machineName,
                                      DockerContainerConfig containerConfig,
                                      RuntimeIdentity identity,
                                      boolean isDev) throws InfrastructureException {
        String workspaceId = identity.getWorkspaceId();

        // copy to not affect/be affected by changes in origin
        containerConfig = new DockerContainerConfig(containerConfig);

        // TODO spi fix in #5102
        ProgressMonitor progressMonitor = ProgressMonitor.DEV_NULL;
        /*LineConsumer machineLogger = new ListLineConsumer();
        ProgressLineFormatterImpl progressLineFormatter = new ProgressLineFormatterImpl();
        ProgressMonitor progressMonitor = currentProgressStatus -> {
            try {
                machineLogger.writeLine(progressLineFormatter.format(currentProgressStatus));
            } catch (IOException e) {
                LOG.error(e.getLocalizedMessage(), e);
            }
        };*/

        String container = null;
        try {
            String image = prepareImage(machineName,
                                        containerConfig,
                                        progressMonitor);

            container = createContainer(workspaceId,
                                        machineName,
                                        isDev,
                                        image,
                                        networkName,
                                        containerConfig);

            connectContainerToAdditionalNetworks(container,
                                                 containerConfig);

            docker.startContainer(StartContainerParams.create(container));

            checkContainerIsRunning(container);

            // TODO spi fix in #5102
            /*readContainerLogsInSeparateThread(container,
                                              workspaceId,
                                              service.getId(),
                                              machineLogger);*/

            dockerInstanceStopDetector.startDetection(container,
                                                      containerConfig.getId(),
                                                      workspaceId);

            return new DockerMachine(docker,
                                     registry,
                                     registryNamespace,
                                     snapshotUseRegistry,
                                     container,
                                     image,
                                     serverEvaluationStrategyProvider,
                                     dockerInstanceStopDetector);
        } catch (RuntimeException | IOException | InfrastructureException e) {
            cleanUpContainer(container);
            if (e instanceof InfrastructureException) {
                throw (InfrastructureException)e;
            } else {
                throw new InternalInfrastructureException(e.getLocalizedMessage(), e);
            }
        }
    }

