  private void normalize(
      String namespace, String workspaceId, String machineName, DockerContainerConfig container)
      throws InfrastructureException {

    // download dockerfile if it is hosted by API to avoid problems with unauthorized requests from docker daemon
    if (container.getBuild() != null
        && container.getBuild().getContext() != null
        && recipeApiPattern.matcher(container.getBuild().getContext()).matches()) {

      String recipeContent;
      try {
        recipeContent = recipeDownloader.getRecipe(container.getBuild().getContext());
      } catch (ServerException e) {
        throw new InfrastructureException(e.getLocalizedMessage(), e);
      }
      container.getBuild().setDockerfileContent(recipeContent);
      container.getBuild().setContext(null);
      container.getBuild().setDockerfilePath(null);
    }
    if (container.getId() == null) {
      container.setId(generateMachineId());
    }

    container.setContainerName(
        containerNameGenerator.generateContainerName(
            workspaceId, container.getId(), namespace, machineName));
  }

