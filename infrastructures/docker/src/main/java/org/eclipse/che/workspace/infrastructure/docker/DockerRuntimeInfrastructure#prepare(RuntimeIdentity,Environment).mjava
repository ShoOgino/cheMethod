    @Override
    public DockerRuntimeContext prepare(RuntimeIdentity identity, Environment originEnv)
            throws ValidationException, InfrastructureException {
        // TODO spi: get recipe from non-impl specific code
        // Copy to be able to change env and protect from env changes by method caller
        EnvironmentImpl environment = new EnvironmentImpl(originEnv);
        DockerEnvironment dockerEnvironment = dockerEnvironmentParser.parse(environment);
        dockerEnvironmentValidator.validate(environment, dockerEnvironment);
        // check that services start order can be resolved
        List<String> orderedServices = startStrategy.order(dockerEnvironment);

        // modify environment with everything needed to use docker machines on particular (cloud) infrastructure
        infrastructureProvisioner.provision(environment, dockerEnvironment, identity);
        // normalize env to provide environment description with absolutely everything expected in
        environmentNormalizer.normalize(environment, dockerEnvironment, identity);

        return new DockerRuntimeContext(this,
                                        identity,
                                        environment,
                                        dockerEnvironment,
                                        orderedServices,
                                        installerRegistry,
                                        runtimeFactory);
    }

