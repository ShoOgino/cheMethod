    private String prepareImage(String machineName,
                                DockerContainerConfig service,
                                ProgressMonitor progressMonitor)
            throws SourceNotFoundException,
                   InternalInfrastructureException {

        String imageName = "eclipse-che/" + service.getContainerName();
        if ((service.getBuild() == null || (service.getBuild().getContext() == null &&
                                            service.getBuild().getDockerfileContent() == null)) &&
            service.getImage() == null) {

            throw new InternalInfrastructureException(
                    format("Che service '%s' doesn't have neither build nor image fields", machineName));
        }

        if (service.getBuild() != null && (service.getBuild().getContext() != null ||
                                           service.getBuild().getDockerfileContent() != null)) {
            buildImage(service, imageName, doForcePullImage, progressMonitor);
        } else {
            pullImage(service, imageName, progressMonitor);
        }

        return imageName;
    }

