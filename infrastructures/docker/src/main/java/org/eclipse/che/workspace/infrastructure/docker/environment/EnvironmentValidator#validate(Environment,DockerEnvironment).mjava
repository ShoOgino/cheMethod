  public void validate(Environment env, DockerEnvironment dockerEnvironment)
      throws ValidationException, InfrastructureException {
    checkArgument(
        dockerEnvironment.getContainers() != null && !dockerEnvironment.getContainers().isEmpty(),
        "Environment should contain at least 1 machine");

    checkArgument(
        env.getMachines() != null && !env.getMachines().isEmpty(),
        "Environment doesn't contain machine with 'org.eclipse.che.ws-agent' agent");

    List<String> missingContainers =
        env.getMachines()
            .keySet()
            .stream()
            .filter(machineName -> !dockerEnvironment.getContainers().containsKey(machineName))
            .collect(toList());
    checkArgument(
        missingContainers.isEmpty(),
        "Environment 'contains machines that are missing in environment recipe: %s",
        Joiner.on(", ").join(missingContainers));

    List<String> devMachines =
        env.getMachines()
            .entrySet()
            .stream()
            .filter(
                entry ->
                    InstallerFqn.idInKeyList(
                        "org.eclipse.che.ws-agent", entry.getValue().getInstallers()))
            .map(Map.Entry::getKey)
            .collect(toList());

    checkArgument(
        devMachines.size() == 1,
        "Environment should contain exactly 1 machine with agent 'org.eclipse.che.ws-agent', but contains '%s'. "
            + "All machines with this agent: %s",
        devMachines.size(),
        Joiner.on(", ").join(devMachines));

    // needed to validate different kinds of dependencies in containers to other containers
    Set<String> containersNames = dockerEnvironment.getContainers().keySet();

    for (Map.Entry<String, DockerContainerConfig> entry :
        dockerEnvironment.getContainers().entrySet()) {
      validateMachine(
          entry.getKey(), env.getMachines().get(entry.getKey()), entry.getValue(), containersNames);
    }
  }

