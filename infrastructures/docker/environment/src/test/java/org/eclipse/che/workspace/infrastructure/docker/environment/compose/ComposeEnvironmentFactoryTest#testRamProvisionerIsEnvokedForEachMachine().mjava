  @Test
  public void testRamProvisionerIsEnvokedForEachMachine() throws Exception {
    final long customRamLimit = 3072 * BYTES_IN_MB;
    final long customRamRequest = 1536 * BYTES_IN_MB;
    final Map<String, String> attributes =
        ImmutableMap.of(
            MEMORY_LIMIT_ATTRIBUTE,
            String.valueOf(customRamLimit),
            MEMORY_REQUEST_ATTRIBUTE,
            String.valueOf(customRamRequest));
    final Map<String, InternalMachineConfig> machines = new HashMap<>();
    machines.put(MACHINE_NAME_1, mockInternalMachineConfig(attributes));
    final Map<String, ComposeService> services =
        ImmutableMap.of(
            MACHINE_NAME_1,
            mockComposeService(0L, 0L),
            MACHINE_NAME_2,
            mockComposeService(4608L, 2048L));

    composeEnvironmentFactory.addRamAttributes(machines, services);

    verify(memoryProvisioner).provision(any(), eq(0L), eq(0L));
    verify(memoryProvisioner).provision(any(), eq(4608L), eq(2048L));
  }

