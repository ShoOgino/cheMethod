  @Test
  public void shouldSucceedOnValidationOfValidEnvironment() throws Exception {
    // given
    String machine2Name = "anotherMachine";
    ComposeService container2 = mock(ComposeService.class);
    when(container2.getImage()).thenReturn("test/image:latest");
    when(composeEnv.getMachines()).thenReturn(singletonMap(MACHINE_NAME, machineConfig));
    when(composeEnv.getServices())
        .thenReturn(
            newLinkedHashMap(ImmutableMap.of(MACHINE_NAME, service, machine2Name, container2)));
    ServerConfigImpl server =
        new ServerConfigImpl()
            .withPort("8080")
            .withPath("/some/path")
            .withProtocol("https")
            .withAttributes(singletonMap("key", "value"));
    when(machineConfig.getServers())
        .thenReturn(singletonMap(Constants.SERVER_WS_AGENT_HTTP_REFERENCE, server));
    Map<String, String> attributes =
        ImmutableMap.of("testKey", "value", MEMORY_LIMIT_ATTRIBUTE, "1000000000");
    when(machineConfig.getAttributes()).thenReturn(attributes);
    when(service.getExpose()).thenReturn(ImmutableSet.of("8090", "9090/tcp", "7070/udp"));
    when(service.getLinks()).thenReturn(singletonList(machine2Name + ":alias1"));
    when(service.getDependsOn()).thenReturn(singletonList(machine2Name));
    when(service.getVolumesFrom()).thenReturn(singletonList(machine2Name + ":ro"));

    // when
    composeEnvironmentValidator.validate(composeEnv);
  }

