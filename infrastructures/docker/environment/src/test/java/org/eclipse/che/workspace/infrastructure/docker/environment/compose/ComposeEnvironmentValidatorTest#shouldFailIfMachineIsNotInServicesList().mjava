  @Test(
    expectedExceptions = ValidationException.class,
    expectedExceptionsMessageRegExp =
        "Environment contains machines that are missing in environment recipe: .*"
  )
  public void shouldFailIfMachineIsNotInServicesList() throws Exception {
    // given
    when(composeEnv.getMachines()).thenReturn(singletonMap(MACHINE_NAME, machineConfig));
    when(composeEnv.getServices()).thenReturn(newLinkedHashMap(singletonMap("machine2", service)));

    // when
    composeEnvironmentValidator.validate(composeEnv);
  }

