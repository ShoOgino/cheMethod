  @VisibleForTesting
  void addRamLimitAttribute(
      Map<String, InternalMachineConfig> machines, Map<String, ComposeService> services)
      throws InfrastructureException {
    for (Entry<String, ComposeService> entry : services.entrySet()) {
      InternalMachineConfig machineConfig;
      if ((machineConfig = machines.get(entry.getKey())) == null) {
        machineConfig = new InternalMachineConfig();
        machines.put(entry.getKey(), machineConfig);
      }
      final Map<String, String> attributes = machineConfig.getAttributes();
      if (isNullOrEmpty(attributes.get(MEMORY_LIMIT_ATTRIBUTE))) {
        final Long ramLimit = entry.getValue().getMemLimit();
        if (ramLimit != null && ramLimit > 0) {
          attributes.put(MEMORY_LIMIT_ATTRIBUTE, String.valueOf(ramLimit));
        }
      }
    }
  }

