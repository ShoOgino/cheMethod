  @Test(
    expectedExceptions = DockerException.class,
    expectedExceptionsMessageRegExp = "Docker image pushing failed. Cause: test error"
  )
  public void shouldThrowDockerExceptionWhenPushFails() throws IOException, InterruptedException {
    String dockerPushOutput =
        "{\"progress\":\"[=====>              ] 25%\"}\n"
            + "{\"progress\":\"[===============>    ] 75%\"}\n"
            + "{\"error\":\"test error\"}\n";

    when(dockerResponse.getInputStream())
        .thenReturn(new ByteArrayInputStream(dockerPushOutput.getBytes()));
    PushParams pushParams = PushParams.create(REPOSITORY);

    dockerConnector.push(pushParams, progressMonitor);
  }

