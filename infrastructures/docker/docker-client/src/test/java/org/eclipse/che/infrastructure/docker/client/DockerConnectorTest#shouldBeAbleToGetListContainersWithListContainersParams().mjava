  @Test
  public void shouldBeAbleToGetListContainersWithListContainersParams()
      throws IOException, JsonParseException {
    ListContainersParams listContainersParams =
        ListContainersParams.create().withAll(true).withSize(true);
    ContainerListEntry containerListEntry = mock(ContainerListEntry.class);
    List<ContainerListEntry> expectedListContainers = singletonList(containerListEntry);

    doReturn(expectedListContainers)
        .when(dockerConnector)
        .parseResponseStreamAndClose(
            eq(inputStream),
            org.mockito.ArgumentMatchers.<TypeToken<List<ContainerListEntry>>>any());

    List<ContainerListEntry> containers = dockerConnector.listContainers(listContainersParams);

    verify(dockerConnectionFactory).openConnection(nullable(URI.class));
    verify(dockerConnection).method(REQUEST_METHOD_GET);
    verify(dockerConnection).path("/containers/json");
    verify(dockerConnection).query("all", 1);
    verify(dockerConnection).query("size", 1);
    verify(dockerConnection).request();
    verify(dockerResponse).getStatus();
    verify(dockerResponse).getInputStream();
    verify(dockerConnector)
        .parseResponseStreamAndClose(
            eq(inputStream),
            org.mockito.ArgumentMatchers.<TypeToken<List<ContainerListEntry>>>any());

    assertEquals(containers, expectedListContainers);
  }

