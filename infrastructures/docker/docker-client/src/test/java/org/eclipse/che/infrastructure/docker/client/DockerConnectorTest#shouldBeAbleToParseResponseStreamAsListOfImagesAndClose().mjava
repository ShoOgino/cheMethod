  @Test
  public void shouldBeAbleToParseResponseStreamAsListOfImagesAndClose()
      throws IOException, JsonParseException {
    String response =
        "[\n"
            + "  {\n"
            + "     \"RepoTags\": [\n"
            + "       \"ubuntu:12.04\",\n"
            + "       \"ubuntu:precise\",\n"
            + "       \"ubuntu:latest\"\n"
            + "     ],\n"
            + "     \"Id\": \"8dbd9e392a964056420e5d58ca5cc376ef18e2de93b5cc90e868a1bbc8318c1c\",\n"
            + "     \"Created\": 1365714795,\n"
            + "     \"Size\": 131506275,\n"
            + "     \"VirtualSize\": 131506275,\n"
            + "     \"Labels\": {}\n"
            + "  },\n"
            + "  {\n"
            + "     \"RepoTags\": [\n"
            + "       \"ubuntu:12.10\",\n"
            + "       \"ubuntu:quantal\"\n"
            + "     ],\n"
            + "     \"ParentId\": \"27cf784147099545\",\n"
            + "     \"Id\": \"b750fe79269d2ec9a3c593ef05b4332b1d1a02a62b4accb2c21d589ff2f5f2dc\",\n"
            + "     \"Created\": 1364102658,\n"
            + "     \"Size\": 24653,\n"
            + "     \"VirtualSize\": 180116135,\n"
            + "     \"Labels\": {\n"
            + "        \"com.example.version\": \"v1\"\n"
            + "     }\n"
            + "  }\n"
            + "]\n";

    List<Image> images =
        dockerConnector.parseResponseStreamAndClose(
            new ByteArrayInputStream(response.getBytes()), new TypeToken<List<Image>>() {});
    assertEquals(images.size(), 2);
    Image actualImage1 = images.get(0);
    Image actualImage2 = images.get(1);

    assertEquals(
        actualImage1.getRepoTags(),
        new String[] {"ubuntu:12.04", "ubuntu:precise", "ubuntu:latest"});
    assertEquals(
        actualImage1.getId(), "8dbd9e392a964056420e5d58ca5cc376ef18e2de93b5cc90e868a1bbc8318c1c");
    assertEquals(actualImage1.getCreated(), 1365714795);
    assertEquals(actualImage1.getSize(), 131506275);
    assertEquals(actualImage1.getVirtualSize(), 131506275);
    assertEquals(actualImage1.getLabels(), emptyMap());

    assertEquals(actualImage2.getRepoTags(), new String[] {"ubuntu:12.10", "ubuntu:quantal"});
    assertEquals(
        actualImage2.getId(), "b750fe79269d2ec9a3c593ef05b4332b1d1a02a62b4accb2c21d589ff2f5f2dc");
    assertEquals(actualImage2.getParentId(), "27cf784147099545");
    assertEquals(actualImage2.getCreated(), 1364102658);
    assertEquals(actualImage2.getSize(), 24653);
    assertEquals(actualImage2.getVirtualSize(), 180116135);
    assertEquals(actualImage2.getLabels(), singletonMap("com.example.version", "v1"));
  }

