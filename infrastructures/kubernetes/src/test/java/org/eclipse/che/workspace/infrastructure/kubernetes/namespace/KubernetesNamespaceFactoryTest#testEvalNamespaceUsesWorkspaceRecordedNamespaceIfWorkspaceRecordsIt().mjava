  @Test
  public void testEvalNamespaceUsesWorkspaceRecordedNamespaceIfWorkspaceRecordsIt()
      throws Exception {

    namespaceFactory =
        new KubernetesNamespaceFactory(
            "blabol-<userid>-<username>-<userid>-<username>--",
            "",
            "",
            "che-<userid>",
            false,
            clientFactory,
            workspaceManager);

    when(workspaceManager.getWorkspace(eq("42")))
        .thenReturn(
            WorkspaceImpl.builder()
                .setId("42")
                .setAttributes(
                    singletonMap(
                        Constants.WORKSPACE_INFRASTRUCTURE_NAMESPACE_ATTRIBUTE, "wkspcnmspc"))
                .build());

    String namespace =
        namespaceFactory.evalNamespaceName("42", new SubjectImpl("JonDoe", "123", null, false));

    assertEquals(namespace, "wkspcnmspc");
  }

