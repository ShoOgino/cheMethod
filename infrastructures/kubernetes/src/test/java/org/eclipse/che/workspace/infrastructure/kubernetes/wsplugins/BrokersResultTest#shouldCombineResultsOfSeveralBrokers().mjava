  @Test
  public void shouldCombineResultsOfSeveralBrokers() throws Exception {
    // given
    brokersResult.oneMoreBroker();
    ChePlugin chePlugin = new ChePlugin();
    brokersResult.oneMoreBroker();
    ChePlugin chePlugin2 = new ChePlugin();
    executeWhenResultIsStarted(
        () -> {
          brokersResult.brokerResult(singletonList(chePlugin));
          brokersResult.brokerResult(singletonList(chePlugin2));
          return null;
        });

    // when
    List<ChePlugin> chePlugins = brokersResult.get(2, TimeUnit.SECONDS);

    // then
    assertEquals(chePlugins, asList(chePlugin, chePlugin2));
  }

