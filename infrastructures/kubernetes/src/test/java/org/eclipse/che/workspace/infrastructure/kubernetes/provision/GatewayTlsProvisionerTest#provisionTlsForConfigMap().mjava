  @Test
  public void provisionTlsForConfigMap() throws Exception {
    // given
    GatewayTlsProvisioner<KubernetesEnvironment> ingressTlsProvisioner =
        new GatewayTlsProvisioner<>(true);

    configMap
        .getMetadata()
        .getAnnotations()
        .putAll(Annotations.newSerializer().servers(servers).machineName(machine).annotations());

    Map<String, ConfigMap> configMaps = new HashMap<>();
    configMaps.put("cm", configMap);
    when(k8sEnv.getConfigMaps()).thenReturn(configMaps);

    // when
    ingressTlsProvisioner.provision(k8sEnv, runtimeIdentity);

    // then
    Map<String, ServerConfigImpl> servers =
        Annotations.newDeserializer(configMap.getMetadata().getAnnotations()).servers();
    assertEquals(servers.get("http-server").getProtocol(), "https");
    assertEquals(servers.get("ws-server").getProtocol(), "wss");
  }

