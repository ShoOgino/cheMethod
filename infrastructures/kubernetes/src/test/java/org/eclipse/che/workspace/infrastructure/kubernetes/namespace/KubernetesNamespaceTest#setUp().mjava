  @BeforeMethod
  public void setUp() throws Exception {
    lenient().when(clientFactory.create()).thenReturn(kubernetesClient);
    lenient().when(clientFactory.create(anyString())).thenReturn(kubernetesClient);

    lenient().doReturn(namespaceOperation).when(kubernetesClient).namespaces();

    final MixedOperation mixedOperation = mock(MixedOperation.class);
    final NonNamespaceOperation namespaceOperation = mock(NonNamespaceOperation.class);
    lenient().doReturn(mixedOperation).when(kubernetesClient).serviceAccounts();
    lenient().when(mixedOperation.inNamespace(anyString())).thenReturn(namespaceOperation);
    lenient().when(namespaceOperation.withName(anyString())).thenReturn(serviceAccountResource);
    lenient().when(serviceAccountResource.get()).thenReturn(mock(ServiceAccount.class));

    // Model DSL: client.pods().inNamespace(...).withName(...).get().getMetadata().getName();
    doReturn(podsMixedOperation).when(kubernetesClient).pods();
    doReturn(podsNamespaceOperation).when(podsMixedOperation).inNamespace(anyString());
    doReturn(podResource).when(podsNamespaceOperation).withName(anyString());
    doReturn(pod).when(podResource).get();
    lenient().doReturn(podMetadata).when(pod).getMetadata();

    doReturn(apps).when(kubernetesClient).apps();
    doReturn(deploymentsMixedOperation).when(apps).deployments();
    doReturn(deploymentsNamespaceOperation)
        .when(deploymentsMixedOperation)
        .inNamespace(anyString());
    doReturn(deploymentResource).when(deploymentsNamespaceOperation).withName(anyString());
    doReturn(deployment).when(deploymentResource).get();
    lenient().doReturn(deploymentMetadata).when(deployment).getMetadata();

    k8sNamespace =
        new KubernetesNamespace(
            clientFactory,
            WORKSPACE_ID,
            NAMESPACE,
            deployments,
            services,
            pvcs,
            ingresses,
            secrets,
            configMaps);
  }

