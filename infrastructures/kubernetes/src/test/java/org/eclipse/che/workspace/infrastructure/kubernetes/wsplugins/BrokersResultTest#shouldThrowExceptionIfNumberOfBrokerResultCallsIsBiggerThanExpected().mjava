  @Test(
      expectedExceptions = InfrastructureException.class,
      expectedExceptionsMessageRegExp =
          "Broker result is submitted when no more results are expected")
  public void shouldThrowExceptionIfNumberOfBrokerResultCallsIsBiggerThanExpected()
      throws Exception {
    // given
    brokersResult.oneMoreBroker();
    brokersResult.oneMoreBroker();
    brokersResult.oneMoreBroker();
    executeBrokerGet();
    waitBrokerGetCalled();

    // when
    brokersResult.brokerResult(singletonList(new ChePlugin()));
    brokersResult.brokerResult(singletonList(new ChePlugin()));
    brokersResult.brokerResult(singletonList(new ChePlugin()));

    // then
    brokersResult.brokerResult(singletonList(new ChePlugin()));
  }

