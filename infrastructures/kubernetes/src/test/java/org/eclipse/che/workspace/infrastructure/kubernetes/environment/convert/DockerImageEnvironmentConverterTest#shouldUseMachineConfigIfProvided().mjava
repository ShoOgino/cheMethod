  @Test
  public void shouldUseMachineConfigIfProvided() throws Exception {
    // given
    doReturn(new EntryPoint(singletonList("/teh/script"), asList("teh", "argz")))
        .when(entryPointParser)
        .parse(any());

    InternalMachineConfig machineConfig = mock(InternalMachineConfig.class);

    Map<String, InternalMachineConfig> machines = new HashMap<>(1);
    machines.put(MACHINE_NAME, machineConfig);

    when(dockerEnv.getMachines()).thenReturn(machines);
    when(dockerEnv.getRecipe()).thenReturn(recipe);

    Container ctn = pod.getSpec().getContainers().get(0);
    ctn.setCommand(singletonList("/teh/script"));
    ctn.setArgs(asList("teh", "argz"));

    // when
    KubernetesEnvironment env = converter.convert(dockerEnv);

    // then
    assertEquals(pod, env.getPodsCopy().values().iterator().next());
    assertEquals(recipe, env.getRecipe());
    assertEquals(machines, env.getMachines());
  }

