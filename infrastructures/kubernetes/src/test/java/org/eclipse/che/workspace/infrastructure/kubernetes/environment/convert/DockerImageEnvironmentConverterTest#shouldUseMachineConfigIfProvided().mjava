  @Test
  public void shouldUseMachineConfigIfProvided() throws Exception {
    // given
    Map<String, String> attributes = new HashMap<>(2);
    attributes.put(MachineConfig.CONTAINER_COMMAND_ATTRIBUTE, "[/teh/script]");
    attributes.put(MachineConfig.CONTAINER_ARGS_ATTRIBUTE, "['teh', 'argz']");

    InternalMachineConfig machineConfig = mock(InternalMachineConfig.class);
    when(machineConfig.getAttributes()).thenReturn(attributes);

    Map<String, InternalMachineConfig> machines = new HashMap<>(1);
    machines.put(MACHINE_NAME, machineConfig);

    when(dockerEnv.getMachines()).thenReturn(machines);
    when(dockerEnv.getRecipe()).thenReturn(recipe);

    Container ctn = pod.getSpec().getContainers().get(0);
    ctn.setCommand(singletonList("/teh/script"));
    ctn.setArgs(asList("teh", "argz"));

    // when
    KubernetesEnvironment env = converter.convert(dockerEnv);

    // then
    assertEquals(pod, env.getPodsCopy().values().iterator().next());
    assertEquals(recipe, env.getRecipe());
    assertEquals(machines, env.getMachines());
  }

