  @Test(
      expectedExceptions = InfrastructureException.class,
      expectedExceptionsMessageRegExp =
          "Broker result is submitted when no more results are expected")
  public void shouldThrowExceptionIfNumberOfAddResultCallsIsBiggerThanExpected() throws Exception {
    // given
    brokersResult.oneMoreBroker();
    brokersResult.oneMoreBroker();
    brokersResult.oneMoreBroker();
    executeBrokerGet();
    waitBrokerGetCalled();

    // when
    brokersResult.addResult(singletonList(new ChePlugin()));
    brokersResult.addResult(singletonList(new ChePlugin()));
    brokersResult.addResult(singletonList(new ChePlugin()));

    // then
    brokersResult.addResult(singletonList(new ChePlugin()));
  }

