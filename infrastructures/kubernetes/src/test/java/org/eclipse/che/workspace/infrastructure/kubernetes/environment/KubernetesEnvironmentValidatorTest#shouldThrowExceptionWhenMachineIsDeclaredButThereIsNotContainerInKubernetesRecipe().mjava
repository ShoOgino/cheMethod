  @Test(
    expectedExceptions = ValidationException.class,
    expectedExceptionsMessageRegExp =
        "Environment contains machines that are missing in recipe: pod1/db"
  )
  public void shouldThrowExceptionWhenMachineIsDeclaredButThereIsNotContainerInKubernetesRecipe()
      throws Exception {
    // given
    Pod pod = createPod("pod1", "main");
    when(kubernetesEnvironment.getPods()).thenReturn(ImmutableMap.of("pod1", pod));
    when(kubernetesEnvironment.getMachines())
        .thenReturn(ImmutableMap.of("pod1/db", mock(InternalMachineConfig.class)));

    // when
    environmentValidator.validate(kubernetesEnvironment);
  }

