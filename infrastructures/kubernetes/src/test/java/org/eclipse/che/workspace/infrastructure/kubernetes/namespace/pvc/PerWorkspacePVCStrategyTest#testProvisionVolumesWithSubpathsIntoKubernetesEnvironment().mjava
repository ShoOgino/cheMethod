  @Test
  public void testProvisionVolumesWithSubpathsIntoKubernetesEnvironment() throws Exception {
    perWorkspaceStratefy.provision(k8sEnv, IDENTITY);

    final Map<String, PersistentVolumeClaim> actual = k8sEnv.getPersistentVolumeClaims();
    assertFalse(actual.isEmpty());
    assertTrue(actual.containsKey(PVC_NAME));
    Set<String> subpaths =
        Arrays.stream(
                (String[])
                    actual
                        .get(PVC_NAME)
                        .getAdditionalProperties()
                        .get(format(SUBPATHS_PROPERTY_FMT, WORKSPACE_ID)))
            .collect(Collectors.toSet());
    assertEquals(subpaths.size(), 2);
    assertTrue(subpaths.contains(expectedVolumeDir(VOLUME_1_NAME)));
    assertTrue(subpaths.contains(expectedVolumeDir(VOLUME_2_NAME)));
  }

