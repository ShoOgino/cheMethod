  @Test
  public void testEmptyDirVolumeMountsSharedBetweenContainers() throws Exception {
    Container container1 = new Container();
    Container container2 = new Container();
    Pod pod = buildPod(POD_NAME, container1, container2);
    k8sEnv.addPod(pod);

    ephemeralWorkspaceAdapter.provision(k8sEnv, runtimeIdentity);

    List<Container> podContainers = pod.getSpec().getContainers();
    List<VolumeMount> container1Mounts = podContainers.get(0).getVolumeMounts();
    List<VolumeMount> container2Mounts = podContainers.get(1).getVolumeMounts();
    assertTrue(container1Mounts.stream().allMatch(container2Mounts::contains));
    assertEquals(pod.getSpec().getVolumes().size(), volumes.size());

    List<String> podVolumeNames =
        pod.getSpec()
            .getVolumes()
            .stream()
            .map(io.fabric8.kubernetes.api.model.Volume::getName)
            .collect(Collectors.toList());
    assertTrue(
        container1Mounts.stream().map(VolumeMount::getName).allMatch(podVolumeNames::contains));
  }

