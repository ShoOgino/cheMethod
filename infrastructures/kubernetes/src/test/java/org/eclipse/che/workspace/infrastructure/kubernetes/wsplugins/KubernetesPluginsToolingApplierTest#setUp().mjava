  @BeforeMethod
  public void setUp() {
    internalEnvironment = spy(KubernetesEnvironment.builder().build());
    applier = new KubernetesPluginsToolingApplier(TEST_IMAGE_POLICY, MEMORY_LIMIT_MB, false);

    Map<String, InternalMachineConfig> machines = new HashMap<>();
    containers = new ArrayList<>();
    containers.add(userContainer);
    machines.put(USER_MACHINE_NAME, userMachineConfig);

    internalEnvironment.getPods().put(POD_NAME, pod);
    when(pod.getSpec()).thenReturn(podSpec);
    when(podSpec.getContainers()).thenReturn(containers);
    when(pod.getMetadata()).thenReturn(meta);
    when(meta.getName()).thenReturn(POD_NAME);
    internalEnvironment.getMachines().putAll(machines);
  }

