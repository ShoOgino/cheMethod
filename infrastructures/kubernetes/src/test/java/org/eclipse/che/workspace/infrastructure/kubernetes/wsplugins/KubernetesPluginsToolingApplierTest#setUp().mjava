  @BeforeMethod
  public void setUp() {
    applier = new KubernetesPluginsToolingApplier(TEST_IMAGE_POLICY, MEMORY_LIMIT_MB, false);

    Map<String, InternalMachineConfig> machines = new HashMap<>();
    List<Container> containers = new ArrayList<>();
    Map<String, Service> services = new HashMap<>();

    containers.add(userContainer);
    machines.put(USER_MACHINE_NAME, userMachineConfig);

    when(internalEnvironment.getPods()).thenReturn(of(POD_NAME, pod));
    when(pod.getSpec()).thenReturn(podSpec);
    when(podSpec.getContainers()).thenReturn(containers);
    when(pod.getMetadata()).thenReturn(meta);
    when(meta.getName()).thenReturn(POD_NAME);
    when(internalEnvironment.getMachines()).thenReturn(machines);
    lenient().when(internalEnvironment.getServices()).thenReturn(services);
    Map<String, String> attributes = new HashMap<>();
    when(internalEnvironment.getAttributes()).thenReturn(attributes);
  }

