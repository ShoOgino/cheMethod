  private boolean isNamespaceManaged(KubernetesClient client) throws InfrastructureException {
    try {
      Namespace namespace = client.namespaces().withName(name).get();
      return namespace.getMetadata().getLabels() != null
          && "true".equals(namespace.getMetadata().getLabels().get(MANAGED_NAMESPACE_LABEL));
    } catch (KubernetesClientException e) {
      if (e.getCode() == 403) {
        throw new InfrastructureException(
            format(
                "Could not access the namespace %s when trying to determine if it is managed "
                    + "for workspace %s",
                name, workspaceId),
            e);
      } else if (e.getCode() == 404) {
        // we don't want to block whatever work the caller is doing on the namespace. The caller
        // will fail anyway if the namespace doesn't exist.
        return true;
      }

      throw new KubernetesInfrastructureException(e);
    }
  }

