  @Override
  @Traced
  public void provision(KubernetesEnvironment k8sEnv, RuntimeIdentity identity)
      throws InfrastructureException {

    TracingTags.WORKSPACE_ID.set(identity::getWorkspaceId);

    final Map<String, InternalMachineConfig> machines = k8sEnv.getMachines();
    for (PodData pod : k8sEnv.getPodsData().values()) {
      for (Container container : pod.getSpec().getContainers()) {
        InternalMachineConfig machineConfig = machines.get(machineName(pod, container));
        memoryAttributeProvisioner.provision(
            machineConfig, Containers.getRamLimit(container), Containers.getRamRequest(container));
        final Map<String, String> attributes = machineConfig.getAttributes();
        String memoryLimitAttribute = attributes.get(MEMORY_LIMIT_ATTRIBUTE);
        if (memoryLimitAttribute != null) {
          Containers.addRamLimit(container, Long.parseLong(memoryLimitAttribute));
        }
        String memoryRequestAttribute = attributes.get(MEMORY_REQUEST_ATTRIBUTE);
        if (memoryRequestAttribute != null) {
          Containers.addRamRequest(container, Long.parseLong(memoryRequestAttribute));
        }
      }
    }
  }

