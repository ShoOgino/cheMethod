    @VisibleForTesting
    int findFreePort() throws InternalInfrastructureException {
      int newPort;
      do {
        newPort = freePort++;
        if (newPort > maxPort) {
          throw new InternalInfrastructureException(
              String.format(
                  "There is no available port in configured ports range [%s, %s].",
                  minPort, maxPort));
        }
      } while (!occupiedPorts.add(newPort));

      return newPort;
    }

