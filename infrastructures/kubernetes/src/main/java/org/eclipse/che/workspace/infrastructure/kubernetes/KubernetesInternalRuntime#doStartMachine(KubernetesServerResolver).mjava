  /**
   * Creates Kubernetes pods and resolves servers using the specified serverResolver.
   *
   * @param serverResolver server resolver that provide servers by container
   * @throws InfrastructureException when any error occurs while creating Kubernetes pods
   */
  protected void doStartMachine(KubernetesServerResolver serverResolver)
      throws InfrastructureException {
    machineStartupTraces =
        new ConcurrentHashMap<>(getContext().getEnvironment().getMachines().size());

    final KubernetesEnvironment environment = getContext().getEnvironment();
    final Map<String, InternalMachineConfig> machineConfigs = environment.getMachines();
    final String workspaceId = getContext().getIdentity().getWorkspaceId();
    LOG.debug("Begin pods creation for workspace '{}'", workspaceId);
    for (Pod toCreate : environment.getPodsCopy().values()) {
      startTracingContainersStartup(toCreate.getSpec(), toCreate.getMetadata());
      ObjectMeta toCreateMeta = toCreate.getMetadata();
      final Pod createdPod = namespace.deployments().deploy(toCreate);
      LOG.debug("Creating pod '{}' in workspace '{}'", toCreateMeta.getName(), workspaceId);
      startMachines(createdPod, toCreateMeta, machineConfigs, serverResolver);
    }
    for (Deployment toCreate : environment.getDeploymentsCopy().values()) {
      PodTemplateSpec template = toCreate.getSpec().getTemplate();
      startTracingContainersStartup(template.getSpec(), template.getMetadata());
      ObjectMeta toCreateMeta = toCreate.getMetadata();
      final Pod createdPod = namespace.deployments().deploy(toCreate);
      LOG.debug("Creating deployment '{}' in workspace '{}'", toCreateMeta.getName(), workspaceId);
      startMachines(createdPod, toCreateMeta, machineConfigs, serverResolver);
    }
    LOG.debug("Pods creation finished in workspace '{}'", workspaceId);
  }

