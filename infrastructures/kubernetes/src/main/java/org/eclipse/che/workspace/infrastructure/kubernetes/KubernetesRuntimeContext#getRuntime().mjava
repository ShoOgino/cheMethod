  @Override
  public KubernetesInternalRuntime getRuntime() throws InfrastructureException {
    Optional<KubernetesRuntimeState> runtimeStateOpt = runtimeStatuses.get(getIdentity());
    String workspaceId = getIdentity().getWorkspaceId();

    if (!runtimeStateOpt.isPresent()) {
      // there is no cached runtime, create a new one
      return runtimeFactory.create(
          this, namespaceFactory.create(workspaceId), getEnvironment().getWarnings());
    }

    // there is cached runtime, restore cached one
    KubernetesRuntimeState runtimeState = runtimeStateOpt.get();
    KubernetesInternalRuntime runtime =
        runtimeFactory.create(
            this,
            namespaceFactory.create(workspaceId, runtimeState.getNamespace()),
            getEnvironment().getWarnings());

    if (runtime.getStatus() == WorkspaceStatus.RUNNING) {
      runtime.startServersCheckers();
    }

    return runtime;
  }

