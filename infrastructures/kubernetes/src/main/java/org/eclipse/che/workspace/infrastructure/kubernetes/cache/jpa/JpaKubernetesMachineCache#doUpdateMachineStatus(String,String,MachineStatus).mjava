  @Transactional(rollbackOn = {RuntimeException.class, InfrastructureException.class})
  protected void doUpdateMachineStatus(String workspaceId, String machineName, MachineStatus status)
      throws InfrastructureException {
    EntityManager entityManager = managerProvider.get();

    KubernetesMachineImpl machine =
        entityManager.find(KubernetesMachineImpl.class, new MachineId(workspaceId, machineName));

    if (machine == null) {
      throw new InfrastructureException("Can't update machine status");
    }

    machine.setStatus(status);

    entityManager.flush();
  }

