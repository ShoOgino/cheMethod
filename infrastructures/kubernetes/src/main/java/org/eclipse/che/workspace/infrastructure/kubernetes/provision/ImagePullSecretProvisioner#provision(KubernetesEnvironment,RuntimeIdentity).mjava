  @Override
  public void provision(KubernetesEnvironment k8sEnv, RuntimeIdentity identity)
      throws InfrastructureException {

    AuthConfigs credentials = credentialsProvider.getCredentials();
    if (credentials == null) {
      return;
    }

    Map<String, AuthConfig> authConfigs = credentials.getConfigs();

    if (authConfigs == null || authConfigs.isEmpty()) {
      return;
    }

    String encodedConfig =
        Base64.getEncoder().encodeToString(generateDockerCfg(authConfigs).getBytes());

    Secret secret =
        new SecretBuilder()
            .addToData(".dockercfg", encodedConfig)
            .withType("kubernetes.io/dockercfg")
            .withNewMetadata()
            .withName(identity.getWorkspaceId() + SECRET_NAME_SUFFIX)
            .endMetadata()
            .build();

    k8sEnv.getSecrets().put(secret.getMetadata().getName(), secret);

    k8sEnv.getPods().values().forEach(p -> addImagePullSecret(secret.getMetadata().getName(), p));
  }

