  public KubernetesEnvironment convert(DockerImageEnvironment environment)
      throws InfrastructureException {

    final String dockerImage = environment.getRecipe().getContent();

    Map.Entry<String, InternalMachineConfig> e =
        environment.getMachines().entrySet().iterator().next();

    InternalMachineConfig machine = e.getValue();
    String machineName = e.getKey();

    ContainerBuilder container =
        new ContainerBuilder()
            .withImage(dockerImage)
            .withName(CONTAINER_NAME)
            .withImagePullPolicy("Always");

    applyEntryPoint(machine, container);

    final Map<String, String> annotations = new HashMap<>();
    annotations.put(format(MACHINE_NAME_ANNOTATION_FMT, CONTAINER_NAME), machineName);

    final Pod pod =
        new PodBuilder()
            .withNewMetadata()
            .withName(POD_NAME)
            .withAnnotations(annotations)
            .endMetadata()
            .withNewSpec()
            .withContainers(container.build())
            .endSpec()
            .build();

    return KubernetesEnvironment.builder(environment)
        .setMachines(environment.getMachines())
        .setInternalRecipe(environment.getRecipe())
        .setPods(ImmutableMap.of(machineName, pod))
        .build();
  }

