  @Transactional
  protected void doReplaceStatus(
      RuntimeIdentity identity, Predicate<WorkspaceStatus> predicate, WorkspaceStatus newStatus) {
    EntityManager entityManager = managerProvider.get();
    KubernetesRuntimeState existingState =
        entityManager.find(KubernetesRuntimeState.class, new RuntimeId(identity));

    if (!predicate.test(existingState.getStatus())) {
      throw new IllegalStateException("Runtime status doesn't match to the specified predicate");
    }

    existingState.setStatus(newStatus);
    entityManager.flush();
  }

